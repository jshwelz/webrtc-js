
/***
Copyright (c) 2013-2016, callstats.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats.js  version = 3.16.7 2016-10-27 */
!function(a){"use strict";var b=function(){function a(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function b(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function c(){var a=b();return a+Na.currentOffset}function d(){return window.performance.now?window.performance.now():null}function e(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){la=a})}function f(){return la?la.level:void 0}function g(){return la?la.charging:void 0}function h(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(a){ka=a})}function i(){xa||window.addEventListener("beforeunload",function(a){var b;for(b in La)La.hasOwnProperty(b)&&Kb(Ya.userLeft,null,b,La[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function j(a,b){setTimeout(function(){var b=c(),d=b-a.data.apiTS;a.data.timeShift=d,ea(a.channel,a.data,a.callback)},b)}function k(a,b,c,e,f){var g=Wb(c,e),h=null;g&&(h=d(),Kb(Ya.mediaPlaybackStartEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function l(a,b,c,e,f){var g=Wb(c,e),h=null;g&&(h=d(),Kb(Ya.mediaSuspendedEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function m(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=La[b].ucID;f.oncanplay=function(){k(g,a,b,d,e)},f.onsuspend=function(){l(g,a,b,d,e)}}}function n(a){var b=Ia.codebase,c=!1;if(null===a)c=!1;else if(b===pb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==Wa&&a instanceof Wa&&(c=!0),("function"==typeof a||b===pb.edge)&&(c=!0),void 0!==typeof a.createOffer&&(c=!0);return c}function o(a,b){var c;return a&&(b===pb.chrome?(c=a.googLocalAddress,c.concat(":",a.googRemoteAddress)):b===pb.firefox&&(c=a.localAddr,c.concat(":",a.remoteAddr))),Qb(c)}function p(){var a;return a=navigator.onLine===!0?"online":"offline"}function q(a,b){var c=qb.unknown,d=null;if(a&&a.data&&void 0!==a.data.mediaType)c=a.data.mediaType;else if(b===pb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=qb.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=qb.audio),d=a.data.googCodecName);else{if(b!==pb.firefox)return;void 0!==a&&void 0!==a.data.framerateMean&&(c=qb.video)}return Qa.hasOwnProperty(a.data.ssrc)&&(Qa[a.data.ssrc].mediaType=c,Qa[a.data.ssrc].codec=d),c}function r(a,b){var c;return b===pb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===pb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function s(a,b){var c="unavailable";if(b===pb.chrome){var d,e,f;d=r(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===pb.firefox;return c}function t(a,b){var c;return b===pb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(c=a.data.googFrameWidthSent):b===pb.firefox,c}function u(a){var b;return b=isNaN(a)||0>a?null:a}function v(a,b){var c;if(b===pb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=u(parseInt(a.data.googRtt,10))}else if(b===pb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=u(parseInt(a.data.mozRtt,10))}else if(b===pb.edge&&a&&a.data.roundTripTime)return c=u(parseInt(a.data.roundTripTime,10))}function w(a){var b=isNaN(a)?null:a;return b}function x(a,b){var c;if(b===pb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=w(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===pb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=w(parseInt(a.data.jitter,10))}function y(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function z(a,b,c){var d;return b===qb.audio?a<c.audio.gThreshold?d=fb.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=fb.fair:a>c.audio.rThreshold&&(d=fb.bad):b===qb.video&&(a<c.video.gThreshold?d=fb.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=fb.fair:a>c.video.rThreshold&&(d=fb.bad)),d}function A(a,b,c){var d;return b===qb.audio?a>c.audio.gThreshold?d=fb.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=fb.fair:a<c.audio.rThreshold&&(d=fb.bad):b===qb.video&&(a>c.video.gThreshold?d=fb.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=fb.fair:a<c.video.rThreshold&&(d=fb.bad)),d}function B(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===fb.excellent?b=gb.excellent:c===fb.fair?b=gb.fair:c===fb.bad&&(b=gb.bad)),b}function C(a,b,c){var d,e,f,g,h,i,j,k,l=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k=c-g,k>0&&(b[d].csioReceivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/k,b[d].csioSentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/k,b[d].csioIntBytesReceived=parseInt(b[d].bytesReceived,10)-i,b[d].csioIntBytesSent=parseInt(b[d].bytesSent,10)-j,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(b[d].csioSentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(k/1e3),b[d].csioIntPacketsSent=parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(b[d].csioReceivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(k/1e3),b[d].csioIntPacketsReceived=parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))),l.push(b[d]))}return l}function D(a,b,c,d){var e=[];return c===pb.firefox?e=null:c===pb.chrome&&(e=C(a,b,d)),e}function E(a){if(a=w(a),null!==a){var b=0>a?null:a;return b}}function F(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function G(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,u,x,C,D,G,H,J,K,L,M,N,O,P,Q=null,R=null,S=null,T=b.reportType,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=b.data,ca=I(c.streams,b.ssrc,"outbound",T);ca?(h=w(parseInt(ca.data.bytesSent,10)),i=a.lastStatsSent.apiTS,H=w(parseInt(ca.data.packetsSent,10)),K=w(parseInt(ca.data.packetsLost,10)),L=w(parseInt(ca.data.discardedPackets,10))):(h=0,i=e,K=0,H=0,L=0),k=e,C=k-i,m=q(b,d),n=s(b,d),o=r(b,d),p=t(b,d),l=v(b,d),j=w(parseInt(ba.bytesSent,10)),null!==j&&null!==h&&h>j&&(h=0,xb(qa,ra,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:f,ucID:g})),void 0!==ba.droppedFrames&&(M=E(parseInt(ba.droppedFrames,10)),null!==M&&null!==L&&L>M&&(L=0),null!==M&&null!==L&&(N=M-L)),J=E(parseInt(ba.packetsLost,10)),null!==J&&null!==K&&(R=J-K),G=E(parseInt(ba.packetsSent,10)),null!==G&&null!==H&&(D=G-H),void 0!==R&&void 0!==D&&D+R>0&&(S=R/(D+R)),C>0&&(null!==j&&null!==h&&(Q=8*(j-h)/C),void 0!==D&&(aa=D/(C/1e3)));var da=b.ssrc;a=F(a,da,"rttInfo",T,"outbound","rttArray",!0),a=F(a,da,"fractionalLossInfo",T,"outbound","fractionalLossArray",!0),a=F(a,da,"timeElapse",T,"outbound","totalTimeMs",!1),a=F(a,da,"frameWidthInfo",T,"outbound","frameWidthArray",!0),a=F(a,da,"frameRateInfo",T,"outbound","frameRateArray",!0),void 0!==l&&null!==l&&a.rttInfo.streams[da].outbound[T].rttArray.push(parseInt(l,10)),void 0!==S&&null!==S&&a.fractionalLossInfo.streams[da].outbound[T].fractionalLossArray.push(S),void 0!==o&&null!==o&&a.frameRateInfo.streams[da].outbound[T].frameRateArray.push(parseInt(o,10)),void 0!==p&&null!==p&&a.frameWidthInfo.streams[da].outbound[T].frameWidthArray.push(parseInt(p,10)),U=y(95,a.rttInfo.streams[da].outbound[T].rttArray),X=y(95,a.fractionalLossInfo.streams[da].outbound[T].fractionalLossArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[da].outbound[T].totalTimeMs=a.timeElapse.streams[da].outbound[T].totalTimeMs+C),a.timeElapse.streams[da].outbound[T].totalTimeMs>0&&null!==j&&(_=8*j/a.timeElapse.streams[da].outbound[T].totalTimeMs);var ea={csioIntMs:C,csioIntFL:S,csioIntPR:aa,csioIntBRKbps:Q,csioMediaType:m,csioSig2Latency:U,csioAvgBRKbps:_,csioTimeElapseMs:a.timeElapse.streams[da].outbound[T].totalTimeMs,csioRes:n,csioPercentileFl:X,csioIntFramesDropped:N};for(O in ba)ba.hasOwnProperty(O)&&(ea[O]=ba[O]);return m===qb.audio?(P=U+40,V=z(P,m,ob),W=A(Q,m,kb),u=B(V,W),ea.csioMark=u,ea.csioeM=P):m===qb.video&&(ea.csioPercentileFrameWidth=y(95,a.frameWidthInfo.streams[da].outbound[T].frameWidthArray),ea.csioPercentileFrameRate=y(95,a.frameRateInfo.streams[da].outbound[T].frameRateArray),x=parseInt(a.rttInfo.streams[da].outbound[T].frameRate,10),Y=A(o/x,m,lb),Z=z(l,m,mb),$=A(Q,m,kb),u=B(Y,Z,$),a.rttInfo.streams[da].outbound[T].frameRate=o,ea.csioMark=u),ea}function H(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,u,C,D,G,H,J,K,L,M,N,O,P,Q,R,S,T,U,V=null,W=null,X=b.reportType,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=b.data,ga=I(c.streams,b.ssrc,"inbound",X);ga?(h=w(parseInt(ga.data.bytesReceived,10)),l=w(parseInt(ga.data.packetsLost,10)),O=w(parseInt(ga.data.packetsReceived,10)),i=a.lastStatsSent.apiTS,Q=w(parseInt(ga.data.discardedPackets,10))):(h=0,i=e,l=0,O=0,Q=0),o=q(b,d),p=s(b,d),C=r(b,d),u=x(b,d),U=t(b,d),n=v(b,d),j=w(parseInt(fa.bytesReceived,10)),null!==j&&null!==h&&h>j&&(h=0,l=0,O=0,xb(qa,ra,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:f,ucID:g})),m=E(parseInt(fa.packetsLost,10)),null!==m&&null!==l&&(W=m-l),k=e,void 0!==fa.discardedPackets&&(P=E(parseInt(fa.discardedPackets,10)),null!==P&&null!==Q&&Q>P&&(Q=0),null!==P&&null!==Q&&(R=P-Q)),N=E(parseInt(fa.packetsReceived,10)),D=N-O,void 0!==W&&null!==D&&D+W>0&&(Z=W/(D+W)),M=k-i,M>0&&(null!==j&&null!==h&&(V=8*(j-h)/M),null!==D&&(Y=D/(M/1e3)));var ha=b.ssrc;a=F(a,ha,"rttInfo",X,"inbound","rttArray",!0),a=F(a,ha,"timeElapse",X,"inbound","totalTimeMs",!1),a=F(a,ha,"jitterInfo",X,"inbound","jitterArray",!0),a=F(a,ha,"fractionalLossInfo",X,"inbound","fractionalLossArray",!0),a=F(a,ha,"frameWidthInfo",X,"inbound","frameWidthArray",!0),a=F(a,ha,"frameRateInfo",X,"inbound","frameRateArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[ha].inbound[X].rttArray.push(parseInt(n,10)),void 0!==u&&null!==u&&a.jitterInfo.streams[ha].inbound[X].jitterArray.push(parseInt(u,10)),void 0!==Z&&null!==Z&&a.fractionalLossInfo.streams[ha].inbound[X].fractionalLossArray.push(Z),void 0!==C&&null!==C&&a.frameRateInfo.streams[ha].inbound[X].frameRateArray.push(parseInt(C,10)),void 0!==U&&null!==U&&a.frameWidthInfo.streams[ha].inbound[X].frameWidthArray.push(parseInt(U,10)),$=y(95,a.rttInfo.streams[ha].inbound[X].rttArray),_=y(95,a.jitterInfo.streams[ha].inbound[X].jitterArray),aa=y(95,a.fractionalLossInfo.streams[ha].inbound[X].fractionalLossArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[ha].inbound[X].totalTimeMs=a.timeElapse.streams[ha].inbound[X].totalTimeMs+M),null!==j&&a.timeElapse.streams[ha].inbound[X].totalTimeMs>0&&(ea=8*j/a.timeElapse.streams[ha].inbound[X].totalTimeMs);var ia={csioIntMs:M,csioIntFL:Z,csioIntPR:Y,csioIntBRKbps:V,csioSig2Latency:$,csioAvgBRKbps:ea,csioMediaType:o,csioTimeElapseMs:a.timeElapse.streams[ha].inbound[X].totalTimeMs,csioIntPktRcv:D,csioIntPktLoss:W,csioPercentileJitter:_,csioRes:p,csioPercentileFl:aa,csioIntPktDiscarded:R};for(S in fa)fa.hasOwnProperty(S)&&(ia[S]=fa[S]);return o===qb.audio?(T=$+40,ba=z(T,o,ob),ca=z(Z,o,nb),da=A(V,o,kb),G=B(ba,ca,da),ia.csioMark=G,ia.csioeM=T):o===qb.video&&(ia.csioPercentileFrameRate=y(95,a.frameRateInfo.streams[ha].inbound[X].frameRateArray),ia.csioPercentileFrameWidth=y(95,a.frameWidthInfo.streams[ha].inbound[X].frameWidthArray),H=a.rttInfo.streams[ha].inbound[X].frameRate,J=A(C/H,o,lb),K=z(n,o,mb),L=A(V,o,kb),G=B(J,K,L),a.rttInfo.streams[ha].inbound[X].frameRate=C,ia.csioMark=G),ia}function I(a,b,c,d){var e=a.filter(function(a){return a.ssrc===b&&a.streamType===c&&a.reportType===d});return e.length>0?e[0]:null}function J(a,b,c,d,e,f){var g={streams:[]};g.fabricState=a.pcState,g.connectionState=p();var h=null;return h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:[]},b.streams.forEach(function(b){var i={cname:b.cname,usage:b.usage,msid:b.msid,userID:b.userID,associatedVideoTag:b.associatedVideoTag,ssrc:b.ssrc,streamType:b.streamType,reportType:b.reportType};"inbound"===b.streamType?i.data=H(a,b,h,c,d,e,f):i.data=G(a,b,h,c,d,e,f),g.streams.push(i)}),g}function K(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===gb.bad?a.streams[b].inbound[d].mark=2:c===gb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===gb.bad?a.streams[b].outbound[d].mark=2:c===gb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function L(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function M(a){var b={},c=Ac.getConferenceURL();return a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),c&&(b.conferenceURL=c),b.streams={},a.streams.forEach(function(a){var c={cname:a.cname,ssrc:a.ssrc,msid:a.msid,remoteUserID:a.userID,usageLabel:a.usage,associatedVideoTag:a.associatedVideoTag};"inbound"===a.streamType?(a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel)):(a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel)),b.streams[a.ssrc]=c}),b}function N(a,b,d,e,f,g){var h=c();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&!Oa?(ea(Za.processedStats,a,g),b.latestEventSent=h,b.lastFabricState=b.pcState):(a.clockUnsynced=Oa,Fb({channel:Za.processedStats,data:a}),a.hasOwnProperty("token")||Ha.sendAuthenticationRequest(qa,f))}function O(a,d,e,h,i,j,k){function l(l){var m=c(),n=b();void 0===j.lastRawStatsSentInterval||null===j.lastRawStatsSentInterval?j.lastRawStatsSentInterval=n-j.statsPollingStart:j.lastRawStatsSentInterval=n-j.rawstatsTS+j.lastRawStatsSentInterval,void 0===j.lastProcessedStatsSentInterval||null===j.lastProcessedStatsSentInterval?j.lastProcessedStatsSentInterval=n-j.statsPollingStart:j.lastProcessedStatsSentInterval=n-j.rawstatsTS+j.lastProcessedStatsSentInterval,j.rawstatsTS=n;var p={},q=Ia.codebase;p.version=pa,p.appID=qa,p.conferenceID=encodeURIComponent(h),p.apiTS=m,p.timeShift=0,p.fabricState=j.pcState,p.pcID=j.pcHash,void 0!==i&&(p.ucID=i),Ha.authToken?p.token=Ha.authToken:Ha.sendAuthenticationRequest(qa,d),p.localID=encodeURIComponent(d),p.remoteID=encodeURIComponent(e),p.deviceID=wa;var r,s,t,u,v,w,x,y={streams:[]},z=null,A=!1,B=!1,C={},E={};for(z=Zb(l),r=0;r<z.length;++r)if(s=T(z[r]),t=Q(JSON.parse(s),q),!U(t))if(t.hasOwnProperty("Transport"))u="Transport",y.hasOwnProperty(u)||(y[u]=[]),q!==pb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(y[u].push(t[u]),"true"===t[u].googActiveConnection&&(p.activeConnectionIndex=y[u].length)):(y[u].push(t[u]),"true"===t[u].selected&&(p.activeConnectionIndex=y[u].length));else if(t.hasOwnProperty("localCandidate"))C[t.localCandidate.id]=t.localCandidate;else if(t.hasOwnProperty("remoteCandidate"))E[t.remoteCandidate.id]=t.remoteCandidate;else if(t.hasOwnProperty("bwe"))y.bwe=t.bwe;else{w=Hb(t.ssrc),void 0!==w&&w.localStartTime||(x=Jb(e,h,i,j,k,null),x&&(B=!0),w=Hb(t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=e);var F={userID:v,data:t.data,reportType:t.reportType,streamType:t.streamType,ssrc:t.ssrc};void 0!==w&&(F.cname=w.cname,F.msid=w.msid,F.associatedVideoTag=w.associatedVideoTag,F.usage=w.usageLabel),y.streams.push(F)}q===pb.firefox&&(y.Transport=L(y.Transport,C,E));var G;if(y.Transport)for(G=0;G<y.Transport.length;G++)y.Transport[G].hash=o(y.Transport[G],q);p.statistics=y,y.Transport&&(A=S(y.Transport,j)),A&&cc(k,Ya.updatedConfiguration,h),j.pcState===hb.disrupted&&X(p);var H=J(j,y,q,m,h,i);if(y.Transport&&(H.Transport=D(j,y.Transport,q,m)),y.bwe&&(H.bwe=y.bwe),void 0===j.processedStatsTupleArray&&(j.processedStatsTupleArray=[]),ma){var I=M(H);ma(I)}H.apiTS=m,H.batteryStatus={},H.batteryStatus.batteryLevel=f(),H.batteryStatus.isBatteryCharging=g(),H=K(H),j.processedStatsTupleArray.push(H),p.processedStatistics=j.processedStatsTupleArray,j.lastStatsSent=p;var O=ga(p),P=ga(p);delete O.processedStatistics,delete P.statistics,B&&Kb(Ya.ssrcMap,e,h,i,Ib(),j.pcHash),(j.lastProcessedStatsSentInterval>=Aa||j.initialPhaseOver)&&(j.processedStatsTupleArray=[],N(P,j,h,e,d,a),j.lastProcessedStatsSentInterval=0)}return l}function P(a){var b;return ib.hasOwnProperty(a)?a===ib.createOffer||a===ib.createAnswer||a===ib.setRemoteDescription?b=jb.negotiationFailure:a===ib.setLocalDescription?b=jb.sdpError:a===ib.addIceCandidate?b=jb.sdpError:a===ib.getUserMedia?b=jb.mediaConfigError:a===ib.iceConnectionFailure?b=jb.iceFailure:a===ib.signalingError?b=jb.signalingError:(a===ib.applicationLog||ib.applicationError)&&(b=jb.applicationLog):b=yb.invalidWebRTCFunctionName,b}function Q(a,b){var c={};return b===pb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inboundrtp"===a.type?"inbound":"outbound",c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===pb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.streamType="outbound":c.streamType="inbound",c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type?c.remoteCandidate=a:"VideoBwe"===a.type&&(c.bwe=a):b===pb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inbound-rtp"===a.type?"inbound":"outbound",c.data=a,c.reportType="local"):"transport"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a)),c}function R(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function S(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=R(b)),!0):!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function T(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function U(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function V(a){return{magicKey:a,statsSubmissionInterval:Ca,endpoint:Ka,localUserIDObject:sa}}function W(a,b,c){var d=La[a];void 0===d&&(La[a]={},La[a].participants=null,c&&(La[a].userJoinedSent=!0),b&&(La[a].refreshPresence=b))}function X(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function Y(a){return clearInterval(a),null}function Z(){var a;for(a in La)La.hasOwnProperty(a)&&(La[a].refreshPresence=Y(La[a].refreshPresence),delete La[a].refreshPresence);ia()}function $(a){var b=La[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function _(a,b){var c=La[a],d=[];if(void 0===c)d.push(b),La[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function aa(a){var b=!1;if(!La[a])return{conferenceFinished:b,ucID:null};var c=La[a].ucID;return 0===La[a].participants.length&&(Y(La[a].refreshPresence),ia(),Db(),delete La[a],b=!0),{conferenceFinished:b,ucID:c}}function ba(a,b){Kb(Ya.userLeft,null,a,b,null,null,null),Sa=Y(Sa),ia(),Ra=Cb,Cb=null}function ca(){var a,b=function(a){return setInterval(function(){Mb(a)},Ea)};for(a in La)La.hasOwnProperty(a)&&(Mb(a),La[a].refreshPresence=b(a));ja()}function da(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ea(a,b,c){var d=b.action;b.channel=a,Ha._isTokenValid(Ha.authToken,qa,ra)?Oa&&-1===rb.indexOf(d)?(b.clockUnsynced=Oa,Fb({channel:a,data:b,callback:c})):(b.token=Ha.authToken,Bc(a,b,c),c&&c(_a.success,d+" sent to the backend.")):Ha.sendAuthenticationRequest(qa,ra,function(e,f){e!==_a.success?(e===ab.authOngoing&&(b.clockUnsynced=Oa,Fb({channel:a,data:b,callback:c})),c&&e!==ab.authOngoing&&c(e,f)):e===_a.success&&"SDK authentication successful."===f&&(Oa&&-1===rb.indexOf(d)?(b.clockUnsynced=Oa,Fb({channel:a,data:b,callback:c})):(b.token=Ha.authToken,Bc(a,b,c),c&&c(_a.success,d+" sent to the backend.")))})}function fa(a){a&&a(ab.authOngoing,null)}function ga(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=ga(a[b]));return c}function ha(){var a={};Object.keys(La).forEach(function(b){var c=La[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:Ha.tokenData?!0:!1,clockSync:!Oa,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:pa};b.wsStatus=Ac.getWSConnectionState(),xb(qa,ra,"stateMachine",b)}function ia(){Ta||(Ta=setInterval(function(){ha()},Ua))}function ja(){Y(Ta),Ta=null}var ka,la,ma,na="https://collector.callstats.io:443/",oa="https://auth.callstats.io/",pa="3.16.7",qa=null,ra=null,sa=null,ta="wss://collector.callstats.io:443/csiows/collectCallStats",ua="https://dashboard.callstats.io/apps/",va="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",wa=null,xa=!1,ya=!1,za=3e4,Aa=1e4,Ba=2e4,Ca=15e3,Da=!1,Ea=1e4,Fa=5e3,Ga=function(){var a=this,b="urn:x-callstats:auth:errorActions",d=.9,e=3600;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var f=null,g=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};m.cryptotype=null,window.crypto&&window.crypto.subtle?(m.cryptotype="standard",m.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(m.cryptotype="webkit",m.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(m.cryptotype="ie",m.subtlecrypto=window.msCrypto.subtle):(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));for(var e=k(a)+"."+k(b),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);var i=function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;f>g;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)},j=function(a){return d(a)},l={name:"HMAC"};("ie"===m.cryptotype||"webkit"===m.cryptotype)&&(l.hash={name:"sha-256"});var n=m.subtlecrypto.sign(l,c,g);"ie"===m.cryptotype?(n.onerror=j,n.oncomplete=function(a){i(a.target.result)}):n.then(i)["catch"](j)},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(b){return null}},m.importKey=function(a,b,c){if("webkit"===m.cryptotype)for(;a.length<32;)a+="\x00";var d={kty:"oct",k:k(a),alg:"HS256"},e={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===m.cryptotype?d.extractable=!1:d.ext=!1,"webkit"===m.cryptotype&&(e=null,d.use="sig"),"ie"===m.cryptotype||"webkit"===m.cryptotype){var f=JSON.stringify(d);d=new Uint8Array(f.length);for(var g=0;g<f.length;g++)d[g]=f.charCodeAt(g)}var h=m.subtlecrypto.importKey("jwk",d,e,!1,["sign"]);"ie"===m.cryptotype?(h.onerror=c,h.oncomplete=function(a){b(a.target.result)}):h.then(b)["catch"](c)},this._isTokenValid=function(a,b,d){var e=!1;if(null===a)return!1;try{var f=m.decode(a);if(null!==f&&f.appID===b&&f.userID===encodeURIComponent(d)){var g=null;if(navigator.mozGetUserMedia){var h=f.expiry.split(" ").join("T");g=Date.parse(h)}else g=new Date(f.expiry);var i=new Date(c());g>i&&(e=!0)}return e}catch(j){}return!1},this.setupAuthToken=function(a){sb("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),Ca=parseInt(this.tokenData.submissionInterval,10),Da=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(c,e,g){if(c&&e){if(a.authInProgress)return void fa(g);null!==f&&(clearTimeout(f),f=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(_a.tokenGenerationError,i.toString()));var k=oa+"authenticate",l={client_id:e+"@"+qa,code:j,grant_type:"authorization_code"};vc(k,l,function(i){var j=null;a.authInProgress=!1;try{j=JSON.parse(i.response)}catch(k){}if(!j)return void(f=setTimeout(a.sendAuthenticationRequest,Fa,c,e,g));if(200===i.status){if("bearer"!==j.token_type)return void(f=setTimeout(a.sendAuthenticationRequest,Fa,c,e,g));a.setupAuthToken(j.access_token);var l=parseInt(1e3*parseInt(j.expires_in)*d);o(l,c,e,g),h=!1,g&&g(_a.success,"SDK authentication successful."),Ac._isChannelReady()?(Eb(),g&&g(_a.success,"WebSocket establishment successful.")):Ac._setupWebSocketConnection(function(a,b){void 0!==g&&g(a,b)})}else{if(j[b]&&j[b].length>0)return p(c,e,g,j[b]);f=setTimeout(a.sendAuthenticationRequest,Fa,c,e,g)}})})}};var n=function(){null!==g&&(clearTimeout(g),g=null)},o=function(b,c,d,e){n(),g=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===zb.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===zb.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===zb.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var d=null,f=null,g=!1,h=null;b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]);var i=function(a){b=null,d=a},j=function(a){g=!0,b=null};return m.importKey(b,i,j),function(b,i){if(g)return i("appsecret based token generation failed");if(!b&&null!==f)return i(null,f);if(null===d)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:ra,appID:qa,exp:parseInt(c()/1e3)+e,nbf:parseInt(c()/1e3)-e};h&&(j.keyID=h),m.sign({alg:"HS256"},j,d,function(a,b){return a?i(a):(f=b,i(null,b))})}}},Ha=new Ga,Ia=detectBrowserInfo(),Ja=measureAppLoadingPerformance(Ia),Ka={type:"browser",name:Ia.name,ver:Ia.ver,os:Ia.os,osVersion:Ia.osVersion,userAgent:Ia.userAgent},La={},Ma={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},Na={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Oa=!0,Pa=[],Qa={},Ra=null,Sa=null,Ta=null,Ua=2e4,Va=100,Wa=null;"Firefox"===Ia.name?Wa=mozRTCPeerConnection:"Chrome"===Ia.name||"Opera"===Ia.name?Wa=webkitRTCPeerConnection:"Safari"===Ia.name||"Edge"===Ia.name&&(Wa=window.RTCPeerConnection);var Xa={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},Ya={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},Za={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},$a={success:"success",failure:"failure"},_a={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",
appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},ab={authOngoing:"authOngoing"},bb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},cb={local:"local",remote:"remote"},db={excellent:5,good:4,fair:3,poor:2,bad:1},eb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},fb={excellent:3,fair:2,bad:1},gb={excellent:"excellent",fair:"fair",bad:"bad"},hb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},ib={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},jb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},kb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},lb={video:{gThreshold:.8,rThreshold:.3}},mb={video:{gThreshold:400,rThreshold:1e3}},nb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},ob={audio:{gThreshold:240,rThreshold:400}},pb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},qb={unknown:"unknown",audio:"audio",video:"video"},rb=[Ya.userJoined,Ya.refreshPresence,Xa.fabricSetupFailed,Xa.applicationErrorLog],sb=function(a,b){window&&window.localStorage&&window.localStorage.setItem(a,b)},tb=function(a){return window&&window.localStorage?window.localStorage.getItem(a):null},ub=function(a){window&&window.localStorage&&window.localStorage.removeItem(a)},vb=function(a,c){var d=null,e=null,f=null,g=new XMLHttpRequest;g&&(g.open("GET",encodeURI(a)),d=b(),g.onload=function(){e=b(),f=e-d,c(g,f)},g.send())},wb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},xb=function(a,b,c,d){var e=na+"generics",f={appID:a,userID:encodeURIComponent(b),version:pa,eventType:c,data:d};wb(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:pa,eventType:"error",message:a.message,pageURL:window.location.href};for(b in La)La.hasOwnProperty(b)&&(d.conferenceID=b,xb(qa,ra,"onErrorLog",d),c=!0);c||xb(qa,ra,"onErrorLog",d)}});var yb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},zb={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Ab="fabricSetupFailed error reported by the developer",Bb="Connectivity Failure",Cb=a(),Db=function(a,b,d,e){if(!Ha.authToken)return void Ha.sendAuthenticationRequest(qa,ra);if(!Oa){var f,g,h,i,k=c(),l=[],m=Math.max(Ca/Pa.length,Va);for(f=0;f<Pa.length;f++)if(h=Pa[f],h.data.action!==Ya.userJoined){if(h.data.token=Ha.authToken,a&&h.data.apiTS>=k-b||!h.data.ucID)if(i=decodeURIComponent(h.data.conferenceID),La[i]&&La[i].ucID)h.data.ucID=La[i].ucID;else{if(i!==d){l.push(Pa[f]);continue}h.data.ucID=e}if(h.data.clockUnsynced&&(h.data.apiTS+=Na.currentOffset),h.channel===Za.processedStats&&h.data.clockUnsynced&&h.data.processedStatistics&&h.data.processedStatistics.length>0)for(g=0;g<h.data.processedStatistics.length;g++)h.data.processedStatistics[g].apiTS+=Na.currentOffset;delete h.data.clockUnsynced,j(h,m*(f+1))}else l.push(Pa[f]);Pa=l}},Eb=function(){if(!Ha.authToken)return void Ha.sendAuthenticationRequest(qa,ra);var a,b,c=[],d=Math.max(Ca/Pa.length,Va);for(a=0;a<Pa.length;a++)b=Pa[a],b.data.action===Ya.userJoined||b.data.action===Xa.fabricSetupFailed?(b.data.token=Ha.authToken,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+Na.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Ca),j(b,d*(a+1))):c.push(Pa[a]);Pa=c},Fb=function(a){Pa.push(a)},Gb=function(a,d){var e=RegExp.prototype.test.bind(/^([a-z])=(.*)/),f=/^ssrc:(\d*) ([\w_]*):(.*)/,g=/^ssrc-group:SIM (\d*)/;a.split(/(\r\n|\r|\n)/).filter(e).forEach(function(a){var e=a[0],h=a.slice(2);if("a"===e){if(f.test(h)){var i=h.match(f),j=i[1];void 0===Qa[j]&&(Qa[j]={}),Qa[j][i[2]]=i[3],Qa[j].localStartTime=b(),Qa[j].syncedStartTime=c(),Qa[j].streamType=d}g.test(h)&&(void 0===Qa.ssrcGroup&&(Qa.ssrcGroup={},Qa.ssrcGroup[d]={}),Qa.ssrcGroup[d].simulcastGroup=h.match(/\d+/g))}})},Hb=function(a){return Qa[a]},Ib=function(){return Qa},Jb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Gb(g,eb.outbound),Gb(h,eb.inbound),Da){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Lb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Kb=function(a,b,d,e,f,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=c(),j={version:pa,apiTS:i,action:a,localID:encodeURIComponent(ra),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(d),timeShift:0,appID:qa,ucID:e,pcID:g,deviceID:wa,value:f};return null===b&&(j.remoteID=null),null===d?void xb(qa,ra,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(e&&!Oa||a===Ya.userJoined||a===Xa.fabricSetupFailed||a===Ya.refreshPresence?(j.token=Ha.authToken,ea(Za.callStatsEvent,j,h)):(j.clockUnsynced=Oa,a!==Ya.fabricStatsCaching&&a!==Ya.refreshPresence&&Fb({channel:Za.callStatsEvent,data:j,callback:h})))},Lb=function(a,b,d,e,f,g){var h=c(),i={version:pa,appID:qa,conferenceID:encodeURIComponent(b),ucID:d,apiTS:h,localID:encodeURIComponent(ra),remoteID:encodeURIComponent(a),pcID:f,deviceID:wa,sdpPayload:e};Ha.authToken&&d&&!Oa?(i.token=Ha.authToken,ea(Za.sdpSubmission,i,g)):(i.clockUnsynced=Oa,Fb({channel:Za.sdpSubmission,data:i,callback:g}))},Mb=function(a){var b={ucID:La[a].ucID,magicKey:Cb,endpoint:Ka,fabricState:{},connectedDevices:ka},c=La[a];if(ka||h(),c&&c.participants){var d,e=c.participants,f=0;for(f=0;f<e.length;f++)d=e[f],b.fabricState[f]={pc:d.pcHash,userId:d.remoteUserID,pcState:d.pcState,iceConnectionState:d.pc.iceConnectionState,iceGatheringState:d.pc.iceGatheringState,iceCandidatesNumber:d.iceCandidates.length,numNegotiationNeededCalls:d.numNegotiationNeededCalls}}Oa||(b.clockSyncOffset=Na.currentOffset),Kb(Ya.refreshPresence,null,a,La[a].ucID,b,null)},Nb=function(){var a={appID:qa,userID:encodeURIComponent(ra),version:pa,endpoint:Ka,pagePerf:Ja,endpointID:wa,action:"registerPresence",channel:Za.registerPresence};-1!==qa&&Ha.authToken&&(a.token=Ha.authToken,Bc(Za.registerPresence,"registerPresence",a))},Ob=function(){var a=tb("feedback"),b=JSON.parse(tb("csio_auth_data"));if(a&&b){var c=JSON.parse(a);if(!c)return;var d=b===c.token?!0:!1;d||ra!==c.userID||(c.token=b,d=!0),d?ea(Za.userFeedback,c):ub("feedback")}},Pb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Qb=function(a,b){var c,d,e,f=0;for(c=0,e=a.length;e>c;c++)d=a.charCodeAt(c),f=(f<<5)-f+d,f|=0;return b&&b(f),f},Rb=function(a,c,d,e,f,g){if(!a||!d||!c)return console.error("initialize: Argument missing/invalid"),Pb($a.failure,"initialize: Argument missing/invalid");if("function"!=typeof c){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle))return e(_a.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Pb($a.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");c=Ha.appSecretTokenGenerator(c)}if("string"==typeof a&&(a=parseInt(a,10)),qa=a,"object"==typeof d?(ra=d.aliasName,sa=d):ra=d,xb(qa,ra,"log",{msg:"callstats initialize in progress"}),Ha.tokenGenerator=c,tb("csio_auth_data"))try{var j=JSON.parse(tb("csio_auth_data"));Ha._isTokenValid(j,qa,ra)&&(e&&e(_a.success,"SDK authentication successful."),Ha.setupAuthToken(j),Ac._isChannelReady()||Ac._setupWebSocketConnection(e))}catch(k){}if(g&&(g.disableBeforeUnloadHandler===!0&&(xa=!0),(null!==g.applicationVersion||void 0!==g.applicationVersion)&&(Ka.appVer=g.applicationVersion)),i(),wa=tb("endpointID"),null===wa){var l=b(),m=Math.random()*l;jc(m.toString(),function(a){wa=a,sb("endpointID",wa)})}return h(),ma=f,Ha.sendAuthenticationRequest(qa,ra,e),Pb($a.success)},Sb=function(a){return function(b){return b.remoteUserID===a?!0:void 0}},Tb=function(a,b){var c=!1,d=null;return La[a]&&La[a].participants&&(d=La[a].participants.filter(Sb(b))),c=d&&d.length>0?!0:!1},Ub=function(a){return function(b){return b.pc===a?!0:a.callstatsID&&b.pcHash===a.callstatsID?!0:void 0}},Vb=function(a,b){var c=null,d=null;return La[a]&&La[a].participants&&(d=La[a].participants.filter(Ub(b))),c=d&&d.length>0?d[0]:null},Wb=function(a,b){var c=null,d=null;return c=Vb(a,b),c&&(d=c.pcHash),d},Xb=function(a){var b=null,c=null,d=null;for(b in La)if(La.hasOwnProperty(b)&&(d=Vb(b,a))){c={fabric:d,conferenceID:b};break}return c},Yb=function(a,b){var c=0;if(a&&La[b].participants)for(c=0;c<La[b].participants.length;c++)if(La[b].participants[c].pcHash===a.pcHash){La[b].participants.splice(c,1);break}},Zb=function(a){var b=Ia.codebase,c=null,d=0;if(b===pb.firefox&&"Safari"!==Ia.name)c=[],a.forEach(function(a){c.push(a)});else if(b===pb.chrome&&"Safari"!==Ia.name)c=a.result();else{c=[];for(d in a)a.hasOwnProperty(d)&&c.push(a[d])}return c},$b=function(a){var b=null,c=null,d=null,e=[],f=[],g=0,h=Ia.codebase;for(b=Zb(a),g=0;g<b.length;++g)c=T(b[g]),d=Q(JSON.parse(c),h),d.hasOwnProperty("localCandidate")?e.push(d.localCandidate):d.hasOwnProperty("remoteCandidate")&&f.push(d.localCandidate);return{localCandidates:e,remoteCandidates:f}},_b=function(a){function b(b){var c={};c=$b(b),a(c.localIceCandidates,c.remoteCandidates)}return b},ac=function(a,b,c,d,e,f,g,h){var i=Ia.codebase,j=Ia.name;i===pb.firefox||"Safari"===j?a.getStats(null,c(b,d,e,f,g,h,a),function(a){xb(qa,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})}):i===pb.chrome?a.getStats(c(b,d,e,f,g,h,a)):i===pb.edge&&a.getStats().then(c(b,d,e,f,g,h,a))["catch"](function(a){xb(qa,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})})},bc=function(a,b){ac(a,b,_b)},cc=function(a,c,d,e){if(!a||!c||!d)return console.error("sendFabricEvent: Arguments missing/Invalid"),Pb($a.failure,"sendFabricEvent: Arguments missing/Invalid");if(!qa||!ra||!La[d])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Pb($a.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(c===Xa.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Pb($a.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!n(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Pb($a.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!Xa.hasOwnProperty(c)&&!Ya.hasOwnProperty(c))return console.error("sendFabricEvent: Invalid fabricEvents value: ",c),Pb($a.failure,"sendFabricEvent: Invalid fabricEvents value: "+c);var f=null,g=null,h=b(),i=La[d],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Pb($a.failure,"sendFabricEvent: Conference ID not found!");if(j=Vb(d,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Pb($a.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(!(c===Xa.fabricSetup||c===Ya.autoFabricSetup&&j.fabricSetupSent)){if(c===Ya.autoFabricSetup){var l=h-j.startTime;if(f={setupDelay:l,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.iceCandidates&&0===j.iceCandidates.length)return void bc(a,function(a,b){f.localCandidates=a,f.remoteCandidates=b,j.localCandidates=a,j.remoteCandidates=b,j.pcState=hb.established,j.fabricSetupSent=!0,Kb(c,g,d,i.ucID,f,j.pcHash,j.pcCallback)});j.pcState=hb.established,j.fabricSetupSent=!0}else if(c===Ya.autoFabricSetupFailed)f={failureDelay:j.setupFailureTime,reason:jb.iceFailure,domError:Bb};else if(c===Ya.fabricDisrupted)f={disruptionDelay:j.connectivityIceStatusDelay};else if(c===Ya.updatedConfiguration)f=j.transportData;else if(c===Xa.fabricSetupFailed){var m=h-k;f={failureDelay:m,reason:jb.iceFailure,domError:Ab,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":ib.iceConnectionFailure,magicKey:Cb,endpoint:Ka}}else if(c===Xa.activeDeviceList){if(!e||!e.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Pb($a.failure,"sendFabricEvent: Arguments missing/Invalid");f={magicKey:Cb,endpoint:Ka,activeDevicelist:e.deviceList}}if(Kb(c,g,d,i.ucID,f,j.pcHash,j.pcCallback),(c===Xa.fabricTerminated||c===Ya.autoFabricSetupFailed||c===Xa.fabricSetupFailed)&&La[d].participants){j&&(j.statsInterval=Y(j.statsInterval),Yb(j,d));var o=aa(d);o.conferenceFinished&&ba(d,o.ucID)}if((c===Xa.fabricSetup||c===Xa.fabricUsageEvent)&&!j.fabricUsageSent){var p=j.fabricUsage;j.fabricUsageSent=!0,Kb(Xa.fabricUsageEvent,g,d,i.ucID,p,j.pcHash,null)}return Pb($a.success)}},dc=function(a){return a.length>Ba&&(console.log("Log exceeds 20kb, It will be truncated"),a=a.substring(0,Ba)),a},ec=function(a){return a&&"string"==typeof a?a=dc(a):a&&"object"==typeof a&&a.hasOwnProperty("message")&&(a.message=dc(a.message)),a},fc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},gc=function(c,d,e,f,g,h){if(void 0===c||!e||!d)return console.error("reportError: Arguments missing/invalid"),Pb($a.error,"reportError: Arguments missing/invalid");if(!qa||!ra)return console.error("reportError: SDK is not initialized"),Pb($a.error,"reportError: SDK is not initialized");if(!ib.hasOwnProperty(e))return console.error("reportError: Invalid webRTC functionName value: %o",e),Pb($a.error,"reportError: Invalid webRTC functionName value: "+e);void 0===f&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=b(),m=La[d],o=null;if(i=P(e),f&&f instanceof DOMException)f={message:f.message,name:f.name};else if(f&&"object"==typeof f){var p={};f.hasOwnProperty("message")&&(p.message=f.message),f.hasOwnProperty("name")&&(p.name=f.name),f.hasOwnProperty("constraintName")&&(p.constraintName=f.constraintName),f.hasOwnProperty("stack")&&(p.stack=f.stack),f=p}if(f=ec(f),n(c)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Pb($a.error,"reportError: Conference ID not found!");if(o=Vb(d,c),null===o)return console.error("reportError: Invalid pcObject passed as argument"),Pb($a.error,"reportError: Invalid pcObject passed as argument");k=o.remoteUserID;var q=o.startTime,r=l-q;if(j={failureDelay:r,reason:i,domError:f,fabricState:o.pcState,iceConnectionState:o.pc.iceConnectionState,"function":e,magicKey:Cb,endpoint:Ka},e===ib.applicationLog||e===ib.applicationError?Kb(Xa.applicationErrorLog,k,d,m.ucID,j,o.pcHash,o.pcCallback):Kb(Xa.fabricSetupFailed,k,d,m.ucID,j,o.pcHash,o.pcCallback),g||h||c&&c.localDescription||c&&c.remoteDescription){var s={sdp:{}};s.sdp.localSDP=fc(c,g,"localDescription"),s.sdp.remoteSDP=fc(c,h,"remoteDescription"),Lb(k,d,m.ucID,s,o.pcHash)}}else{null===Cb&&(Cb=a());var t=a();j={failureDelay:0,reason:i,domError:f,"function":e,magicKey:Cb,endpoint:Ka},e===ib.applicationLog||e===ib.applicationError?Kb(Xa.applicationErrorLog,k,d,null,j,null,null):Kb(Xa.fabricSetupFailed,k,d,null,j,t,null)}return Pb($a.success)},hc=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b[b.length]=d:d>127&&2048>d?(b[b.length]=d>>6|192,b[b.length]=63&d|128):(b[b.length]=d>>12|224,b[b.length]=d>>6&63|128,b[b.length]=63&d|128)}return new Uint8Array(b).buffer},ic=function(a){for(var b,c=new DataView(a),d="",e=0;e<c.byteLength;e++)b=c.getUint8(e).toString(16),b.length<2&&(b="0"+b),d+=b;return d},jc=function(a,b){var c={name:"SHA-256"};if(window.crypto){var d=window.crypto.subtle||window.crypto.webkitSubtle;if(!d)return void Qb(a,b);d.digest(c,hc(a)).then(function(a){b(ic(a))})["catch"](function(){Qb(a,b)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Qb(a,b);var e=window.msCrypto.subtle.digest(c,hc(a));e.oncomplete=function(a){a.target&&b(ic(a.target.result))},e.onerror=function(){Qb(a,b)}}else Qb(a,b)},kc=function(a,b,c){var d;if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Pb($a.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Pb($a.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Pb($a.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Pb($a.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var e=La[a],f=null;void 0!==e&&void 0!==e.ucID&&(f=e.ucID);var g=null;if(g=null===Cb?Ra:Cb,null===f&&(f=da(a)),null===f)return console.error("sendUserFeedback: ucID unavailable"),Pb($a.error,"sendUserFeedback: ucID unavailable");d="object"==typeof b.userID?b.userID.aliasName:b.userID;var h={conferenceID:encodeURIComponent(a),magicKey:g,appID:qa,version:pa,ucID:f,userID:encodeURIComponent(d),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?h.userQoe.video=b.video:h.userQoe.video=-1,b.hasOwnProperty("audio")?h.userQoe.audio=b.audio:h.userQoe.audio=-1,b.hasOwnProperty("screen")?h.userQoe.screen=b.screen:h.userQoe.screen=-1,b.hasOwnProperty("comment")?h.userQoe.comment=b.comment:h.userQoe.comment=-1,Ha.authToken&&!Oa?(h.token=Ha.authToken,sb("feedback",JSON.stringify(h)),ea(Za.userFeedback,h,c)):(h.clockUnsynced=Oa,Fb({channel:Za.userFeedback,data:h,callback:c})),Pb($a.success)},lc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Pb($a.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Pb($a.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!n(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Pb($a.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=La[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Pb($a.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=Vb(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Pb($a.error,"associateMstWithUserID: Unknown pcObject passed");var j=Hb(d);return void 0===j&&(Qa[d]={},j=Hb(d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==ra&&m(g,c,f,a,d),Pb($a.success)},mc=function(c,d,e,f,g){var h=null,i={authStatus:Ha.tokenData?!0:!1,clockSync:!Oa,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:f,version:pa};if(xb(qa,ra,"stateMachine",i),h="object"==typeof d?d.aliasName:d,!(c&&h&&e&&f))return console.error("addNewFabric: Arguments missing/Invalid"),Pb($a.error,"addNewFabric: Arguments missing/Invalid");if(!qa||!ra)return console.error("addNewFabric: SDK not initialized."),Pb($a.error,"addNewFabric: SDK not initialized");if(""===f||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Pb($a.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!n(c))return console.error("addNewFabric: Invalid PeerConnection object passed"),Pb($a.error,"addNewFabric: Invalid PeerConnection object passed");if(!bb.hasOwnProperty(e)||e instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Pb($a.error,"addNewFabric: Invalid fabricUsage value");var j=b();null===Cb&&(Cb=a());var k=null,l=!1;if(!$(f)){var m=V(Cb);Kb(Ya.userJoined,null,f,null,m,null,null),l=!0,i={authStatus:Ha.tokenData?!0:!1,clockSync:!Oa,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:f,version:pa},xb(qa,ra,"stateMachine",i)}if(W(f,k,l),!Vb(f,c)){c.addEventListener&&(c.addEventListener("icecandidate",sc,!1),c.addEventListener("iceconnectionstatechange",rc,!1),c.addEventListener("signalingstatechange",oc,!1),c.addEventListener("negotiationneeded",qc,!1));var o=a(),p={pc:c,remoteUserID:h,fabricUsage:e,magicKey:Cb,startTime:j,pcCallback:g,pcState:hb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:c.iceConnectionState,latestEventSent:j,pcHash:o,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};"function"!=typeof c||c.callstatsID||(c.callstatsID=o),("connected"===c.iceConnectionState||"completed"===c.iceConnectionState)&&(p.pcState=hb.established),_(f,p),p.pcState===hb.established&&(cc(c,Ya.autoFabricSetup,f),pc(p,c,f,h))}return Pb($a.success)},nc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Pb($a.error,"reportUserIDChange: Arguments missing/Invalid");if(!qa||!ra)return console.error("reportUserIDChange: SDK not initialized."),Pb($a.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Pb($a.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!n(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Pb($a.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=La[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Pb($a.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),xb(qa,ra,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Pb($a.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=Vb(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Pb($a.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Kb(Xa.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Pb($a.success)},oc=function(a){if(a){var b,c=Ia.codebase,d=null;if(c===pb.firefox)b=a.target;else if(c===pb.chrome)b=a.srcElement;else{if(c!==pb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var e=b.signalingState;"closed"===e&&(d=Xb(b),d&&d.fabric&&cc(b,Xa.fabricTerminated,d.conferenceID))}}},pc=function(a,c,d,e){null===a.statsInterval&&(a.statsPollingStart=b(),tc(c,d,e),a.statsInterval=setInterval(tc,Ma.statsSubmissionIntervalInMS[Ma.currentActivePhaseIndex],c,d,e))},qc=function(a){if(a){var b,c=Ia.codebase;if(c===pb.firefox)b=a.target;else if(c===pb.chrome)b=a.srcElement;else{if(c!==pb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=Xb(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},rc=function(a){if(a){var c,d=Ia.codebase;if(d===pb.firefox)c=a.target;else if(d===pb.chrome)c=a.srcElement;else{if(d!==pb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");c=a.pc}if(void 0!==c){var e,f,g,h,i=null,j=null;j=Xb(c),j&&j.fabric&&(i=j.fabric,e=j.conferenceID,f=i.remoteUserID,g=b(),h=g-i.startTime,"complete"===c.iceGatheringState&&"checking"===c.iceConnectionState&&(i.gatheringIceCandidatesDelay=h),"connected"===c.iceConnectionState||"completed"===c.iceConnectionState?(i.connectivityIceStatusDelay=h,i.pcState===hb.initializing?i.fabricSetupSent||cc(i.pc,Ya.autoFabricSetup,e):i.pcState===hb.disrupted&&cc(i.pc,Ya.fabricDisrupted,e),i.pcState=hb.established,pc(i,c,e,f)):"failed"===c.iceConnectionState?(i.setupFailureTime=h,cc(i.pc,Ya.autoFabricSetupFailed,e),i.pcState=hb.failed):"disconnected"===c.iceConnectionState&&(i.startTime=b(),i.pcState=hb.disrupted,i.pcCallback&&i.pcCallback(_a.appConnectivityError,"Connectivity check for PC object to "+f+" failed.")),i.iceConnectionState=c.iceConnectionState)}}},sc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Ia.codebase;if(h===pb.firefox)g=a.target;else if(h===pb.chrome)g=a.srcElement;else{if(h!==pb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=Xb(g),i&&i.fabric&&void 0!==b&&-1===i.fabric.iceCandidates.indexOf(b)&&i.fabric.iceCandidates.push(b)}},tc=function(a,c,d){if(!La.hasOwnProperty(c))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",c);if(!Tb(c,d))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",d);if("closed"===a.signalingState)return cc(a,Xa.fabricTerminated,c),!0;var e=Vb(c,a);if(e.pcState!==hb.established&&e.lastFabricState===e.pcState&&"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState)return!0;var f=La[c].ucID;ac(a,e.pcCallback,O,ra,d,c,f,e);var g,h=b(),i=h-e.statsPollingStart,j=5e3;(i>Ma.statsSubmissionPhaseDurationInMS[Ma.currentActivePhaseIndex]&&e.intervalAdaptionPhase||ya===!0)&&(Y(e.statsInterval),ya?(g=za,e.intervalAdaptionPhase=!1,ya=!1):Ma.currentActivePhaseIndex<Ma.statsSubmissionIntervalInMS.length-1?(Ma.currentActivePhaseIndex+=1,g=Ma.statsSubmissionIntervalInMS[Ma.currentActivePhaseIndex]):(g=Ca,e.intervalAdaptionPhase=!1),g>j&&(e.initialPhaseOver=!0),e.statsInterval=setInterval(tc,g,a,c,d))},uc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},vc=function(a,b,c){var d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));var f=d.join("&"),g=new XMLHttpRequest;g.open("POST",a),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.onload=function(){c(g)},g.send(f)},wc=function(){vb(va,function(a){if(200===a.status)try{var b=JSON.parse(a.responseText);uc("eModelThreshold",b,ob),uc("throughputThreshold",b,kb),uc("fractionalLossThreshold",b,nb),uc("rttThreshold",b,mb),uc("currOverPrevFrameRateThreshold",b,lb)}catch(c){return c}})},xc=function(){var a=na+"clockSync",c=null,d=null;vb(a,function(a,e){200===a.status&&(c=JSON.parse(a.response),d=b(),yc(c,e,d))})},yc=function(a,b,c){if(Oa){var d=b/2;if(d>Na.maxAllowedLatency)Na.offsetResults=[],xb(qa,ra,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Na.offsetResults.push(f)}if(Na.offsetResults.length>=Na.syncAttempts){var g=Na.offsetResults.reduce(function(a,b){return a+b});Na.currentOffset=g/Na.offsetResults.length,Na.offsetResults=[],Oa=!1,xb(qa,ra,"log",{msg:"clockSync Done"}),Eb(),Db()}else Oa&&setTimeout(function(){xc()},100)}},zc=function(){var a=this,c=null,d=!1,e=!1,f={},g={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=g.closed;var h=function(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),f[a]=ua+qa+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"};this.getConferenceURL=function(){return f},this._setupWebSocketConnection=function(f){return a._wsConnectionState===g.initiated||a._wsConnectionState===g.connected?(xb(qa,ra,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),void(f&&f(_a.success,"WebSocket establishment successful."))):(a._wsConnectionState=g.initiated,c=new WebSocket(ta,"echo-protocol"),c.onopen=function(){xb(qa,ra,"log",{msg:"Successfully connected to the backend"}),a._wsConnectionState=g.connected,d?e=!0:d=!0,Na.syncHandler||(xb(qa,ra,"log",{msg:"start clockSync"}),Na.offsetResults=[],xc(),Na.syncHandler=!0),Eb(),e?(ca(),Db()):Nb(),e=!1},c.onclose=function(){a._wsConnectionState=g.closed,xb(qa,ra,"log",{msg:"Connection to the server closed."}),Z(),Oa&&(Na.offsetResults=[],Na.syncHandler=null,Oa=!1),c&&(c=null),f&&f(_a.httpError,"Connection to the server closed.")},c.onerror=function(b){a._wsConnectionState=g.closed,xb(qa,ra,"log",{msg:"WebSocket establishment failed."}),f&&f(_a.wsChannelFailure,"WebSocket establishment failed.",b)},void(c.onmessage=function(a){var c,d=a.data,e=b(),g=JSON.parse(d);if("Error"===g.status)"Invalid client token."===g.reason&&(Ha.tokenData=null,Ha.authToken=null,Ha.sendAuthenticationRequest(qa,ra)),f&&f(_a.csProtoError,d.reason);else if("200 OK"===g.status)if("feedback"===g.event)window.localStorage.removeItem("feedback");else if(g.event===Ya.userJoined||g.event===Ya.refreshPresence){var i=!1,j=null;c=decodeURIComponent(g.conferenceID);var k=function(a){return setInterval(function(){Mb(a)},Ea)};La.hasOwnProperty(c)&&(La[c].ucID!==g.ucID&&(i=!0,h(c,g.ucID),j=g.conferenceCreationTS?g.conferenceCreationTS:g.conferenceDuration),g.event!==Ya.userJoined||La[c].refreshPresence||(La[c].refreshPresence=k(c),ja()),La[c].ucID=g.ucID),Ob(),Db(i,j,c,g.ucID)}else g.event===Za.clockSync?yc(g,e):g.event===Xa.fabricSetupFailed&&(c=decodeURIComponent(g.conferenceID),g.ucID&&(h(c,g.ucID),Ob(),Db(!0,0,c,g.ucID)))}))},this._isChannelReady=function(){return c&&1===c.readyState?!0:!1},this.getWSConnectionState=function(){return c?c.readyState:-1},this.send=function(a){c.send(JSON.stringify(a))}},Ac=new zc,Bc=function(a,b,c){if(Ac._isChannelReady())try{Ac.send(b)}catch(d){d&&"InvalidStateError"===d.name&&Fb({channel:a,data:b,callback:c})}else Fb({channel:a,data:b,callback:c}),Ac._setupWebSocketConnection()};return e(),wc(),xc(),ia(),{version:pa,initialize:Rb,fabricEvent:Xa,addNewFabric:mc,sendFabricEvent:cc,sendUserFeedback:kc,associateMstWithUserID:lc,csError:_a,fabricUsage:bb,qualityRating:db,webRTCFunctions:ib,reportError:gc,reportUserIDChange:nc,userIDType:cb,callStatsAPIReturnStatus:$a}};"function"==typeof define&&define.amd?define("callstats",[],b):a.callstats=b}(this);
/*! callstats.js  version = 3.16.7 2016-10-27 */
function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))?(d="Firefox",f=c.substring(a+8),b=g.moz):-1!==(a=c.indexOf("Trident"))&&(d="Microsoft Internet Explorer",a=c.indexOf("rv"),f=c.substring(a+3,a+7),b=g.goog);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j,osVersion:l,codebase:b,userAgent:c}}
/*! callstats.js  version = 3.16.7 2016-10-27 */
function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}
