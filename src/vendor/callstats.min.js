/*! callstats.js 2016-07-28 */
!function(a){"use strict";var b=function(a,b,c){function d(){}function e(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function f(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function g(){var a=f();return a+_a.currentOffset}function h(){return window.performance.now?window.performance.now():null}function i(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){ta=a})}function j(){return ta?ta.level:void 0}function k(){return ta?ta.charging:void 0}function l(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(a){sa=a})}function m(){Ia||window.addEventListener("beforeunload",function(a){var b;for(b in Za)Za.hasOwnProperty(b)&&Ub(kb.userLeft,null,b,Za[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function n(a,b){setTimeout(function(){var b=g(),c=b-a.data.apiTS;a.data.timeShift=c,ka(a.type,a.action,a.data,a.callback)},b)}function o(a,b,c,d,e){var f=dc(c,d),g=null;f?(g=h(),Ub(kb.mediaPlaybackStartEvent,b,c,a,{ssrc:e,highResTs:g},f,null)):console.error("sendMediaStartEvent: Invalid pcHash")}function p(a,b,c,d,e){var f=dc(c,d),g=null;f?(g=h(),Ub(kb.mediaSuspendedEvent,b,c,a,{ssrc:e,highResTs:g},f,null)):console.error("sendMediaSuspendedEvent: Invalid pcHash")}function q(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=Za[b].ucID;f.oncanplay=function(){o(g,a,b,d,e)},f.onsuspend=function(){p(g,a,b,d,e)}}}function r(a){var b=Wa.codebase,c=!1;if(null===a)c=!1;else if(b===Eb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==ib&&a instanceof ib&&(c=!0),("function"==typeof a||b===Eb.edge)&&(c=!0);return c}function s(a,b){var d,e;return a&&(b===Eb.chrome?(d=a.googLocalAddress,d.concat(":",a.googRemoteAddress)):b===Eb.firefox&&(d=a.localAddr,d.concat(":",a.remoteAddr))),e=new c(d,"TEXT"),e.getHash("SHA-1","B64")}function t(){var a;return a=navigator.onLine===!0?"online":"offline"}function u(a,b){var c=Fb.unknown,d=null;if(b===Eb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=Fb.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=Fb.audio),d=a.data.googCodecName);else{if(b!==Eb.firefox)return;void 0!==a&&(void 0!==a.data.mediaType?c=a.data.mediaType:void 0!==a.data.framerateMean&&(c=Fb.video))}return cb.hasOwnProperty(a.data.ssrc)&&(cb[a.data.ssrc].mediaType=c,cb[a.data.ssrc].codec=d),c}function v(a,b){var c;return b===Eb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===Eb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function w(a,b){var c="unavailable";if(b===Eb.chrome){var d,e,f;d=v(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===Eb.firefox;return c}function x(a,b){var c;return b===Eb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(c=a.data.googFrameWidthSent):b===Eb.firefox,c}function y(a){var b;return b=isNaN(a)||0>a?null:a}function z(a,b){var c;if(b===Eb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=y(parseInt(a.data.googRtt,10))}else if(b===Eb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=y(parseInt(a.data.mozRtt,10))}else if(b===Eb.edge&&a&&a.data.roundTripTime)return c=y(parseInt(a.data.roundTripTime,10))}function A(a){var b=isNaN(a)?null:a;return b}function B(a,b){var c;if(b===Eb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=A(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===Eb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=A(parseInt(a.data.jitter,10))}function C(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function D(a,b,c){var d;return b===Fb.audio?a<c.audio.gThreshold?d=ub.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=ub.fair:a>c.audio.rThreshold&&(d=ub.bad):b===Fb.video&&(a<c.video.gThreshold?d=ub.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=ub.fair:a>c.video.rThreshold&&(d=ub.bad)),d}function E(a,b,c){var d;return b===Fb.audio?a>c.audio.gThreshold?d=ub.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=ub.fair:a<c.audio.rThreshold&&(d=ub.bad):b===Fb.video&&(a>c.video.gThreshold?d=ub.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=ub.fair:a<c.video.rThreshold&&(d=ub.bad)),d}function F(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===ub.excellent?b=vb.excellent:c===ub.fair?b=vb.fair:c===ub.bad&&(b=vb.bad)),b}function G(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(k={},h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k.hash=b[d].hash,l=c-g,l>0&&(k.receivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/l,k.sentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/l,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(k.sentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(l/1e3)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(k.receivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(l/1e3))),k.rtt=b[d].googRtt,m.push(k))}return m}function H(a,b,c,d){var e=[];return c===Eb.firefox?e=null:c===Eb.chrome&&(e=G(a,b,d)),e}function I(a){if(a=A(a),null!==a){var b=0>a?null:a;return b}}function J(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function K(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,y,B,G,H,K,L,M,N,O,P,Q,R,S,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null;for(o in b.streams[c].outbound)if(b.streams[c].outbound.hasOwnProperty(o)){Q=b.streams[c].outbound[o].data,void 0!==e.streams[c]&&void 0!==e.streams[c].outbound&&void 0!==e.streams[c].outbound[o]?(j=A(parseInt(e.streams[c].outbound[o].data.bytesSent,10)),k=a.lastStatsSent.apiTS,K=A(parseInt(e.streams[c].outbound[o].data.packetsSent,10)),M=A(parseInt(e.streams[c].outbound[o].data.packetsLost,10)),N=A(parseInt(e.streams[c].outbound[o].data.discardedPackets,10))):(j=0,k=g,M=0,K=0,N=0),m=g,B=m-k,p=u(b.streams[c].outbound[o],f),q=w(b.streams[c].outbound[o],f),r=v(b.streams[c].outbound[o],f),s=x(b.streams[c].outbound[o],f),void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].outbound&&(d.streams[c].outbound={}),d.streams[c].outbound[o]={},n=z(b.streams[c].outbound[o],f),l=A(parseInt(Q.bytesSent,10)),null!==l&&null!==j&&j>l&&(j=0,Ib(Ba,Ca,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:h,ucID:i})),void 0!==Q.droppedFrames&&(O=I(parseInt(Q.droppedFrames,10)),null!==O&&null!==N&&N>O&&(N=0),null!==O&&null!==N&&(P=O-N)),L=I(parseInt(Q.packetsLost,10)),null!==L&&null!==M&&(U=L-M),H=I(parseInt(Q.packetsSent,10)),null!==H&&null!==K&&(G=H-K),void 0!==U&&void 0!==G&&G+U>0&&(V=U/(G+U)),B>0&&(null!==l&&null!==j&&(T=8*(l-j)/B),void 0!==G&&(ca=G/(B/1e3))),a=J(a,c,"rttInfo",o,"outbound","rttArray",!0),a=J(a,c,"fractionalLossInfo",o,"outbound","fractionalLossArray",!0),a=J(a,c,"timeElapse",o,"outbound","totalTimeMs",!1),a=J(a,c,"frameWidthInfo",o,"outbound","frameWidthArray",!0),a=J(a,c,"frameRateInfo",o,"outbound","frameRateArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[c].outbound[o].rttArray.push(parseInt(n,10)),void 0!==V&&null!==V&&a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray.push(V),void 0!==r&&null!==r&&a.frameRateInfo.streams[c].outbound[o].frameRateArray.push(parseInt(r,10)),void 0!==s&&null!==s&&a.frameWidthInfo.streams[c].outbound[o].frameWidthArray.push(parseInt(s,10)),W=C(95,a.rttInfo.streams[c].outbound[o].rttArray),Z=C(95,a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray),ea=C(95,a.frameWidthInfo.streams[c].outbound[o].frameWidthArray),da=C(95,a.frameRateInfo.streams[c].outbound[o].frameRateArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].outbound[o].totalTimeMs=a.timeElapse.streams[c].outbound[o].totalTimeMs+B),a.timeElapse.streams[c].outbound[o].totalTimeMs>0&&null!==l&&(ba=8*l/a.timeElapse.streams[c].outbound[o].totalTimeMs),d.streams[c].outbound[o]={csioIntMs:B,csioIntFL:V,csioIntPR:ca,csioIntBRKbps:T,csioMediaType:p,csioSig2Latency:W,csioAvgBRKbps:ba,csioTimeElapseMs:a.timeElapse.streams[c].outbound[o].totalTimeMs,csioRes:q,csioPercentileFl:Z,csioIntFramesDropped:P,csioPercentileFrameRate:da,csioPercentileFrameWidth:ea};for(R in Q)Q.hasOwnProperty(R)&&(d.streams[c].outbound[o][R]=Q[R]);p===Fb.audio?(S=W+40,X=D(S,p,Db),Y=E(T,p,zb),t=F(X,Y),d.streams[c].outbound[o].csioMark=t,d.streams[c].outbound[o].csioeM=S):p===Fb.video&&(y=parseInt(a.rttInfo.streams[c].outbound[o].frameRate,10),$=E(r/y,p,Ab),_=D(n,p,Bb),aa=E(T,p,zb),t=F($,_,aa),a.rttInfo.streams[c].outbound[o].frameRate=r,d.streams[c].outbound[o].csioMark=t)}}function L(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,y,G,H,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=null,ga=null,ha=null,ia=null;for(q in b.streams[c].inbound)if(b.streams[c].inbound.hasOwnProperty(q)){U=b.streams[c].inbound[q].data,void 0!==e.streams[c]&&void 0!==e.streams[c].inbound&&void 0!==e.streams[c].inbound[q]?(j=A(parseInt(e.streams[c].inbound[q].data.bytesReceived,10)),n=A(parseInt(e.streams[c].inbound[q].data.packetsLost,10)),Q=A(parseInt(e.streams[c].inbound[q].data.packetsReceived,10)),k=a.lastStatsSent.apiTS,S=A(parseInt(e.streams[c].inbound[q].data.discardedPackets,10))):(j=0,k=g,n=0,Q=0,S=0),r=u(b.streams[c].inbound[q],f),s=w(b.streams[c].inbound[q],f),y=v(b.streams[c].inbound[q],f),t=B(b.streams[c].inbound[q],f),X=x(b.streams[c].inbound[q],f),p=z(b.streams[c].inbound[q],f),l=A(parseInt(U.bytesReceived,10)),null!==l&&null!==j&&j>l&&(j=0,n=0,Q=0,Ib(Ba,Ca,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:h,ucID:i})),o=I(parseInt(U.packetsLost,10)),m=g,void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].inbound&&(d.streams[c].inbound={}),d.streams[c].inbound[q]={},null!==o&&null!==n&&(Z=o-n),void 0!==U.discardedPackets&&(R=I(parseInt(U.discardedPackets,10)),null!==R&&null!==S&&S>R&&(S=0),null!==R&&null!==S&&(T=R-S)),P=I(parseInt(U.packetsReceived,10)),G=P-Q,void 0!==Z&&null!==G&&G+Z>0&&(_=Z/(G+Z)),O=m-k,O>0&&(null!==l&&null!==j&&(Y=8*(l-j)/O),null!==G&&($=G/(O/1e3))),a=J(a,c,"rttInfo",q,"inbound","rttArray",!0),a=J(a,c,"timeElapse",q,"inbound","totalTimeMs",!1),a=J(a,c,"jitterInfo",q,"inbound","jitterArray",!0),a=J(a,c,"fractionalLossInfo",q,"inbound","fractionalLossArray",!0),a=J(a,c,"frameWidthInfo",q,"inbound","frameWidthArray",!0),a=J(a,c,"frameRateInfo",q,"inbound","frameRateArray",!0),void 0!==p&&null!==p&&a.rttInfo.streams[c].inbound[q].rttArray.push(parseInt(p,10)),void 0!==t&&null!==t&&a.jitterInfo.streams[c].inbound[q].jitterArray.push(parseInt(t,10)),void 0!==_&&null!==_&&a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray.push(_),void 0!==y&&null!==y&&a.frameRateInfo.streams[c].inbound[q].frameRateArray.push(parseInt(y,10)),void 0!==X&&null!==X&&a.frameWidthInfo.streams[c].inbound[q].frameWidthArray.push(parseInt(X,10)),aa=C(95,a.rttInfo.streams[c].inbound[q].rttArray),ba=C(95,a.jitterInfo.streams[c].inbound[q].jitterArray),ca=C(95,a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray),ha=C(95,a.frameRateInfo.streams[c].inbound[q].frameRateArray),ia=C(95,a.frameWidthInfo.streams[c].inbound[q].frameWidthArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].inbound[q].totalTimeMs=a.timeElapse.streams[c].inbound[q].totalTimeMs+O),null!==l&&a.timeElapse.streams[c].inbound[q].totalTimeMs>0&&(ga=8*l/a.timeElapse.streams[c].inbound[q].totalTimeMs),d.streams[c].inbound[q]={csioIntMs:O,csioIntFL:_,csioIntPR:$,csioIntBRKbps:Y,csioSig2Latency:aa,csioAvgBRKbps:ga,csioMediaType:r,csioTimeElapseMs:a.timeElapse.streams[c].inbound[q].totalTimeMs,csioIntPktRcv:G,csioIntPktLoss:Z,csioPercentileJitter:ba,csioRes:s,csioPercentileFl:ca,csioIntPktDiscarded:T,csioPercentileFrameRate:ha,csioPercentileFrameWidth:ia};for(V in U)U.hasOwnProperty(V)&&(d.streams[c].inbound[q][V]=U[V]);r===Fb.audio?(W=aa+40,da=D(W,r,Db),ea=D(_,r,Cb),fa=E(Y,r,zb),H=F(da,ea,fa),d.streams[c].inbound[q].csioMark=H,d.streams[c].inbound[q].csioeM=W):r===Fb.video&&(K=a.rttInfo.streams[c].inbound[q].frameRate,L=E(y/K,r,Ab),M=D(p,r,Bb),N=E(Y,r,zb),H=F(L,M,N),a.rttInfo.streams[c].inbound[q].frameRate=y,d.streams[c].inbound[q].csioMark=H)}}function M(a,b,c,d,e,f){var g={streams:{}};g.fabricState=a.pcState,g.connectionState=t();var h=null;h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:{}};var i;for(i in b.streams)b.streams.hasOwnProperty(i)&&(void 0!==b.streams[i].inbound&&L(a,b,i,g,h,c,d,e,f),void 0!==b.streams[i].outbound&&K(a,b,i,g,h,c,d,e,f),void 0===g.streams[i]&&(g.streams[i]={}),b.streams[i].cname&&(g.streams[i].cname=b.streams[i].cname),b.streams[i].usage&&(g.streams[i].usage=b.streams[i].usage),b.streams[i].msid&&(g.streams[i].msid=b.streams[i].msid),b.streams[i].userID&&(g.streams[i].userID=b.streams[i].userID),b.streams[i].associatedVideoTag&&(g.streams[i].associatedVideoTag=b.streams[i].associatedVideoTag));if(c===Eb.firefox)for(i in g.streams)g.streams.hasOwnProperty(i)&&void 0!==g.streams[i].inbound&&void 0!==g.streams[i].inbound[tb.remote]&&(void 0===g.streams[i].outbound&&(g.streams[i].outbound={}),void 0===g.streams[i].outbound[tb.local]&&(g.streams[i].outbound[tb.local]={}),g.streams[i].outbound[tb.local].rtt=g.streams[i].inbound[tb.remote].rtt);return g}function N(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===vb.bad?a.streams[b].inbound[d].mark=2:c===vb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===vb.bad?a.streams[b].outbound[d].mark=2:c===vb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function O(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function P(a){var b={};a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),Ha&&(b.conferenceURL=Ha);var c,d,e,f;b.streams={};for(c in a.streams)if(a.streams.hasOwnProperty(c)){if(void 0===b.streams[c]&&(b.streams[c]={}),a.streams[c].cname&&(b.streams[c].cname=a.streams[c].cname),a.streams[c].msid&&(b.streams[c].msid=a.streams[c].msid),a.streams[c].userID&&(b.streams[c].remoteUserID=a.streams[c].userID),a.streams[c].usage&&(b.streams[c].usageLabel=a.streams[c].usage),a.streams[c].associatedVideoTag&&(b.streams[c].associatedVideoTag=a.streams[c].associatedVideoTag),void 0!==a.streams[c].inbound)for(d in a.streams[c].inbound)a.streams[c].inbound.hasOwnProperty(d)&&(e=a.streams[c].inbound[d],d===tb.local&&(b.streams[c].reportType=tb.inbound,e.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=e.csioIntFL),e.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=e.csioIntBRKbps),e.hasOwnProperty("csioMark")&&(b.streams[c].quality=e.csioMark),e.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=e.csioMediaType),e.hasOwnProperty("googRtt")&&(b.streams[c].rtt=e.googRtt),e.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=e.mozRtt),e.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=e.roundTripTime),e.hasOwnProperty("jitter")&&(b.streams[c].jitter=e.jitter),e.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=e.googJitterReceived),e.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=e.audioOutputLevel),e.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=e.audioInputLevel)));if(void 0!==a.streams[c].outbound)for(d in a.streams[c].outbound)a.streams[c].outbound.hasOwnProperty(d)&&d===tb.local&&(f=a.streams[c].outbound[d],b.streams[c].reportType=tb.outbound,f.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=f.csioIntFL),f.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=f.csioIntBRKbps),f.hasOwnProperty("csioMark")&&(b.streams[c].quality=f.csioMark),f.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=f.csioMediaType),f.hasOwnProperty("googRtt")&&(b.streams[c].rtt=f.googRtt),f.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=f.mozRtt),f.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=f.roundTripTime),f.hasOwnProperty("jitter")&&(b.streams[c].jitter=f.jitter),f.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=f.googJitterReceived),f.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=f.audioInputLevel),f.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=f.audioOutputLevel))}return b}function Q(a,b,c,e,f,h){var i=g();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&ja()&&!ab?(d("Pushing to the cloud ",a),ka(lb.processedStats,jb.fabricStats,a,h),b.latestEventSent=i,b.lastFabricState=b.pcState):(a.clockUnsynced=ab,Pb({type:lb.processedStats,action:jb.fabricStats,data:a}),a.hasOwnProperty("token")||vc(Ba,Ea,f))}function R(a,b,c,d,e,h,i){function l(l){var m=g(),n=f();void 0===e.lastRawStatsSentInterval||null===e.lastRawStatsSentInterval?e.lastRawStatsSentInterval=n-e.statsPollingStart:e.lastRawStatsSentInterval=n-e.rawstatsTS+e.lastRawStatsSentInterval,void 0===e.lastProcessedStatsSentInterval||null===e.lastProcessedStatsSentInterval?e.lastProcessedStatsSentInterval=n-e.statsPollingStart:e.lastProcessedStatsSentInterval=n-e.rawstatsTS+e.lastProcessedStatsSentInterval,e.rawstatsTS=n;var o={},p=Wa.codebase;o.version=xa,o.appID=Ba,o.conferenceID=encodeURIComponent(c),o.apiTS=m,o.timeShift=0,o.fabricState=e.pcState,o.pcID=e.pcHash,void 0!==d&&(o.ucID=d),Fa?o.token=Fa.challenge.token:vc(Ba,Ea,a),o.localID=encodeURIComponent(a),o.remoteID=encodeURIComponent(b),o.deviceID=Ga;var q,r,t,u,v,w,x,y,z={streams:{}},A=null,B=!1,C=!1,D={},E={};if(p===Eb.firefox&&"Safari"!==Wa.name)A=[],l.forEach(function(a){A.push(a)});else if(p===Eb.chrome&&"Safari"!==Wa.name)A=l.result();else{A=[];for(q in l)l.hasOwnProperty(q)&&A.push(l[q])}for(q=0;q<A.length;++q)r=W(A[q]),t=T(JSON.parse(r),p),X(t)||(t.hasOwnProperty("Transport")?(u="Transport",z.hasOwnProperty(u)||(z[u]=[]),p!==Eb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(z[u].push(t[u]),"true"===t[u].googActiveConnection&&(o.activeConnectionIndex=z[u].length)):(z[u].push(t[u]),"true"===t[u].selected&&(o.activeConnectionIndex=z[u].length))):t.hasOwnProperty("localCandidate")?D[t.localCandidate.id]=t.localCandidate:t.hasOwnProperty("remoteCandidate")?E[t.remoteCandidate.id]=t.remoteCandidate:t.hasOwnProperty("bwe")?z.bwe=t.bwe:(w=Rb(t.ssrc),void 0!==w&&w.localStartTime||(y=Tb(b,c,d,e,h,null),y&&(C=!0),w=Rb(t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=b),void 0===z.streams[t.ssrc]&&(z.streams[t.ssrc]={userID:v},void 0!==w&&(z.streams[t.ssrc].cname=w.cname,z.streams[t.ssrc].msid=w.msid)),t.inbound?(void 0===z.streams[t.ssrc].inbound&&(z.streams[t.ssrc].inbound={}),x=z.streams[t.ssrc].inbound,x[t.reportType]={data:t.data},w&&(z.streams[t.ssrc].usage=w.usage,z.streams[t.ssrc].associatedVideoTag=w.associatedVideoTag)):(void 0===z.streams[t.ssrc].outbound&&(z.streams[t.ssrc].outbound={}),z.streams[t.ssrc].outbound[t.reportType]={data:t.data})));p===Eb.firefox&&(z.Transport=O(z.Transport,D,E));var F;if(z.Transport)for(F=0;F<z.Transport.length;F++)z.Transport[F].hash=s(z.Transport[F],p);o.statistics=z,z.Transport&&(B=V(z.Transport,e)),B&&gc(h,kb.updatedConfiguration,c),e.pcState===wb.disrupted&&$(o);var G=M(e,z,p,m,c,d);if(z.Transport&&(G.Transport=H(e,z.Transport,p,m)),z.bwe&&(G.bwe=z.bwe),void 0===e.processedStatsTupleArray&&(e.processedStatsTupleArray=[]),ua){var I=P(G);ua(I)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=j(),G.batteryStatus.isBatteryCharging=k(),G=N(G),e.processedStatsTupleArray.push(G),o.processedStatistics=e.processedStatsTupleArray,e.lastStatsSent=o;var J=oa(o),K=oa(o);delete J.processedStatistics,delete K.statistics,C&&Ub(kb.ssrcMap,b,c,d,Sb(),e.pcHash),(e.lastProcessedStatsSentInterval>=La||e.initialPhaseOver)&&(e.processedStatsTupleArray=[],Q(K,e,c,b,a,i),e.lastProcessedStatsSentInterval=0)}return l}function S(a){var b;return xb.hasOwnProperty(a)?a===xb.createOffer||a===xb.createAnswer||a===xb.setRemoteDescription?b=yb.negotiationFailure:a===xb.setLocalDescription?b=yb.sdpError:a===xb.addIceCandidate?b=yb.sdpError:a===xb.getUserMedia?b=yb.mediaConfigError:a===xb.iceConnectionFailure?b=yb.iceFailure:a===xb.signalingError?b=yb.signalingError:(a===xb.applicationLog||xb.applicationError)&&(b=yb.applicationLog):b=Jb.invalidWebRTCFunctionName,b}function T(a,b){var c={};return b===Eb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inboundrtp"===a.type?!0:!1,c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===Eb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.inbound=!1:c.inbound=!0,c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"VideoBwe"===a.type&&(c.bwe=a):b===Eb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inbound-rtp"===a.type?!0:!1,c.data=a,c.reportType="local"):"transport"===a.type&&(c.Transport=a)),c}function U(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function V(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=U(b)),!0):!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function W(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function X(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function Y(a){return{magicKey:a,statsSubmissionInterval:Sa,endpoint:Ya,localUserName:Da}}function Z(a,b,c){var d=Za[a];void 0===d&&(Za[a]={},Za[a].participants=null,c&&(Za[a].userJoinedSent=!0),b&&(Za[a].refreshPresence=b))}function $(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function _(a){return clearInterval(a),null}function aa(){var a;for(a in Za)Za.hasOwnProperty(a)&&(Za[a].refreshPresence=_(Za[a].refreshPresence),delete Za[a].refreshPresence);qa()}function ba(){var a,b=function(a){return setInterval(function(){Wb(a)},Ua)};for(a in Za)Za.hasOwnProperty(a)&&(Wb(a),Za[a].refreshPresence=b(a));ra()}function ca(a){var b=Za[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function da(a,b){var c=Za[a],d=[];if(void 0===c)d.push(b),Za[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function ea(a){var b=!1;if(!Za[a])return{conferenceFinished:b,ucID:null};var c=Za[a].ucID;return 0===Za[a].participants.length&&(_(Za[a].refreshPresence),qa(),delete Za[a],b=!0),{conferenceFinished:b,ucID:c}}function fa(a,b){Ub(kb.userLeft,null,a,b,null,null,null),eb=_(eb),qa(),db=Mb,Mb=null}function ga(a,b,c){var d=!1;if(null!==a&&void 0===a.challenge)return d;if(null!==a&&a.challenge.appID===b&&a.challenge.userID===encodeURIComponent(c)){var e=null;if(navigator.mozGetUserMedia){var f=a.challenge.expires.split(" ").join("T");e=Date.parse(f)}else e=new Date(a.challenge.expires);var h=new Date(g());e>h&&(d=!0)}return d}function ha(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),Ha[a]=za+Ba+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"}function ia(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ja(){return Pa}function ka(a,b,c,d){a===lb.clockSync?ja()?(_a.syncStartTime=f(),c.syncStartTime=_a.syncStartTime,c.offsetResultsLength=_a.offsetResults.length,Oa.emit(a,JSON.stringify(c)),d&&b!==jb.fabricStats&&d(nb.success,b+" sent to the backend.")):setTimeout(function(){wc()},100):ga(Fa,Ba,Ca)?ab&&c.action!==kb.userJoined&&c.action!==kb.refreshPresence&&c.action!==kb.fabricSetupFailed||!ja()?(c.clockUnsynced=ab,Pb({type:b,action:a,data:c,callback:d})):(Oa.emit(a,JSON.stringify(c)),d&&b!==jb.fabricStats&&d(nb.success,b+" sent to the backend.")):vc(Ba,Ea,Ca,function(e,f){e!==nb.success?(e===pb.authOngoing&&(c.clockUnsynced=ab,Pb({type:b,action:a,data:c,callback:d})),d&&e!==pb.authOngoing&&d(e,f)):e===nb.success&&"SDK authentication successful."===f&&(ab&&b!==kb.userJoined&&c.action!==kb.refreshPresence&&c.action!==kb.fabricSetupFailed||!ja()?(c.clockUnsynced=ab,Pb({type:b,action:a,data:c,callback:d})):(c.token=Fa.challenge.token,Oa.emit(a,JSON.stringify(c)),d&&b!==jb.fabricStats&&d(nb.success,b+" sent to the backend.")))})}function la(a,b,d,e,f){var g=new c(b,"TEXT"),h=g.getHMAC(a,"TEXT","SHA-1","B64"),i={};i.version=xa,i.challenge={},i.challenge.response=h,i.challenge.original=b,i.appID=d,i.userID=encodeURIComponent(e),i.authType=ya;var j=va+"o/challenge";Hb(j,JSON.stringify(i),function(c){var g;if(200===c.status)g=JSON.parse(c.response),void 0!==g.challenge.status&&g.challenge.status!==nb.ok?g.challenge.reason===ob.csProtoError?(Ma=!1,ma(f)):g.challenge.reason===ob.csNoAuthState&&(Na||(Na=setTimeout(function(){vc(Ba,Ea,Ca,f)},Va))):(g.appID=d,window.localStorage.setItem("auth_data",JSON.stringify(g)),Ba=d,Ea=a,Ca=e,Fa=g,Ma=!1,Sa=parseInt(g.challenge.submissionInterval,10),Ta=g.challenge.collectSDP,f&&f(nb.success,"SDK authentication successful."),ja()?(Ob(),f&&f(nb.success,"WebSocket establishment successful.")):yc(va+Ra,function(a,b){void 0!==f&&f(a,b)}));else if(200!==c.status&&((502===c.status||0===c.status)&&setTimeout(function(){la(a,b,d,e,f)},Va),f)){var h;400===c.status?(h=c.responseText,f(nb.authError,h)):502===c.status||0===c.status?(h="HTTP "+c.status+", "+c.statusText+". Server temporarily unavailable. Retrying in "+Va+"ms",f(nb.appConnectivityError,h)):(h="HTTP "+c.status+", "+c.statusText+". "+c.responseText,f(nb.httpError,h))}})}function ma(a){return a?void a(nb.csProtoError,"Fatal authentication error. Invalid auth protocol message."):void console.error("Fatal authentication error. Invalid auth protocol message.")}function na(a){a&&a(pb.authOngoing,null)}function oa(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=oa(a[b]));return c}function pa(){var a={};Object.keys(Za).forEach(function(b){var c=Za[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:Fa?!0:!1,clockSync:!ab,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:xa};Ib(Ba,Ca,"stateMachine",b)}function qa(){fb||(fb=setInterval(function(){pa()},gb))}function ra(){_(fb),fb=null}var sa,ta,ua,va="https://collector.callstats.io:443/",wa="443",xa="3.13.1",ya="BasicAuth",za="https://dashboard.callstats.io/apps/",Aa="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",Ba=-1,Ca="",Da=null,Ea=null,Fa=null,Ga=null,Ha={},Ia=!1,Ja=!1,Ka=3e4,La=1e4,Ma=!1,Na=null,Oa=null,Pa=!1,Qa=!1,Ra="collectCallStats",Sa=15e3,Ta=!1,Ua=1e4,Va=5e3,Wa=detectBrowserInfo(),Xa=measureAppLoadingPerformance(Wa),Ya={type:"browser",name:Wa.name,ver:Wa.ver,os:Wa.os},Za={},$a={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},_a={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},ab=!0,bb=[],cb={},db=null,eb=null,fb=null,gb=2e4,hb=100,ib=null;"Firefox"===Wa.name?ib=mozRTCPeerConnection:"Chrome"===Wa.name||"Opera"===Wa.name?ib=webkitRTCPeerConnection:"Safari"===Wa.name?d("Browser type Safari"):"Edge"===Wa.name&&(ib=window.RTCPeerConnection);var jb={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},kb={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},lb={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},mb={success:"success",failure:"failure"},nb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",
ok:"OK"},ob={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},pb={authOngoing:"authOngoing"},qb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},rb={local:"local",remote:"remote"},sb={excellent:5,good:4,fair:3,poor:2,bad:1},tb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},ub={excellent:3,fair:2,bad:1},vb={excellent:"excellent",fair:"fair",bad:"bad"},wb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},xb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},yb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},zb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},Ab={video:{gThreshold:.8,rThreshold:.3}},Bb={video:{gThreshold:400,rThreshold:1e3}},Cb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},Db={audio:{gThreshold:240,rThreshold:400}},Eb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},Fb={unknown:"unknown",audio:"audio",video:"video"},Gb=function(a,b){var c=null,d=null,e=null,g=new XMLHttpRequest;g&&(g.open("GET",encodeURI(a)),c=f(),g.onload=function(){d=f(),e=d-c,b(g,e)},g.send())},Hb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},Ib=function(a,b,c,d){var e=va+"generics",f={appID:a,userID:encodeURIComponent(b),version:xa,eventType:c,data:d};Hb(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:xa,eventType:"error",message:a.message,pageURL:window.location.href};for(b in Za)Za.hasOwnProperty(b)&&(d.conferenceID=b,Ib(Ba,Ca,"onErrorLog",d),c=!0);c||Ib(Ba,Ca,"onErrorLog",d)}});var Jb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Kb="fabricSetupFailed error reported by the developer",Lb="Connectivity Failure",Mb=e(),Nb=function(a,b){if(!Fa)return void vc(Ba,Ea,Ca);if(!ab){var c,d,e,f,h=g(),i=[],j=Math.max(Sa/bb.length,hb);for(c=0;c<bb.length;c++)if(e=bb[c],e.data.action!==kb.userJoined){if(e.data.token=Fa.challenge.token,a&&e.data.apiTS>=h-b||!e.data.ucID){if(f=decodeURIComponent(e.data.conferenceID),!Za[f])continue;e.data.ucID=Za[f].ucID}if(e.data.clockUnsynced&&(e.data.apiTS+=_a.currentOffset),e.action===jb.fabricStats&&e.data.clockUnsynced&&e.data.processedStatistics&&e.data.processedStatistics.length>0)for(d=0;d<e.data.processedStatistics.length;d++)e.data.processedStatistics[d].apiTS+=_a.currentOffset;delete e.data.clockUnsynced,n(e,j*(c+1))}else i.push(bb[c]);bb=i}},Ob=function(){if(!Fa)return void vc(Ba,Ea,Ca);var a,b,c=[],d=Math.max(Sa/bb.length,hb);for(a=0;a<bb.length;a++)b=bb[a],b.type!==lb.callStatsEvent||b.data.action!==kb.userJoined&&b.data.action!==jb.fabricSetupFailed?c.push(bb[a]):(b.data.token=Fa.challenge.token,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+_a.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Sa),n(b,d*(a+1)));bb=c},Pb=function(a){bb.push(a)},Qb=function(a,b){var c=RegExp.prototype.test.bind(/^([a-z])=(.*)/),d=/^ssrc:(\d*) ([\w_]*):(.*)/,e=/^ssrc-group:SIM (\d*)/;a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],h=a.slice(2);if("a"===c){if(d.test(h)){var i=h.match(d),j=i[1];void 0===cb[j]&&(cb[j]={}),cb[j][i[2]]=i[3],cb[j].localStartTime=f(),cb[j].syncedStartTime=g(),cb[j].streamType=b}e.test(h)&&(void 0===cb.ssrcGroup&&(cb.ssrcGroup={},cb.ssrcGroup[b]={}),cb.ssrcGroup[b].simulcastGroup=h.match(/\d+/g))}})},Rb=function(a){return cb[a]},Sb=function(){return cb},Tb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Qb(g,tb.outbound),Qb(h,tb.inbound),Ta){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Vb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Ub=function(a,b,c,d,e,f,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=g(),j={version:xa,apiTS:i,action:a,localID:encodeURIComponent(Ca),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:Ba,ucID:d,pcID:f,deviceID:Ga,value:e};return null===b&&(j.remoteID=null),null===c?void Ib(Ba,Ca,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(Fa&&ja()&&(d&&!ab||a===kb.userJoined||a===jb.fabricSetupFailed||a===kb.refreshPresence)?(j.token=Fa.challenge.token,ka(lb.callStatsEvent,a,j,h)):(j.clockUnsynced=ab,Fa||vc(Ba,Ea,Ca),a!==kb.fabricStatsCaching&&a!==kb.refreshPresence&&Pb({type:lb.callStatsEvent,action:lb.callStatsEvent,data:j,callback:h})))},Vb=function(a,b,c,d,e,f){var h=g(),i={version:xa,appID:Ba,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(Ca),remoteID:encodeURIComponent(a),pcID:e,deviceID:Ga,sdpPayload:d};Fa&&ja()&&c&&!ab?(i.token=Fa.challenge.token,ka(lb.sdpSubmission,lb.sdpSubmission,i,f)):(i.clockUnsynced=ab,Pb({type:lb.sdpSubmission,action:lb.sdpSubmission,data:i,callback:f}),Fa||vc(Ba,Ea,Ca))},Wb=function(a){var b={ucID:Za[a].ucID,magicKey:Mb,endpoint:Ya,fabricState:{},connectedDevices:sa},c=Za[a];if(c&&c.participants){var d,e=c.participants,f=0;for(f=0;f<e.length;f++)d=e[f],b.fabricState[f]={pc:d.pcHash,userId:d.remoteUserID,pcState:d.pcState,iceConnectionState:d.pc.iceConnectionState,iceGatheringState:d.pc.iceGatheringState,iceCandidatesNumber:d.iceCandidates.length,numNegotiationNeededCalls:d.numNegotiationNeededCalls}}ab||(b.clockSyncOffset=_a.currentOffset),Ub(kb.refreshPresence,null,a,Za[a].ucID,b,null)},Xb=function(a){var b={appID:Ba,userID:encodeURIComponent(Ca),version:xa,endpoint:Ya,pagePerf:Xa,endpointID:Ga,wsID:a.io.engine.id};-1!==Ba&&Fa&&(b.token=Fa.challenge.token,a.emit(lb.registerPresence,JSON.stringify(b)))},Yb=function(){var a=window.localStorage.getItem("feedback"),b=JSON.parse(window.localStorage.getItem("auth_data"));if(null!==a){var c=JSON.parse(a),d=b.challenge.token===c.token?!0:!1;d||Ca!==c.userID||(c.token=b.challenge.token,d=!0),d?ka(lb.userFeedback,lb.userFeedback,c):window.localStorage.removeItem("feedback")}},Zb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},$b=function(a,b,d,e,g,h){if(!a||!b||null===d||void 0===d||0>=a)return console.error("initialize: Argument missing/invalid"),Zb(mb.failure,"initialize: Argument missing/invalid");if("string"==typeof a&&(a=parseInt(a,10)),Ba=a,Ea=b,"object"==typeof d?(Da=d.userName,Ca=d.displayName):Ca=d,h&&(h.disableBeforeUnloadHandler===!0&&(Ia=!0),(null!==h.applicationVersion||void 0!==h.applicationVersion)&&(Ya.appVer=h.applicationVersion)),m(),Ga=window.localStorage.getItem("endpointID"),null===Ga){var i=f(),j=Math.random()*i,k=new c(j.toString(),"TEXT");Ga=k.getHash("SHA-1","B64"),window.localStorage.setItem("endpointID",Ga)}l(),ua=g;var n=JSON.parse(window.localStorage.getItem("auth_data"));return ga(n,a,d)?(e&&e(nb.success,"SDK already authenticated."),Sa=parseInt(n.challenge.submissionInterval,10),Ta=n.challenge.collectSDP,Fa=n,ja()||yc(va+Ra,e)):vc(a,b,d,e),Zb(mb.success)},_b=function(a){return function(b){return b.remoteUserID===a?!0:void 0}},ac=function(a,b){var c=!1,d=null;return Za[a]&&Za[a].participants&&(d=Za[a].participants.filter(_b(b))),c=d&&d.length>0?!0:!1},bc=function(a){return function(b){return b.pc===a?!0:void 0}},cc=function(a,b){var c=null,d=null;return Za[a]&&Za[a].participants&&(d=Za[a].participants.filter(bc(b))),c=d&&d.length>0?d[0]:null},dc=function(a,b){var c=null,d=null;return c=cc(a,b),c&&(d=c.pcHash),d},ec=function(a){var b=null,c=null,d=null;for(b in Za)if(Za.hasOwnProperty(b)&&(d=cc(b,a))){c={fabric:d,conferenceID:b};break}return c},fc=function(a,b){var c=0;if(a&&Za[b].participants)for(c=0;c<Za[b].participants.length;c++)if(Za[b].participants[c].pcHash===a.pcHash){Za[b].participants.splice(c,1);break}},gc=function(a,b,c,d){if(!a||!b||!c)return console.error("sendFabricEvent: Arguments missing/Invalid"),Zb(mb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!Ba||0>Ba||!Ea||""===Ca||!Za[c])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Zb(mb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===jb.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Zb(mb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!r(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Zb(mb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!jb.hasOwnProperty(b)&&!kb.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Zb(mb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var e=null,g=null,h=f(),i=Za[c],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Zb(mb.failure,"sendFabricEvent: Conference ID not found!");if(j=cc(c,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Zb(mb.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(!(b===jb.fabricSetup||b===kb.autoFabricSetup&&j.fabricSetupSent)){if(b===kb.autoFabricSetup){var l=h-j.startTime;e={setupDelay:l,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.pcState=wb.established,j.fabricSetupSent=!0}else if(b===kb.autoFabricSetupFailed)e={failureDelay:j.setupFailureTime,reason:yb.iceFailure,domError:Lb};else if(b===kb.fabricDisrupted)e={disruptionDelay:j.connectivityIceStatusDelay};else if(b===kb.updatedConfiguration)e=j.transportData;else if(b===jb.fabricSetupFailed){var m=h-k;e={failureDelay:m,reason:yb.iceFailure,domError:Kb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":xb.iceConnectionFailure,magicKey:Mb,endpoint:Ya}}else if(b===jb.activeDeviceList){if(!d||!d.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Zb(mb.failure,"sendFabricEvent: Arguments missing/Invalid");e={magicKey:Mb,endpoint:Ya,activeDevicelist:d.deviceList}}if(Ub(b,g,c,i.ucID,e,j.pcHash,j.pcCallback),(b===jb.fabricTerminated||b===kb.autoFabricSetupFailed||b===jb.fabricSetupFailed)&&Za[c].participants){j&&(j.statsInterval=_(j.statsInterval),fc(j,c));var n=ea(c);n.conferenceFinished&&fa(c,n.ucID)}if((b===jb.fabricSetup||b===jb.fabricUsageEvent)&&!j.fabricUsageSent){var o=j.fabricUsage;j.fabricUsageSent=!0,Ub(jb.fabricUsageEvent,g,c,i.ucID,o,j.pcHash,null)}return Zb(mb.success)}},hc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},ic=function(a,b,c,d,g,h){if(void 0===a||!c||!b)return console.error("reportError: Arguments missing/invalid"),Zb(mb.error,"reportError: Arguments missing/invalid");if(0>Ba||!Ba||!Ea||""===Ca)return console.error("reportError: SDK is not initialized"),Zb(mb.error,"reportError: SDK is not initialized");if(!xb.hasOwnProperty(c))return console.error("reportError: Invalid webRTC functionName value: %o",c),Zb(mb.error,"reportError: Invalid webRTC functionName value: "+c);void 0===d&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=f(),m=Za[b],n=null;if(i=S(c),d&&d instanceof DOMException)d={message:d.message,name:d.name};else if(d&&"object"==typeof d){var o={};d.hasOwnProperty("message")&&(o.message=d.message),d.hasOwnProperty("name")&&(o.name=d.name),d.hasOwnProperty("constraintName")&&(o.constraintName=d.constraintName),d.hasOwnProperty("stack")&&(o.stack=d.stack),d=o}if(r(a)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Zb(mb.error,"reportError: Conference ID not found!");if(n=cc(b,a),null===n)return console.error("reportError: Invalid pcObject passed as argument"),Zb(mb.error,"reportError: Invalid pcObject passed as argument");k=n.remoteUserID;var p=n.startTime,q=l-p;if(j={failureDelay:q,reason:i,domError:d,fabricState:n.pcState,iceConnectionState:n.pc.iceConnectionState,"function":c,magicKey:Mb,endpoint:Ya},c===xb.applicationLog||c===xb.applicationError?Ub(jb.applicationErrorLog,k,b,m.ucID,j,n.pcHash,n.pcCallback):Ub(jb.fabricSetupFailed,k,b,m.ucID,j,n.pcHash,n.pcCallback),g||h||a&&a.localDescription||a&&a.remoteDescription){var s={sdp:{}};s.sdp.localSDP=hc(a,g,"localDescription"),s.sdp.remoteSDP=hc(a,h,"remoteDescription"),Vb(k,b,m.ucID,s,n.pcHash)}}else{null===Mb&&(Mb=e());var t=e();j={failureDelay:0,reason:i,domError:d,"function":c,magicKey:Mb,endpoint:Ya},c===xb.applicationLog||c===xb.applicationError?Ub(jb.applicationErrorLog,k,b,null,j,t,null):Ub(jb.fabricSetupFailed,k,b,null,j,t,null)}return Zb(mb.success)},jc=function(a,b,c){if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Zb(mb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Zb(mb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Zb(mb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Zb(mb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var d=Za[a],e=null;void 0!==d&&void 0!==d.ucID&&(e=d.ucID);var f=null;if(f=null===Mb?db:Mb,null===e&&(e=ia(a)),null===e)return console.error("sendUserFeedback: ucID unavailable"),Zb(mb.error,"sendUserFeedback: ucID unavailable");var g={conferenceID:encodeURIComponent(a),magicKey:f,appID:Ba,version:xa,ucID:e,userID:encodeURIComponent(b.userID),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?g.userQoe.video=b.video:g.userQoe.video=-1,b.hasOwnProperty("audio")?g.userQoe.audio=b.audio:g.userQoe.audio=-1,b.hasOwnProperty("screen")?g.userQoe.screen=b.screen:g.userQoe.screen=-1,b.hasOwnProperty("comment")?g.userQoe.comment=b.comment:g.userQoe.comment=-1,Fa&&!ab?(g.token=Fa.challenge.token,window.localStorage.setItem("feedback",JSON.stringify(g)),ka(lb.userFeedback,lb.userFeedback,g,c)):(g.clockUnsynced=ab,Pb({type:lb.userFeedback,action:lb.userFeedback,data:g,callback:c}),vc(Ba,Ea,Ca)),Zb(mb.success)},kc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.displayName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Zb(mb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Zb(mb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!r(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Zb(mb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=Za[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Zb(mb.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=cc(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Zb(mb.error,"associateMstWithUserID: Unknown pcObject passed");var j=Rb(d);return void 0===j&&(cb[d]={},j=Rb(d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==Ca&&q(g,c,f,a,d),Zb(mb.success)},lc=function(a,b,c,d,g){var h=null,i={authStatus:Fa?!0:!1,clockSync:!ab,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:d,version:xa};if(Ib(Ba,Ca,"stateMachine",i),h="object"==typeof b?b.displayName:b,!(a&&h&&c&&d))return console.error("addNewFabric: Arguments missing/Invalid"),Zb(mb.error,"addNewFabric: Arguments missing/Invalid");if(0>Ba||!Ba||!Ea||""===Ca)return console.error("addNewFabric: SDK not initialized."),Zb(mb.error,"addNewFabric: SDK not initialized");if(""===d||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Zb(mb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!r(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Zb(mb.error,"addNewFabric: Invalid PeerConnection object passed");if(!qb.hasOwnProperty(c)||c instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Zb(mb.error,"addNewFabric: Invalid fabricUsage value");var j=f();null===Mb&&(Mb=e());var k=null,l=!1;if(!ca(d)){var m=Y(Mb);Ub(kb.userJoined,null,d,null,m,null,null),l=!0,i={authStatus:Fa?!0:!1,clockSync:!ab,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:d,version:xa},Ib(Ba,Ca,"stateMachine",i)}a.addEventListener("icecandidate",rc,!1),a.addEventListener("iceconnectionstatechange",qc,!1),a.addEventListener("signalingstatechange",nc,!1),a.addEventListener("negotiationneeded",pc,!1);var n=e(),o={pc:a,remoteUserID:h,fabricUsage:c,magicKey:Mb,startTime:j,pcCallback:g,pcState:wb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:j,pcHash:n,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};return"function"==typeof a&&(a.callstatsID=e()),("connected"===a.iceConnectionState||"completed"===a.iceConnectionState)&&(o.pcState=wb.established),Z(d,k,l),cc(d,a)||da(d,o),o.pcState===wb.established&&(gc(a,kb.autoFabricSetup,d),oc(o,a,d,h)),Zb(mb.success)},mc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Zb(mb.error,"reportUserIDChange: Arguments missing/Invalid");if(0>Ba||!Ba||!Ea||""===Ca)return console.error("reportUserIDChange: SDK not initialized."),Zb(mb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Zb(mb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!r(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Zb(mb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=Za[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Zb(mb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),Ib(Ba,Ca,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Zb(mb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=cc(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Zb(mb.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Ub(jb.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Zb(mb.success)},nc=function(a){if(a){var b,c=Wa.codebase,d=null;if(c===Eb.firefox)b=a.target;else if(c===Eb.chrome)b=a.srcElement;else{if(c!==Eb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var e=b.signalingState;"closed"===e&&(d=ec(b),d&&d.fabric&&gc(b,jb.fabricTerminated,d.conferenceID))}}},oc=function(a,b,c,d){null===a.statsInterval&&(a.statsPollingStart=f(),sc(b,c,d),a.statsInterval=setInterval(sc,$a.statsSubmissionIntervalInMS[$a.currentActivePhaseIndex],b,c,d))},pc=function(a){if(a){var b,c=Wa.codebase;if(c===Eb.firefox)b=a.target;else if(c===Eb.chrome)b=a.srcElement;else{if(c!==Eb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=ec(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},qc=function(a){if(a){var b,c=Wa.codebase;if(c===Eb.firefox)b=a.target;else if(c===Eb.chrome)b=a.srcElement;else{if(c!==Eb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,g,h,i=null,j=null;j=ec(b),j&&j.fabric&&(i=j.fabric,d=j.conferenceID,e=i.remoteUserID,g=f(),h=g-i.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(i.gatheringIceCandidatesDelay=h),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(i.connectivityIceStatusDelay=h,i.pcState===wb.initializing?i.fabricSetupSent||gc(i.pc,kb.autoFabricSetup,d):i.pcState===wb.disrupted&&gc(i.pc,kb.fabricDisrupted,d),i.pcState=wb.established,oc(i,b,d,e)):"failed"===b.iceConnectionState?(i.setupFailureTime=h,gc(i.pc,kb.autoFabricSetupFailed,d),i.pcState=wb.failed):"disconnected"===b.iceConnectionState&&(i.startTime=f(),i.pcState=wb.disrupted,i.pcCallback&&i.pcCallback(nb.appConnectivityError,"Connectivity check for PC object to "+e+" failed.")),i.iceConnectionState=b.iceConnectionState)}}},rc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Wa.codebase;if(h===Eb.firefox)g=a.target;else if(h===Eb.chrome)g=a.srcElement;else{if(h!==Eb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=ec(g),i&&i.fabric&&void 0!==b&&-1===i.fabric.iceCandidates.indexOf(b)&&i.fabric.iceCandidates.push(b)}},sc=function(a,b,c){if(!Za.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!ac(b,c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return gc(a,jb.fabricTerminated,b),!0;var d=cc(b,a);if(d.pcState!==wb.established&&d.lastFabricState===d.pcState)return!0;var e=Wa.codebase,g=Wa.name,h=Za[b].ucID;e===Eb.firefox||"Safari"===g?a.getStats(null,R(Ca,c,b,h,d,a,d.pcCallback),function(a){Ib(Ba,Ca,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})}):e===Eb.chrome?a.getStats(R(Ca,c,b,h,d,a,d.pcCallback)):e===Eb.edge&&a.getStats().then(R(Ca,c,b,h,d,a,d.pcCallback))["catch"](function(a){Ib(Ba,Ca,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})});var i,j=f(),k=j-d.statsPollingStart,l=5e3;(k>$a.statsSubmissionPhaseDurationInMS[$a.currentActivePhaseIndex]&&d.intervalAdaptionPhase||Ja===!0)&&(_(d.statsInterval),Ja?(i=Ka,d.intervalAdaptionPhase=!1,Ja=!1):$a.currentActivePhaseIndex<$a.statsSubmissionIntervalInMS.length-1?($a.currentActivePhaseIndex+=1,i=$a.statsSubmissionIntervalInMS[$a.currentActivePhaseIndex]):(i=Sa,d.intervalAdaptionPhase=!1),i>l&&(d.initialPhaseOver=!0),d.statsInterval=setInterval(sc,i,a,b,c))},tc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},uc=function(){Gb(Aa,function(a){if(200===a.status){var b=JSON.parse(a.responseText);tc("eModelThreshold",b,Db),tc("throughputThreshold",b,zb),tc("fractionalLossThreshold",b,Cb),tc("rttThreshold",b,Bb),tc("currOverPrevFrameRateThreshold",b,Ab)}})},vc=function(a,b,c,d){if(!(void 0===a||void 0===b||void 0===c||0>=a||0>c)){if(Ma)return void na(d);Na&&(clearTimeout(Na),Na=null),Ma=!0;var e=va+"o/authorize",f={appID:a,userID:encodeURIComponent(c),version:xa,authType:ya};Hb(e,JSON.stringify(f),function(e){var f;if(200===e.status)f=JSON.parse(e.response),void 0!==f.authorize.status&&f.authorize.status!==nb.ok?f.reason===ob.csProtoError&&(Ma=!1,ma(d)):la(b,f.authorize.challenge,a,c,d);else if(200!==e.status&&(Ma=!1,(502===e.status||0===e.status||500===e.status)&&(Na||(Na=setTimeout(function(){vc(a,b,c,d)},Va))),void 0!==d)){var g;400===e.status?(g=e.responseText,d(nb.authError,g)):502===e.status||0===e.status||500===e.status?(g="HTTP "+e.status+", "+e.statusText+". Server temporarily unavailable. Retrying in "+Va+"ms",d(nb.appConnectivityError,g)):(g="HTTP "+e.status+", "+e.statusText+". "+e.responseText,d(nb.httpError,g))}})}},wc=function(){var a=va+"clockSync",b=null,c=null;Gb(a,function(a,d){200===a.status&&(b=JSON.parse(a.response),c=f(),xc(b,d,c))})},xc=function(a,b,c){if(ab){var d=b/2;if(d>_a.maxAllowedLatency)_a.offsetResults=[],Ib(Ba,Ca,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;_a.offsetResults.push(f)}if(_a.offsetResults.length>=_a.syncAttempts){var g=_a.offsetResults.reduce(function(a,b){return a+b});_a.currentOffset=g/_a.offsetResults.length,_a.offsetResults=[],ab=!1,Ib(Ba,Ca,"log",{msg:"clockSync Done"})}else ab&&setTimeout(function(){wc()},100)}},yc=function(a,c){return Pa?(Ib(Ba,Ca,"log",{msg:"### _setupChannel is called when already connected!"}),void(c&&c(nb.success,"WebSocket establishment successful."))):Oa?void Ib(Ba,Ca,"log",{msg:"### _setupChannel is called when _connection is not null and not connected! Let's rely on auto reconnect!"}):(Oa=b.connect(a,{port:wa,reconnect:!0,"reconnection delay":500,"max reconnection attempts":500,reconnectionDelayMax:8e3}),Oa.on("connect",function(){Ib(Ba,Ca,"log",{msg:"Successfully connected to the backend",io_ver:b.protocol}),Pa=!0,_a.syncHandler||(Ib(Ba,Ca,"log",{msg:"start clockSync"}),_a.offsetResults=[],wc(),_a.syncHandler=!0),Ob(),Qa?ba():Xb(Oa),Qa=!1}),Oa.on("disconnect",function(){Pa=!1,aa(),ab&&(_a.offsetResults=[],_a.syncHandler=null,ab=!1),c&&c(nb.httpError,"Connection to the server disappeared.")}),Oa.on("connect_failed",function(){Pa=!1,c&&c(nb.wsChannelFailure,"WebSocket establishment failed.")}),Oa.on("reconnect",function(){Qa=!0}),Oa.on("reconnect_failed",function(){Pa=!1}),void Oa.on("response",function(a){var b=f(),d=JSON.parse(a);if("Error"===d.status)"Invalid client token."===d.reason&&(Fa=null,vc(Ba,Ea,Ca)),c&&c(nb.csProtoError,a.reason);else if("200 OK"===d.status)if("feedback"===d.event)window.localStorage.removeItem("feedback");else if(d.event===kb.userJoined||d.event===kb.refreshPresence){var e,g=!1,h=null,i=decodeURIComponent(d.conferenceID),j=function(a){return setInterval(function(){Wb(a)},Ua)};for(e in Za)if(Za.hasOwnProperty(e)&&e===i){Za[e].ucID!==d.ucID&&(g=!0,ha(e,d.ucID),h=d.conferenceCreationTS?d.conferenceCreationTS:d.conferenceDuration),d.event!==kb.userJoined||Za[e].refreshPresence||(Za[e].refreshPresence=j(i),ra()),Za[e].ucID=d.ucID;break}Yb(),Nb(g,h)}else d.event===lb.clockSync&&xc(d,b)}))};return i(),uc(),wc(),qa(),{version:xa,initialize:$b,fabricEvent:jb,addNewFabric:lc,sendFabricEvent:gc,sendUserFeedback:jc,associateMstWithUserID:kc,csError:nb,fabricUsage:qb,qualityRating:sb,webRTCFunctions:xb,reportError:ic,reportUserIDChange:mc,userIDType:rb,callStatsAPIReturnStatus:mb}};"function"==typeof define&&define.amd?define("callstats",["jquery","socketio","sha"],b):a.callstats=b}(this);
/*! callstats.js 2016-07-28 */
function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))?(d="Firefox",f=c.substring(a+8),b=g.moz):-1!==(a=c.indexOf("Trident"))&&(d="Microsoft Internet Explorer",a=c.indexOf("rv"),f=c.substring(a+3,a+7),b=g.goog);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j+" "+l,codebase:b}}
/*! callstats.js 2016-07-28 */
function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}