/*! callstats.js 2016-06-28 */
!function(a){"use strict";var b=function(a,b,c){function d(){}function e(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function f(){var a=g();return a+bb.currentOffset}function g(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function h(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){wa=a})}function i(){return wa?wa.level:void 0}function j(){return wa?wa.charging:void 0}function k(){navigator.mediaDevices.enumerateDevices().then(function(a){va=a})}function l(a){var b=a.toString();return null!==a.localDescription&&null!==a.localDescription.sdp&&a.localDescription.sdp.split("\r\n").filter(function(a){return 0===a.indexOf("o=")}).forEach(function(a){var d=a.split(" ")[1],e=new c(d,"TEXT");b=e.getHash("SHA-1","B64")}),b}function m(a){var b=new c(a,"TEXT");return b.getHash("SHA-1","B64")}function n(a,b){var c=l(a),d=l(b);return c===d}function o(a){var b=0;return null!==a.localDescription&&null!==a.localDescription.sdp&&""!==a.localDescription.sdp&&(b=a.localDescription.sdp.split("\r\n").filter(function(a){return 0===a.indexOf("o=")})),b.length}function p(){Ka||window.addEventListener("beforeunload",function(a){var b;for(b in _a)_a.hasOwnProperty(b)&&Ub(nb.userLeft,null,b,_a[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function q(a,b){setTimeout(function(){var b=f(),c=b-a.data.apiTS;a.data.timeShift=c,na(a.type,a.action,a.data,a.callback)},b)}function r(a,b,c,d,e){var f=l(d);Ub(nb.mediaPlaybackStartEvent,b,c,a,{ssrc:e},f,null)}function s(a,b,c,d,e){var f=l(d);Ub(nb.mediaSuspendedEvent,b,c,a,{ssrc:e},f,null)}function t(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=_a[b].ucID;f.oncanplay=function(){r(g,a,b,d,e)},f.onsuspend=function(){s(g,a,b,d,e)}}}function u(a){var b=Ya.codebase,c=!1;return null===a?c=!1:b===Hb.firefox?"undefined"!=typeof mozRTCPeerConnection&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!=typeof RTCPeerConnection&&a instanceof RTCPeerConnection&&(c=!0):("function"==typeof a||a instanceof lb||b===Hb.edge)&&(c=!0),c}function v(a,b){var d,e;return a&&(b===Hb.chrome?(d=a.googLocalAddress,d.concat(":",a.googRemoteAddress)):b===Hb.firefox&&(d=a.localAddr,d.concat(":",a.remoteAddr))),e=new c(d,"TEXT"),e.getHash("SHA-1","B64")}function w(){var a;return a=navigator.onLine===!0?"online":"offline"}function x(a,b){var c=Ib.unknown,d=null;if(b===Hb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=Ib.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=Ib.audio),d=a.data.googCodecName);else{if(b!==Hb.firefox)return;void 0!==a&&(void 0!==a.data.mediaType?c=a.data.mediaType:void 0!==a.data.framerateMean&&(c=Ib.video))}return a.data.ssrc in db&&(db[a.data.ssrc].mediaType=c,db[a.data.ssrc].codec=d),c}function y(a,b){return b===Hb.chrome&&void 0!==a.data.googCurrentDelayMs?a.data.googCurrentDelayMs:void 0}function z(a,b){var c;return b===Hb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===Hb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function A(a,b){var c="unavailable";if(b===Hb.chrome){var d,e,f;d=z(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===Hb.firefox;return c}function B(a){var b;return b=isNaN(a)||0>a?null:a}function C(a,b){var c;if(b===Hb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=B(parseInt(a.data.googRtt,10))}else if(b===Hb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=B(parseInt(a.data.mozRtt,10))}else if(b===Hb.edge&&a&&a.data.roundTripTime)return c=B(parseInt(a.data.roundTripTime,10))}function D(a,b){var c;if(b===Hb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=K(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===Hb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=K(parseInt(a.data.jitter,10))}function E(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function F(a,b,c){var d;return b===Ib.audio?a<c.audio.gThreshold?d=xb.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=xb.fair:a>c.audio.rThreshold&&(d=xb.bad):b===Ib.video&&(a<c.video.gThreshold?d=xb.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=xb.fair:a>c.video.rThreshold&&(d=xb.bad)),d}function G(a,b,c){var d;return b===Ib.audio?a>c.audio.gThreshold?d=xb.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=xb.fair:a<c.audio.rThreshold&&(d=xb.bad):b===Ib.video&&(a>c.video.gThreshold?d=xb.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=xb.fair:a<c.video.rThreshold&&(d=xb.bad)),d}function H(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===xb.excellent?b=yb.excellent:c===xb.fair?b=yb.fair:c===xb.bad&&(b=yb.bad)),b}function I(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(k={},h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k.hash=b[d].hash,l=c-g,l>0&&(k.receivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/l,k.sentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/l,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(k.sentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(l/1e3)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(k.receivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(l/1e3))),k.rtt=b[d].googRtt,m.push(k))}return m}function J(a,b,c,d){var e=[];return c===Hb.firefox?e=null:c===Hb.chrome&&(e=I(a,b,d)),e}function K(a){var b=isNaN(a)?null:a;return b}function L(a){if(a=K(a),null!==a){var b=0>a?null:a;return b}}function M(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function N(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,B,D,I,J,N,O,P,Q=null,R=null,S=null,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null;for(o in b.streams[c].outbound)if(b.streams[c].outbound.hasOwnProperty(o)){var aa=b.streams[c].outbound[o].data;void 0!==e.streams[c]&&void 0!==e.streams[c].outbound&&void 0!==e.streams[c].outbound[o]?(j=K(parseInt(e.streams[c].outbound[o].data.bytesSent,10)),k=a.lastStatsSent.apiTS,D=K(parseInt(e.streams[c].outbound[o].data.packetsSent,10)),J=K(parseInt(e.streams[c].outbound[o].data.packetsLost,10)),N=K(parseInt(e.streams[c].outbound[o].data.discardedPackets,10))):(j=0,k=g,J=0,D=0,N=0),m=g,u=m-k,p=x(b.streams[c].outbound[o],f),q=A(b.streams[c].outbound[o],f),r=z(b.streams[c].outbound[o],f),v=y(b.streams[c].outbound[o],f),void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].outbound&&(d.streams[c].outbound={}),d.streams[c].outbound[o]={},n=C(b.streams[c].outbound[o],f),l=K(parseInt(aa.bytesSent,10)),null!==l&&null!==j&&j>l&&(j=0,pc(Da,Ea,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:h,ucID:i})),void 0!==aa.droppedFrames&&(O=L(parseInt(aa.droppedFrames,10)),null!==O&&null!==N&&N>O&&(N=0),null!==O&&null!==N&&(P=O-N)),I=L(parseInt(aa.packetsLost,10)),null!==I&&null!==J&&(R=I-J),B=L(parseInt(aa.packetsSent,10)),null!==B&&null!==D&&(w=B-D),void 0!==R&&void 0!==w&&w+R>0&&(S=R/(w+R)),u>0&&(null!==l&&null!==j&&(Q=8*(l-j)/u),void 0!==w&&(_=w/(u/1e3))),a=M(a,c,"rttInfo",o,"outbound","rttArray",!0),a=M(a,c,"fractionalLossInfo",o,"outbound","fractionalLossArray",!0),a=M(a,c,"timeElapse",o,"outbound","totalTimeMs",!1),void 0!==n&&null!==n&&a.rttInfo.streams[c].outbound[o].rttArray.push(parseInt(n,10)),void 0!==S&&null!==S&&a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray.push(S),T=E(95,a.rttInfo.streams[c].outbound[o].rttArray),W=E(95,a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].outbound[o].totalTimeMs=a.timeElapse.streams[c].outbound[o].totalTimeMs+u),a.timeElapse.streams[c].outbound[o].totalTimeMs>0&&null!==l&&($=8*l/a.timeElapse.streams[c].outbound[o].totalTimeMs),d.streams[c].outbound[o]={csioIntMs:u,csioIntFL:S,csioIntPR:_,csioIntBRKbps:Q,csioMediaType:p,csioSig2Latency:T,csioAvgBRKbps:$,csioTimeElapseMs:a.timeElapse.streams[c].outbound[o].totalTimeMs,csioRes:q,csioPercentileFl:W,csioIntFramesDropped:P};for(var ba in aa)aa.hasOwnProperty(ba)&&(d.streams[c].outbound[o][ba]=aa[ba]);if(p===Ib.audio){var ca=T+40;U=F(ca,p,Gb),V=G(Q,p,Cb),s=H(U,V),d.streams[c].outbound[o].csioMark=s,d.streams[c].outbound[o].csioeM=ca}else p===Ib.video&&(t=parseInt(a.rttInfo.streams[c].outbound[o].frameRate,10),X=G(t/r,p,Db),Y=F(n,p,Eb),Z=G(Q,p,Cb),s=H(X,Y,Z),a.rttInfo.streams[c].outbound[o].frameRate=r,d.streams[c].outbound[o].csioMark=s)}}function O(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,B,I,J,N,O,P,Q,R,S,T,U,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null;for(q in b.streams[c].inbound)if(b.streams[c].inbound.hasOwnProperty(q)){var ea=b.streams[c].inbound[q].data;void 0!==e.streams[c]&&void 0!==e.streams[c].inbound&&void 0!==e.streams[c].inbound[q]?(j=K(parseInt(e.streams[c].inbound[q].data.bytesReceived,10)),n=K(parseInt(e.streams[c].inbound[q].data.packetsLost,10)),Q=K(parseInt(e.streams[c].inbound[q].data.packetsReceived,10)),k=a.lastStatsSent.apiTS,T=K(parseInt(e.streams[c].inbound[q].data.discardedPackets,10))):(j=0,k=g,n=0,Q=0,T=0),r=x(b.streams[c].inbound[q],f),s=A(b.streams[c].inbound[q],f),u=z(b.streams[c].inbound[q],f),t=D(b.streams[c].inbound[q],f),R=y(b.streams[c].inbound[q],f),p=C(b.streams[c].inbound[q],f),l=K(parseInt(ea.bytesReceived,10)),null!==l&&null!==j&&j>l&&(j=0,n=0,Q=0,pc(Da,Ea,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:h,ucID:i})),o=L(parseInt(ea.packetsLost,10)),m=g,void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].inbound&&(d.streams[c].inbound={}),d.streams[c].inbound[q]={},null!==o&&null!==n&&(W=o-n),void 0!==ea.discardedPackets&&(S=L(parseInt(ea.discardedPackets,10)),null!==S&&null!==T&&T>S&&(T=0),null!==S&&null!==T&&(U=S-T)),P=L(parseInt(ea.packetsReceived,10)),v=P-Q,void 0!==W&&null!==v&&v+W>0&&(Y=W/(v+W)),O=m-k,O>0&&(null!==l&&null!==j&&(V=8*(l-j)/O),null!==v&&(X=v/(O/1e3))),a=M(a,c,"rttInfo",q,"inbound","rttArray",!0),a=M(a,c,"timeElapse",q,"inbound","totalTimeMs",!1),a=M(a,c,"jitterInfo",q,"inbound","jitterArray",!0),a=M(a,c,"fractionalLossInfo",q,"inbound","fractionalLossArray",!0),void 0!==p&&null!==p&&a.rttInfo.streams[c].inbound[q].rttArray.push(parseInt(p,10)),void 0!==t&&null!==t&&a.jitterInfo.streams[c].inbound[q].jitterArray.push(parseInt(t,10)),void 0!==Y&&null!==Y&&a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray.push(Y),Z=E(95,a.rttInfo.streams[c].inbound[q].rttArray),$=E(95,a.jitterInfo.streams[c].inbound[q].jitterArray),_=E(95,a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].inbound[q].totalTimeMs=a.timeElapse.streams[c].inbound[q].totalTimeMs+O),null!==l&&a.timeElapse.streams[c].inbound[q].totalTimeMs>0&&(da=8*l/a.timeElapse.streams[c].inbound[q].totalTimeMs),d.streams[c].inbound[q]={csioIntMs:O,csioIntFL:Y,csioIntPR:X,csioIntBRKbps:V,csioSig2Latency:Z,csioAvgBRKbps:da,csioMediaType:r,csioTimeElapseMs:a.timeElapse.streams[c].inbound[q].totalTimeMs,csioIntPktRcv:v,csioIntPktLoss:W,csioPercentileJitter:$,csioRes:s,csioPercentileFl:_,csioIntPktDiscarded:U};for(var fa in ea)ea.hasOwnProperty(fa)&&(d.streams[c].inbound[q][fa]=ea[fa]);if(r===Ib.audio){var ga=Z+40;aa=F(ga,r,Gb),ba=F(Y,r,Fb),ca=G(V,r,Cb),w=H(aa,ba,ca),d.streams[c].inbound[q].csioMark=w,d.streams[c].inbound[q].csioeM=ga}else r===Ib.video&&(B=a.rttInfo.streams[c].inbound[q].frameRate,I=G(B/u,r,Db),J=F(p,r,Eb),N=G(V,r,Cb),w=H(I,J,N),a.rttInfo.streams[c].inbound[q].frameRate=u,d.streams[c].inbound[q].csioMark=w)}}function P(a,b,c,d,e,f){var g={streams:{}};g.fabricState=a.pcState,g.connectionState=w();var h=null;h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:{}};var i;for(i in b.streams)b.streams.hasOwnProperty(i)&&(void 0!==b.streams[i].inbound&&O(a,b,i,g,h,c,d,e,f),void 0!==b.streams[i].outbound&&N(a,b,i,g,h,c,d,e,f),void 0===g.streams[i]&&(g.streams[i]={}),b.streams[i].cname&&(g.streams[i].cname=b.streams[i].cname),b.streams[i].usage&&(g.streams[i].usage=b.streams[i].usage),b.streams[i].msid&&(g.streams[i].msid=b.streams[i].msid),b.streams[i].userID&&(g.streams[i].userID=b.streams[i].userID),b.streams[i].associatedVideoTag&&(g.streams[i].associatedVideoTag=b.streams[i].associatedVideoTag));if(c===Hb.firefox)for(i in g.streams)void 0!==g.streams[i].inbound&&void 0!==g.streams[i].inbound[wb.remote]&&(void 0===g.streams[i].outbound&&(g.streams[i].outbound={}),void 0===g.streams[i].outbound[wb.local]&&(g.streams[i].outbound[wb.local]={}),g.streams[i].outbound[wb.local].rtt=g.streams[i].inbound[wb.remote].rtt);return g}function Q(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===yb.bad?a.streams[b].inbound[d].mark=2:c===yb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===yb.bad?a.streams[b].outbound[d].mark=2:c===yb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function R(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function S(a){var b={};a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),Ja&&(b.conferenceURL=Ja);var c,d,e,f;b.streams={};for(c in a.streams)if(a.streams.hasOwnProperty(c)){if(void 0===b.streams[c]&&(b.streams[c]={}),a.streams[c].cname&&(b.streams[c].cname=a.streams[c].cname),a.streams[c].msid&&(b.streams[c].msid=a.streams[c].msid),a.streams[c].userID&&(b.streams[c].remoteUserID=a.streams[c].userID),a.streams[c].usage&&(b.streams[c].usageLabel=a.streams[c].usage),a.streams[c].associatedVideoTag&&(b.streams[c].associatedVideoTag=a.streams[c].associatedVideoTag),void 0!==a.streams[c].inbound)for(d in a.streams[c].inbound)a.streams[c].inbound.hasOwnProperty(d)&&(e=a.streams[c].inbound[d],d===wb.local&&(b.streams[c].reportType=wb.inbound,e.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=e.csioIntFL),e.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=e.csioIntBRKbps),e.hasOwnProperty("csioMark")&&(b.streams[c].quality=e.csioMark),e.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=e.csioMediaType),e.hasOwnProperty("googRtt")&&(b.streams[c].rtt=e.googRtt),e.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=e.mozRtt),e.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=e.roundTripTime),e.hasOwnProperty("jitter")&&(b.streams[c].jitter=e.jitter),e.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=e.googJitterReceived),e.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=e.audioOutputLevel),e.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=e.audioInputLevel)));if(void 0!==a.streams[c].outbound)for(d in a.streams[c].outbound)a.streams[c].outbound.hasOwnProperty(d)&&d===wb.local&&(f=a.streams[c].outbound[d],b.streams[c].reportType=wb.outbound,f.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=f.csioIntFL),f.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=f.csioIntBRKbps),f.hasOwnProperty("csioMark")&&(b.streams[c].quality=f.csioMark),f.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=f.csioMediaType),f.hasOwnProperty("googRtt")&&(b.streams[c].rtt=f.googRtt),f.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=f.mozRtt),f.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=f.roundTripTime),f.hasOwnProperty("jitter")&&(b.streams[c].jitter=f.jitter),f.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=f.googJitterReceived),f.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=f.audioInputLevel),f.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=f.audioOutputLevel))}return b}function T(a,b,c,e,g,h){var i=f();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&ma()&&!cb?(d("Pushing to the cloud ",a),na(ob.processedStats,mb.fabricStats,a,h),b.latestEventSent=i,b.lastFabricState=b.pcState):(a.clockUnsynced=cb,Pb({type:ob.processedStats,action:mb.fabricStats,data:a}),a.hasOwnProperty("token")||rc(Da,Ga,g))}function U(a,b,c,d,e,h,k){function l(l){var m=f(),n=g();void 0===e.lastRawStatsSentInterval||null===e.lastRawStatsSentInterval?e.lastRawStatsSentInterval=n-e.statsPollingStart:e.lastRawStatsSentInterval=n-e.rawstatsTS+e.lastRawStatsSentInterval,void 0===e.lastProcessedStatsSentInterval||null===e.lastProcessedStatsSentInterval?e.lastProcessedStatsSentInterval=n-e.statsPollingStart:e.lastProcessedStatsSentInterval=n-e.rawstatsTS+e.lastProcessedStatsSentInterval,e.rawstatsTS=n;var o={},p=Ya.codebase;o.version=Aa,o.appID=Da,o.conferenceID=encodeURIComponent(c),o.apiTS=m,o.timeShift=0,o.fabricState=e.pcState,o.pcID=e.pcHash,void 0!==d&&(o.ucID=d),Ha?o.token=Ha.challenge.token:rc(Da,Ga,a),o.localID=encodeURIComponent(a),o.remoteID=encodeURIComponent(b),o.deviceID=Ia;var q,r,s,t,u,w,x,y={streams:{}},z=null,A=!1,B=!1,C={},D={};if(p===Hb.firefox&&"Safari"!==Ya.name)z=[],l.forEach(function(a){z.push(a)});else if(p===Hb.chrome&&"Safari"!==Ya.name)z=l.result();else{z=[];for(q in l)z.push(l[q])}for(q=0;q<z.length;++q)if(r=Z(z[q]),s=W(JSON.parse(r),p),!$(s))if(s.hasOwnProperty("Transport"))t="Transport",y.hasOwnProperty(t)||(y[t]=[]),p!==Hb.firefox?(parseInt(s[t].bytesReceived,10)>0||parseInt(s[t].bytesSent,10)>0)&&(y[t].push(s[t]),"true"===s[t].googActiveConnection&&(o.activeConnectionIndex=y[t].length)):(y[t].push(s[t]),"true"===s[t].selected&&(o.activeConnectionIndex=y[t].length));else if(s.hasOwnProperty("localCandidate"))C[s.localCandidate.id]=s.localCandidate;else if(s.hasOwnProperty("remoteCandidate"))D[s.remoteCandidate.id]=s.remoteCandidate;else if(s.hasOwnProperty("bwe"))y.bwe=s.bwe;else{if(w=Rb(s.ssrc),void 0===w||!w.localStartTime){var E=Tb(b,c,d,e,h,null);E&&(B=!0),w=Rb(s.ssrc)}w&&(u=w.remoteUserID),void 0===u&&(u=b),void 0===y.streams[s.ssrc]&&(y.streams[s.ssrc]={userID:u},void 0!==w&&(y.streams[s.ssrc].cname=w.cname,y.streams[s.ssrc].msid=w.msid)),s.inbound?(void 0===y.streams[s.ssrc].inbound&&(y.streams[s.ssrc].inbound={}),x=y.streams[s.ssrc].inbound,x[s.reportType]={data:s.data},w&&(y.streams[s.ssrc].usage=w.usage,y.streams[s.ssrc].associatedVideoTag=w.associatedVideoTag)):(void 0===y.streams[s.ssrc].outbound&&(y.streams[s.ssrc].outbound={}),y.streams[s.ssrc].outbound[s.reportType]={data:s.data})}p===Hb.firefox&&(y.Transport=R(y.Transport,C,D));var F;if(y.Transport)for(F=0;F<y.Transport.length;F++)y.Transport[F].hash=v(y.Transport[F],p);o.statistics=y,y.Transport&&(A=Y(y.Transport,e)),A&&_b(h,nb.updatedConfiguration,c),e.pcState===zb.disrupted&&ba(o);var G=P(e,y,p,m,c,d);if(y.Transport&&(G.Transport=J(e,y.Transport,p,m)),y.bwe&&(G.bwe=y.bwe),void 0===e.processedStatsTupleArray&&(e.processedStatsTupleArray=[]),xa){var H=S(G);xa(H)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=i(),G.batteryStatus.isBatteryCharging=j(),G=Q(G),e.processedStatsTupleArray.push(G),o.processedStatistics=e.processedStatsTupleArray,e.lastStatsSent=o;var I=ra(o),K=ra(o);delete I.processedStatistics,delete K.statistics,B&&Ub(nb.ssrcMap,b,c,d,Sb(),e.pcHash),(e.lastProcessedStatsSentInterval>=Na||e.initialPhaseOver)&&(e.processedStatsTupleArray=[],T(K,e,c,b,a,k),e.lastProcessedStatsSentInterval=0)}return l}function V(a){var b;return Ab.hasOwnProperty(a)?a===Ab.createOffer||a===Ab.createAnswer||a===Ab.setRemoteDescription?b=Bb.negotiationFailure:a===Ab.setLocalDescription?b=Bb.sdpError:a===Ab.addIceCandidate?b=Bb.sdpError:a===Ab.getUserMedia?b=Bb.mediaConfigError:a===Ab.iceConnectionFailure?b=Bb.iceFailure:a===Ab.signalingError?b=Bb.signalingError:(a===Ab.applicationLog||Ab.applicationError)&&(b=Bb.applicationLog):b=Jb.invalidWebRTCFunctionName,b}function W(a,b){var c={};return b===Hb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inboundrtp"===a.type?!0:!1,c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===Hb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.inbound=!1:c.inbound=!0,c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"VideoBwe"===a.type&&(c.bwe=a):b===Hb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inbound-rtp"===a.type?!0:!1,c.data=a,c.reportType="local"):"transport"===a.type&&(c.Transport=a)),c}function X(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function Y(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=X(b)),!0):!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function Z(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function $(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function _(a){return{magicKey:a,statsSubmissionInterval:Sa,endpoint:$a,localUserName:Fa}}function aa(a,b,c){var d=_a[a];void 0===d&&(_a[a]={},_a[a].participants={},c&&(_a[a].userJoinedSent=!0),b&&(_a[a].refreshPresence=b))}function ba(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function ca(a){return clearInterval(a),null}function da(){var a;for(a in _a)_a.hasOwnProperty(a)&&(_a[a].refreshPresence=ca(_a[a].refreshPresence),delete _a[a].refreshPresence);ta()}function ea(){var a,b=function(a){return setInterval(function(){Wb(a)},Ua)};for(a in _a)_a.hasOwnProperty(a)&&(Wb(a),_a[a].refreshPresence=b(a));ua()}function fa(a){var b,c=_a[a],d=!1;if(void 0!==c)if(Object.keys(c.participants).length>0)d=!0;else for(b=0;b<eb.length;b++)if(eb[b].confID===a){d=!0;break}return d}function ga(a,b,c){var d,e=_a[a];if(void 0===e)d=new Hashtable({hashCode:l,equals:n}),d.put(c.pc,c),_a[a].participants[b]=d;else{var f=e.participants[b];if(void 0===f)d=new Hashtable({hashCode:l,equals:n}),d.put(c.pc,c),e.participants[b]=d;else{if(f.containsKey(c.pc))return;f.put(c.pc,c)}}}function ha(a,b){var c=!1;if(!_a[a])return{conferenceFinished:c,ucID:null};var d=_a[a].ucID;return 0===_a[a].participants[b].size()&&delete _a[a].participants[b],0===Object.keys(_a[a].participants).length&&(ca(_a[a].refreshPresence),ta(),delete _a[a],c=!0),{conferenceFinished:c,ucID:d}}function ia(a,b){Ub(nb.userLeft,null,a,b,null,null,null),gb=ca(gb),ta(),fb=Mb,Mb=null}function ja(a,b,c){var d=!1;if(null!==a&&void 0===a.challenge)return d;if(null!==a&&a.challenge.appID===b&&a.challenge.userID===encodeURIComponent(c)){var e=null;if(navigator.mozGetUserMedia){var g=a.challenge.expires.split(" ").join("T");e=Date.parse(g)}else e=new Date(a.challenge.expires);var h=new Date(f());e>h&&(d=!0)}return d}function ka(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),Ja[a]=Ca+encodeURIComponent(a)+"&ucid="+b}function la(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ma(){return Pa}function na(a,b,c,d){a===ob.clockSync?ma()?(bb.syncStartTime=g(),c.syncStartTime=bb.syncStartTime,c.offsetResultsLength=bb.offsetResults.length,Oa.emit(a,JSON.stringify(c)),d&&b!==mb.fabricStats&&d(qb.success,b+" sent to the backend.")):setTimeout(function(){sc()},100):ja(Ha,Da,Ea)?cb&&c.action!==nb.userJoined&&c.action!==nb.refreshPresence&&c.action!==nb.fabricSetupFailed||!ma()?(c.clockUnsynced=cb,Pb({type:b,action:a,data:c,callback:d})):(Oa.emit(a,JSON.stringify(c)),d&&b!==mb.fabricStats&&d(qb.success,b+" sent to the backend.")):rc(Da,Ga,Ea,function(e,f){e!==qb.success?(e===sb.authOngoing&&(c.clockUnsynced=cb,Pb({type:b,action:a,data:c,callback:d})),d&&e!==sb.authOngoing&&d(e,f)):e===qb.success&&"SDK authentication successful."===f&&(cb&&b!==nb.userJoined&&c.action!==nb.refreshPresence&&c.action!==nb.fabricSetupFailed||!ma()?(c.clockUnsynced=cb,Pb({type:b,action:a,data:c,callback:d})):(c.token=Ha.challenge.token,Oa.emit(a,JSON.stringify(c)),d&&b!==mb.fabricStats&&d(qb.success,b+" sent to the backend.")))})}function oa(a,b,d,e,f){var g=new c(b,"TEXT"),h=g.getHMAC(a,"TEXT","SHA-1","B64"),i={};i.version=Aa,i.challenge={},i.challenge.response=h,i.challenge.original=b,i.appID=d,i.userID=encodeURIComponent(e),i.authType=Ba;var j=ya+"o/challenge";qc(j,JSON.stringify(i),function(c){var g;if(200===c.status)g=JSON.parse(c.response),void 0!==g.challenge.status&&g.challenge.status!==qb.ok?g.challenge.reason===rb.csProtoError?(Wa=!1,pa(f)):g.challenge.reason===rb.csNoAuthState&&(Xa||(Xa=setTimeout(function(){rc(Da,Ga,Ea,f)},Va))):(g.appID=d,window.localStorage.setItem("auth_data",JSON.stringify(g)),Da=d,Ga=a,Ea=e,Ha=g,Wa=!1,Sa=parseInt(g.challenge.submissionInterval,10),Ta=g.challenge.collectSDP,f&&f(qb.success,"SDK authentication successful."),ma()?(Ob(),f&&f(qb.success,"WebSocket establishment successful.")):uc(ya+Ra,function(a,b){void 0!==f&&f(a,b)}));else if(200!==c.status&&((502===c.status||0===c.status)&&setTimeout(function(){oa(a,b,d,e,f)},Va),f)){var h;400===c.status?(h=c.responseText,f(qb.authError,h)):502===c.status||0===c.status?(h="HTTP "+c.status+", "+c.statusText+". Server temporarily unavailable. Retrying in "+Va+"ms",f(qb.appConnectivityError,h)):(h="HTTP "+c.status+", "+c.statusText+". "+c.responseText,f(qb.httpError,h))}})}function pa(a){return a?void a(qb.csProtoError,"Fatal authentication error. Invalid auth protocol message."):void console.error("Fatal authentication error. Invalid auth protocol message.")}function qa(a){a&&a(sb.authOngoing,null)}function ra(a){if(null===a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)b[c]=ra(a[c]);return b}function sa(){var a={};Object.keys(_a).forEach(function(b){var c=_a[b];if(!c)return!0;var d={ucID:c.ucID,userJoinedSent:c.userJoinedSent},e={};c.participants&&Object.keys(c.participants).forEach(function(a){for(var b=c.participants[a].values(),d=[],f=0;f<b.length;f++){var g=b[f];d.push({pcID:g.pcHash,pcState:g.pcState,iceConnectionState:g.iceConnectionState,iceGatheringState:g.iceGatheringState,iceCandidatesNumber:g.iceCandidates.length})}e[a]=d}),d.participants=e,a[b]=d});var b={authStatus:Ha?!0:!1,clockSync:!cb,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:Aa};pc(Da,Ea,"stateMachine",b)}function ta(){hb||(hb=setInterval(function(){sa()},ib))}function ua(){ca(hb),hb=null}var va,wa,xa,ya="https://collector.callstats.io:443/",za="443",Aa="3.12.3",Ba="BasicAuth",Ca="https://dashboard.callstats.io/search?confid=",Da=-1,Ea="",Fa=null,Ga=null,Ha=null,Ia=null,Ja={},Ka=!1,La=!1,Ma=3e4,Na=1e4,Oa=null,Pa=!1,Qa=!1,Ra="collectCallStats",Sa=15e3,Ta=!1,Ua=1e4,Va=5e3,Wa=!1,Xa=null,Ya=detectBrowserInfo(),Za=measureAppLoadingPerformance(Ya),$a={type:"browser",name:Ya.name,ver:Ya.ver,os:Ya.os},_a={},ab={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},bb={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},cb=!0,db={},eb=[],fb=null,gb=null,hb=null,ib=2e4,jb=[],kb=100,lb=null;"Firefox"===Ya.name?lb=mozRTCPeerConnection:"Chrome"===Ya.name||"Opera"===Ya.name?lb=webkitRTCPeerConnection:"Safari"===Ya.name?d("Browser type Safari"):"Edge"===Ya.name&&(lb=window.RTCPeerConnection);var mb={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},nb={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},ob={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},pb={success:"success",failure:"failure"},qb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",ok:"OK"},rb={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},sb={authOngoing:"authOngoing"},tb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},ub={local:"local",remote:"remote"},vb={excellent:5,good:4,fair:3,poor:2,bad:1},wb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},xb={excellent:3,fair:2,bad:1},yb={excellent:"excellent",fair:"fair",bad:"bad"},zb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"
},Ab={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},Bb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},Cb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},Db={video:{gThreshold:.8,rThreshold:.3}},Eb={video:{gThreshold:400,rThreshold:1e3}},Fb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},Gb={audio:{gThreshold:240,rThreshold:400}},Hb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},Ib={unknown:"unknown",audio:"audio",video:"video"};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:Aa,eventType:"error",message:a.message,pageURL:window.location.href};for(b in _a)_a.hasOwnProperty(b)&&(d.conferenceID=b,pc(Da,Ea,"onErrorLog",d),c=!0);c||pc(Da,Ea,"onErrorLog",d)}});var Jb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Kb="fabricSetupFailed error reported by the developer",Lb="Connectivity Failure",Mb=e(),Nb=function(a,b){if(!Ha)return void rc(Da,Ga,Ea);if(!cb){var c,d,e,g=f(),h=[],i=Math.max(Sa/jb.length,kb);for(c=0;c<jb.length;c++)if(d=jb[c],d.data.action!==nb.userJoined){if(d.data.token=Ha.challenge.token,(a&&d.data.apiTS>=g-b||!d.data.ucID)&&(e=decodeURIComponent(d.data.conferenceID),d.data.ucID=_a[e].ucID),d.data.clockUnsynced&&(d.data.apiTS+=bb.currentOffset),d.action===mb.fabricStats&&d.data.clockUnsynced&&d.data.processedStatistics&&d.data.processedStatistics.length>0)for(var j=0;j<d.data.processedStatistics.length;j++)d.data.processedStatistics[j].apiTS+=bb.currentOffset;delete d.data.clockUnsynced,q(d,i*(c+1))}else h.push(jb[c]);jb=h}},Ob=function(){if(!Ha)return void rc(Da,Ga,Ea);var a,b,c=[],d=Math.max(Sa/jb.length,kb);for(a=0;a<jb.length;a++)b=jb[a],b.type!==ob.callStatsEvent||b.data.action!==nb.userJoined&&b.data.action!==mb.fabricSetupFailed?c.push(jb[a]):(b.data.token=Ha.challenge.token,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+bb.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Sa),q(b,d*(a+1)));jb=c},Pb=function(a){jb.push(a)},Qb=function(a,b){var c=RegExp.prototype.test.bind(/^([a-z])=(.*)/),d=/^ssrc:(\d*) ([\w_]*):(.*)/;a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],e=a.slice(2);if("a"===c&&d.test(e)){var h=e.match(d),i=h[1];void 0===db[i]&&(db[i]={}),db[i][h[2]]=h[3],db[i].localStartTime=g(),db[i].syncedStartTime=f(),db[i].streamType=b}})},Rb=function(a){return db[a]},Sb=function(){return db},Tb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Qb(g,wb.outbound),Qb(h,wb.inbound),Ta){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Vb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Ub=function(a,b,c,d,e,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=f(),j={version:Aa,apiTS:i,action:a,localID:encodeURIComponent(Ea),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:Da,ucID:d,pcID:g,deviceID:Ia,value:e};return null===b&&(j.remoteID=null),null===c?void pc(Da,Ea,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(Ha&&ma()&&(d&&!cb||a===nb.userJoined||a===mb.fabricSetupFailed||a===nb.refreshPresence)?(j.token=Ha.challenge.token,na(ob.callStatsEvent,a,j,h)):(j.clockUnsynced=cb,Ha||rc(Da,Ga,Ea),a!==nb.fabricStatsCaching&&a!==nb.refreshPresence&&Pb({type:ob.callStatsEvent,action:ob.callStatsEvent,data:j,callback:h})))},Vb=function(a,b,c,d,e,g){var h=f(),i={version:Aa,appID:Da,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(Ea),remoteID:encodeURIComponent(a),pcID:e,deviceID:Ia,sdpPayload:d};Ha&&ma()&&c&&!cb?(i.token=Ha.challenge.token,na(ob.sdpSubmission,ob.sdpSubmission,i,g)):(i.clockUnsynced=cb,Pb({type:ob.sdpSubmission,action:ob.sdpSubmission,data:i,callback:g}),Ha||rc(Da,Ga,Ea))},Wb=function(a){var b={ucID:_a[a].ucID,magicKey:Mb,endpoint:$a,fabricState:{},connectedDevices:va},c=_a[a];if(c){var d,e,f=c.participants,g=0;for(d in f){e=f[d];for(var h=e.keys(),i=0;i<h.length;i++){var j=e.get(h[i]),k=j.pcHash;b.fabricState[g]={},b.fabricState[g].pc=k,b.fabricState[g].userId=d,b.fabricState[g].pcState=j.pcState,b.fabricState[g].iceConnectionState=j.pc.iceConnectionState,b.fabricState[g].iceGatheringState=j.pc.iceGatheringState,b.fabricState[g].iceCandidatesNumber=j.iceCandidates.length,b.fabricState[g].numNegotiationNeededCalls=j.numNegotiationNeededCalls,g++}}}cb||(b.clockSyncOffset=bb.currentOffset),Ub(nb.refreshPresence,null,a,_a[a].ucID,b,null)},Xb=function(a){var b={appID:Da,userID:encodeURIComponent(Ea),version:Aa,endpoint:$a,pagePerf:Za,endpointID:Ia,wsID:a.io.engine.id};-1!==Da&&Ha&&(b.token=Ha.challenge.token,a.emit(ob.registerPresence,JSON.stringify(b)))},Yb=function(){var a=window.localStorage.getItem("feedback"),b=JSON.parse(window.localStorage.getItem("auth_data"));if(null!==a){var c=JSON.parse(a),d=b.challenge.token===c.token?!0:!1;d||Ea!==c.userID||(c.token=b.challenge.token,d=!0),d?na(ob.userFeedback,ob.userFeedback,c):window.localStorage.removeItem("feedback")}},Zb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},$b=function(a,b,d,e,f,h){if(!a||!b||null===d||void 0===d||0>=a)return console.error("initialize: Argument missing/invalid"),Zb(pb.failure,"initialize: Argument missing/invalid");if("string"==typeof a&&(a=parseInt(a,10)),Da=a,Ga=b,"object"==typeof d?(Fa=d.userName,Ea=d.displayName):Ea=d,h&&(h.disableBeforeUnloadHandler===!0&&(Ka=!0),(null!==h.applicationVersion||void 0!==h.applicationVersion)&&($a.appVer=h.applicationVersion)),p(),Ia=window.localStorage.getItem("endpointID"),null===Ia){var i=g(),j=Math.random()*i,l=new c(j.toString(),"TEXT");Ia=l.getHash("SHA-1","B64"),window.localStorage.setItem("endpointID",Ia)}k(),xa=f;var m=JSON.parse(window.localStorage.getItem("auth_data"));return ja(m,a,d)?(e&&e(qb.success,"SDK already authenticated."),Sa=parseInt(m.challenge.submissionInterval,10),Ta=m.challenge.collectSDP,Ha=m,ma()||uc(ya+Ra,e)):rc(a,b,d,e),Zb(pb.success)},_b=function(a,b,c,d){if(!a||!b||!c)return console.error("sendFabricEvent: Arguments missing/Invalid"),Zb(pb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!Da||0>Da||!Ga||""===Ea||!_a[c])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Zb(pb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===mb.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Zb(pb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!u(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Zb(pb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!mb.hasOwnProperty(b)&&!nb.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Zb(pb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var e=null,f=null,h=g(),i=_a[c],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Zb(pb.failure,"sendFabricEvent: Conference ID not found!");if(Object.keys(_a[c].participants).length>0&&(f=gc(i,a),null!==f&&(j=_a[c].participants[f].get(a))),null===j){var k=l(a),m=ic(k);if(null===m)return console.error("sendFabricEvent: pcObject is null"),Zb(pb.failure,"sendFabricEvent: pcObject is null");f=m.remoteID,j=m.fabricData}var n=j.startTime;if(!(b===mb.fabricSetup||b===nb.autoFabricSetup&&j.fabricSetupSent)){if(b===nb.autoFabricSetup){var o=h-j.startTime;e={setupDelay:o,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.pcState=zb.established,j.fabricSetupSent=!0}else if(b===nb.autoFabricSetupFailed)e={failureDelay:j.setupFailureTime,reason:Bb.iceFailure,domError:Lb};else if(b===nb.fabricDisrupted)e={disruptionDelay:j.connectivityIceStatusDelay};else if(b===nb.updatedConfiguration)e=j.transportData;else if(b===mb.fabricSetupFailed){var p=h-n;e={failureDelay:p,reason:Bb.iceFailure,domError:Kb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":Ab.iceConnectionFailure,magicKey:Mb,endpoint:$a}}else if(b===mb.activeDeviceList){if(!d||!d.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Zb(pb.failure,"sendFabricEvent: Arguments missing/Invalid");e={magicKey:Mb,endpoint:$a,activeDevicelist:d.deviceList}}if(Ub(b,f,c,i.ucID,e,j.pcHash,j.pcCallback),(b===mb.fabricTerminated||b===nb.autoFabricSetupFailed||b===mb.fabricSetupFailed)&&_a[c].participants[f]){j&&(j.statsInterval=ca(j.statsInterval)),_a[c].participants[f].remove(a);var q=ha(c,f);q.conferenceFinished&&ia(c,q.ucID)}if((b===mb.fabricSetup||b===mb.fabricUsageEvent)&&!j.fabricUsageSent){var r=j.fabricUsage;j.fabricUsageSent=!0,Ub(mb.fabricUsageEvent,f,c,i.ucID,r,j.pcHash,null)}return Zb(pb.success)}},ac=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},bc=function(a,b,c,d,f,h){if(void 0===a||!c||!b)return console.error("reportError: Arguments missing/invalid"),Zb(pb.error,"reportError: Arguments missing/invalid");if(0>Da||!Da||!Ga||""===Ea)return console.error("reportError: SDK is not initialized"),Zb(pb.error,"reportError: SDK is not initialized");if(!Ab.hasOwnProperty(c))return console.error("reportError: Invalid webRTC functionName value: %o",c),Zb(pb.error,"reportError: Invalid webRTC functionName value: "+c);void 0===d&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=g(),n=_a[b],o=null;if(i=V(c),d&&d instanceof DOMException)d={message:d.message,name:d.name};else if(d&&"object"==typeof d){var p={};"message"in d&&(p.message=d.message),"name"in d&&(p.name=d.name),"constraintName"in d&&(p.constraintName=d.constraintName),"stack"in d&&(p.stack=d.stack),d=p}if(u(a)){if(void 0===n)return console.error("reportError: Conference ID not found!"),Zb(pb.error,"reportError: Conference ID not found!");if(Object.keys(_a[b].participants).length>0&&(k=gc(n,a),null!==k&&(o=_a[b].participants[k].get(a))),null===o){var q=hc(a);if(null===q)return console.error("reportError: Invalid pcObject passed as argument"),Zb(pb.error,"reportError: Invalid pcObject passed as argument");k=q.remoteID,o=q.fabricData,o.pcHash=m(k.concat(":",b))}var r=o.startTime,s=l-r;if(j={failureDelay:s,reason:i,domError:d,fabricState:o.pcState,iceConnectionState:o.pc.iceConnectionState,"function":c,magicKey:Mb,endpoint:$a},c===Ab.applicationLog||c===Ab.applicationError?Ub(mb.applicationErrorLog,k,b,n.ucID,j,o.pcHash,o.pcCallback):Ub(mb.fabricSetupFailed,k,b,n.ucID,j,o.pcHash,o.pcCallback),f||h||a&&a.localDescription||a&&a.remoteDescription){var t={sdp:{}};t.sdp.localSDP=ac(a,f,"localDescription"),t.sdp.remoteSDP=ac(a,h,"remoteDescription"),Vb(k,b,n.ucID,t,o.pcHash)}}else{null===Mb&&(Mb=e());var v=e();j={failureDelay:0,reason:i,domError:d,"function":c,magicKey:Mb,endpoint:$a},c===Ab.applicationLog||c===Ab.applicationError?Ub(mb.applicationErrorLog,k,b,null,j,v,null):Ub(mb.fabricSetupFailed,k,b,null,j,v,null)}return Zb(pb.success)},cc=function(a,b,c){if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Zb(pb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Zb(pb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Zb(pb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Zb(pb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var d=_a[a],e=null;void 0!==d&&void 0!==d.ucID&&(e=d.ucID);var f=null;if(f=null===Mb?fb:Mb,null===e&&(e=la(a)),null===e)return console.error("sendUserFeedback: ucID unavailable"),Zb(pb.error,"sendUserFeedback: ucID unavailable");var g={conferenceID:encodeURIComponent(a),magicKey:f,appID:Da,version:Aa,ucID:e,userID:encodeURIComponent(b.userID),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?g.userQoe.video=b.video:g.userQoe.video=-1,b.hasOwnProperty("audio")?g.userQoe.audio=b.audio:g.userQoe.audio=-1,b.hasOwnProperty("screen")?g.userQoe.screen=b.screen:g.userQoe.screen=-1,b.hasOwnProperty("comment")?g.userQoe.comment=b.comment:g.userQoe.comment=-1,Ha&&!cb?(g.token=Ha.challenge.token,window.localStorage.setItem("feedback",JSON.stringify(g)),na(ob.userFeedback,ob.userFeedback,g,c)):(g.clockUnsynced=cb,Pb({type:ob.userFeedback,action:ob.userFeedback,data:g,callback:c}),rc(Da,Ga,Ea)),Zb(pb.success)},dc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.displayName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Zb(pb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Zb(pb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!u(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Zb(pb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=_a[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Zb(pb.error,"associateMstWithUserID: conferenceID doesn't exist");var i,j,k=h.participants,l=null;for(i in k)if(k.hasOwnProperty(i)&&(j=k[i],l=j.get(a)))break;if(null===l){var m=hc(a);if(null===m)return console.error("associateMstWithUserID: Unknown pcObject passed"),Zb(pb.error,"associateMstWithUserID: Unknown pcObject passed");l=m.fabricData}var n=Rb(d);return void 0===n&&(db[d]={},n=Rb(d)),n.remoteUserID=g,n.ssrc=d,n.associatedVideoTag=f,n.usageLabel=e,f&&g!==Ea&&t(g,c,f,a,d),Zb(pb.success)},ec=function(a,b,c,d,f){var h=null,i={authStatus:Ha?!0:!1,clockSync:!cb,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:d,version:Aa};if(pc(Da,Ea,"stateMachine",i),h="object"==typeof b?b.displayName:b,!(a&&h&&c&&d))return console.error("addNewFabric: Arguments missing/Invalid"),Zb(pb.error,"addNewFabric: Arguments missing/Invalid");if(0>Da||!Da||!Ga||""===Ea)return console.error("addNewFabric: SDK not initialized."),Zb(pb.error,"addNewFabric: SDK not initialized");if(""===d||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Zb(pb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!u(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Zb(pb.error,"addNewFabric: Invalid PeerConnection object passed");if(!tb.hasOwnProperty(c)||c instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Zb(pb.error,"addNewFabric: Invalid fabricUsage value");var j=g();null===Mb&&(Mb=e());var k=null,m=!1;if(!fa(d)){var n=_(Mb);Ub(nb.userJoined,null,d,null,n,null,null),m=!0,i={authStatus:Ha?!0:!1,clockSync:!cb,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:d,version:Aa},pc(Da,Ea,"stateMachine",i)}a.addEventListener("icecandidate",nc,!1),a.addEventListener("iceconnectionstatechange",mc,!1),a.addEventListener("signalingstatechange",jc,!1),a.addEventListener("negotiationneeded",lc,!1);var p=l(a),q={pc:a,fabricUsage:c,magicKey:Mb,startTime:j,pcCallback:f,pcState:zb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:j,pcHash:p,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};if("function"==typeof a&&(a.callstatsID=e()),("connected"===a.iceConnectionState||"completed"===a.iceConnectionState)&&(q.pcState=zb.established),aa(d,k,m),o(a))ga(d,h,q);else{var r={confID:d,remoteID:h,fabricData:q};a.callstatsID&&(r.callstatsID=a.callstatsID),eb.push(r)}return q.pcState===zb.established&&(_b(a,nb.autoFabricSetup,d),kc(q,a,d,h)),Zb(pb.success)},fc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Zb(pb.error,"reportUserIDChange: Arguments missing/Invalid");if(0>Da||!Da||!Ga||""===Ea)return console.error("reportUserIDChange: SDK not initialized."),Zb(pb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Zb(pb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!u(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Zb(pb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=_a[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Zb(pb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),pc(Da,Ea,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Zb(pb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,Object.keys(_a[b].participants).length>0&&(e=gc(g,a),null!==e&&(f=_a[b].participants[e].get(a))),null===f){var i=hc(a);if(null===i)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Zb(pb.error,"reportUserIDChange: Invalid pcObject passed as argument");e=i.remoteID,f=i.fabricData}var j={id:c,idType:d};return Ub(mb.userIDChangedEvent,e,b,g.ucID,j,null,f.pcCallback),Zb(pb.success)},gc=function(a,b){var c;for(c in a.participants)if(a.participants.hasOwnProperty(c)&&a.participants[c].containsKey(b))return c;return null},hc=function(a){var b;for(b=0;b<eb.length;b++)if(a===eb[b].fabricData.pc||a.callstatsID&&a.callstatsID===eb[b].callstatsID)return eb[b];return null},ic=function(a){var b;for(b=0;b<eb.length;b++)if(eb[b].fabricData.pcHash===a)return eb[b];return null},jc=function(a){if(a){var b,c=Ya.codebase;if(c===Hb.firefox)b=a.target;else if(c===Hb.chrome)b=a.srcElement;else{if(c!==Hb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var d=b.signalingState;if("closed"===d){var e,f;for(e in _a)if(_a.hasOwnProperty(e))for(f in _a[e].participants)if(_a[e].participants.hasOwnProperty(f)&&_a[e].participants[f].containsKey(b))return void _b(b,mb.fabricTerminated,e)}else if("have-local-offer"===d||"have-remote-offer"===d||"stable"===d){var g,h,i,j,k=-1;for(g=0;g<eb.length;g++)if(j=eb[g].fabricData,(b===j.pc||b.callstatsID===j.pc.callstatsID)&&o(b)){h=eb[g].confID,i=eb[g].remoteID,k=g,j.pcHash=l(j.pc),ga(h,i,j);break}-1!==k&&eb.splice(k,1)}}}},kc=function(a,b,c,d){null===a.statsInterval&&(a.statsPollingStart=g(),oc(b,c,d),a.statsInterval=setInterval(oc,ab.statsSubmissionIntervalInMS[ab.currentActivePhaseIndex],b,c,d))},lc=function(a){if(a){var b,c=Ya.codebase;if(c===Hb.firefox)b=a.target;else if(c===Hb.chrome)b=a.srcElement;else{if(c!==Hb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,f;for(d in _a)if(_a.hasOwnProperty(d))for(e in _a[d].participants)if(_a[d].participants.hasOwnProperty(e)&&_a[d].participants[e].containsKey(b)){f=_a[d].participants[e].get(b);break}null==f&&(f=hc(b)),null!=f&&f.numNegotiationNeededCalls++}}},mc=function(a){if(a){var b,c=Ya.codebase;if(c===Hb.firefox)b=a.target;else if(c===Hb.chrome)b=a.srcElement;else{if(c!==Hb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,f,h,i;for(d in _a)if(_a.hasOwnProperty(d))for(e in _a[d].participants)if(_a[d].participants.hasOwnProperty(e)&&_a[d].participants[e].containsKey(b)){f=_a[d].participants[e].get(b),h=g(),i=h-f.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(f.gatheringIceCandidatesDelay=i),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(f.connectivityIceStatusDelay=i,f.pcState===zb.initializing?f.fabricSetupSent||_b(f.pc,nb.autoFabricSetup,d):f.pcState===zb.disrupted&&_b(f.pc,nb.fabricDisrupted,d),f.pcState=zb.established,kc(f,b,d,e)):"failed"===b.iceConnectionState?(f.setupFailureTime=i,_b(f.pc,nb.autoFabricSetupFailed,d),f.pcState=zb.failed):"disconnected"===b.iceConnectionState&&(f.startTime=g(),f.pcState=zb.disrupted,f.pcCallback&&f.pcCallback(qb.appConnectivityError,"Connectivity check for PC object to "+e+" failed.")),f.iceConnectionState=b.iceConnectionState;break}}}},nc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Ya.codebase;if(h===Hb.firefox)g=a.target;else if(h===Hb.chrome)g=a.srcElement;else{if(h!==Hb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i,j,k;for(i in _a)if(_a.hasOwnProperty(i))for(j in _a[i].participants)if(_a[i].participants.hasOwnProperty(j)&&_a[i].participants[j].containsKey(g))return k=_a[i].participants[j].get(g),void(void 0!==b&&-1===k.iceCandidates.indexOf(b)&&k.iceCandidates.push(b))}},oc=function(a,b,c){if(!_a.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!_a[b].participants.hasOwnProperty(c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return _b(a,mb.fabricTerminated,b),!0;var d=_a[b].participants[c].get(a);if(d.pcState!==zb.established&&d.lastFabricState===d.pcState)return!0;var e=Ya.codebase,f=Ya.name,h=_a[b].ucID;e===Hb.firefox||"Safari"===f?a.getStats(null,U(Ea,c,b,h,d,a,d.pcCallback),function(a){pc(Da,Ea,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})}):e===Hb.chrome?a.getStats(U(Ea,c,b,h,d,a,d.pcCallback)):e===Hb.edge&&a.getStats().then(U(Ea,c,b,h,d,a,d.pcCallback))["catch"](function(a){pc(Da,Ea,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})});var i,j=g(),k=j-d.statsPollingStart,l=5e3;(k>ab.statsSubmissionPhaseDurationInMS[ab.currentActivePhaseIndex]&&d.intervalAdaptionPhase||La===!0)&&(ca(d.statsInterval),La?(i=Ma,d.intervalAdaptionPhase=!1,La=!1):ab.currentActivePhaseIndex<ab.statsSubmissionIntervalInMS.length-1?(ab.currentActivePhaseIndex+=1,i=ab.statsSubmissionIntervalInMS[ab.currentActivePhaseIndex]):(i=Sa,d.intervalAdaptionPhase=!1),i>l&&(d.initialPhaseOver=!0),d.statsInterval=setInterval(oc,i,a,b,c))},pc=function(a,b,c,d){var e=ya+"generics",f={appID:a,userID:encodeURIComponent(b),version:Aa,eventType:c,data:d};qc(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})},qc=function(a,b,c){var d=new XMLHttpRequest;d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b)},rc=function(a,b,c,d){if(!(void 0===a||void 0===b||void 0===c||0>=a||0>c)){if(Wa)return void qa(d);Xa&&(clearTimeout(Xa),Xa=null),Wa=!0;var e=ya+"o/authorize",f={appID:a,userID:encodeURIComponent(c),version:Aa,authType:Ba};qc(e,JSON.stringify(f),function(e){var f;if(200===e.status)f=JSON.parse(e.response),void 0!==f.authorize.status&&f.authorize.status!==qb.ok?f.reason===rb.csProtoError&&(Wa=!1,pa(d)):oa(b,f.authorize.challenge,a,c,d);else if(200!==e.status&&(Wa=!1,(502===e.status||0===e.status||500===e.status)&&(Xa||(Xa=setTimeout(function(){rc(a,b,c,d)},Va))),void 0!==d)){var g;400===e.status?(g=e.responseText,d(qb.authError,g)):502===e.status||0===e.status||500===e.status?(g="HTTP "+e.status+", "+e.statusText+". Server temporarily unavailable. Retrying in "+Va+"ms",d(qb.appConnectivityError,g)):(g="HTTP "+e.status+", "+e.statusText+". "+e.responseText,d(qb.httpError,g))}})}},sc=function(){na(ob.clockSync,ob.clockSync,{userID:Ea},null)},tc=function(a,b){if(cb){var c=(b-bb.syncStartTime)/2;if(c>bb.maxAllowedLatency)bb.offsetResults=[],pc(Da,Ea,"log",{msg:"clockSync restarting"});else{var d=a.now+c,e=d-b;bb.offsetResults.push(e)}if(bb.offsetResults.length>=bb.syncAttempts){var f=bb.offsetResults.reduce(function(a,b){return a+b});bb.currentOffset=f/bb.offsetResults.length,bb.offsetResults=[],cb=!1,pc(Da,Ea,"log",{msg:"clockSync Done"})}else cb&&setTimeout(function(){sc()},100)}},uc=function(a,c){return Pa?(pc(Da,Ea,"log",{msg:"### _setupChannel is called when already connected!"}),void(c&&c(qb.success,"WebSocket establishment successful."))):Oa?void pc(Da,Ea,"log",{msg:"### _setupChannel is called when _connection is not null and not connected! Let's rely on auto reconnect!"}):(Oa=b.connect(a,{port:za,reconnect:!0,"reconnection delay":500,"max reconnection attempts":500,reconnectionDelayMax:8e3}),Oa.on("connect",function(){pc(Da,Ea,"log",{msg:"Successfully connected to the backend",io_ver:b.protocol}),Pa=!0,bb.syncHandler||(pc(Da,Ea,"log",{msg:"start clockSync"}),bb.offsetResults=[],sc(),bb.syncHandler=!0),Ob(),Qa?ea():Xb(Oa),Qa=!1}),Oa.on("disconnect",function(){Pa=!1,da(),cb&&(bb.offsetResults=[],bb.syncHandler=null,cb=!1),c&&c(qb.httpError,"Connection to the server disappeared.")}),Oa.on("connect_failed",function(){Pa=!1,c&&c(qb.wsChannelFailure,"WebSocket establishment failed.")}),Oa.on("reconnect",function(){Qa=!0}),Oa.on("reconnect_failed",function(){Pa=!1}),void Oa.on("response",function(a){var b=g(),d=JSON.parse(a);if("Error"===d.status)"Invalid client token."===d.reason&&(Ha=null,rc(Da,Ga,Ea)),c&&c(qb.csProtoError,a.reason);else if("200 OK"===d.status)if("feedback"===d.event)window.localStorage.removeItem("feedback");else if(d.event===nb.userJoined||d.event===nb.refreshPresence){var e,f=!1,h=null,i=decodeURIComponent(d.conferenceID),j=function(a){return setInterval(function(){Wb(a)},Ua)};for(e in _a)if(_a.hasOwnProperty(e)&&e===i){_a[e].ucID!==d.ucID&&(f=!0,ka(e,d.ucID),h=d.conferenceCreationTS?d.conferenceCreationTS:d.conferenceDuration),d.event!==nb.userJoined||_a[e].refreshPresence||(_a[e].refreshPresence=j(i),ua()),_a[e].ucID=d.ucID;break}Yb(),Nb(f,h)}else d.event===ob.clockSync&&tc(d,b)}))};return h(),uc(ya+Ra),ta(),{version:Aa,initialize:$b,fabricEvent:mb,addNewFabric:ec,sendFabricEvent:_b,sendUserFeedback:cc,associateMstWithUserID:dc,csError:qb,fabricUsage:tb,qualityRating:vb,webRTCFunctions:Ab,reportError:bc,reportUserIDChange:fc,userIDType:ub,callStatsAPIReturnStatus:pb}};"function"==typeof define&&define.amd?define("callstats",["jquery","socketio","sha"],b):a.callstats=b}(this);
/**
 * @license jahashtable, a JavaScript implementation of a hash table. It creates a single constructor function called
 * Hashtable in the global scope.
 *
 * http://www.timdown.co.uk/jshashtable/
 * Copyright 2013 Tim Down.
 * Version: 3.0
 * Build date: 17 July 2013
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Hashtable=function(t){function n(t){return typeof t==p?t:""+t}function e(t){var r;return typeof t==p?t:typeof t.hashCode==y?(r=t.hashCode(),typeof r==p?r:e(r)):n(t)}function r(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}function i(t,n){return t.equals(n)}function u(t,n){return typeof n.equals==y?n.equals(t):t===n}function o(n){return function(e){if(null===e)throw new Error("null is not a valid "+n);if(e===t)throw new Error(n+" must not be undefined")}}function s(t,n,e,r){this[0]=t,this.entries=[],this.addEntry(n,e),null!==r&&(this.getEqualityFunction=function(){return r})}function a(t){return function(n){for(var e,r=this.entries.length,i=this.getEqualityFunction(n);r--;)if(e=this.entries[r],i(n,e[0]))switch(t){case E:return!0;case K:return e;case q:return[r,e[1]]}return!1}}function l(t){return function(n){for(var e=n.length,r=0,i=this.entries,u=i.length;u>r;++r)n[e+r]=i[r][t]}}function f(t,n){for(var e,r=t.length;r--;)if(e=t[r],n===e[0])return r;return null}function h(t,n){var e=t[n];return e&&e instanceof s?e:null}function c(){var n=[],i={},u={replaceDuplicateKey:!0,hashCode:e,equals:null},o=arguments[0],a=arguments[1];a!==t?(u.hashCode=o,u.equals=a):o!==t&&r(u,o);var l=u.hashCode,c=u.equals;this.properties=u,this.put=function(t,e){g(t),d(e);var r,o,a=l(t),f=null;return r=h(i,a),r?(o=r.getEntryForKey(t),o?(u.replaceDuplicateKey&&(o[0]=t),f=o[1],o[1]=e):r.addEntry(t,e)):(r=new s(a,t,e,c),n.push(r),i[a]=r),f},this.get=function(t){g(t);var n=l(t),e=h(i,n);if(e){var r=e.getEntryForKey(t);if(r)return r[1]}return null},this.containsKey=function(t){g(t);var n=l(t),e=h(i,n);return e?e.containsKey(t):!1},this.containsValue=function(t){d(t);for(var e=n.length;e--;)if(n[e].containsValue(t))return!0;return!1},this.clear=function(){n.length=0,i={}},this.isEmpty=function(){return!n.length};var y=function(t){return function(){for(var e=[],r=n.length;r--;)n[r][t](e);return e}};this.keys=y("keys"),this.values=y("values"),this.entries=y("getEntries"),this.remove=function(t){g(t);var e,r=l(t),u=null,o=h(i,r);return o&&(u=o.removeEntryForKey(t),null!==u&&0==o.entries.length&&(e=f(n,r),n.splice(e,1),delete i[r])),u},this.size=function(){for(var t=0,e=n.length;e--;)t+=n[e].entries.length;return t}}var y="function",p="string",v="undefined";if(typeof encodeURIComponent==v||Array.prototype.splice===t||Object.prototype.hasOwnProperty===t)return null;var g=o("key"),d=o("value"),E=0,K=1,q=2;return s.prototype={getEqualityFunction:function(t){return typeof t.equals==y?i:u},getEntryForKey:a(K),getEntryAndIndexForKey:a(q),removeEntryForKey:function(t){var n=this.getEntryAndIndexForKey(t);return n?(this.entries.splice(n[0],1),n[1]):null},addEntry:function(t,n){this.entries.push([t,n])},keys:l(0),values:l(1),getEntries:function(t){for(var n=t.length,e=0,r=this.entries,i=r.length;i>e;++e)t[n+e]=r[e].slice(0)},containsKey:a(E),containsValue:function(t){for(var n=this.entries,e=n.length;e--;)if(t===n[e][1])return!0;return!1}},c.prototype={each:function(t){for(var n,e=this.entries(),r=e.length;r--;)n=e[r],t(n[0],n[1])},equals:function(t){var n,e,r,i=this.size();if(i==t.size()){for(n=this.keys();i--;)if(e=n[i],r=t.get(e),null===r||r!==this.get(e))return!1;return!0}return!1},putAll:function(t,n){for(var e,r,i,u,o=t.entries(),s=o.length,a=typeof n==y;s--;)e=o[s],r=e[0],i=e[1],a&&(u=this.get(r))&&(i=n(r,u,i)),this.put(r,i)},clone:function(){var t=new c(this.properties);return t.putAll(this),t}},c.prototype.toQueryString=function(){for(var t,e=this.entries(),r=e.length,i=[];r--;)t=e[r],i[r]=encodeURIComponent(n(t[0]))+"="+encodeURIComponent(n(t[1]));return i.join("&")},c}();
/*! callstats.js 2016-06-28 */
function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))&&(d="Firefox",f=c.substring(a+8),b=g.moz);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j+" "+l,codebase:b}}
/*! callstats.js 2016-06-28 */
function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}