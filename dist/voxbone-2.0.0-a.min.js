/*!
 * @license Voxbone v2.0.0-a
 * Copyright 2016 Voxbone. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License")
 */
/**
 * @preserve JsSIP v0.7.9
 * the Javascript SIP library
 * Copyright: 2012-2015 José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)
 * Homepage: http://jssip.net
 * License: MIT
 */
function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))&&(d="Firefox",f=c.substring(a+8),b=g.moz);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j+" "+l,codebase:b}}function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}function extend(a,b){var c=Object.prototype.toString,d=c.call({});for(var e in b)b[e]&&d===c.call(b[e])?(a[e]=a[e]||{},extend(a[e],b[e])):a[e]=b[e];return a}!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JsSIP=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("../package.json"),e={USER_AGENT:d.title+" "+d.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:3600,MIN_SESSION_EXPIRES:60};b.exports=e},{"../package.json":49}],2:[function(a,b,c){function d(a,b,c,d){var g;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,b.hasHeader("contact")?(d=b instanceof h.IncomingResponse?b.status_code<200?e.STATUS_EARLY:e.STATUS_CONFIRMED:d||e.STATUS_CONFIRMED,g=b.parseHeader("contact"),"UAS"===c?(this.id={call_id:b.call_id,local_tag:b.to_tag,remote_tag:b.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.remote_seqnum=b.cseq,this.local_uri=b.parseHeader("to").uri,this.remote_uri=b.parseHeader("from").uri,this.remote_target=g.uri,this.route_set=b.getHeaders("record-route")):"UAC"===c&&(this.id={call_id:b.call_id,local_tag:b.from_tag,remote_tag:b.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.local_seqnum=b.cseq,this.local_uri=b.parseHeader("from").uri,this.remote_uri=b.parseHeader("to").uri,this.remote_target=g.uri,this.route_set=b.getHeaders("record-route").reverse()),this.owner=a,a.ua.dialogs[this.id.toString()]=this,void f("new "+c+" dialog created with status "+(this.state===e.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}b.exports=d;var e={STATUS_EARLY:1,STATUS_CONFIRMED:2};d.C=e;var f=a("debug")("JsSIP:Dialog"),g=a("./VoxboneLogger.js");f.log=g.loginfo.bind(console);var h=a("./SIPMessage"),i=a("./Constants"),j=a("./Transactions"),k=a("./Dialog/RequestSender");d.prototype={update:function(a,b){this.state=e.STATUS_CONFIRMED,f("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===b&&(this.route_set=a.getHeaders("record-route").reverse())},terminate:function(){f("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(a,b,c){var d,e;return b=b&&b.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),d=a===i.CANCEL||a===i.ACK?this.local_seqnum:this.local_seqnum+=1,e=new h.OutgoingRequest(a,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},b,c),e.dialog=this,e},checkInDialogRequest:function(a){var b=this;if(this.remote_seqnum){if(a.cseq<this.remote_seqnum)return a.method!==i.ACK&&a.reply(500),!1;a.cseq>this.remote_seqnum&&(this.remote_seqnum=a.cseq)}else this.remote_seqnum=a.cseq;if(a.method===i.INVITE||a.method===i.UPDATE&&a.body){if(this.uac_pending_reply===!0)a.reply(491);else{if(this.uas_pending_reply===!0){var c=(10*Math.random()|0)+1;return a.reply(500,null,["Retry-After:"+c]),!1}this.uas_pending_reply=!0,a.server_transaction.on("stateChanged",function d(){this.state!==j.C.STATUS_ACCEPTED&&this.state!==j.C.STATUS_COMPLETED&&this.state!==j.C.STATUS_TERMINATED||(a.server_transaction.removeListener("stateChanged",d),b.uas_pending_reply=!1)})}a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(){this.state===j.C.STATUS_ACCEPTED&&(b.remote_target=a.parseHeader("contact").uri)})}else a.method===i.NOTIFY&&a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(){this.state===j.C.STATUS_COMPLETED&&(b.remote_target=a.parseHeader("contact").uri)});return!0},sendRequest:function(a,b,c){c=c||{};var d=c.extraHeaders&&c.extraHeaders.slice()||[],e=c.body||null,f=this.createRequest(b,d,e),g=new k(this,a,f);g.send()},receiveRequest:function(a){this.checkInDialogRequest(a)&&this.owner.receiveRequest(a)}}},{"./Constants":1,"./Dialog/RequestSender":3,"./SIPMessage":18,"./Transactions":20,"./VoxboneLogger.js":25,debug:32}],3:[function(a,b,c){function d(a,b,c){this.dialog=a,this.applicant=b,this.request=c,this.reattempt=!1,this.reattemptTimer=null}b.exports=d;var e=a("../Constants"),f=a("../Transactions"),g=a("../RTCSession"),h=a("../RequestSender");d.prototype={send:function(){var a=this,b=new h(this,this.dialog.owner.ua);b.send(),(this.request.method===e.INVITE||this.request.method===e.UPDATE&&this.request.body)&&b.clientTransaction.state!==f.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,b.clientTransaction.on("stateChanged",function c(){this.state!==f.C.STATUS_ACCEPTED&&this.state!==f.C.STATUS_COMPLETED&&this.state!==f.C.STATUS_TERMINATED||(b.clientTransaction.removeListener("stateChanged",c),a.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b=this;408===a.status_code||481===a.status_code?this.applicant.onDialogError(a):a.method===e.INVITE&&491===a.status_code?this.reattempt?this.applicant.receiveResponse(a):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){b.applicant.owner.status!==g.C.STATUS_TERMINATED&&(b.reattempt=!0,b.request_sender.send())},1e3)):this.applicant.receiveResponse(a)}}},{"../Constants":1,"../RTCSession":11,"../RequestSender":17,"../Transactions":20}],4:[function(a,b,c){function d(a){this.username=a.configuration.authorization_user,this.password=a.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}b.exports=d;var e=a("debug")("JsSIP:DigestAuthentication"),f=a("./VoxboneLogger.js");e.log=f.loginfo.bind(console);var g=a("./Utils");d.prototype.authenticate=function(a,b){if(this.algorithm=b.algorithm,this.realm=b.realm,this.nonce=b.nonce,this.opaque=b.opaque,this.stale=b.stale,this.algorithm){if("MD5"!==this.algorithm)return e('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return e("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return e("challenge without Digest nonce, authentication aborted"),!1;if(b.qop)if(b.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(b.qop.indexOf("auth-int")>-1))return e('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=a.method,this.uri=a.ruri,this.cnonce=g.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},d.prototype.calculateResponse=function(){var a,b;a=g.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(b=g.calculateMD5(this.method+":"+this.uri),this.response=g.calculateMD5(a+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+b)):"auth-int"===this.qop?(b=g.calculateMD5(this.method+":"+this.uri+":"+g.calculateMD5(this.body?this.body:"")),this.response=g.calculateMD5(a+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+b)):null===this.qop&&(b=g.calculateMD5(this.method+":"+this.uri),this.response=g.calculateMD5(a+":"+this.nonce+":"+b))},d.prototype.toString=function(){var a=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return a.push("algorithm="+this.algorithm),a.push('username="'+this.username+'"'),a.push('realm="'+this.realm+'"'),a.push('nonce="'+this.nonce+'"'),a.push('uri="'+this.uri+'"'),a.push('response="'+this.response+'"'),this.opaque&&a.push('opaque="'+this.opaque+'"'),this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex)),"Digest "+a.join(", ")},d.prototype.updateNcHex=function(){var a=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-a.length)+a}},{"./Utils":24,"./VoxboneLogger.js":25,debug:32}],5:[function(a,b,c){var d={ConfigurationError:function(){var a=function(a,b){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=a,this.value=b,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return a.prototype=new Error,a}(),InvalidStateError:function(){var a=function(a){this.code=2,this.name="INVALID_STATE_ERROR",this.status=a,this.message="Invalid status: "+a};return a.prototype=new Error,a}(),NotSupportedError:function(){var a=function(a){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=a};return a.prototype=new Error,a}(),NotReadyError:function(){var a=function(a){this.code=4,this.name="NOT_READY_ERROR",this.message=a};return a.prototype=new Error,a}()};b.exports=d},{}],6:[function(a,b,c){b.exports=function(){function b(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(c,d){function e(a){pd<rd||(pd>rd&&(rd=pd,sd=[]),sd.push(a))}function f(){var a;return"\r\n"===c.substr(pd,2)?(a="\r\n",pd+=2):(a=null,0===qd&&e('"\\r\\n"')),a}function g(){var a;return/^[0-9]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[0-9]")),a}function h(){var a;return/^[a-zA-Z]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[a-zA-Z]")),a}function i(){var a;return/^[0-9a-fA-F]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[0-9a-fA-F]")),a}function j(){var a;return a=m(),null===a&&(a=n()),a}function k(){var a;return/^[\0-\xFF]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[\\0-\\xFF]")),a}function l(){var a;return/^["]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e('["]')),a}function m(){var a;return 32===c.charCodeAt(pd)?(a=" ",pd++):(a=null,0===qd&&e('" "')),a}function n(){var a;return 9===c.charCodeAt(pd)?(a="\t",pd++):(a=null,0===qd&&e('"\\t"')),a}function o(){var a;return/^[a-zA-Z0-9]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[a-zA-Z0-9]")),a}function p(){var a;return 59===c.charCodeAt(pd)?(a=";",pd++):(a=null,0===qd&&e('";"')),null===a&&(47===c.charCodeAt(pd)?(a="/",pd++):(a=null,0===qd&&e('"/"')),null===a&&(63===c.charCodeAt(pd)?(a="?",pd++):(a=null,0===qd&&e('"?"')),null===a&&(58===c.charCodeAt(pd)?(a=":",pd++):(a=null,0===qd&&e('":"')),null===a&&(64===c.charCodeAt(pd)?(a="@",pd++):(a=null,0===qd&&e('"@"')),null===a&&(38===c.charCodeAt(pd)?(a="&",pd++):(a=null,0===qd&&e('"&"')),null===a&&(61===c.charCodeAt(pd)?(a="=",pd++):(a=null,0===qd&&e('"="')),null===a&&(43===c.charCodeAt(pd)?(a="+",pd++):(a=null,0===qd&&e('"+"')),null===a&&(36===c.charCodeAt(pd)?(a="$",pd++):(a=null,0===qd&&e('"$"')),null===a&&(44===c.charCodeAt(pd)?(a=",",pd++):(a=null,0===qd&&e('","'))))))))))),a}function q(){var a;return a=o(),null===a&&(a=r()),a}function r(){var a;return 45===c.charCodeAt(pd)?(a="-",pd++):(a=null,0===qd&&e('"-"')),null===a&&(95===c.charCodeAt(pd)?(a="_",pd++):(a=null,0===qd&&e('"_"')),null===a&&(46===c.charCodeAt(pd)?(a=".",pd++):(a=null,0===qd&&e('"."')),null===a&&(33===c.charCodeAt(pd)?(a="!",pd++):(a=null,0===qd&&e('"!"')),null===a&&(126===c.charCodeAt(pd)?(a="~",pd++):(a=null,0===qd&&e('"~"')),null===a&&(42===c.charCodeAt(pd)?(a="*",pd++):(a=null,0===qd&&e('"*"')),null===a&&(39===c.charCodeAt(pd)?(a="'",pd++):(a=null,0===qd&&e('"\'"')),null===a&&(40===c.charCodeAt(pd)?(a="(",pd++):(a=null,0===qd&&e('"("')),null===a&&(41===c.charCodeAt(pd)?(a=")",pd++):(a=null,0===qd&&e('")"')))))))))),a}function s(){var a,b,d,f,g;return f=pd,g=pd,37===c.charCodeAt(pd)?(a="%",pd++):(a=null,0===qd&&e('"%"')),null!==a?(b=i(),null!==b?(d=i(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){return b.join("")}(f,a)),null===a&&(pd=f),a}function t(){var a,b,c,d,e,g;for(d=pd,e=pd,g=pd,a=[],b=j();null!==b;)a.push(b),b=j();if(null!==a?(b=f(),null!==b?a=[a,b]:(a=null,pd=g)):(a=null,pd=g),a=null!==a?a:"",null!==a){if(c=j(),null!==c)for(b=[];null!==c;)b.push(c),c=j();else b=null;null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return null!==a&&(a=function(a){return" "}(d)),null===a&&(pd=d),a}function u(){var a;return a=t(),a=null!==a?a:""}function v(){var a,b,d,f,g;for(f=pd,g=pd,a=[],b=m(),null===b&&(b=n());null!==b;)a.push(b),b=m(),null===b&&(b=n());return null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(pd=f),a}function w(){var a,b,d,e,f,g,h;if(f=pd,g=pd,b=x(),null!==b)for(a=[];null!==b;)a.push(b),b=x();else a=null;if(null!==a){for(b=[],h=pd,d=[],e=t();null!==e;)d.push(e),e=t();for(null!==d?(e=x(),null!==e?d=[d,e]:(d=null,pd=h)):(d=null,pd=h);null!==d;){for(b.push(d),h=pd,d=[],e=t();null!==e;)d.push(e),e=t();null!==d?(e=x(),null!==e?d=[d,e]:(d=null,pd=h)):(d=null,pd=h)}null!==b?a=[a,b]:(a=null,pd=g)}else a=null,pd=g;return null!==a&&(a=function(a){return c.substring(pd,a)}(f)),null===a&&(pd=f),a}function x(){var a;return/^[!-~]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[!-~]")),null===a&&(a=y()),a}function y(){var a;return/^[\x80-\uFFFF]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[\\x80-\\uFFFF]")),a}function z(){var a;return/^[\x80-\xBF]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[\\x80-\\xBF]")),a}function A(){var a;return a=g(),null===a&&(/^[a-f]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[a-f]"))),a}function B(){var a,b,d;if(d=pd,b=o(),null===b&&(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null===b&&(46===c.charCodeAt(pd)?(b=".",pd++):(b=null,0===qd&&e('"."')),null===b&&(33===c.charCodeAt(pd)?(b="!",pd++):(b=null,0===qd&&e('"!"')),null===b&&(37===c.charCodeAt(pd)?(b="%",pd++):(b=null,0===qd&&e('"%"')),null===b&&(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null===b&&(95===c.charCodeAt(pd)?(b="_",pd++):(b=null,0===qd&&e('"_"')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(96===c.charCodeAt(pd)?(b="`",pd++):(b=null,0===qd&&e('"`"')),null===b&&(39===c.charCodeAt(pd)?(b="'",pd++):(b=null,0===qd&&e('"\'"')),null===b&&(126===c.charCodeAt(pd)?(b="~",pd++):(b=null,0===qd&&e('"~"')))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null===b&&(46===c.charCodeAt(pd)?(b=".",pd++):(b=null,0===qd&&e('"."')),null===b&&(33===c.charCodeAt(pd)?(b="!",pd++):(b=null,0===qd&&e('"!"')),null===b&&(37===c.charCodeAt(pd)?(b="%",pd++):(b=null,0===qd&&e('"%"')),null===b&&(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null===b&&(95===c.charCodeAt(pd)?(b="_",pd++):(b=null,0===qd&&e('"_"')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(96===c.charCodeAt(pd)?(b="`",pd++):(b=null,0===qd&&e('"`"')),null===b&&(39===c.charCodeAt(pd)?(b="'",pd++):(b=null,0===qd&&e('"\'"')),null===b&&(126===c.charCodeAt(pd)?(b="~",pd++):(b=null,0===qd&&e('"~"'))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(pd,a)}(d)),null===a&&(pd=d),a}function C(){var a,b,d;if(d=pd,b=o(),null===b&&(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null===b&&(33===c.charCodeAt(pd)?(b="!",pd++):(b=null,0===qd&&e('"!"')),null===b&&(37===c.charCodeAt(pd)?(b="%",pd++):(b=null,0===qd&&e('"%"')),null===b&&(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null===b&&(95===c.charCodeAt(pd)?(b="_",pd++):(b=null,0===qd&&e('"_"')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(96===c.charCodeAt(pd)?(b="`",pd++):(b=null,0===qd&&e('"`"')),null===b&&(39===c.charCodeAt(pd)?(b="'",pd++):(b=null,0===qd&&e('"\'"')),null===b&&(126===c.charCodeAt(pd)?(b="~",pd++):(b=null,0===qd&&e('"~"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null===b&&(33===c.charCodeAt(pd)?(b="!",pd++):(b=null,0===qd&&e('"!"')),null===b&&(37===c.charCodeAt(pd)?(b="%",pd++):(b=null,0===qd&&e('"%"')),null===b&&(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null===b&&(95===c.charCodeAt(pd)?(b="_",pd++):(b=null,0===qd&&e('"_"')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(96===c.charCodeAt(pd)?(b="`",pd++):(b=null,0===qd&&e('"`"')),null===b&&(39===c.charCodeAt(pd)?(b="'",pd++):(b=null,0===qd&&e('"\'"')),null===b&&(126===c.charCodeAt(pd)?(b="~",pd++):(b=null,0===qd&&e('"~"')))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(pd,a)}(d)),null===a&&(pd=d),a}function D(){var a;return 40===c.charCodeAt(pd)?(a="(",pd++):(a=null,0===qd&&e('"("')),null===a&&(41===c.charCodeAt(pd)?(a=")",pd++):(a=null,0===qd&&e('")"')),null===a&&(60===c.charCodeAt(pd)?(a="<",pd++):(a=null,0===qd&&e('"<"')),null===a&&(62===c.charCodeAt(pd)?(a=">",pd++):(a=null,0===qd&&e('">"')),null===a&&(64===c.charCodeAt(pd)?(a="@",pd++):(a=null,0===qd&&e('"@"')),null===a&&(44===c.charCodeAt(pd)?(a=",",pd++):(a=null,0===qd&&e('","')),null===a&&(59===c.charCodeAt(pd)?(a=";",pd++):(a=null,0===qd&&e('";"')),null===a&&(58===c.charCodeAt(pd)?(a=":",pd++):(a=null,0===qd&&e('":"')),null===a&&(92===c.charCodeAt(pd)?(a="\\",pd++):(a=null,0===qd&&e('"\\\\"')),null===a&&(a=l(),null===a&&(47===c.charCodeAt(pd)?(a="/",pd++):(a=null,0===qd&&e('"/"')),null===a&&(91===c.charCodeAt(pd)?(a="[",pd++):(a=null,0===qd&&e('"["')),null===a&&(93===c.charCodeAt(pd)?(a="]",pd++):(a=null,0===qd&&e('"]"')),null===a&&(63===c.charCodeAt(pd)?(a="?",pd++):(a=null,0===qd&&e('"?"')),null===a&&(61===c.charCodeAt(pd)?(a="=",pd++):(a=null,0===qd&&e('"="')),null===a&&(123===c.charCodeAt(pd)?(a="{",pd++):(a=null,0===qd&&e('"{"')),null===a&&(125===c.charCodeAt(pd)?(a="}",pd++):(a=null,0===qd&&e('"}"')),null===a&&(a=m(),null===a&&(a=n())))))))))))))))))),a}function E(){var a,b,d;if(d=pd,b=o(),null===b&&(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null===b&&(46===c.charCodeAt(pd)?(b=".",pd++):(b=null,0===qd&&e('"."')),null===b&&(33===c.charCodeAt(pd)?(b="!",pd++):(b=null,0===qd&&e('"!"')),null===b&&(37===c.charCodeAt(pd)?(b="%",pd++):(b=null,0===qd&&e('"%"')),null===b&&(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null===b&&(95===c.charCodeAt(pd)?(b="_",pd++):(b=null,0===qd&&e('"_"')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(96===c.charCodeAt(pd)?(b="`",pd++):(b=null,0===qd&&e('"`"')),null===b&&(39===c.charCodeAt(pd)?(b="'",pd++):(b=null,0===qd&&e('"\'"')),null===b&&(126===c.charCodeAt(pd)?(b="~",pd++):(b=null,0===qd&&e('"~"')),null===b&&(40===c.charCodeAt(pd)?(b="(",pd++):(b=null,0===qd&&e('"("')),null===b&&(41===c.charCodeAt(pd)?(b=")",pd++):(b=null,0===qd&&e('")"')),null===b&&(60===c.charCodeAt(pd)?(b="<",pd++):(b=null,0===qd&&e('"<"')),null===b&&(62===c.charCodeAt(pd)?(b=">",pd++):(b=null,0===qd&&e('">"')),null===b&&(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null===b&&(92===c.charCodeAt(pd)?(b="\\",pd++):(b=null,0===qd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(pd)?(b="/",pd++):(b=null,0===qd&&e('"/"')),null===b&&(91===c.charCodeAt(pd)?(b="[",pd++):(b=null,0===qd&&e('"["')),null===b&&(93===c.charCodeAt(pd)?(b="]",pd++):(b=null,0===qd&&e('"]"')),null===b&&(63===c.charCodeAt(pd)?(b="?",pd++):(b=null,0===qd&&e('"?"')),null===b&&(123===c.charCodeAt(pd)?(b="{",pd++):(b=null,0===qd&&e('"{"')),null===b&&(125===c.charCodeAt(pd)?(b="}",pd++):(b=null,0===qd&&e('"}"'))))))))))))))))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null===b&&(46===c.charCodeAt(pd)?(b=".",pd++):(b=null,0===qd&&e('"."')),null===b&&(33===c.charCodeAt(pd)?(b="!",pd++):(b=null,0===qd&&e('"!"')),null===b&&(37===c.charCodeAt(pd)?(b="%",pd++):(b=null,0===qd&&e('"%"')),null===b&&(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null===b&&(95===c.charCodeAt(pd)?(b="_",pd++):(b=null,0===qd&&e('"_"')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(96===c.charCodeAt(pd)?(b="`",pd++):(b=null,0===qd&&e('"`"')),null===b&&(39===c.charCodeAt(pd)?(b="'",pd++):(b=null,0===qd&&e('"\'"')),null===b&&(126===c.charCodeAt(pd)?(b="~",pd++):(b=null,0===qd&&e('"~"')),null===b&&(40===c.charCodeAt(pd)?(b="(",pd++):(b=null,0===qd&&e('"("')),null===b&&(41===c.charCodeAt(pd)?(b=")",pd++):(b=null,0===qd&&e('")"')),null===b&&(60===c.charCodeAt(pd)?(b="<",pd++):(b=null,0===qd&&e('"<"')),null===b&&(62===c.charCodeAt(pd)?(b=">",pd++):(b=null,0===qd&&e('">"')),null===b&&(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null===b&&(92===c.charCodeAt(pd)?(b="\\",pd++):(b=null,0===qd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(pd)?(b="/",pd++):(b=null,0===qd&&e('"/"')),null===b&&(91===c.charCodeAt(pd)?(b="[",pd++):(b=null,0===qd&&e('"["')),null===b&&(93===c.charCodeAt(pd)?(b="]",pd++):(b=null,0===qd&&e('"]"')),null===b&&(63===c.charCodeAt(pd)?(b="?",pd++):(b=null,0===qd&&e('"?"')),null===b&&(123===c.charCodeAt(pd)?(b="{",pd++):(b=null,0===qd&&e('"{"')),null===b&&(125===c.charCodeAt(pd)?(b="}",pd++):(b=null,0===qd&&e('"}"')))))))))))))))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(pd,a)}(d)),null===a&&(pd=d),a}function F(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(42===c.charCodeAt(pd)?(b="*",pd++):(b=null,0===qd&&e('"*"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return"*"}(f)),null===a&&(pd=f),a}function G(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(47===c.charCodeAt(pd)?(b="/",pd++):(b=null,0===qd&&e('"/"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return"/"}(f)),null===a&&(pd=f),a}function H(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return"="}(f)),null===a&&(pd=f),a}function I(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(40===c.charCodeAt(pd)?(b="(",pd++):(b=null,0===qd&&e('"("')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return"("}(f)),null===a&&(pd=f),a}function J(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(41===c.charCodeAt(pd)?(b=")",pd++):(b=null,0===qd&&e('")"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return")"}(f)),null===a&&(pd=f),a}function K(){var a,b,d,f;return d=pd,f=pd,62===c.charCodeAt(pd)?(a=">",pd++):(a=null,0===qd&&e('">"')),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a){return">"}(d)),null===a&&(pd=d),a}function L(){var a,b,d,f;return d=pd,f=pd,a=u(),null!==a?(60===c.charCodeAt(pd)?(b="<",pd++):(b=null,0===qd&&e('"<"')),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a){return"<"}(d)),null===a&&(pd=d),a}function M(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(44===c.charCodeAt(pd)?(b=",",pd++):(b=null,0===qd&&e('","')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return","}(f)),null===a&&(pd=f),a}function N(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(59===c.charCodeAt(pd)?(b=";",pd++):(b=null,0===qd&&e('";"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return";"}(f)),null===a&&(pd=f),a}function O(){var a,b,d,f,g;return f=pd,g=pd,a=u(),null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(pd=f),a}function P(){var a,b,c,d;return c=pd,d=pd,a=u(),null!==a?(b=l(),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(pd=c),a}function Q(){var a,b,c,d;return c=pd,d=pd,a=l(),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(pd=c),a}function R(){var a,b,c,d;if(d=pd,a=I(),null!==a){for(b=[],c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==c;)b.push(c),c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==b?(c=J(),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)}else a=null,pd=d;return a}function S(){var a;return/^[!-']/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[!-']")),null===a&&(/^[*-[]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[*-[]")),null===a&&(/^[\]-~]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[\\]-~]")),null===a&&(a=y(),null===a&&(a=t())))),a}function T(){var a,b,d,e,f,g;if(f=pd,g=pd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,pd=g)):(a=null,pd=g)}else a=null,pd=g;else a=null,pd=g;return null!==a&&(a=function(a){return c.substring(pd,a)}(f)),null===a&&(pd=f),a}function U(){var a,b,d,e,f,g;if(f=pd,g=pd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,pd=g)):(a=null,pd=g)}else a=null,pd=g;else a=null,pd=g;
return null!==a&&(a=function(a){return c.substring(pd-1,a+1)}(f)),null===a&&(pd=f),a}function V(){var a;return a=t(),null===a&&(33===c.charCodeAt(pd)?(a="!",pd++):(a=null,0===qd&&e('"!"')),null===a&&(/^[#-[]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[#-[]")),null===a&&(/^[\]-~]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[\\]-~]")),null===a&&(a=y())))),a}function W(){var a,b,d;return d=pd,92===c.charCodeAt(pd)?(a="\\",pd++):(a=null,0===qd&&e('"\\\\"')),null!==a?(/^[\0-\t]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[\\0-\\t]")),null===b&&(/^[\x0B-\f]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[\\x0B-\\f]")),null===b&&(/^[\x0E-]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[\\x0E-]")))),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),a}function X(){var a,b,d,f,g,h;return g=pd,h=pd,a=Z(),null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=$(),d=null!==d?d:"",null!==d?(f=ca(),null!==f?a=[a,b,d,f]:(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h),null!==a&&(a=function(a){try{vd.uri=new td(vd.scheme,vd.user,vd.host,vd.port),delete vd.scheme,delete vd.user,delete vd.host,delete vd.host_type,delete vd.port}catch(b){vd=-1}}(g)),null===a&&(pd=g),a}function Y(){var a,b,f,g,h,i,j,k;return j=pd,k=pd,a=Z(),null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(f=$(),f=null!==f?f:"",null!==f?(g=ca(),null!==g?(h=oa(),null!==h?(i=Ba(),i=null!==i?i:"",null!==i?a=[a,b,f,g,h,i]:(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k),null!==a&&(a=function(a){try{vd.uri=new td(vd.scheme,vd.user,vd.host,vd.port,vd.uri_params,vd.uri_headers),delete vd.scheme,delete vd.user,delete vd.host,delete vd.host_type,delete vd.port,delete vd.uri_params,"SIP_URI"===d&&(vd=vd.uri)}catch(b){vd=-1}}(j)),null===a&&(pd=j),a}function Z(){var a,b;return"sip"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"sip"')),null===a&&(b=pd,"sips"===c.substr(pd,4).toLowerCase()?(a=c.substr(pd,4),pd+=4):(a=null,0===qd&&e('"sips"')),null!==a&&(a=function(a){vd.scheme=uri_scheme.toLowerCase()}(b)),null===a&&(pd=b)),a}function $(){var a,b,d,f,g,h;return f=pd,g=pd,a=_(),null!==a?(h=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ba(),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h),b=null!==b?b:"",null!==b?(64===c.charCodeAt(pd)?(d="@",pd++):(d=null,0===qd&&e('"@"')),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){vd.user=decodeURIComponent(c.substring(pd-1,a))}(f)),null===a&&(pd=f),a}function _(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(b=aa())),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(b=aa()));else a=null;return a}function aa(){var a;return 38===c.charCodeAt(pd)?(a="&",pd++):(a=null,0===qd&&e('"&"')),null===a&&(61===c.charCodeAt(pd)?(a="=",pd++):(a=null,0===qd&&e('"="')),null===a&&(43===c.charCodeAt(pd)?(a="+",pd++):(a=null,0===qd&&e('"+"')),null===a&&(36===c.charCodeAt(pd)?(a="$",pd++):(a=null,0===qd&&e('"$"')),null===a&&(44===c.charCodeAt(pd)?(a=",",pd++):(a=null,0===qd&&e('","')),null===a&&(59===c.charCodeAt(pd)?(a=";",pd++):(a=null,0===qd&&e('";"')),null===a&&(63===c.charCodeAt(pd)?(a="?",pd++):(a=null,0===qd&&e('"?"')),null===a&&(47===c.charCodeAt(pd)?(a="/",pd++):(a=null,0===qd&&e('"/"'))))))))),a}function ba(){var a,b,d;for(d=pd,a=[],b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(pd)?(b="&",pd++):(b=null,0===qd&&e('"&"')),null===b&&(61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(36===c.charCodeAt(pd)?(b="$",pd++):(b=null,0===qd&&e('"$"')),null===b&&(44===c.charCodeAt(pd)?(b=",",pd++):(b=null,0===qd&&e('","'))))))));null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(pd)?(b="&",pd++):(b=null,0===qd&&e('"&"')),null===b&&(61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')),null===b&&(36===c.charCodeAt(pd)?(b="$",pd++):(b=null,0===qd&&e('"$"')),null===b&&(44===c.charCodeAt(pd)?(b=",",pd++):(b=null,0===qd&&e('","'))))))));return null!==a&&(a=function(a){vd.password=c.substring(pd,a)}(d)),null===a&&(pd=d),a}function ca(){var a,b,d,f,g;return f=pd,a=da(),null!==a?(g=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=na(),null!==d?b=[b,d]:(b=null,pd=g)):(b=null,pd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),a}function da(){var a,b;return b=pd,a=la(),null===a&&(a=ha(),null===a&&(a=ea())),null!==a&&(a=function(a){return vd.host=c.substring(pd,a).toLowerCase(),vd.host}(b)),null===a&&(pd=b),a}function ea(){var a,b,d,f,g,h;for(f=pd,g=pd,a=[],h=pd,b=fa(),null!==b?(46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."')),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h);null!==b;)a.push(b),h=pd,b=fa(),null!==b?(46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."')),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h);return null!==a?(b=ga(),null!==b?(46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."')),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return vd.host_type="domain",c.substring(pd,a)}(f)),null===a&&(pd=f),a}function fa(){var a,b;if(/^[a-zA-Z0-9_\-]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[a-zA-Z0-9_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z0-9_\-]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[a-zA-Z0-9_\\-]"));else a=null;return a}function ga(){var a,b;if(/^[a-zA-Z0-9_\-]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[a-zA-Z0-9_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z0-9_\-]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[a-zA-Z0-9_\\-]"));else a=null;return a}function ha(){var a,b,d,f,g;return f=pd,g=pd,91===c.charCodeAt(pd)?(a="[",pd++):(a=null,0===qd&&e('"["')),null!==a?(b=ia(),null!==b?(93===c.charCodeAt(pd)?(d="]",pd++):(d=null,0===qd&&e('"]"')),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){return vd.host_type="IPv6",c.substring(pd,a)}(f)),null===a&&(pd=f),a}function ia(){var a,b,d,f,g,h,i,j,k,l,m,n,o,p,q,r;return p=pd,q=pd,a=ja(),null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?(58===c.charCodeAt(pd)?(f=":",pd++):(f=null,0===qd&&e('":"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(pd)?(h=":",pd++):(h=null,0===qd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(pd)?(j=":",pd++):(j=null,0===qd&&e('":"')),null!==j?(k=ja(),null!==k?(58===c.charCodeAt(pd)?(l=":",pd++):(l=null,0===qd&&e('":"')),null!==l?(m=ja(),null!==m?(58===c.charCodeAt(pd)?(n=":",pd++):(n=null,0===qd&&e('":"')),null!==n?(o=ka(),null!==o?a=[a,b,d,f,g,h,i,j,k,l,m,n,o]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(pd)?(i=":",pd++):(i=null,0===qd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(pd)?(k=":",pd++):(k=null,0===qd&&e('":"')),null!==k?(l=ja(),null!==l?(58===c.charCodeAt(pd)?(m=":",pd++):(m=null,0===qd&&e('":"')),null!==m?(n=ka(),null!==n?a=[a,b,d,f,g,h,i,j,k,l,m,n]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(pd)?(i=":",pd++):(i=null,0===qd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(pd)?(k=":",pd++):(k=null,0===qd&&e('":"')),null!==k?(l=ka(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(pd)?(i=":",pd++):(i=null,0===qd&&e('":"')),null!==i?(j=ka(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ka(),null!==h?a=[a,b,d,f,g,h]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ka(),null!==f?a=[a,b,d,f]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ka(),null!==b?a=[a,b]:(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,"::"===c.substr(pd,2)?(a="::",pd+=2):(a=null,0===qd&&e('"::"')),null!==a?(b=ja(),null!==b?a=[a,b]:(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?("::"===c.substr(pd,2)?(b="::",pd+=2):(b=null,0===qd&&e('"::"')),null!==b?(d=ja(),null!==d?(58===c.charCodeAt(pd)?(f=":",pd++):(f=null,0===qd&&e('":"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(pd)?(h=":",pd++):(h=null,0===qd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(pd)?(j=":",pd++):(j=null,0===qd&&e('":"')),null!==j?(k=ja(),null!==k?(58===c.charCodeAt(pd)?(l=":",pd++):(l=null,0===qd&&e('":"')),null!==l?(m=ka(),null!==m?a=[a,b,d,f,g,h,i,j,k,l,m]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?(r=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,pd=r)):(b=null,pd=r),b=null!==b?b:"",null!==b?("::"===c.substr(pd,2)?(d="::",pd+=2):(d=null,0===qd&&e('"::"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(pd)?(i=":",pd++):(i=null,0===qd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(pd)?(k=":",pd++):(k=null,0===qd&&e('":"')),null!==k?(l=ka(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?(r=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,pd=r)):(b=null,pd=r),b=null!==b?b:"",null!==b?(r=pd,58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,pd=r)):(d=null,pd=r),d=null!==d?d:"",null!==d?("::"===c.substr(pd,2)?(f="::",pd+=2):(f=null,0===qd&&e('"::"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(pd)?(h=":",pd++):(h=null,0===qd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(pd)?(j=":",pd++):(j=null,0===qd&&e('":"')),null!==j?(k=ka(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?(r=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,pd=r)):(b=null,pd=r),b=null!==b?b:"",null!==b?(r=pd,58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,pd=r)):(d=null,pd=r),d=null!==d?d:"",null!==d?(r=pd,58===c.charCodeAt(pd)?(f=":",pd++):(f=null,0===qd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,pd=r)):(f=null,pd=r),f=null!==f?f:"",null!==f?("::"===c.substr(pd,2)?(g="::",pd+=2):(g=null,0===qd&&e('"::"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(pd)?(i=":",pd++):(i=null,0===qd&&e('":"')),null!==i?(j=ka(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?(r=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,pd=r)):(b=null,pd=r),b=null!==b?b:"",null!==b?(r=pd,58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,pd=r)):(d=null,pd=r),d=null!==d?d:"",null!==d?(r=pd,58===c.charCodeAt(pd)?(f=":",pd++):(f=null,0===qd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,pd=r)):(f=null,pd=r),f=null!==f?f:"",null!==f?(r=pd,58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,pd=r)):(g=null,pd=r),g=null!==g?g:"",null!==g?("::"===c.substr(pd,2)?(h="::",pd+=2):(h=null,0===qd&&e('"::"')),null!==h?(i=ka(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?(r=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,pd=r)):(b=null,pd=r),b=null!==b?b:"",null!==b?(r=pd,58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,pd=r)):(d=null,pd=r),d=null!==d?d:"",null!==d?(r=pd,58===c.charCodeAt(pd)?(f=":",pd++):(f=null,0===qd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,pd=r)):(f=null,pd=r),f=null!==f?f:"",null!==f?(r=pd,58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,pd=r)):(g=null,pd=r),g=null!==g?g:"",null!==g?(r=pd,58===c.charCodeAt(pd)?(h=":",pd++):(h=null,0===qd&&e('":"')),null!==h?(i=ja(),null!==i?h=[h,i]:(h=null,pd=r)):(h=null,pd=r),h=null!==h?h:"",null!==h?("::"===c.substr(pd,2)?(i="::",pd+=2):(i=null,0===qd&&e('"::"')),null!==i?(j=ja(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q),null===a&&(q=pd,a=ja(),null!==a?(r=pd,58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,pd=r)):(b=null,pd=r),b=null!==b?b:"",null!==b?(r=pd,58===c.charCodeAt(pd)?(d=":",pd++):(d=null,0===qd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,pd=r)):(d=null,pd=r),d=null!==d?d:"",null!==d?(r=pd,58===c.charCodeAt(pd)?(f=":",pd++):(f=null,0===qd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,pd=r)):(f=null,pd=r),f=null!==f?f:"",null!==f?(r=pd,58===c.charCodeAt(pd)?(g=":",pd++):(g=null,0===qd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,pd=r)):(g=null,pd=r),g=null!==g?g:"",null!==g?(r=pd,58===c.charCodeAt(pd)?(h=":",pd++):(h=null,0===qd&&e('":"')),null!==h?(i=ja(),null!==i?h=[h,i]:(h=null,pd=r)):(h=null,pd=r),h=null!==h?h:"",null!==h?(r=pd,58===c.charCodeAt(pd)?(i=":",pd++):(i=null,0===qd&&e('":"')),null!==i?(j=ja(),null!==j?i=[i,j]:(i=null,pd=r)):(i=null,pd=r),i=null!==i?i:"",null!==i?("::"===c.substr(pd,2)?(j="::",pd+=2):(j=null,0===qd&&e('"::"')),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q)):(a=null,pd=q))))))))))))))),null!==a&&(a=function(a){return vd.host_type="IPv6",c.substring(pd,a)}(p)),null===a&&(pd=p),a}function ja(){var a,b,c,d,e;return e=pd,a=i(),null!==a?(b=i(),b=null!==b?b:"",null!==b?(c=i(),c=null!==c?c:"",null!==c?(d=i(),d=null!==d?d:"",null!==d?a=[a,b,c,d]:(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e),a}function ka(){var a,b,d,f;return f=pd,a=ja(),null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=ja(),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),null===a&&(a=la()),a}function la(){var a,b,d,f,g,h,i,j,k;return j=pd,k=pd,a=ma(),null!==a?(46===c.charCodeAt(pd)?(b=".",pd++):(b=null,0===qd&&e('"."')),null!==b?(d=ma(),null!==d?(46===c.charCodeAt(pd)?(f=".",pd++):(f=null,0===qd&&e('"."')),null!==f?(g=ma(),null!==g?(46===c.charCodeAt(pd)?(h=".",pd++):(h=null,0===qd&&e('"."')),null!==h?(i=ma(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k)):(a=null,pd=k),null!==a&&(a=function(a){return vd.host_type="IPv4",c.substring(pd,a)}(j)),null===a&&(pd=j),a}function ma(){var a,b,d,f;return f=pd,"25"===c.substr(pd,2)?(a="25",pd+=2):(a=null,0===qd&&e('"25"')),null!==a?(/^[0-5]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[0-5]")),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null===a&&(f=pd,50===c.charCodeAt(pd)?(a="2",pd++):(a=null,0===qd&&e('"2"')),null!==a?(/^[0-4]/.test(c.charAt(pd))?(b=c.charAt(pd),pd++):(b=null,0===qd&&e("[0-4]")),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),null===a&&(f=pd,49===c.charCodeAt(pd)?(a="1",pd++):(a=null,0===qd&&e('"1"')),null!==a?(b=g(),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),null===a&&(f=pd,/^[1-9]/.test(c.charAt(pd))?(a=c.charAt(pd),pd++):(a=null,0===qd&&e("[1-9]")),null!==a?(b=g(),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null===a&&(a=g())))),a}function na(){var a,b,c,d,e,f,h;return f=pd,h=pd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h),null!==a&&(a=function(a,b){return b=parseInt(b.join("")),vd.port=b,b}(f,a)),null===a&&(pd=f),a}function oa(){var a,b,d,f;for(a=[],f=pd,59===c.charCodeAt(pd)?(b=";",pd++):(b=null,0===qd&&e('";"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,pd=f)):(b=null,pd=f);null!==b;)a.push(b),f=pd,59===c.charCodeAt(pd)?(b=";",pd++):(b=null,0===qd&&e('";"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,pd=f)):(b=null,pd=f);return a}function pa(){var a;return a=qa(),null===a&&(a=ra(),null===a&&(a=sa(),null===a&&(a=ta(),null===a&&(a=ua(),null===a&&(a=va(),null===a&&(a=wa())))))),a}function qa(){var a,b,d,f;return d=pd,f=pd,"transport="===c.substr(pd,10).toLowerCase()?(a=c.substr(pd,10),pd+=10):(a=null,0===qd&&e('"transport="')),null!==a?("udp"===c.substr(pd,3).toLowerCase()?(b=c.substr(pd,3),pd+=3):(b=null,0===qd&&e('"udp"')),null===b&&("tcp"===c.substr(pd,3).toLowerCase()?(b=c.substr(pd,3),pd+=3):(b=null,0===qd&&e('"tcp"')),null===b&&("sctp"===c.substr(pd,4).toLowerCase()?(b=c.substr(pd,4),pd+=4):(b=null,0===qd&&e('"sctp"')),null===b&&("tls"===c.substr(pd,3).toLowerCase()?(b=c.substr(pd,3),pd+=3):(b=null,0===qd&&e('"tls"')),null===b&&(b=B())))),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a,b){vd.uri_params||(vd.uri_params={}),vd.uri_params.transport=b.toLowerCase()}(d,a[1])),null===a&&(pd=d),a}function ra(){var a,b,d,f;return d=pd,f=pd,"user="===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"user="')),null!==a?("phone"===c.substr(pd,5).toLowerCase()?(b=c.substr(pd,5),pd+=5):(b=null,0===qd&&e('"phone"')),null===b&&("ip"===c.substr(pd,2).toLowerCase()?(b=c.substr(pd,2),pd+=2):(b=null,0===qd&&e('"ip"')),null===b&&(b=B())),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a,b){vd.uri_params||(vd.uri_params={}),vd.uri_params.user=b.toLowerCase()}(d,a[1])),null===a&&(pd=d),a}function sa(){var a,b,d,f;return d=pd,f=pd,"method="===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"method="')),null!==a?(b=hb(),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a,b){vd.uri_params||(vd.uri_params={}),vd.uri_params.method=b}(d,a[1])),null===a&&(pd=d),a}function ta(){var a,b,d,f;return d=pd,f=pd,"ttl="===c.substr(pd,4).toLowerCase()?(a=c.substr(pd,4),pd+=4):(a=null,0===qd&&e('"ttl="')),null!==a?(b=Tc(),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a,b){vd.params||(vd.params={}),vd.params.ttl=b}(d,a[1])),null===a&&(pd=d),a}function ua(){var a,b,d,f;return d=pd,f=pd,"maddr="===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"maddr="')),null!==a?(b=da(),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),null!==a&&(a=function(a,b){vd.uri_params||(vd.uri_params={}),vd.uri_params.maddr=b}(d,a[1])),null===a&&(pd=d),a}function va(){var a,b,d,f,g,h;return f=pd,g=pd,"lr"===c.substr(pd,2).toLowerCase()?(a=c.substr(pd,2),pd+=2):(a=null,0===qd&&e('"lr"')),null!==a?(h=pd,61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null!==b?(d=B(),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){vd.uri_params||(vd.uri_params={}),vd.uri_params.lr=void 0}(f)),null===a&&(pd=f),a}function wa(){var a,b,d,f,g,h;return f=pd,g=pd,a=xa(),null!==a?(h=pd,61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null!==b?(d=ya(),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b,c){vd.uri_params||(vd.uri_params={}),c="undefined"==typeof c?void 0:c[1],vd.uri_params[b.toLowerCase()]=c&&c.toLowerCase()}(f,a[0],a[1])),null===a&&(pd=f),a}function xa(){var a,b,c;if(c=pd,b=za(),null!==b)for(a=[];null!==b;)a.push(b),b=za();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(pd=c),a}function ya(){var a,b,c;if(c=pd,b=za(),null!==b)for(a=[];null!==b;)a.push(b),b=za();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(pd=c),a}function za(){var a;return a=Aa(),null===a&&(a=q(),null===a&&(a=s())),a}function Aa(){var a;return 91===c.charCodeAt(pd)?(a="[",pd++):(a=null,0===qd&&e('"["')),null===a&&(93===c.charCodeAt(pd)?(a="]",pd++):(a=null,0===qd&&e('"]"')),null===a&&(47===c.charCodeAt(pd)?(a="/",pd++):(a=null,0===qd&&e('"/"')),null===a&&(58===c.charCodeAt(pd)?(a=":",pd++):(a=null,0===qd&&e('":"')),null===a&&(38===c.charCodeAt(pd)?(a="&",pd++):(a=null,0===qd&&e('"&"')),null===a&&(43===c.charCodeAt(pd)?(a="+",pd++):(a=null,0===qd&&e('"+"')),null===a&&(36===c.charCodeAt(pd)?(a="$",pd++):(a=null,0===qd&&e('"$"')))))))),a}function Ba(){var a,b,d,f,g,h,i;if(h=pd,63===c.charCodeAt(pd)?(a="?",pd++):(a=null,0===qd&&e('"?"')),null!==a)if(b=Ca(),null!==b){for(d=[],i=pd,38===c.charCodeAt(pd)?(f="&",pd++):(f=null,0===qd&&e('"&"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,pd=i)):(f=null,pd=i);null!==f;)d.push(f),i=pd,38===c.charCodeAt(pd)?(f="&",pd++):(f=null,0===qd&&e('"&"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,pd=i)):(f=null,pd=i);null!==d?a=[a,b,d]:(a=null,pd=h)}else a=null,pd=h;else a=null,pd=h;return a}function Ca(){var a,b,d,f,g;return f=pd,g=pd,a=Da(),null!==a?(61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null!==b?(d=Ea(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b,c){b=b.join("").toLowerCase(),c=c.join(""),vd.uri_headers||(vd.uri_headers={}),vd.uri_headers[b]?vd.uri_headers[b].push(c):vd.uri_headers[b]=[c]}(f,a[0],a[2])),null===a&&(pd=f),a}function Da(){var a,b;if(b=Fa(),null===b&&(b=q(),null===b&&(b=s())),null!==b)for(a=[];null!==b;)a.push(b),b=Fa(),null===b&&(b=q(),null===b&&(b=s()));else a=null;return a}function Ea(){var a,b;for(a=[],b=Fa(),null===b&&(b=q(),null===b&&(b=s()));null!==b;)a.push(b),b=Fa(),null===b&&(b=q(),null===b&&(b=s()));return a}function Fa(){var a;return 91===c.charCodeAt(pd)?(a="[",pd++):(a=null,0===qd&&e('"["')),null===a&&(93===c.charCodeAt(pd)?(a="]",pd++):(a=null,0===qd&&e('"]"')),null===a&&(47===c.charCodeAt(pd)?(a="/",pd++):(a=null,0===qd&&e('"/"')),null===a&&(63===c.charCodeAt(pd)?(a="?",pd++):(a=null,0===qd&&e('"?"')),null===a&&(58===c.charCodeAt(pd)?(a=":",pd++):(a=null,0===qd&&e('":"')),null===a&&(43===c.charCodeAt(pd)?(a="+",pd++):(a=null,0===qd&&e('"+"')),null===a&&(36===c.charCodeAt(pd)?(a="$",pd++):(a=null,0===qd&&e('"$"')))))))),a}function Ga(){var a;return a=ib(),null===a&&(a=Ha()),a}function Ha(){var a,b,c,d,e,f;return f=pd,a=hb(),null!==a?(b=m(),null!==b?(c=Ia(),null!==c?(d=m(),null!==d?(e=Za(),null!==e?a=[a,b,c,d,e]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function Ia(){var a;return a=Y(),null===a&&(a=Ja()),a}function Ja(){var a,b,d,f;return f=pd,a=Ua(),null!==a?(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null!==b?(d=Ka(),null===d&&(d=Na()),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function Ka(){var a,b,d,f,g;return f=pd,a=La(),null===a&&(a=Ma()),null!==a?(g=pd,63===c.charCodeAt(pd)?(b="?",pd++):(b=null,0===qd&&e('"?"')),null!==b?(d=Ya(),null!==d?b=[b,d]:(b=null,pd=g)):(b=null,pd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),a}function La(){var a,b,d,f;return f=pd,"//"===c.substr(pd,2)?(a="//",pd+=2):(a=null,0===qd&&e('"//"')),null!==a?(b=Va(),null!==b?(d=Ma(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function Ma(){var a,b,d;return d=pd,47===c.charCodeAt(pd)?(a="/",pd++):(a=null,0===qd&&e('"/"')),null!==a?(b=Qa(),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),a}function Na(){var a,b,c,d;if(d=pd,a=Pa(),null!==a){for(b=[],c=Oa();null!==c;)b.push(c),c=Oa();null!==b?a=[a,b]:(a=null,pd=d)}else a=null,pd=d;return a}function Oa(){var a;return a=p(),null===a&&(a=q(),null===a&&(a=s())),a}function Pa(){var a;return a=q(),null===a&&(a=s(),null===a&&(59===c.charCodeAt(pd)?(a=";",pd++):(a=null,0===qd&&e('";"')),null===a&&(63===c.charCodeAt(pd)?(a="?",pd++):(a=null,0===qd&&e('"?"')),null===a&&(58===c.charCodeAt(pd)?(a=":",pd++):(a=null,0===qd&&e('":"')),null===a&&(64===c.charCodeAt(pd)?(a="@",pd++):(a=null,0===qd&&e('"@"')),null===a&&(38===c.charCodeAt(pd)?(a="&",pd++):(a=null,0===qd&&e('"&"')),null===a&&(61===c.charCodeAt(pd)?(a="=",pd++):(a=null,0===qd&&e('"="')),null===a&&(43===c.charCodeAt(pd)?(a="+",pd++):(a=null,0===qd&&e('"+"')),null===a&&(36===c.charCodeAt(pd)?(a="$",pd++):(a=null,0===qd&&e('"$"')),null===a&&(44===c.charCodeAt(pd)?(a=",",pd++):(a=null,0===qd&&e('","')))))))))))),a}function Qa(){var a,b,d,f,g,h;if(g=pd,a=Ra(),null!==a){for(b=[],h=pd,47===c.charCodeAt(pd)?(d="/",pd++):(d=null,0===qd&&e('"/"')),null!==d?(f=Ra(),null!==f?d=[d,f]:(d=null,pd=h)):(d=null,pd=h);null!==d;)b.push(d),h=pd,47===c.charCodeAt(pd)?(d="/",pd++):(d=null,0===qd&&e('"/"')),null!==d?(f=Ra(),null!==f?d=[d,f]:(d=null,pd=h)):(d=null,pd=h);null!==b?a=[a,b]:(a=null,pd=g)}else a=null,pd=g;return a}function Ra(){var a,b,d,f,g,h;for(g=pd,a=[],b=Ta();null!==b;)a.push(b),b=Ta();if(null!==a){for(b=[],h=pd,59===c.charCodeAt(pd)?(d=";",pd++):(d=null,0===qd&&e('";"')),null!==d?(f=Sa(),null!==f?d=[d,f]:(d=null,pd=h)):(d=null,pd=h);null!==d;)b.push(d),h=pd,59===c.charCodeAt(pd)?(d=";",pd++):(d=null,0===qd&&e('";"')),null!==d?(f=Sa(),null!==f?d=[d,f]:(d=null,pd=h)):(d=null,pd=h);null!==b?a=[a,b]:(a=null,pd=g)}else a=null,pd=g;return a}function Sa(){var a,b;for(a=[],b=Ta();null!==b;)a.push(b),b=Ta();return a}function Ta(){var a;return a=q(),null===a&&(a=s(),null===a&&(58===c.charCodeAt(pd)?(a=":",pd++):(a=null,0===qd&&e('":"')),null===a&&(64===c.charCodeAt(pd)?(a="@",pd++):(a=null,0===qd&&e('"@"')),null===a&&(38===c.charCodeAt(pd)?(a="&",pd++):(a=null,0===qd&&e('"&"')),null===a&&(61===c.charCodeAt(pd)?(a="=",pd++):(a=null,0===qd&&e('"="')),null===a&&(43===c.charCodeAt(pd)?(a="+",pd++):(a=null,0===qd&&e('"+"')),null===a&&(36===c.charCodeAt(pd)?(a="$",pd++):(a=null,0===qd&&e('"$"')),null===a&&(44===c.charCodeAt(pd)?(a=",",pd++):(a=null,0===qd&&e('","')))))))))),a}function Ua(){var a,b,d,f,i;if(f=pd,i=pd,a=h(),null!==a){for(b=[],d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(pd)?(d="+",pd++):(d=null,0===qd&&e('"+"')),null===d&&(45===c.charCodeAt(pd)?(d="-",pd++):(d=null,0===qd&&e('"-"')),null===d&&(46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."'))))));null!==d;)b.push(d),d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(pd)?(d="+",pd++):(d=null,0===qd&&e('"+"')),null===d&&(45===c.charCodeAt(pd)?(d="-",pd++):(d=null,0===qd&&e('"-"')),null===d&&(46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."'))))));null!==b?a=[a,b]:(a=null,pd=i)}else a=null,pd=i;return null!==a&&(a=function(a){vd.scheme=c.substring(pd,a)}(f)),null===a&&(pd=f),a}function Va(){var a;return a=Wa(),null===a&&(a=Xa()),a}function Wa(){var a,b,d,f;return d=pd,f=pd,a=$(),null!==a?(64===c.charCodeAt(pd)?(b="@",pd++):(b=null,0===qd&&e('"@"')),null!==b?a=[a,b]:(a=null,pd=f)):(a=null,pd=f),a=null!==a?a:"",null!==a?(b=ca(),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),a=null!==a?a:""}function Xa(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(pd)?(b="$",pd++):(b=null,0===qd&&e('"$"')),null===b&&(44===c.charCodeAt(pd)?(b=",",pd++):(b=null,0===qd&&e('","')),null===b&&(59===c.charCodeAt(pd)?(b=";",pd++):(b=null,0===qd&&e('";"')),null===b&&(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null===b&&(64===c.charCodeAt(pd)?(b="@",pd++):(b=null,0===qd&&e('"@"')),null===b&&(38===c.charCodeAt(pd)?(b="&",pd++):(b=null,0===qd&&e('"&"')),null===b&&(61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(pd)?(b="$",pd++):(b=null,0===qd&&e('"$"')),null===b&&(44===c.charCodeAt(pd)?(b=",",pd++):(b=null,0===qd&&e('","')),null===b&&(59===c.charCodeAt(pd)?(b=";",pd++):(b=null,0===qd&&e('";"')),null===b&&(58===c.charCodeAt(pd)?(b=":",pd++):(b=null,0===qd&&e('":"')),null===b&&(64===c.charCodeAt(pd)?(b="@",pd++):(b=null,0===qd&&e('"@"')),null===b&&(38===c.charCodeAt(pd)?(b="&",pd++):(b=null,0===qd&&e('"&"')),null===b&&(61===c.charCodeAt(pd)?(b="=",pd++):(b=null,0===qd&&e('"="')),null===b&&(43===c.charCodeAt(pd)?(b="+",pd++):(b=null,0===qd&&e('"+"')))))))))));else a=null;return a}function Ya(){var a,b;for(a=[],b=Oa();null!==b;)a.push(b),b=Oa();return a}function Za(){var a,b,d,f,h,i,j,k;if(j=pd,k=pd,"sip"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"SIP"')),null!==a)if(47===c.charCodeAt(pd)?(b="/",pd++):(b=null,0===qd&&e('"/"')),null!==b){if(f=g(),null!==f)for(d=[];null!==f;)d.push(f),f=g();else d=null;if(null!==d)if(46===c.charCodeAt(pd)?(f=".",pd++):(f=null,0===qd&&e('"."')),null!==f){if(i=g(),null!==i)for(h=[];null!==i;)h.push(i),i=g();else h=null;null!==h?a=[a,b,d,f,h]:(a=null,pd=k)}else a=null,pd=k;else a=null,pd=k}else a=null,pd=k;else a=null,pd=k;return null!==a&&(a=function(a){vd.sip_version=c.substring(pd,a)}(j)),null===a&&(pd=j),a}function $a(){var a;return"INVITE"===c.substr(pd,6)?(a="INVITE",pd+=6):(a=null,0===qd&&e('"INVITE"')),a}function _a(){var a;return"ACK"===c.substr(pd,3)?(a="ACK",pd+=3):(a=null,0===qd&&e('"ACK"')),a}function ab(){var a;return"OPTIONS"===c.substr(pd,7)?(a="OPTIONS",pd+=7):(a=null,0===qd&&e('"OPTIONS"')),a}function bb(){var a;return"BYE"===c.substr(pd,3)?(a="BYE",pd+=3):(a=null,0===qd&&e('"BYE"')),a}function cb(){var a;return"CANCEL"===c.substr(pd,6)?(a="CANCEL",pd+=6):(a=null,0===qd&&e('"CANCEL"')),a}function db(){var a;return"REGISTER"===c.substr(pd,8)?(a="REGISTER",pd+=8):(a=null,0===qd&&e('"REGISTER"')),a}function eb(){var a;return"SUBSCRIBE"===c.substr(pd,9)?(a="SUBSCRIBE",pd+=9):(a=null,0===qd&&e('"SUBSCRIBE"')),a}function fb(){var a;return"NOTIFY"===c.substr(pd,6)?(a="NOTIFY",pd+=6):(a=null,0===qd&&e('"NOTIFY"')),
a}function gb(){var a;return"REFER"===c.substr(pd,5)?(a="REFER",pd+=5):(a=null,0===qd&&e('"REFER"')),a}function hb(){var a,b;return b=pd,a=$a(),null===a&&(a=_a(),null===a&&(a=ab(),null===a&&(a=bb(),null===a&&(a=cb(),null===a&&(a=db(),null===a&&(a=eb(),null===a&&(a=fb(),null===a&&(a=gb(),null===a&&(a=B()))))))))),null!==a&&(a=function(a){return vd.method=c.substring(pd,a),vd.method}(b)),null===a&&(pd=b),a}function ib(){var a,b,c,d,e,f;return f=pd,a=Za(),null!==a?(b=m(),null!==b?(c=jb(),null!==c?(d=m(),null!==d?(e=lb(),null!==e?a=[a,b,c,d,e]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function jb(){var a,b;return b=pd,a=kb(),null!==a&&(a=function(a,b){vd.status_code=parseInt(b.join(""))}(b,a)),null===a&&(pd=b),a}function kb(){var a,b,c,d;return d=pd,a=g(),null!==a?(b=g(),null!==b?(c=g(),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)):(a=null,pd=d),a}function lb(){var a,b,d;for(d=pd,a=[],b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));null!==b;)a.push(b),b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));return null!==a&&(a=function(a){vd.reason_phrase=c.substring(pd,a)}(d)),null===a&&(pd=d),a}function mb(){var a,b,c,d,e,f;if(e=pd,a=Tb(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=Tb(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=Tb(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function nb(){var a,b,d,f,g,h;return f=pd,g=pd,a=E(),null!==a?(h=pd,64===c.charCodeAt(pd)?(b="@",pd++):(b=null,0===qd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){vd=c.substring(pd,a)}(f)),null===a&&(pd=f),a}function ob(){var a,b,c,d,e,f,g;if(e=pd,a=F(),null===a)if(f=pd,a=pb(),null!==a){for(b=[],g=pd,c=M(),null!==c?(d=pb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=M(),null!==c?(d=pb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){var b,c;for(c=vd.multi_header.length,b=0;b<c;b++)if(null===vd.multi_header[b].parsed){vd=null;break}vd=null!==vd?vd.multi_header:-1}(e)),null===a&&(pd=e),a}function pb(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=X(),null===a&&(a=qb()),null!==a){for(b=[],g=pd,c=N(),null!==c?(d=sb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=N(),null!==c?(d=sb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){var b;vd.multi_header||(vd.multi_header=[]);try{b=new ud(vd.uri,vd.display_name,vd.params),delete vd.uri,delete vd.display_name,delete vd.params}catch(c){b=null}vd.multi_header.push({possition:pd,offset:a,parsed:b})}(e)),null===a&&(pd=e),a}function qb(){var a,b,c,d,e;return e=pd,a=rb(),a=null!==a?a:"",null!==a?(b=L(),null!==b?(c=Y(),null!==c?(d=K(),null!==d?a=[a,b,c,d]:(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e),a}function rb(){var a,b,d,e,f,g,h;if(f=pd,g=pd,a=B(),null!==a){for(b=[],h=pd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,pd=h)):(d=null,pd=h);null!==d;)b.push(d),h=pd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,pd=h)):(d=null,pd=h);null!==b?a=[a,b]:(a=null,pd=g)}else a=null,pd=g;return null===a&&(a=T()),null!==a&&(a=function(a,b){b=c.substring(pd,a).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),vd.display_name=b}(f,a)),null===a&&(pd=f),a}function sb(){var a;return a=tb(),null===a&&(a=ub(),null===a&&(a=xb())),a}function tb(){var a,b,d,f,g;return f=pd,g=pd,"q"===c.substr(pd,1).toLowerCase()?(a=c.substr(pd,1),pd++):(a=null,0===qd&&e('"q"')),null!==a?(b=H(),null!==b?(d=wb(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.params||(vd.params={}),vd.params.q=b}(f,a[2])),null===a&&(pd=f),a}function ub(){var a,b,d,f,g;return f=pd,g=pd,"expires"===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=vb(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.params||(vd.params={}),vd.params.expires=b}(f,a[2])),null===a&&(pd=f),a}function vb(){var a,b,c;if(c=pd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){return parseInt(b.join(""))}(c,a)),null===a&&(pd=c),a}function wb(){var a,b,d,f,h,i,j,k;return i=pd,j=pd,48===c.charCodeAt(pd)?(a="0",pd++):(a=null,0===qd&&e('"0"')),null!==a?(k=pd,46===c.charCodeAt(pd)?(b=".",pd++):(b=null,0===qd&&e('"."')),null!==b?(d=g(),d=null!==d?d:"",null!==d?(f=g(),f=null!==f?f:"",null!==f?(h=g(),h=null!==h?h:"",null!==h?b=[b,d,f,h]:(b=null,pd=k)):(b=null,pd=k)):(b=null,pd=k)):(b=null,pd=k),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=j)):(a=null,pd=j),null!==a&&(a=function(a){return parseFloat(c.substring(pd,a))}(i)),null===a&&(pd=i),a}function xb(){var a,b,c,d,e,f;return d=pd,e=pd,a=B(),null!==a?(f=pd,b=H(),null!==b?(c=yb(),null!==c?b=[b,c]:(b=null,pd=f)):(b=null,pd=f),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=e)):(a=null,pd=e),null!==a&&(a=function(a,b,c){vd.params||(vd.params={}),c="undefined"==typeof c?void 0:c[1],vd.params[b.toLowerCase()]=c}(d,a[0],a[1])),null===a&&(pd=d),a}function yb(){var a;return a=B(),null===a&&(a=da(),null===a&&(a=T())),a}function zb(){var a,b,c,d,e,f;if(e=pd,a=Ab(),null!==a){for(b=[],f=pd,c=N(),null!==c?(d=Bb(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=N(),null!==c?(d=Bb(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function Ab(){var a;return"render"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"render"')),null===a&&("session"===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"session"')),null===a&&("icon"===c.substr(pd,4).toLowerCase()?(a=c.substr(pd,4),pd+=4):(a=null,0===qd&&e('"icon"')),null===a&&("alert"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"alert"')),null===a&&(a=B())))),a}function Bb(){var a;return a=Cb(),null===a&&(a=xb()),a}function Cb(){var a,b,d,f;return f=pd,"handling"===c.substr(pd,8).toLowerCase()?(a=c.substr(pd,8),pd+=8):(a=null,0===qd&&e('"handling"')),null!==a?(b=H(),null!==b?("optional"===c.substr(pd,8).toLowerCase()?(d=c.substr(pd,8),pd+=8):(d=null,0===qd&&e('"optional"')),null===d&&("required"===c.substr(pd,8).toLowerCase()?(d=c.substr(pd,8),pd+=8):(d=null,0===qd&&e('"required"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function Db(){var a,b,c,d,e,f;if(e=pd,a=B(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function Eb(){var a,b,c;if(c=pd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){vd=parseInt(b.join(""))}(c,a)),null===a&&(pd=c),a}function Fb(){var a,b;return b=pd,a=Gb(),null!==a&&(a=function(a){vd=c.substring(pd,a)}(b)),null===a&&(pd=b),a}function Gb(){var a,b,c,d,e,f,g,h;if(g=pd,a=Hb(),null!==a)if(b=G(),null!==b)if(c=Mb(),null!==c){for(d=[],h=pd,e=N(),null!==e?(f=Nb(),null!==f?e=[e,f]:(e=null,pd=h)):(e=null,pd=h);null!==e;)d.push(e),h=pd,e=N(),null!==e?(f=Nb(),null!==f?e=[e,f]:(e=null,pd=h)):(e=null,pd=h);null!==d?a=[a,b,c,d]:(a=null,pd=g)}else a=null,pd=g;else a=null,pd=g;else a=null,pd=g;return a}function Hb(){var a;return a=Ib(),null===a&&(a=Jb()),a}function Ib(){var a;return"text"===c.substr(pd,4).toLowerCase()?(a=c.substr(pd,4),pd+=4):(a=null,0===qd&&e('"text"')),null===a&&("image"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"image"')),null===a&&("audio"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"audio"')),null===a&&("video"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"video"')),null===a&&("application"===c.substr(pd,11).toLowerCase()?(a=c.substr(pd,11),pd+=11):(a=null,0===qd&&e('"application"')),null===a&&(a=Kb()))))),a}function Jb(){var a;return"message"===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"message"')),null===a&&("multipart"===c.substr(pd,9).toLowerCase()?(a=c.substr(pd,9),pd+=9):(a=null,0===qd&&e('"multipart"')),null===a&&(a=Kb())),a}function Kb(){var a;return a=B(),null===a&&(a=Lb()),a}function Lb(){var a,b,d;return d=pd,"x-"===c.substr(pd,2).toLowerCase()?(a=c.substr(pd,2),pd+=2):(a=null,0===qd&&e('"x-"')),null!==a?(b=B(),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),a}function Mb(){var a;return a=Kb(),null===a&&(a=B()),a}function Nb(){var a,b,c,d;return d=pd,a=B(),null!==a?(b=H(),null!==b?(c=Ob(),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)):(a=null,pd=d),a}function Ob(){var a;return a=B(),null===a&&(a=T()),a}function Pb(){var a,b,c,d;return d=pd,a=Qb(),null!==a?(b=t(),null!==b?(c=hb(),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)):(a=null,pd=d),a}function Qb(){var a,b,c;if(c=pd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){vd.value=parseInt(b.join(""))}(c,a)),null===a&&(pd=c),a}function Rb(){var a,b;return b=pd,a=vb(),null!==a&&(a=function(a,b){vd=b}(b,a)),null===a&&(pd=b),a}function Sb(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=Tb(),null!==a){for(b=[],g=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a,b){vd.event=b.join("").toLowerCase()}(e,a[0])),null===a&&(pd=e),a}function Tb(){var a,b,d,f,g,h;if(g=pd,a=C(),null!==a){for(b=[],h=pd,46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,pd=h)):(d=null,pd=h);null!==d;)b.push(d),h=pd,46===c.charCodeAt(pd)?(d=".",pd++):(d=null,0===qd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,pd=h)):(d=null,pd=h);null!==b?a=[a,b]:(a=null,pd=g)}else a=null,pd=g;return a}function Ub(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=X(),null===a&&(a=qb()),null!==a){for(b=[],g=pd,c=N(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=N(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){var b=vd.tag;try{vd=new ud(vd.uri,vd.display_name,vd.params),b&&vd.setParam("tag",b)}catch(c){vd=-1}}(e)),null===a&&(pd=e),a}function Vb(){var a;return a=Wb(),null===a&&(a=xb()),a}function Wb(){var a,b,d,f,g;return f=pd,g=pd,"tag"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.tag=b}(f,a[2])),null===a&&(pd=f),a}function Xb(){var a,b,c;if(c=pd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){vd=parseInt(b.join(""))}(c,a)),null===a&&(pd=c),a}function Yb(){var a,b;return b=pd,a=vb(),null!==a&&(a=function(a,b){vd=b}(b,a)),null===a&&(pd=b),a}function Zb(){var a,b,c,d,e,f,g,h,i,j;for(h=pd,i=pd,a=[],b=rb();null!==b;)a.push(b),b=rb();if(null!==a)if(b=L(),null!==b)if(c=Y(),null!==c)if(d=K(),null!==d){for(e=[],j=pd,f=N(),null!==f?(g=xb(),null!==g?f=[f,g]:(f=null,pd=j)):(f=null,pd=j);null!==f;)e.push(f),j=pd,f=N(),null!==f?(g=xb(),null!==g?f=[f,g]:(f=null,pd=j)):(f=null,pd=j);null!==e?a=[a,b,c,d,e]:(a=null,pd=i)}else a=null,pd=i;else a=null,pd=i;else a=null,pd=i;else a=null,pd=i;return null!==a&&(a=function(a){try{vd=new ud(vd.uri,vd.display_name,vd.params)}catch(b){vd=-1}}(h)),null===a&&(pd=h),a}function $b(){var a;return a=_b()}function _b(){var a,b,d,f,g,h,i,j;if(i=pd,"digest"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"Digest"')),null!==a)if(b=t(),null!==b)if(d=cc(),null!==d){for(f=[],j=pd,g=M(),null!==g?(h=cc(),null!==h?g=[g,h]:(g=null,pd=j)):(g=null,pd=j);null!==g;)f.push(g),j=pd,g=M(),null!==g?(h=cc(),null!==h?g=[g,h]:(g=null,pd=j)):(g=null,pd=j);null!==f?a=[a,b,d,f]:(a=null,pd=i)}else a=null,pd=i;else a=null,pd=i;else a=null,pd=i;return null===a&&(a=ac()),a}function ac(){var a,b,c,d,e,f,g,h;if(g=pd,a=B(),null!==a)if(b=t(),null!==b)if(c=bc(),null!==c){for(d=[],h=pd,e=M(),null!==e?(f=bc(),null!==f?e=[e,f]:(e=null,pd=h)):(e=null,pd=h);null!==e;)d.push(e),h=pd,e=M(),null!==e?(f=bc(),null!==f?e=[e,f]:(e=null,pd=h)):(e=null,pd=h);null!==d?a=[a,b,c,d]:(a=null,pd=g)}else a=null,pd=g;else a=null,pd=g;else a=null,pd=g;return a}function bc(){var a,b,c,d;return d=pd,a=B(),null!==a?(b=H(),null!==b?(c=B(),null===c&&(c=T()),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)):(a=null,pd=d),a}function cc(){var a;return a=dc(),null===a&&(a=fc(),null===a&&(a=hc(),null===a&&(a=jc(),null===a&&(a=kc(),null===a&&(a=lc(),null===a&&(a=mc(),null===a&&(a=bc()))))))),a}function dc(){var a,b,d,f;return f=pd,"realm"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"realm"')),null!==a?(b=H(),null!==b?(d=ec(),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function ec(){var a,b;return b=pd,a=U(),null!==a&&(a=function(a,b){vd.realm=b}(b,a)),null===a&&(pd=b),a}function fc(){var a,b,d,f,g,h,i,j,k;if(j=pd,"domain"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"domain"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d)if(f=gc(),null!==f){if(g=[],k=pd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;for(null!==h?(i=gc(),null!==i?h=[h,i]:(h=null,pd=k)):(h=null,pd=k);null!==h;){if(g.push(h),k=pd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;null!==h?(i=gc(),null!==i?h=[h,i]:(h=null,pd=k)):(h=null,pd=k)}null!==g?(h=Q(),null!==h?a=[a,b,d,f,g,h]:(a=null,pd=j)):(a=null,pd=j)}else a=null,pd=j;else a=null,pd=j;else a=null,pd=j;else a=null,pd=j;return a}function gc(){var a;return a=Ja(),null===a&&(a=Ma()),a}function hc(){var a,b,d,f;return f=pd,"nonce"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"nonce"')),null!==a?(b=H(),null!==b?(d=ic(),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function ic(){var a,b;return b=pd,a=U(),null!==a&&(a=function(a,b){vd.nonce=b}(b,a)),null===a&&(pd=b),a}function jc(){var a,b,d,f,g;return f=pd,g=pd,"opaque"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"opaque"')),null!==a?(b=H(),null!==b?(d=U(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.opaque=b}(f,a[2])),null===a&&(pd=f),a}function kc(){var a,b,d,f,g;return f=pd,"stale"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"stale"')),null!==a?(b=H(),null!==b?(g=pd,"true"===c.substr(pd,4).toLowerCase()?(d=c.substr(pd,4),pd+=4):(d=null,0===qd&&e('"true"')),null!==d&&(d=function(a){vd.stale=!0}(g)),null===d&&(pd=g),null===d&&(g=pd,"false"===c.substr(pd,5).toLowerCase()?(d=c.substr(pd,5),pd+=5):(d=null,0===qd&&e('"false"')),null!==d&&(d=function(a){vd.stale=!1}(g)),null===d&&(pd=g)),null!==d?a=[a,b,d]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function lc(){var a,b,d,f,g;return f=pd,g=pd,"algorithm"===c.substr(pd,9).toLowerCase()?(a=c.substr(pd,9),pd+=9):(a=null,0===qd&&e('"algorithm"')),null!==a?(b=H(),null!==b?("md5"===c.substr(pd,3).toLowerCase()?(d=c.substr(pd,3),pd+=3):(d=null,0===qd&&e('"MD5"')),null===d&&("md5-sess"===c.substr(pd,8).toLowerCase()?(d=c.substr(pd,8),pd+=8):(d=null,0===qd&&e('"MD5-sess"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.algorithm=b.toUpperCase()}(f,a[2])),null===a&&(pd=f),a}function mc(){var a,b,d,f,g,h,i,j,k,l;if(j=pd,"qop"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"qop"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d){if(k=pd,f=nc(),null!==f){for(g=[],l=pd,44===c.charCodeAt(pd)?(h=",",pd++):(h=null,0===qd&&e('","')),null!==h?(i=nc(),null!==i?h=[h,i]:(h=null,pd=l)):(h=null,pd=l);null!==h;)g.push(h),l=pd,44===c.charCodeAt(pd)?(h=",",pd++):(h=null,0===qd&&e('","')),null!==h?(i=nc(),null!==i?h=[h,i]:(h=null,pd=l)):(h=null,pd=l);null!==g?f=[f,g]:(f=null,pd=k)}else f=null,pd=k;null!==f?(g=Q(),null!==g?a=[a,b,d,f,g]:(a=null,pd=j)):(a=null,pd=j)}else a=null,pd=j;else a=null,pd=j;else a=null,pd=j;return a}function nc(){var a,b;return b=pd,"auth-int"===c.substr(pd,8).toLowerCase()?(a=c.substr(pd,8),pd+=8):(a=null,0===qd&&e('"auth-int"')),null===a&&("auth"===c.substr(pd,4).toLowerCase()?(a=c.substr(pd,4),pd+=4):(a=null,0===qd&&e('"auth"')),null===a&&(a=B())),null!==a&&(a=function(a,b){vd.qop||(vd.qop=[]),vd.qop.push(b.toLowerCase())}(b,a)),null===a&&(pd=b),a}function oc(){var a,b,c,d,e,f;if(e=pd,a=B(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function pc(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=qc(),null!==a){for(b=[],g=pd,c=M(),null!==c?(d=qc(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=M(),null!==c?(d=qc(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){var b,c;for(c=vd.multi_header.length,b=0;b<c;b++)if(null===vd.multi_header[b].parsed){vd=null;break}vd=null!==vd?vd.multi_header:-1}(e)),null===a&&(pd=e),a}function qc(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=qb(),null!==a){for(b=[],g=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){var b;vd.multi_header||(vd.multi_header=[]);try{b=new ud(vd.uri,vd.display_name,vd.params),delete vd.uri,delete vd.display_name,delete vd.params}catch(c){b=null}vd.multi_header.push({possition:pd,offset:a,parsed:b})}(e)),null===a&&(pd=e),a}function rc(){var a,b,d,f,g,h,i;if(g=pd,h=pd,"sip"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"SIP"')),null===a&&(a=B()),null!==a){for(b=[],i=pd,d=N(),null!==d?(f=sc(),null!==f?d=[d,f]:(d=null,pd=i)):(d=null,pd=i);null!==d;)b.push(d),i=pd,d=N(),null!==d?(f=sc(),null!==f?d=[d,f]:(d=null,pd=i)):(d=null,pd=i);null!==b?a=[a,b]:(a=null,pd=h)}else a=null,pd=h;return null!==a&&(a=function(a,b){if(vd.protocol=b.toLowerCase(),vd.params||(vd.params={}),vd.params.text&&'"'===vd.params.text[0]){var c=vd.params.text;vd.text=c.substring(1,c.length-1),delete vd.params.text}}(g,a[0])),null===a&&(pd=g),a}function sc(){var a;return a=tc(),null===a&&(a=xb()),a}function tc(){var a,b,d,f,h,i;if(h=pd,i=pd,"cause"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"cause"')),null!==a)if(b=H(),null!==b){if(f=g(),null!==f)for(d=[];null!==f;)d.push(f),f=g();else d=null;null!==d?a=[a,b,d]:(a=null,pd=i)}else a=null,pd=i;else a=null,pd=i;return null!==a&&(a=function(a,b){vd.cause=parseInt(b.join(""))}(h,a[2])),null===a&&(pd=h),a}function uc(){var a,b,c,d,e,f;if(e=pd,a=B(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function vc(){var a,b,c,d,e,f;if(e=pd,a=wc(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=wc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=wc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function wc(){var a,b,c,d,e,f;if(e=pd,a=qb(),null!==a){for(b=[],f=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function xc(){var a,b,c,d,e,f;if(e=pd,a=yc(),null!==a){for(b=[],f=pd,c=N(),null!==c?(d=zc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=N(),null!==c?(d=zc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function yc(){var a,b;return b=pd,"active"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"active"')),null===a&&("pending"===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"pending"')),null===a&&("terminated"===c.substr(pd,10).toLowerCase()?(a=c.substr(pd,10),pd+=10):(a=null,0===qd&&e('"terminated"')),null===a&&(a=B()))),null!==a&&(a=function(a){vd.state=c.substring(pd,a)}(b)),null===a&&(pd=b),a}function zc(){var a,b,d,f,g;return f=pd,g=pd,"reason"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"reason"')),null!==a?(b=H(),null!==b?(d=Ac(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(vd.reason=b)}(f,a[2])),null===a&&(pd=f),null===a&&(f=pd,g=pd,"expires"===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=vb(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(vd.expires=b)}(f,a[2])),null===a&&(pd=f),null===a&&(f=pd,g=pd,"retry_after"===c.substr(pd,11).toLowerCase()?(a=c.substr(pd,11),pd+=11):(a=null,0===qd&&e('"retry_after"')),null!==a?(b=H(),null!==b?(d=vb(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(vd.retry_after=b)}(f,a[2])),null===a&&(pd=f),null===a&&(a=xb()))),a}function Ac(){var a;return"deactivated"===c.substr(pd,11).toLowerCase()?(a=c.substr(pd,11),pd+=11):(a=null,0===qd&&e('"deactivated"')),null===a&&("probation"===c.substr(pd,9).toLowerCase()?(a=c.substr(pd,9),pd+=9):(a=null,0===qd&&e('"probation"')),null===a&&("rejected"===c.substr(pd,8).toLowerCase()?(a=c.substr(pd,8),pd+=8):(a=null,0===qd&&e('"rejected"')),null===a&&("timeout"===c.substr(pd,7).toLowerCase()?(a=c.substr(pd,7),pd+=7):(a=null,0===qd&&e('"timeout"')),null===a&&("giveup"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"giveup"')),null===a&&("noresource"===c.substr(pd,10).toLowerCase()?(a=c.substr(pd,10),pd+=10):(a=null,0===qd&&e('"noresource"')),null===a&&("invariant"===c.substr(pd,9).toLowerCase()?(a=c.substr(pd,9),pd+=9):(a=null,0===qd&&e('"invariant"')),null===a&&(a=B()))))))),a}function Bc(){var a;return a=w(),a=null!==a?a:""}function Cc(){var a,b,c,d,e,f;if(e=pd,a=B(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a=null!==a?a:""}function Dc(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=X(),null===a&&(a=qb()),null!==a){for(b=[],g=pd,c=N(),null!==c?(d=Ec(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=N(),null!==c?(d=Ec(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){var b=vd.tag;try{vd=new ud(vd.uri,vd.display_name,vd.params),b&&vd.setParam("tag",b)}catch(c){vd=-1}}(e)),null===a&&(pd=e),a}function Ec(){var a;return a=Wb(),null===a&&(a=xb()),a}function Fc(){var a,b,c,d,e,f;if(e=pd,a=Gc(),null!==a){for(b=[],f=pd,c=M(),null!==c?(d=Gc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=M(),null!==c?(d=Gc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function Gc(){var a,b,c,d,e,f,g,h;if(g=pd,a=Nc(),null!==a)if(b=t(),null!==b)if(c=Qc(),null!==c){for(d=[],h=pd,e=N(),null!==e?(f=Hc(),null!==f?e=[e,f]:(e=null,pd=h)):(e=null,pd=h);null!==e;)d.push(e),h=pd,e=N(),null!==e?(f=Hc(),null!==f?e=[e,f]:(e=null,pd=h)):(e=null,pd=h);null!==d?a=[a,b,c,d]:(a=null,pd=g)}else a=null,pd=g;else a=null,pd=g;else a=null,pd=g;return a}function Hc(){var a;return a=Ic(),null===a&&(a=Jc(),null===a&&(a=Kc(),null===a&&(a=Lc(),null===a&&(a=Mc(),null===a&&(a=xb()))))),a}function Ic(){var a,b,d,f,g;return f=pd,g=pd,"ttl"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"ttl"')),null!==a?(b=H(),null!==b?(d=Tc(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.ttl=b}(f,a[2])),null===a&&(pd=f),a}function Jc(){var a,b,d,f,g;return f=pd,g=pd,"maddr"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"maddr"')),null!==a?(b=H(),null!==b?(d=da(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.maddr=b}(f,a[2])),null===a&&(pd=f),a}function Kc(){var a,b,d,f,g;return f=pd,g=pd,"received"===c.substr(pd,8).toLowerCase()?(a=c.substr(pd,8),pd+=8):(a=null,0===qd&&e('"received"')),null!==a?(b=H(),null!==b?(d=la(),null===d&&(d=ia()),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.received=b}(f,a[2])),null===a&&(pd=f),a}function Lc(){var a,b,d,f,g;return f=pd,g=pd,"branch"===c.substr(pd,6).toLowerCase()?(a=c.substr(pd,6),pd+=6):(a=null,0===qd&&e('"branch"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.branch=b}(f,a[2])),null===a&&(pd=f),a}function Mc(){var a,b,d,f,h,i,j;if(h=pd,i=pd,"rport"===c.substr(pd,5).toLowerCase()?(a=c.substr(pd,5),pd+=5):(a=null,0===qd&&e('"rport"')),null!==a){if(j=pd,b=H(),null!==b){for(d=[],f=g();null!==f;)d.push(f),f=g();null!==d?b=[b,d]:(b=null,pd=j)}else b=null,pd=j;b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=i)}else a=null,pd=i;return null!==a&&(a=function(a){"undefined"!=typeof response_port&&(vd.rport=response_port.join(""))}(h)),null===a&&(pd=h),a}function Nc(){var a,b,c,d,e,f;return f=pd,a=Oc(),null!==a?(b=G(),null!==b?(c=B(),null!==c?(d=G(),null!==d?(e=Pc(),null!==e?a=[a,b,c,d,e]:(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f)):(a=null,pd=f),a}function Oc(){var a,b;return b=pd,"sip"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"SIP"')),null===a&&(a=B()),null!==a&&(a=function(a,b){vd.protocol=b}(b,a)),null===a&&(pd=b),a}function Pc(){var a,b;return b=pd,"udp"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"UDP"')),null===a&&("tcp"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"TCP"')),null===a&&("tls"===c.substr(pd,3).toLowerCase()?(a=c.substr(pd,3),pd+=3):(a=null,0===qd&&e('"TLS"')),null===a&&("sctp"===c.substr(pd,4).toLowerCase()?(a=c.substr(pd,4),pd+=4):(a=null,0===qd&&e('"SCTP"')),null===a&&(a=B())))),null!==a&&(a=function(a,b){vd.transport=b}(b,a)),null===a&&(pd=b),a}function Qc(){var a,b,c,d,e;return d=pd,a=Rc(),null!==a?(e=pd,b=O(),null!==b?(c=Sc(),null!==c?b=[b,c]:(b=null,pd=e)):(b=null,pd=e),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),a}function Rc(){var a,b;return b=pd,a=la(),null===a&&(a=ha(),null===a&&(a=ea())),null!==a&&(a=function(a){vd.host=c.substring(pd,a)}(b)),null===a&&(pd=b),a}function Sc(){var a,b,c,d,e,f,h;return f=pd,h=pd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h)):(a=null,pd=h),null!==a&&(a=function(a,b){vd.port=parseInt(b.join(""))}(f,a)),null===a&&(pd=f),a}function Tc(){var a,b,c,d,e;return d=pd,e=pd,a=g(),null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e),null!==a&&(a=function(a,b){return parseInt(b.join(""))}(d,a)),null===a&&(pd=d),a}function Uc(){var a;return a=_b()}function Vc(){var a,b,c,d,e,f;if(e=pd,a=Wc(),null!==a){for(b=[],f=pd,c=N(),null!==c?(d=Xc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=N(),null!==c?(d=Xc(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function Wc(){var a,b;return b=pd,a=vb(),null!==a&&(a=function(a,b){vd.expires=b}(b,a)),null===a&&(pd=b),a}function Xc(){var a;return a=Yc(),null===a&&(a=xb()),a}function Yc(){var a,b,d,f,g;return f=pd,g=pd,"refresher"===c.substr(pd,9).toLowerCase()?(a=c.substr(pd,9),pd+=9):(a=null,0===qd&&e('"refresher"')),null!==a?(b=H(),null!==b?("uac"===c.substr(pd,3).toLowerCase()?(d=c.substr(pd,3),pd+=3):(d=null,0===qd&&e('"uac"')),null===d&&("uas"===c.substr(pd,3).toLowerCase()?(d=c.substr(pd,3),pd+=3):(d=null,0===qd&&e('"uas"'))),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.refresher=b.toLowerCase()}(f,a[2])),null===a&&(pd=f),a}function Zc(){var a,b,c,d;return d=pd,a=B(),null!==a?(b=v(),null!==b?(c=$c(),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)):(a=null,pd=d),a}function $c(){var a,b;for(a=[],b=x(),null===b&&(b=z(),null===b&&(b=t()));null!==b;)a.push(b),b=x(),null===b&&(b=z(),null===b&&(b=t()));return a}function _c(){var a,b;for(a=[],b=k();null!==b;)a.push(b),b=k();return a}function ad(){var a,b,d;return d=pd,"uuid:"===c.substr(pd,5)?(a="uuid:",pd+=5):(a=null,0===qd&&e('"uuid:"')),null!==a?(b=bd(),null!==b?a=[a,b]:(a=null,pd=d)):(a=null,pd=d),a}function bd(){var a,b,d,f,g,h,i,j,k,l,m;return l=pd,m=pd,a=dd(),null!==a?(45===c.charCodeAt(pd)?(b="-",pd++):(b=null,0===qd&&e('"-"')),null!==b?(d=cd(),null!==d?(45===c.charCodeAt(pd)?(f="-",pd++):(f=null,0===qd&&e('"-"')),null!==f?(g=cd(),null!==g?(45===c.charCodeAt(pd)?(h="-",pd++):(h=null,0===qd&&e('"-"')),null!==h?(i=cd(),null!==i?(45===c.charCodeAt(pd)?(j="-",pd++):(j=null,0===qd&&e('"-"')),null!==j?(k=ed(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m)):(a=null,pd=m),null!==a&&(a=function(a,b){vd=c.substring(pd+5,a)}(l,a[0])),null===a&&(pd=l),a}function cd(){var a,b,c,d,e;return e=pd,a=i(),null!==a?(b=i(),null!==b?(c=i(),null!==c?(d=i(),null!==d?a=[a,b,c,d]:(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e)):(a=null,pd=e),a}function dd(){var a,b,c;return c=pd,a=cd(),null!==a?(b=cd(),null!==b?a=[a,b]:(a=null,pd=c)):(a=null,pd=c),a}function ed(){var a,b,c,d;return d=pd,a=cd(),null!==a?(b=cd(),null!==b?(c=cd(),null!==c?a=[a,b,c]:(a=null,pd=d)):(a=null,pd=d)):(a=null,pd=d),a}function fd(){var a,b,c,d,e,f,g;if(e=pd,f=pd,a=X(),null===a&&(a=qb()),null!==a){for(b=[],g=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==c;)b.push(c),g=pd,c=N(),null!==c?(d=xb(),null!==d?c=[c,d]:(c=null,pd=g)):(c=null,pd=g);null!==b?a=[a,b]:(a=null,pd=f)}else a=null,pd=f;return null!==a&&(a=function(a){try{vd=new ud(vd.uri,vd.display_name,vd.params)}catch(b){vd=-1}}(e)),null===a&&(pd=e),a}function gd(){var a,b,c,d,e,f;if(e=pd,a=hd(),null!==a){for(b=[],f=pd,c=N(),null!==c?(d=id(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==c;)b.push(c),f=pd,c=N(),null!==c?(d=id(),null!==d?c=[c,d]:(c=null,pd=f)):(c=null,pd=f);null!==b?a=[a,b]:(a=null,pd=e)}else a=null,pd=e;return a}function hd(){var a,b,d,f,g,h;return f=pd,g=pd,a=E(),null!==a?(h=pd,64===c.charCodeAt(pd)?(b="@",pd++):(b=null,0===qd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,pd=h)):(b=null,pd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a){vd.call_id=c.substring(pd,a)}(f)),null===a&&(pd=f),a}function id(){var a;return a=jd(),null===a&&(a=kd(),null===a&&(a=ld(),null===a&&(a=xb()))),a}function jd(){var a,b,d,f,g;return f=pd,g=pd,"to-tag"===c.substr(pd,6)?(a="to-tag",pd+=6):(a=null,0===qd&&e('"to-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.to_tag=b}(f,a[2])),null===a&&(pd=f),
a}function kd(){var a,b,d,f,g;return f=pd,g=pd,"from-tag"===c.substr(pd,8)?(a="from-tag",pd+=8):(a=null,0===qd&&e('"from-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,pd=g)):(a=null,pd=g)):(a=null,pd=g),null!==a&&(a=function(a,b){vd.from_tag=b}(f,a[2])),null===a&&(pd=f),a}function ld(){var a,b;return b=pd,"early-only"===c.substr(pd,10)?(a="early-only",pd+=10):(a=null,0===qd&&e('"early-only"')),null!==a&&(a=function(a){vd.early_only=!0}(b)),null===a&&(pd=b),a}function md(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function nd(){for(var a=1,b=1,d=!1,e=0;e<Math.max(pd,rd);e++){var f=c.charAt(e);"\n"===f?(d||a++,b=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,b=1,d=!0):(b++,d=!1)}return{line:a,column:b}}var od={CRLF:f,DIGIT:g,ALPHA:h,HEXDIG:i,WSP:j,OCTET:k,DQUOTE:l,SP:m,HTAB:n,alphanum:o,reserved:p,unreserved:q,mark:r,escaped:s,LWS:t,SWS:u,HCOLON:v,TEXT_UTF8_TRIM:w,TEXT_UTF8char:x,UTF8_NONASCII:y,UTF8_CONT:z,LHEX:A,token:B,token_nodot:C,separators:D,word:E,STAR:F,SLASH:G,EQUAL:H,LPAREN:I,RPAREN:J,RAQUOT:K,LAQUOT:L,COMMA:M,SEMI:N,COLON:O,LDQUOT:P,RDQUOT:Q,comment:R,ctext:S,quoted_string:T,quoted_string_clean:U,qdtext:V,quoted_pair:W,SIP_URI_noparams:X,SIP_URI:Y,uri_scheme:Z,userinfo:$,user:_,user_unreserved:aa,password:ba,hostport:ca,host:da,hostname:ea,domainlabel:fa,toplabel:ga,IPv6reference:ha,IPv6address:ia,h16:ja,ls32:ka,IPv4address:la,dec_octet:ma,port:na,uri_parameters:oa,uri_parameter:pa,transport_param:qa,user_param:ra,method_param:sa,ttl_param:ta,maddr_param:ua,lr_param:va,other_param:wa,pname:xa,pvalue:ya,paramchar:za,param_unreserved:Aa,headers:Ba,header:Ca,hname:Da,hvalue:Ea,hnv_unreserved:Fa,Request_Response:Ga,Request_Line:Ha,Request_URI:Ia,absoluteURI:Ja,hier_part:Ka,net_path:La,abs_path:Ma,opaque_part:Na,uric:Oa,uric_no_slash:Pa,path_segments:Qa,segment:Ra,param:Sa,pchar:Ta,scheme:Ua,authority:Va,srvr:Wa,reg_name:Xa,query:Ya,SIP_Version:Za,INVITEm:$a,ACKm:_a,OPTIONSm:ab,BYEm:bb,CANCELm:cb,REGISTERm:db,SUBSCRIBEm:eb,NOTIFYm:fb,REFERm:gb,Method:hb,Status_Line:ib,Status_Code:jb,extension_code:kb,Reason_Phrase:lb,Allow_Events:mb,Call_ID:nb,Contact:ob,contact_param:pb,name_addr:qb,display_name:rb,contact_params:sb,c_p_q:tb,c_p_expires:ub,delta_seconds:vb,qvalue:wb,generic_param:xb,gen_value:yb,Content_Disposition:zb,disp_type:Ab,disp_param:Bb,handling_param:Cb,Content_Encoding:Db,Content_Length:Eb,Content_Type:Fb,media_type:Gb,m_type:Hb,discrete_type:Ib,composite_type:Jb,extension_token:Kb,x_token:Lb,m_subtype:Mb,m_parameter:Nb,m_value:Ob,CSeq:Pb,CSeq_value:Qb,Expires:Rb,Event:Sb,event_type:Tb,From:Ub,from_param:Vb,tag_param:Wb,Max_Forwards:Xb,Min_Expires:Yb,Name_Addr_Header:Zb,Proxy_Authenticate:$b,challenge:_b,other_challenge:ac,auth_param:bc,digest_cln:cc,realm:dc,realm_value:ec,domain:fc,URI:gc,nonce:hc,nonce_value:ic,opaque:jc,stale:kc,algorithm:lc,qop_options:mc,qop_value:nc,Proxy_Require:oc,Record_Route:pc,rec_route:qc,Reason:rc,reason_param:sc,reason_cause:tc,Require:uc,Route:vc,route_param:wc,Subscription_State:xc,substate_value:yc,subexp_params:zc,event_reason_value:Ac,Subject:Bc,Supported:Cc,To:Dc,to_param:Ec,Via:Fc,via_param:Gc,via_params:Hc,via_ttl:Ic,via_maddr:Jc,via_received:Kc,via_branch:Lc,response_port:Mc,sent_protocol:Nc,protocol_name:Oc,transport:Pc,sent_by:Qc,via_host:Rc,via_port:Sc,ttl:Tc,WWW_Authenticate:Uc,Session_Expires:Vc,s_e_expires:Wc,s_e_params:Xc,s_e_refresher:Yc,extension_header:Zc,header_value:$c,message_body:_c,uuid_URI:ad,uuid:bd,hex4:cd,hex8:dd,hex12:ed,Refer_To:fd,Replaces:gd,call_id:hd,replaces_param:id,to_tag:jd,from_tag:kd,early_flag:ld};if(void 0!==d){if(void 0===od[d])throw new Error("Invalid rule name: "+b(d)+".")}else d="CRLF";var pd=0,qd=0,rd=0,sd=[],td=a("./URI"),ud=a("./NameAddrHeader"),vd={},wd=od[d]();if(null===wd||pd!==c.length){var xd=Math.max(pd,rd),yd=xd<c.length?c.charAt(xd):null,zd=nd();return new this.SyntaxError(md(sd),yd,xd,zd.line,zd.column),-1}return vd},toSource:function(){return this._source}};return c.SyntaxError=function(a,c,d,e,f){function g(a,c){var d,e;switch(a.length){case 0:d="end of input";break;case 1:d=a[0];break;default:d=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return e=c?b(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=a,this.found=c,this.message=g(a,c),this.offset=d,this.line=e,this.column=f},c.SyntaxError.prototype=Error.prototype,c}()},{"./NameAddrHeader":9,"./URI":23}],7:[function(a,b,c){var d=a("debug")("JsSIP"),e=a("debug");e.enable("JsSIP:*");var f=a("../package.json");d("version %s",f.version);var g=a("rtcninja"),h=a("./Constants"),i=a("./Exceptions"),j=a("./Utils"),k=a("./UA"),l=a("./URI"),m=a("./NameAddrHeader"),n=a("./Grammar"),o=a("./VoxboneLogger.js"),p=b.exports={C:h,Exceptions:i,Utils:j,UA:k,URI:l,NameAddrHeader:m,Grammar:n,debug:a("debug"),rtcninja:g,VoxboneLogger:o};Object.defineProperties(p,{name:{get:function(){return f.title}},version:{get:function(){return f.version}}})},{"../package.json":49,"./Constants":1,"./Exceptions":5,"./Grammar":6,"./NameAddrHeader":9,"./UA":22,"./URI":23,"./Utils":24,"./VoxboneLogger.js":25,debug:32,rtcninja:37}],8:[function(a,b,c){function d(a){this.ua=a,this.data={},f.EventEmitter.call(this)}b.exports=d;var e=a("util"),f=a("events"),g=a("./Constants"),h=a("./SIPMessage"),i=a("./Utils"),j=a("./RequestSender"),k=a("./Transactions"),l=a("./Exceptions");e.inherits(d,f.EventEmitter),d.prototype.send=function(a,b,c){var d,e,f,i,k,l=a;if(void 0===a||void 0===b)throw new TypeError("Not enough arguments");if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+l);c=c||{},k=c.extraHeaders&&c.extraHeaders.slice()||[],i=c.eventHandlers||{},f=c.contentType||"text/plain",this.content_type=f;for(e in i)this.on(e,i[e]);this.closed=!1,this.ua.applicants[this]=this,k.push("Content-Type: "+f),this.request=new h.OutgoingRequest(g.MESSAGE,a,this.ua,null,k),b?(this.request.body=b,this.content=b):this.content=null,d=new j(this,this.ua),this.newMessage("local",this.request),d.send()},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:a});break;default:delete this.ua.applicants[this],b=i.sipErrorCause(a.status_code),this.emit("failed",{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:g.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:g.causes.CONNECTION_ERROR})},d.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},d.prototype.init_incoming=function(a){var b;this.request=a,this.content_type=a.getHeader("Content-Type"),a.body?this.content=a.body:this.content=null,this.newMessage("remote",a),b=this.ua.transactions.nist[a.via_branch],!b||b.state!==k.C.STATUS_TRYING&&b.state!==k.C.STATUS_PROCEEDING||a.reply(200)},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body;if("incoming"!==this.direction)throw new l.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,b,c)},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders&&a.extraHeaders.slice()||[],e=a.body;if("incoming"!==this.direction)throw new l.NotSupportedError('"reject" not supported for outgoing Message');if(b<300||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e)},d.prototype.newMessage=function(a,b){"remote"===a?(this.direction="incoming",this.local_identity=b.to,this.remote_identity=b.from):"local"===a&&(this.direction="outgoing",this.local_identity=b.from,this.remote_identity=b.to),this.ua.newMessage({originator:a,message:this,request:b})}},{"./Constants":1,"./Exceptions":5,"./RequestSender":17,"./SIPMessage":18,"./Transactions":20,"./Utils":24,events:27,util:31}],9:[function(a,b,c){function d(a,b,c){var d;if(!(a&&a instanceof e))throw new TypeError('missing or invalid "uri" parameter');this.uri=a,this.parameters={};for(d in c)this.setParam(d,c[d]);Object.defineProperties(this,{display_name:{get:function(){return b},set:function(a){b=0===a?"0":a}}})}b.exports=d;var e=a("./URI"),f=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var b;if(a=a.toLowerCase(),this.parameters.hasOwnProperty(a))return b=this.parameters[a],delete this.parameters[a],b},clearParams:function(){this.parameters={}},clone:function(){return new d(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var a,b;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",a+="<"+this.uri.toString()+">";for(b in this.parameters)a+=";"+b,null!==this.parameters[b]&&(a+="="+this.parameters[b]);return a}},d.parse=function(a){return a=f.parse(a,"Name_Addr_Header"),a!==-1?a:void 0}},{"./Grammar":6,"./URI":23}],10:[function(a,b,c){function d(a,b){var c=b,d=0,e=0;if(a.substring(c,c+2).match(/(^\r\n)/))return-2;for(;0===d;){if(e=a.indexOf("\r\n",c),e===-1)return e;!a.substring(e+2,e+4).match(/(^\r\n)/)&&a.charAt(e+2).match(/(^\s+)/)?c=e+2:d=e}return d}function e(a,b,c,d){var e,f,g,h,k=b.indexOf(":",c),l=b.substring(c,k).trim(),m=b.substring(k+1,d).trim();switch(l.toLowerCase()){case"via":case"v":a.addHeader("via",m),1===a.getHeaders("via").length?(h=a.parseHeader("Via"),h&&(a.via=h,a.via_branch=h.branch)):h=0;break;case"from":case"f":a.setHeader("from",m),h=a.parseHeader("from"),h&&(a.from=h,a.from_tag=h.getParam("tag"));break;case"to":case"t":a.setHeader("to",m),h=a.parseHeader("to"),h&&(a.to=h,a.to_tag=h.getParam("tag"));break;case"record-route":for(h=i.parse(m,"Record_Route"),h===-1&&(h=void 0),g=h.length,f=0;f<g;f++)e=h[f],a.addHeader("record-route",m.substring(e.possition,e.offset)),a.headers["Record-Route"][a.getHeaders("record-route").length-1].parsed=e.parsed;break;case"call-id":case"i":a.setHeader("call-id",m),h=a.parseHeader("call-id"),h&&(a.call_id=m);break;case"contact":case"m":for(h=i.parse(m,"Contact"),h===-1&&(h=void 0),g=h.length,f=0;f<g;f++)e=h[f],a.addHeader("contact",m.substring(e.possition,e.offset)),a.headers.Contact[a.getHeaders("contact").length-1].parsed=e.parsed;break;case"content-length":case"l":a.setHeader("content-length",m),h=a.parseHeader("content-length");break;case"content-type":case"c":a.setHeader("content-type",m),h=a.parseHeader("content-type");break;case"cseq":a.setHeader("cseq",m),h=a.parseHeader("cseq"),h&&(a.cseq=h.value),a instanceof j.IncomingResponse&&(a.method=h.method);break;case"max-forwards":a.setHeader("max-forwards",m),h=a.parseHeader("max-forwards");break;case"www-authenticate":a.setHeader("www-authenticate",m),h=a.parseHeader("www-authenticate");break;case"proxy-authenticate":a.setHeader("proxy-authenticate",m),h=a.parseHeader("proxy-authenticate");break;case"session-expires":case"x":a.setHeader("session-expires",m),h=a.parseHeader("session-expires"),h&&(a.session_expires=h.expires,a.session_expires_refresher=h.refresher);break;case"refer-to":case"r":a.setHeader("refer-to",m),h=a.parseHeader("refer-to"),h&&(a.refer_to=h);break;case"replaces":a.setHeader("replaces",m),h=a.parseHeader("replaces"),h&&(a.replaces=h);break;case"event":case"o":a.setHeader("event",m),h=a.parseHeader("event"),h&&(a.event=h);break;default:a.setHeader(l,m),h=0}return void 0!==h||{error:'error parsing header "'+l+'"'}}var f={};b.exports=f;var g=a("debug")("JsSIP:ERROR:Parser"),h=a("./VoxboneLogger.js");g.log=h.logerror.bind(console);var i=a("./Grammar"),j=a("./SIPMessage");f.parseMessage=function(a,b){var c,f,h,k,l,m=0,n=a.indexOf("\r\n");if(n===-1)return void g("parseMessage() | no CRLF found, not a SIP message");if(f=a.substring(0,n),l=i.parse(f,"Request_Response"),l===-1)return void g('parseMessage() | error parsing first line of SIP message: "'+f+'"');for(l.status_code?(c=new j.IncomingResponse,c.status_code=l.status_code,c.reason_phrase=l.reason_phrase):(c=new j.IncomingRequest(b),c.method=l.method,c.ruri=l.uri),c.data=a,m=n+2;;){if(n=d(a,m),n===-2){k=m+2;break}if(n===-1)return void l.error("parseMessage() | malformed message");if(l=e(c,a,m,n),l!==!0)return void g("parseMessage() |",l.error);m=n+2}return c.hasHeader("content-length")?(h=c.getHeader("content-length"),c.body=a.substr(k,h)):c.body=a.substring(k),c}},{"./Grammar":6,"./SIPMessage":18,"./VoxboneLogger.js":25,debug:32}],11:[function(a,b,c){function d(a){P("new"),this.ua=a,this.status=M.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.last_sdp=null,this.reinvite_as_sess_ref=!0,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:U.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.data={},O.EventEmitter.call(this)}function e(a,b){var c=this,d=Y.T1;this.timers.invite2xxTimer=setTimeout(function e(){c.status===M.STATUS_WAITING_FOR_ACK&&(a.reply(200,null,["Contact: "+c.contact],b),d<Y.T2&&(d=2*d,d>Y.T2&&(d=Y.T2)),c.timers.invite2xxTimer=setTimeout(e,d))},d)}function f(){var a=this;this.timers.ackTimer=setTimeout(function(){a.status===M.STATUS_WAITING_FOR_ACK&&(P("no ACK received, terminating the session"),clearTimeout(a.timers.invite2xxTimer),t.call(a,U.BYE),G.call(a,"remote",null,U.causes.NO_ACK))},Y.TIMER_H)}function g(a,b){var c=this;this.connection=new S.RTCPeerConnection(a,b),this.connection.onaddstream=function(a,b){c.emit("addstream",{stream:b})},this.connection.onremovestream=function(a,b){c.emit("removestream",{stream:b})},this.connection.oniceconnectionstatechange=function(a,b){c.emit("iceconnetionstatechange",{state:b}),"failed"===b&&c.terminate({cause:U.causes.RTP_TIMEOUT,status_code:200,reason_phrase:U.causes.RTP_TIMEOUT})}}function h(a,b,c,d){function e(a){g.onicecandidate=function(a,c){c||(g.onicecandidate=null,f.rtcReady=!0,b&&b(g.localDescription.sdp),b=null)},g.setLocalDescription(a,function(){"complete"===g.iceGatheringState&&(f.rtcReady=!0,b&&b(g.localDescription.sdp),b=null)},function(a){f.rtcReady=!0,c&&c(a)})}P("createLocalDescription()");var f=this,g=this.connection;if(this.rtcReady=!1,"offer"===a)g.createOffer(e,function(a){f.rtcReady=!0,c&&c(a)},d);else{if("answer"!==a)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+a+'" was given');g.createAnswer(e,function(a){f.rtcReady=!0,c&&c(a)},d)}}function i(a,b,c){var d,e,f="UAS"===b?a.to_tag:a.from_tag,g="UAS"===b?a.from_tag:a.to_tag,h=a.call_id+f+g;return e=this.earlyDialogs[h],c?!!e||(e=new $(this,a,b,$.C.STATUS_EARLY),e.error?(P(e.error),H.call(this,"remote",a,U.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[h]=e,!0)):(this.from_tag=a.from_tag,this.to_tag=a.to_tag,e?(e.update(a,b),this.dialog=e,delete this.earlyDialogs[h],!0):(d=new $(this,a,b),d.error?(P(d.error),H.call(this,"remote",a,U.causes.INTERNAL_ERROR),!1):(this.dialog=d,!0)))}function j(a){function b(b){b=b||{},o=!0;var c=b.status_code||403,d=b.reason_phrase||"",e=b.extraHeaders&&b.extraHeaders.slice()||[];if(this.status!==M.STATUS_CONFIRMED)return!1;if(c<300||c>=700)throw new TypeError("Invalid status_code: "+c);a.reply(c,d,e)}function c(){d(function(b){var c=["Contact: "+l.contact];w.call(l,a,c),l.late_sdp&&(b=u.call(l,b)),a.reply(200,null,c,b,function(){l.status=M.STATUS_WAITING_FOR_ACK,e.call(l,a,b),f.call(l)}),"function"==typeof p.callback&&p.callback()},function(){a.reply(500)})}function d(a,b){l.late_sdp?h.call(l,"offer",a,b,l.rtcOfferConstraints):(l.remoteHold===!0&&n===!1?(l.remoteHold=!1,J.call(l,"remote")):l.remoteHold===!1&&n===!0&&(l.remoteHold=!0,I.call(l,"remote")),h.call(l,"answer",a,b,l.rtcAnswerConstraints))}P("receiveReinvite()");var g,i,j,k,l=this,m=a.getHeader("Content-Type"),n=!1,o=!1,p={request:a,callback:void 0,reject:b.bind(this)};if(this.emit("reinvite",p),!o)if(a.body){if(this.late_sdp=!1,"application/sdp"!==m)return P("invalid Content-Type"),void a.reply(415);for(g=a.parseSDP(),i=0;i<g.media.length;i++)if(k=g.media[i],ea.indexOf(k.type)!==-1){if(j=k.direction||g.direction||"sendrecv","sendonly"!==j&&"inactive"!==j){n=!1;break}n=!0}if(l.reinvite_as_sess_ref){var q=["Contact: "+l.contact];return w.call(l,a,q),void a.reply(200,null,q,null,function(){l.status=M.STATUS_WAITING_FOR_ACK,e.call(l,a,null),f.call(l)})}this.connection.setRemoteDescription(new S.RTCSessionDescription({type:"offer",sdp:a.body}),c,function(){a.reply(488)})}else this.late_sdp=!0,c()}function k(a){function b(b){b=b||{},j=!0;var c=b.status_code||403,d=b.reason_phrase||"",e=b.extraHeaders&&b.extraHeaders.slice()||[];if(this.status!==M.STATUS_CONFIRMED)return!1;if(c<300||c>=700)throw new TypeError("Invalid status_code: "+c);a.reply(c,d,e)}P("receiveUpdate()");var c,d,e,f,g=this,i=a.getHeader("Content-Type"),j=!1,k=!1,l={request:a,callback:void 0,reject:b.bind(this)};if(this.emit("update",l),!j){if(!a.body){var m=[];return w.call(this,a,m),void a.reply(200,null,m)}if("application/sdp"!==i)return P("invalid Content-Type"),void a.reply(415);for(c=a.parseSDP(),d=0;d<c.media.length;d++)if(f=c.media[d],ea.indexOf(f.type)!==-1){if(e=f.direction||c.direction||"sendrecv","sendonly"!==e&&"inactive"!==e){k=!1;break}k=!0}this.connection.setRemoteDescription(new S.RTCSessionDescription({type:"offer",sdp:a.body}),function(){g.remoteHold===!0&&k===!1?(g.remoteHold=!1,J.call(g,"remote")):g.remoteHold===!1&&k===!0&&(g.remoteHold=!0,I.call(g,"remote")),h.call(g,"answer",function(b){var c=["Contact: "+g.contact];w.call(g,a,c),a.reply(200,null,c,b),"function"==typeof l.callback&&l.callback()},function(){a.reply(500)})},function(){a.reply(488)},this.rtcAnswerConstraints)}}function l(a){function b(b,c){var f,g;return c=c||{},b="function"==typeof b?b:null,(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(f=new d(this.ua),f.on("progress",function(a){e.notify(a.response.status_code,a.response.reason_phrase)}),f.on("accepted",function(a){e.notify(a.response.status_code,a.response.reason_phrase)}),f.on("failed",function(a){a.message?e.notify(a.message.status_code,a.message.reason_phrase):e.notify(487,a.cause)}),a.refer_to.uri.hasHeader("replaces")&&(g=decodeURIComponent(a.refer_to.uri.getHeader("replaces")),c.extraHeaders=c.extraHeaders||[],c.extraHeaders.push("Replaces: "+g)),void f.connect(a.refer_to.uri.toAor(),c,b))}function c(){e.notify(603)}P("receiveRefer()");var e,f=this;return void 0===typeof a.refer_to?(P("no Refer-To header field present in REFER"),void a.reply(400)):a.refer_to.uri.scheme!==U.SIP?(P("Refer-To header field points to a non-SIP URI scheme"),void a.reply(416)):(a.reply(202),e=new ca(this,a.cseq),void this.emit("refer",{request:a,accept:function(a,c){b.call(f,a,c)},reject:function(){c.call(f)}}))}function m(a){P("receiveNotify()"),void 0===typeof a.event?a.reply(400):"refer"!==a.event.event?a.reply(489):this.referSubscriber?(this.referSubscriber.receiveNotify(a),a.reply(200)):a.reply(481,"Subscription does not exist")}function n(a){function b(b){var c;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(c=new d(this.ua),c.on("confirmed",function(){e.terminate()}),void c.init_incoming(a,b))}function c(){P("Replaced INVITE rejected by the user"),a.reply(486)}P("receiveReplaces()");var e=this;this.emit("replaces",{request:a,accept:function(a){b.call(e,a)},reject:function(){c.call(e)}})}function o(a,b,c){function d(a){i.status!==M.STATUS_TERMINATED&&(i.localMediaStream=a,a&&i.connection.addStream(a),i.emit("peerconnection",{peerconnection:i.connection}),C.call(i,i.request),h.call(i,"offer",f,g,b))}function e(){i.status!==M.STATUS_TERMINATED&&H.call(i,"local",null,U.causes.USER_DENIED_MEDIA_ACCESS)}function f(a){i.isCanceled||i.status===M.STATUS_TERMINATED||(a=a.replace(/\s+RTP\/SAVPF\s+/gm," UDP/TLS/RTP/SAVPF "),i.request.body=a,i.last_sdp=a,i.status=M.STATUS_INVITE_SENT,i.emit("sending",{request:i.request}),j.send())}function g(){i.status!==M.STATUS_TERMINATED&&H.call(i,"system",null,U.causes.WEBRTC_ERROR)}var i=this,j=new _(i,this.ua);this.receiveResponse=function(a){p.call(i,a)},c?setTimeout(function(){d(c)}):a.audio||a.video?(this.localMediaStreamLocallyGenerated=!0,S.getUserMedia(a,d,e)):d(null)}function p(a){P("receiveInviteResponse()");var b,c,d=this;if(this.dialog&&a.status_code>=200&&a.status_code<=299)return this.dialog.id.call_id===a.call_id&&this.dialog.id.local_tag===a.from_tag&&this.dialog.id.remote_tag===a.to_tag?void t.call(this,U.ACK):(c=new $(this,a,"UAC"),void 0!==c.error?void P(c.error):(c.sendRequest({owner:{status:M.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},U.ACK),void c.sendRequest({owner:{status:M.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},U.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(a.status_code>=100&&a.status_code<200?this.request.cancel(this.cancelReason):a.status_code>=200&&a.status_code<299&&s.call(this,a));if(this.status===M.STATUS_INVITE_SENT||this.status===M.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(a.status_code):this.status=M.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(a.status_code):if(!a.to_tag){P("1xx response received without to tag");break}if(a.hasHeader("contact")&&!i.call(this,a,"UAC",!0))break;if(this.status=M.STATUS_1XX_RECEIVED,D.call(this,"remote",a),!a.body)break;this.connection.setRemoteDescription(new S.RTCSessionDescription({type:"pranswer",sdp:a.body}),null,null);break;case/^2[0-9]{2}$/.test(a.status_code):if(this.status=M.STATUS_CONFIRMED,!a.body){s.call(this,a,400,U.causes.MISSING_SDP),H.call(this,"remote",a,U.causes.BAD_MEDIA_DESCRIPTION);break}if(!i.call(this,a,"UAC"))break;a.body=a.body.replace(/\s+UDP\/TLS\/RTP\/SAVPF\s+/," RTP/SAVPF "),a.body=a.body.replace(/:SHA-256 /,":sha-256 "),this.connection.setRemoteDescription(new S.RTCSessionDescription({type:"answer",sdp:a.body}),function(){x.call(d,a),E.call(d,"remote",a),t.call(d,U.ACK),F.call(d,"local",null)},function(){s.call(d,a,488,"Not Acceptable Here"),H.call(d,"remote",a,U.causes.BAD_MEDIA_DESCRIPTION)});break;default:b=X.sipErrorCause(a.status_code),H.call(this,"remote",a,b)}}function q(a){function b(a){if(d.status!==M.STATUS_TERMINATED&&(t.call(d,U.ACK),!i))return x.call(d,a),a.body?"application/sdp"!==a.getHeader("Content-Type")?void c():void d.connection.setRemoteDescription(new S.RTCSessionDescription({type:"answer",sdp:a.body}),function(){f.succeeded&&f.succeeded(a)},function(){c()}):void c()}function c(a){f.failed&&f.failed(a)}P("sendReinvite()"),a=a||{};var d=this,e=a.extraHeaders||[],f=a.eventHandlers||{},g=a.rtcOfferConstraints||this.rtcOfferConstraints||null,i=!1;e.push("Contact: "+this.contact),e.push("Content-Type: application/sdp"),this.sessionTimers.running&&e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),h.call(this,"offer",function(a){a=u.call(d,a);var f=new aa(d,U.INVITE);f.send({extraHeaders:e,body:a,eventHandlers:{onSuccessResponse:function(a){b(a),i=!0},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){c()},g)}function r(a){function b(a){if(d.status!==M.STATUS_TERMINATED&&!j)if(x.call(d,a),i){if(!a.body)return void c();if("application/sdp"!==a.getHeader("Content-Type"))return void c();d.connection.setRemoteDescription(new S.RTCSessionDescription({type:"answer",sdp:a.body}),function(){f.succeeded&&f.succeeded(a)},function(){c()})}else f.succeeded&&f.succeeded(a)}function c(a){f.failed&&f.failed(a)}P("sendUpdate()"),a=a||{};var d=this,e=a.extraHeaders||[],f=a.eventHandlers||{},g=a.rtcOfferConstraints||this.rtcOfferConstraints||null,i=a.sdpOffer||!1,j=!1;if(e.push("Contact: "+this.contact),this.sessionTimers.running&&e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),i)e.push("Content-Type: application/sdp"),h.call(this,"offer",function(a){a=u.call(d,a);var f=new aa(d,U.UPDATE);f.send({extraHeaders:e,body:a,eventHandlers:{onSuccessResponse:function(a){b(a),j=!0},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){c()},g);else{var k=new aa(d,U.UPDATE);k.send({extraHeaders:e,eventHandlers:{onSuccessResponse:function(a){b(a)},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})}}function s(a,b,c){P("acceptAndTerminate()");var d=[];b&&(c=c||U.REASON_PHRASE[b]||"",d.push("Reason: SIP ;cause="+b+'; text="'+c+'"')),(this.dialog||i.call(this,a,"UAC"))&&(t.call(this,U.ACK),t.call(this,U.BYE,{extraHeaders:d})),this.status=M.STATUS_TERMINATED}function t(a,b){P("sendRequest()");var c=new aa(this,a);c.send(b)}function u(a){var b,c,d;if(!this.localHold&&!this.remoteHold)return a;if(a=T.parse(a),this.localHold&&!this.remoteHold)for(P("mangleOffer() | me on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],ea.indexOf(d.type)!==-1&&(d.direction?"sendrecv"===d.direction?d.direction="sendonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="sendonly");else if(this.localHold&&this.remoteHold)for(P("mangleOffer() | both on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],ea.indexOf(d.type)!==-1&&(d.direction="inactive");else if(this.remoteHold)for(P("mangleOffer() | remote on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],ea.indexOf(d.type)!==-1&&(d.direction?"sendrecv"===d.direction?d.direction="recvonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="recvonly");return T.write(a)}function v(){var a=!0,b=!0;(this.localHold||this.remoteHold)&&(a=!1,b=!1),this.audioMuted&&(a=!1),this.videoMuted&&(b=!1),z.call(this,!a),A.call(this,!b)}function w(a,b){if(this.sessionTimers.enabled){var c;a.session_expires&&a.session_expires>=U.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,c=a.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,c="uas"),b.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+c),this.sessionTimers.refresher="uas"===c,y.call(this)}}function x(a){if(this.sessionTimers.enabled){var b;a.session_expires&&a.session_expires>=U.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,b=a.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,b="uac"),this.sessionTimers.refresher="uac"===b,y.call(this)}}function y(){var a=this,b=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){a.status!==M.STATUS_TERMINATED&&(P("runSessionTimer() | sending session refresh request"),r.call(a,{eventHandlers:{succeeded:function(b){x.call(a,b)}}}))},500*b):this.sessionTimers.timer=setTimeout(function(){a.status!==M.STATUS_TERMINATED&&(Q("runSessionTimer() | timer expired, terminating the session"),a.terminate({cause:U.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*b)}function z(a){var b,c,d,e,f,g=this.connection.getLocalStreams();for(d=g.length,b=0;b<d;b++)for(f=g[b].getAudioTracks(),e=f.length,c=0;c<e;c++)f[c].enabled=!a}function A(a){var b,c,d,e,f,g=this.connection.getLocalStreams();for(d=g.length,b=0;b<d;b++)for(f=g[b].getVideoTracks(),e=f.length,c=0;c<e;c++)f[c].enabled=!a}function B(a,b){P("newRTCSession"),this.ua.newRTCSession({originator:a,session:this,request:b})}function C(a){P("session connecting"),this.emit("connecting",{request:a})}function D(a,b){P("session progress"),this.emit("progress",{originator:a,response:b||null})}function E(a,b){P("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:a,response:b||null})}function F(a,b){P("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:a,ack:b||null})}function G(a,b,c){P("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:a,message:b||null,cause:c})}function H(a,b,c){P("session failed"),this.close(),this.emit("failed",{originator:a,message:b||null,cause:c})}function I(a){P("session onhold"),v.call(this),this.emit("hold",{originator:a})}function J(a){P("session onunhold"),v.call(this),this.emit("unhold",{originator:a})}function K(a){P("session onmute"),v.call(this),this.emit("muted",{audio:a.audio,video:a.video})}function L(a){P("session onunmute"),v.call(this),this.emit("unmuted",{audio:a.audio,video:a.video})}b.exports=d;var M={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};d.C=M;var N=a("util"),O=a("events"),P=a("debug")("JsSIP:RTCSession"),Q=a("debug")("JsSIP:ERROR:RTCSession"),R=a("./VoxboneLogger.js");P.log=R.loginfo.bind(console),Q.log=R.logerror.bind(console);var S=a("rtcninja"),T=a("sdp-transform"),U=a("./Constants"),V=a("./Exceptions"),W=a("./Transactions"),X=a("./Utils"),Y=a("./Timers"),Z=a("./SIPMessage"),$=a("./Dialog"),_=a("./RequestSender"),aa=a("./RTCSession/Request"),ba=a("./RTCSession/DTMF"),ca=a("./RTCSession/ReferNotifier"),da=a("./RTCSession/ReferSubscriber"),ea=["audio","video"];N.inherits(d,O.EventEmitter),d.prototype.isInProgress=function(){switch(this.status){case M.STATUS_NULL:case M.STATUS_INVITE_SENT:case M.STATUS_1XX_RECEIVED:case M.STATUS_INVITE_RECEIVED:case M.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},d.prototype.isEstablished=function(){switch(this.status){case M.STATUS_ANSWERED:case M.STATUS_WAITING_FOR_ACK:case M.STATUS_CONFIRMED:return!0;default:return!1}},d.prototype.isEnded=function(){switch(this.status){case M.STATUS_CANCELED:case M.STATUS_TERMINATED:return!0;default:return!1}},d.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},d.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},d.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?this.dialog.uac_pending_reply!==!0&&this.dialog.uas_pending_reply!==!0||(P("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(P("isReadyToReOffer() | session not established yet"),!1):(P("isReadyToReOffer() | internal WebRTC status not ready"),!1)},d.prototype.connect=function(a,b,c){P("connect()"),b=b||{};var d,e,f=a,h=b.eventHandlers||{},i=b.extraHeaders&&b.extraHeaders.slice()||[],j=b.mediaConstraints||{audio:!0,video:!0},k=b.mediaStream||null,l=b.pcConfig||{iceServers:[]},m=b.rtcConstraints||null,n=b.rtcOfferConstraints||null;if(this.rtcOfferConstraints=n,this.rtcAnswerConstraints=b.rtcAnswerConstraints||null,this.sessionTimers.enabled&&X.isDecimal(b.sessionTimersExpires)&&(b.sessionTimersExpires>=U.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=b.sessionTimersExpires:this.sessionTimers.defaultExpires=U.SESSION_EXPIRES),
this.data=b.data||this.data,void 0===a)throw new TypeError("Not enough arguments");if(!S.hasWebRTC())throw new V.NotSupportedError("WebRTC not supported");if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+f);if(this.status!==M.STATUS_NULL)throw new V.InvalidStateError(this.status);for(d in h)this.on(d,h[d]);this.from_tag=X.newTag(),this.anonymous=b.anonymous||!1,this.isCanceled=!1,e={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(e.from_display_name="Anonymous",e.from_uri="sip:anonymous@anonymous.invalid",i.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),i.push("Privacy: id")),i.push("Contact: "+this.contact),i.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&i.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new Z.OutgoingRequest(U.INVITE,a,this.ua,e,i),this.id=this.request.call_id+this.from_tag,g.call(this,l,m),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,c?c(this):B.call(this,"local",this.request),o.call(this,j,n,k)},d.prototype.init_incoming=function(a,b){P("init_incoming()");var c,d=this,e=a.getHeader("Content-Type");return a.body&&"application/sdp"!==e?void a.reply(415):(this.status=M.STATUS_INVITE_RECEIVED,this.from_tag=a.from_tag,this.id=a.call_id+this.from_tag,this.request=a,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,a.hasHeader("expires")&&(c=1e3*a.getHeader("expires")),a.to_tag=X.newTag(),i.call(this,a,"UAS",!0)?(a.body?this.late_sdp=!1:this.late_sdp=!0,this.status=M.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){a.reply(408),H.call(d,"local",null,U.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),c&&(this.timers.expiresTimer=setTimeout(function(){d.status===M.STATUS_WAITING_FOR_ANSWER&&(a.reply(487),H.call(d,"system",null,U.causes.EXPIRES))},c)),this.direction="incoming",this.local_identity=a.to,this.remote_identity=a.from,b?b(this):B.call(this,"remote",a),void(this.status!==M.STATUS_TERMINATED&&(a.reply(180,null,["Contact: "+d.contact]),D.call(d,"local",null)))):void a.reply(500,"Missing Contact header field"))},d.prototype.answer=function(a){function b(a){t.status!==M.STATUS_TERMINATED&&(t.localMediaStream=a,a&&t.connection.addStream(a),t.late_sdp?d():t.connection.setRemoteDescription(new S.RTCSessionDescription({type:"offer",sdp:u.body}),d,function(){u.reply(488),H.call(t,"system",null,U.causes.WEBRTC_ERROR)}))}function c(){t.status!==M.STATUS_TERMINATED&&(u.reply(480),H.call(t,"local",null,U.causes.USER_DENIED_MEDIA_ACCESS))}function d(){C.call(t,u),t.late_sdp?h.call(t,"offer",j,k,t.rtcOfferConstraints):h.call(t,"answer",j,k,B)}function j(a){function b(){t.status=M.STATUS_WAITING_FOR_ACK,e.call(t,u,a),f.call(t),E.call(t,"local")}function c(){H.call(t,"system",null,U.causes.CONNECTION_ERROR)}t.status!==M.STATUS_TERMINATED&&(w.call(t,u,v),u.reply(200,null,v,a,b,c))}function k(){t.status!==M.STATUS_TERMINATED&&(u.reply(500),H.call(t,"system",null,U.causes.WEBRTC_ERROR))}P("answer()"),a=a||{};var l,m,n,o,p=!1,q=!1,r=!1,s=!1,t=this,u=this.request,v=a.extraHeaders&&a.extraHeaders.slice()||[],x=a.mediaConstraints||{},y=a.mediaStream||null,z=a.pcConfig||{iceServers:[]},A=a.rtcConstraints||null,B=a.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=B,this.rtcOfferConstraints=a.rtcOfferConstraints||null,this.sessionTimers.enabled&&X.isDecimal(a.sessionTimersExpires)&&(a.sessionTimersExpires>=U.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=a.sessionTimersExpires:this.sessionTimers.defaultExpires=U.SESSION_EXPIRES),this.data=a.data||this.data,"incoming"!==this.direction)throw new V.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==M.STATUS_WAITING_FOR_ANSWER)throw new V.InvalidStateError(this.status);if(this.status=M.STATUS_ANSWERED,!i.call(this,u,"UAS"))return void u.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),v.unshift("Contact: "+t.contact),n=u.parseSDP(),Array.isArray(n.media)||(n.media=[n.media]),l=n.media.length;l--;){var D=n.media[l];"audio"===D.type&&(p=!0,D.direction&&"sendrecv"!==D.direction||(r=!0)),"video"===D.type&&(q=!0,D.direction&&"sendrecv"!==D.direction||(s=!0))}if(y&&x.audio===!1)for(o=y.getAudioTracks(),m=o.length,l=0;l<m;l++)y.removeTrack(o[l]);if(y&&x.video===!1)for(o=y.getVideoTracks(),m=o.length,l=0;l<m;l++)y.removeTrack(o[l]);y||void 0!==x.audio||(x.audio=r),y||void 0!==x.video||(x.video=s),y||p||(x.audio=!1),y||q||(x.video=!1),g.call(this,z,A),y?b(y):x.audio||x.video?(t.localMediaStreamLocallyGenerated=!0,S.getUserMedia(x,b,c)):b(null)},d.prototype.terminate=function(a){P("terminate()"),a=a||{};var b,c,d=a.cause||U.causes.BYE,e=a.status_code,f=a.reason_phrase,g=a.extraHeaders&&a.extraHeaders.slice()||[],h=a.body,i=this;if(this.status===M.STATUS_TERMINATED)throw new V.InvalidStateError(this.status);switch(this.status){case M.STATUS_NULL:case M.STATUS_INVITE_SENT:case M.STATUS_1XX_RECEIVED:if(P("canceling sesssion"),e&&(e<200||e>=700))throw new TypeError("Invalid status_code: "+e);e&&(f=f||U.REASON_PHRASE[e]||"",b="SIP ;cause="+e+' ;text="'+f+'"'),this.status===M.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=b):this.status===M.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=b):this.status===M.STATUS_1XX_RECEIVED&&this.request.cancel(b),this.status=M.STATUS_CANCELED,H.call(this,"local",null,U.causes.CANCELED);break;case M.STATUS_WAITING_FOR_ANSWER:case M.STATUS_ANSWERED:if(P("rejecting session"),e=e||480,e<300||e>=700)throw new TypeError("Invalid status_code: "+e);this.request.reply(e,f,g,h),H.call(this,"local",null,U.causes.REJECTED);break;case M.STATUS_WAITING_FOR_ACK:case M.STATUS_CONFIRMED:if(P("terminating session"),f=a.reason_phrase||U.REASON_PHRASE[e]||"",e&&(e<200||e>=700))throw new TypeError("Invalid status_code: "+e);e&&g.push("Reason: SIP ;cause="+e+'; text="'+f+'"'),this.status===M.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==W.C.STATUS_TERMINATED?(c=this.dialog,this.receiveRequest=function(a){a.method===U.ACK&&(t.call(this,U.BYE,{extraHeaders:g,body:h}),c.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===W.C.STATUS_TERMINATED&&(t.call(i,U.BYE,{extraHeaders:g,body:h}),c.terminate())}),G.call(this,"local",null,d),this.dialog=c,this.ua.dialogs[c.id.toString()]=c):(t.call(this,U.BYE,{extraHeaders:g,body:h}),G.call(this,"local",null,d))}},d.prototype.close=function(){P("close()");var a;if(this.status!==M.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(b){Q("close() | error closing the RTCPeerConnection: %o",b)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(P("close() | closing local MediaStream"),S.closeMediaStream(this.localMediaStream));for(a in this.timers)clearTimeout(this.timers[a]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a];this.status=M.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},d.prototype.sendDTMF=function(a,b){function c(){var a,h;if(g.status===M.STATUS_TERMINATED||!g.tones||f>=g.tones.length)return void(g.tones=null);if(a=g.tones[f],f+=1,","===a)h=2e3;else{var i=new ba(g);b.eventHandlers={failed:function(){g.tones=null}},i.send(a,b),h=d+e}setTimeout(c,h)}P("sendDTMF() | tones: %s",a);var d,e,f=0,g=this;if(b=b||{},d=b.duration||null,e=b.interToneGap||null,void 0===a)throw new TypeError("Not enough arguments");if(this.status!==M.STATUS_CONFIRMED&&this.status!==M.STATUS_WAITING_FOR_ACK)throw new V.InvalidStateError(this.status);if("number"==typeof a&&(a=a.toString()),!a||"string"!=typeof a||!a.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+a);if(d&&!X.isDecimal(d))throw new TypeError("Invalid tone duration: "+d);if(d?d<ba.C.MIN_DURATION?(P('"duration" value is lower than the minimum allowed, setting it to '+ba.C.MIN_DURATION+" milliseconds"),d=ba.C.MIN_DURATION):d>ba.C.MAX_DURATION?(P('"duration" value is greater than the maximum allowed, setting it to '+ba.C.MAX_DURATION+" milliseconds"),d=ba.C.MAX_DURATION):d=Math.abs(d):d=ba.C.DEFAULT_DURATION,b.duration=d,e&&!X.isDecimal(e))throw new TypeError("Invalid interToneGap: "+e);return e?e<ba.C.MIN_INTER_TONE_GAP?(P('"interToneGap" value is lower than the minimum allowed, setting it to '+ba.C.MIN_INTER_TONE_GAP+" milliseconds"),e=ba.C.MIN_INTER_TONE_GAP):e=Math.abs(e):e=ba.C.DEFAULT_INTER_TONE_GAP,this.tones?void(this.tones+=a):(this.tones=a,void c())},d.prototype.mute=function(a){P("mute()"),a=a||{audio:!0,video:!1};var b=!1,c=!1;this.audioMuted===!1&&a.audio&&(b=!0,this.audioMuted=!0,z.call(this,!0)),this.videoMuted===!1&&a.video&&(c=!0,this.videoMuted=!0,A.call(this,!0)),b!==!0&&c!==!0||K.call(this,{audio:b,video:c})},d.prototype.unmute=function(a){P("unmute()"),a=a||{audio:!0,video:!0};var b=!1,c=!1;this.audioMuted===!0&&a.audio&&(b=!0,this.audioMuted=!1,this.localHold===!1&&z.call(this,!1)),this.videoMuted===!0&&a.video&&(c=!0,this.videoMuted=!1,this.localHold===!1&&A.call(this,!1)),b!==!0&&c!==!0||L.call(this,{audio:b,video:c})},d.prototype.hold=function(a,b){P("hold()"),a=a||{};var c,d=this;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(this.localHold!==!0&&(!!this.isReadyToReOffer()&&(this.localHold=!0,I.call(this,"local"),c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:U.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},a.useUpdate?r.call(this,{sdpOffer:!0,eventHandlers:c,extraHeaders:a.extraHeaders}):q.call(this,{eventHandlers:c,extraHeaders:a.extraHeaders}),!0)))},d.prototype.unhold=function(a,b){P("unhold()"),a=a||{};var c,d=this;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(this.localHold!==!1&&(!!this.isReadyToReOffer()&&(this.localHold=!1,J.call(this,"local"),c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:U.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},a.useUpdate?r.call(this,{sdpOffer:!0,eventHandlers:c,extraHeaders:a.extraHeaders}):q.call(this,{eventHandlers:c,extraHeaders:a.extraHeaders}),!0)))},d.prototype.renegotiate=function(a,b){P("renegotiate()"),a=a||{};var c,d=this,e=a.rtcOfferConstraints||null;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:U.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},v.call(this),a.useUpdate?r.call(this,{sdpOffer:!0,eventHandlers:c,rtcOfferConstraints:e,extraHeaders:a.extraHeaders}):q.call(this,{eventHandlers:c,rtcOfferConstraints:e,extraHeaders:a.extraHeaders}),!0))},d.prototype.refer=function(a,b){P("refer()");var c=a;if(this.status!==M.STATUS_WAITING_FOR_ACK&&this.status!==M.STATUS_CONFIRMED)return!1;if(this.referSubscriber)return!1;if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+c);this.referSubscriber=new da(this),this.referSubscriber.sendRefer(a,b)},d.prototype.receiveRequest=function(a){P("receiveRequest()");var b,c=this;if(a.method===U.CANCEL)this.status!==M.STATUS_WAITING_FOR_ANSWER&&this.status!==M.STATUS_ANSWERED||(this.status=M.STATUS_CANCELED,this.request.reply(487),H.call(this,"remote",a,U.causes.CANCELED));else switch(a.method){case U.ACK:if(this.status===M.STATUS_WAITING_FOR_ACK){if(clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!a.body){G.call(this,"remote",a,U.causes.MISSING_SDP);break}this.connection.setRemoteDescription(new S.RTCSessionDescription({type:"answer",sdp:a.body}),function(){c.status=M.STATUS_CONFIRMED},function(){G.call(c,"remote",a,U.causes.BAD_MEDIA_DESCRIPTION)})}else this.status=M.STATUS_CONFIRMED;this.status!==M.STATUS_CONFIRMED||this.is_confirmed||F.call(this,"remote",a)}break;case U.BYE:this.status===M.STATUS_CONFIRMED?(a.reply(200),G.call(this,"remote",a,U.causes.BYE)):this.status===M.STATUS_INVITE_RECEIVED?(a.reply(200),this.request.reply(487,"BYE Received"),G.call(this,"remote",a,U.causes.BYE)):a.reply(403,"Wrong Status");break;case U.INVITE:this.status===M.STATUS_CONFIRMED?a.hasHeader("replaces")?n.call(this,a):j.call(this,a):a.reply(403,"Wrong Status");break;case U.INFO:this.status===M.STATUS_CONFIRMED||this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_INVITE_RECEIVED?(b=a.getHeader("content-type"),b&&b.match(/^application\/dtmf-relay/i)?new ba(this).init_incoming(a):a.reply(415)):a.reply(403,"Wrong Status");break;case U.UPDATE:this.status===M.STATUS_CONFIRMED?k.call(this,a):a.reply(403,"Wrong Status");break;case U.REFER:this.status===M.STATUS_CONFIRMED?l.call(this,a):a.reply(403,"Wrong Status");break;case U.NOTIFY:this.status===M.STATUS_CONFIRMED?m.call(this,a):a.reply(403,"Wrong Status");break;default:a.reply(501)}},d.prototype.onTransportError=function(){Q("onTransportError()"),this.status!==M.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:U.causes.CONNECTION_ERROR,cause:U.causes.CONNECTION_ERROR})},d.prototype.onRequestTimeout=function(){P("onRequestTimeout"),this.status!==M.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:U.causes.REQUEST_TIMEOUT,cause:U.causes.REQUEST_TIMEOUT})},d.prototype.onDialogError=function(){Q("onDialogError()"),this.status!==M.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:U.causes.DIALOG_ERROR,cause:U.causes.DIALOG_ERROR})},d.prototype.newDTMF=function(a){P("newDTMF()"),this.emit("newDTMF",a)},d.prototype.resetLocalMedia=function(){P("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,v.call(this)}},{"./Constants":1,"./Dialog":2,"./Exceptions":5,"./RTCSession/DTMF":12,"./RTCSession/ReferNotifier":13,"./RTCSession/ReferSubscriber":14,"./RTCSession/Request":15,"./RequestSender":17,"./SIPMessage":18,"./Timers":19,"./Transactions":20,"./Utils":24,"./VoxboneLogger.js":25,debug:32,events:27,rtcninja:37,"sdp-transform":43,util:31}],12:[function(a,b,c){function d(a){this.owner=a,this.direction=null,this.tone=null,this.duration=null}b.exports=d;var e={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};d.C=e;var f=a("debug")("JsSIP:RTCSession:DTMF"),g=a("debug")("JsSIP:ERROR:RTCSession:DTMF");g.log=console.warn.bind(console);var h=a("../Constants"),i=a("../Exceptions"),j=a("../RTCSession");d.prototype.send=function(a,b){var c,d;if(void 0===a)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==j.C.STATUS_CONFIRMED&&this.owner.status!==j.C.STATUS_WAITING_FOR_ACK)throw new i.InvalidStateError(this.owner.status);if(b=b||{},c=b.extraHeaders?b.extraHeaders.slice():[],this.eventHandlers=b.eventHandlers||{},"string"==typeof a)a=a.toUpperCase();else{if("number"!=typeof a)throw new TypeError("Invalid tone: "+a);a=a.toString()}if(!a.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+a);this.tone=a,this.duration=b.duration,c.push("Content-Type: application/dtmf-relay"),d="Signal="+this.tone+"\r\n",d+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,h.INFO,{extraHeaders:c,body:d})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):f("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(a);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(a)}},d.prototype.onRequestTimeout=function(){g("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},d.prototype.onTransportError=function(){g("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},d.prototype.onDialogError=function(){g("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},d.prototype.init_incoming=function(a){var b,c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,d=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=a,a.reply(200),a.body&&(b=a.body.split("\n"),b.length>=1&&c.test(b[0])&&(this.tone=b[0].replace(c,"$2")),b.length>=2&&d.test(b[1])&&(this.duration=parseInt(b[1].replace(d,"$2"),10))),this.duration||(this.duration=e.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:a}):f("invalid INFO DTMF received, discarded")}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:32}],13:[function(a,b,c){function d(a,b,c){this.session=a,this.id=b,this.expires=c||e.expires,this.active=!0,this.notify(100)}b.exports=d;var e={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},f=a("debug")("JsSIP:RTCSession:ReferNotifier"),g=a("../Constants"),h=a("./Request");d.prototype.notify=function(a,b){f("notify()");var c,d=this;if(this.active!==!1){b=b||g.REASON_PHRASE[a]||"",c=a>=200?"terminated;reason=noresource":"active;expires="+this.expires;var i=new h(this.session,g.NOTIFY);i.send({extraHeaders:["Event: "+e.event_type+";id="+d.id,"Subscription-State: "+c,"Content-Type: "+e.body_type],body:"SIP/2.0 "+a+" "+b,eventHandlers:{onErrorResponse:function(){d.active=!1}}})}}},{"../Constants":1,"./Request":15,debug:32}],14:[function(a,b,c){function d(a){this.session=a,this.timer=null,h.EventEmitter.call(this)}function e(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}b.exports=d;var f={expires:120},g=a("util"),h=a("events"),i=a("debug")("JsSIP:RTCSession:ReferSubscriber"),j=a("../Constants"),k=a("../Grammar"),l=a("./Request");g.inherits(d,h.EventEmitter),d.prototype.sendRefer=function(a,b){i("sendRefer()");var c,d,g,h=null,k=this;b=b||{},c=b.extraHeaders?b.extraHeaders.slice():[],d=b.eventHandlers||{};for(var m in d)this.on(m,d[m]);b.replaces&&(h=b.replaces.request.call_id,h+=";to-tag="+b.replaces.to_tag,h+=";from-tag="+b.replaces.from_tag,h=encodeURIComponent(h)),g="Refer-To: <"+a+(h?"?Replaces="+h:"")+">",c.push(g);var n=new l(this.session,j.REFER);this.timer=setTimeout(function(){e.call(k)},1e3*f.expires),n.send({extraHeaders:c,eventHandlers:{onSuccessResponse:function(a){k.emit("requestSucceeded",{response:a})},onErrorResponse:function(a){k.emit("requestFailed",{response:a,cause:j.causes.REJECTED})},onTransportError:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.CONNECTION_ERROR})},onRequestTimeout:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.REQUEST_TIMEOUT})},onDialogError:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.DIALOG_ERROR})}}})},d.prototype.receiveNotify=function(a){i("receiveNotify()");var b;if(a.body){if(b=k.parse(a.body,"Status_Line"),b===-1)return void i('receiveNotify() | error parsing NOTIFY body: "'+a.body+'"');switch(!0){case/^100$/.test(b.status_code):this.emit("trying",{request:a,satus_line:b});break;case/^1[0-9]{2}$/.test(b.status_code):this.emit("progress",{request:a,satus_line:b});break;case/^2[0-9]{2}$/.test(b.status_code):e.call(this),this.emit("accepted",{request:a,satus_line:b});break;default:e.call(this),this.emit("failed",{request:a,satus_line:b})}}}},{"../Constants":1,"../Grammar":6,"./Request":15,debug:32,events:27,util:31}],15:[function(a,b,c){function d(a,b){if(e("new | %s",b),this.session=a,this.method=b,this.session.status!==i.C.STATUS_1XX_RECEIVED&&this.session.status!==i.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==i.C.STATUS_WAITING_FOR_ACK&&this.session.status!==i.C.STATUS_CONFIRMED&&this.session.status!==i.C.STATUS_TERMINATED)throw new h.InvalidStateError(this.session.status);if(this.session.status===i.C.STATUS_TERMINATED&&b!==g.BYE)throw new h.InvalidStateError(this.session.status)}b.exports=d;var e=a("debug")("JsSIP:RTCSession:Request"),f=a("debug")("JsSIP:ERROR:RTCSession:Request");f.log=console.warn.bind(console);var g=a("../Constants"),h=a("../Exceptions"),i=a("../RTCSession");d.prototype.send=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body||null;this.eventHandlers=a.eventHandlers||{},this.session.dialog.sendRequest(this,this.method,{extraHeaders:b,body:c})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):e("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(a);break;case/^2[0-9]{2}$/.test(a.status_code):e("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(a);break;default:e("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(a)}},d.prototype.onRequestTimeout=function(){f("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},d.prototype.onTransportError=function(){f("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},d.prototype.onDialogError=function(){f("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:32}],16:[function(a,b,c){function d(a,b){var c=1;this.ua=a,this.transport=b,this.registrar=a.configuration.registrar_server,this.expires=a.configuration.register_expires,this.call_id=g.createRandomToken(22),this.cseq=0,this.to_uri=a.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",c&&(this.contact+=";reg-id="+c,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}b.exports=d;var e=a("debug")("JsSIP:Registrator"),f=a("./VoxboneLogger.js");e.log=f.loginfo.bind(console);var g=a("./Utils"),h=a("./Constants"),i=a("./SIPMessage"),j=a("./RequestSender");d.prototype={setExtraHeaders:function(a){Array.isArray(a)||(a=[]),this.extraHeaders=a.slice()},setExtraContactParams:function(a){a instanceof Object||(a={}),this.extraContactParams="";for(var b in a){var c=a[b];this.extraContactParams+=";"+b,c&&(this.extraContactParams+="="+c)}},register:function(){var a,b,c,d=this;c=this.extraHeaders.slice(),c.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),c.push("Expires: "+this.expires),this.request=new i.OutgoingRequest(h.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},c),a=new j(this,this.ua),this.receiveResponse=function(a){var c,f,i=a.getHeaders("contact").length;if(a.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):if(a.hasHeader("expires")&&(f=a.getHeader("expires")),!i){e("no Contact header in response to REGISTER, response ignored");break}for(;i--;){if(c=a.parseHeader("contact",i),c.uri.user===this.ua.contact.uri.user){f=c.getParam("expires");break}c=null}if(!c){e("no Contact header pointing to us, response ignored");break}f||(f=this.expires),this.registrationTimer=setTimeout(function(){d.registrationTimer=null,d.register()},1e3*f-3e3),c.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=c.getParam("temp-gruu").replace(/"/g,"")),c.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=c.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:a}));break;case/^423$/.test(a.status_code):a.hasHeader("min-expires")?(this.expires=a.getHeader("min-expires"),this.register()):(e("423 response received for REGISTER without Min-Expires"),this.registrationFailure(a,h.causes.SIP_FAILURE_CODE));break;default:b=g.sipErrorCause(a.status_code),this.registrationFailure(a,b)}},this.onRequestTimeout=function(){this.registrationFailure(null,h.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,h.causes.CONNECTION_ERROR)},a.send()},unregister:function(a){var b;if(!this.registered)return void e("already unregistered");a=a||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),b=this.extraHeaders.slice(),a.all?(b.push("Contact: *"+this.extraContactParams),b.push("Expires: 0"),this.request=new i.OutgoingRequest(h.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b)):(b.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),b.push("Expires: 0"),this.request=new i.OutgoingRequest(h.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b));var c=new j(this,this.ua);this.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.unregistered(a);break;default:b=g.sipErrorCause(a.status_code),this.unregistered(a,b)}},this.onRequestTimeout=function(){this.unregistered(null,h.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,h.causes.CONNECTION_ERROR)},c.send()},registrationFailure:function(a,b){this.ua.registrationFailed({response:a||null,cause:b}),this.registered&&(this.registered=!1,this.ua.unregistered({response:a||null,cause:b}))},unregistered:function(a,b){this.registered=!1,this.ua.unregistered({response:a||null,cause:b||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":1,"./RequestSender":17,"./SIPMessage":18,"./Utils":24,"./VoxboneLogger.js":25,debug:32}],17:[function(a,b,c){function d(a,b){this.ua=b,this.applicant=a,this.method=a.request.method,this.request=a.request,this.credentials=null,this.challenged=!1,this.staled=!1,b.status!==h.C.STATUS_USER_CLOSED||this.method===g.BYE&&this.method===g.ACK||this.onTransportError()}b.exports=d;var e=a("debug")("JsSIP:RequestSender"),f=a("./VoxboneLogger.js");e.log=f.loginfo.bind(console);var g=a("./Constants"),h=a("./UA"),i=a("./DigestAuthentication"),j=a("./Transactions");d.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new j.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new j.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new j.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b,c,d,f=a.status_code;if(401!==f&&407!==f||null===this.ua.configuration.password)this.applicant.receiveResponse(a);else{if(401===a.status_code?(c=a.parseHeader("www-authenticate"),d="authorization"):(c=a.parseHeader("proxy-authenticate"),d="proxy-authorization"),!c)return e(a.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(a);if(!this.challenged||!this.staled&&c.stale===!0){if(this.credentials||(this.credentials=new i(this.ua)),!this.credentials.authenticate(this.request,c))return void this.applicant.receiveResponse(a);this.challenged=!0,c.stale&&(this.staled=!0),a.method===g.REGISTER?b=this.applicant.cseq+=1:this.request.dialog?b=this.request.dialog.local_seqnum+=1:(b=this.request.cseq+1,this.request.cseq=b),this.request.setHeader("cseq",b+" "+this.method),this.request.setHeader(d,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(a)}}}},{"./Constants":1,"./DigestAuthentication":4,"./Transactions":20,"./UA":22,"./VoxboneLogger.js":25,debug:32}],18:[function(a,b,c){function d(a,b,c,d,e,f){var g,h,i,j;return d=d||{},a&&b&&c?(this.ua=c,this.headers={},this.method=a,this.ruri=b,this.body=f,this.extraHeaders=e&&e.slice()||[],d.route_set?this.setHeader("route",d.route_set):c.configuration.use_preloaded_route&&this.setHeader("route",c.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",k.MAX_FORWARDS),g=d.to_display_name||0===d.to_display_name?'"'+d.to_display_name+'" ':"",g+="<"+(d.to_uri||b)+">",g+=d.to_tag?";tag="+d.to_tag:"",this.to=new m.parse(g),this.setHeader("to",g),h=d.from_display_name||0===d.from_display_name?'"'+d.from_display_name+'" ':c.configuration.display_name?'"'+c.configuration.display_name+'" ':"",h+="<"+(d.from_uri||c.configuration.uri)+">;tag=",h+=d.from_tag||l.newTag(),this.from=new m.parse(h),this.setHeader("from",h),i=d.call_id||c.configuration.jssip_id+l.createRandomToken(15),this.call_id=i,this.setHeader("call-id",i),j=d.cseq||Math.floor(1e4*Math.random()),this.cseq=j,void this.setHeader("cseq",j+" "+a)):null}function e(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function f(a){this.ua=a,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function g(){this.headers={},this.status_code=null,this.reason_phrase=null}b.exports={OutgoingRequest:d,IncomingRequest:f,IncomingResponse:g};var h=a("debug")("JsSIP:SIPMessage"),i=a("sdp-transform"),j=a("./VoxboneLogger.js");h.log=j.loginfo.bind(console);var k=a("./Constants"),l=a("./Utils"),m=a("./NameAddrHeader"),n=a("./Grammar");d.prototype={setHeader:function(a,b){var c,d;for(c=new RegExp("^\\s*"+a+"\\s*:","i"),d=0;d<this.extraHeaders.length;d++)c.test(this.extraHeaders[d])&&this.extraHeaders.splice(d,1);this.headers[l.headerize(a)]=Array.isArray(b)?b:[b]},getHeader:function(a){var b,c,d=this.extraHeaders.length,e=this.headers[l.headerize(a)];if(e){if(e[0])return e[0]}else for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(e=this.extraHeaders[c],b.test(e))return e.substring(e.indexOf(":")+1).trim()},getHeaders:function(a){var b,c,d,e=this.headers[l.headerize(a)],f=[];if(e){for(c=e.length,b=0;b<c;b++)f.push(e[b]);return f}for(c=this.extraHeaders.length,d=new RegExp("^\\s*"+a+"\\s*:","i"),b=0;b<c;b++)e=this.extraHeaders[b],d.test(e)&&f.push(e.substring(e.indexOf(":")+1).trim());return f},hasHeader:function(a){var b,c,d=this.extraHeaders.length;if(this.headers[l.headerize(a)])return!0;for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(b.test(this.extraHeaders[c]))return!0;return!1},parseSDP:function(a){return!a&&this.sdp?this.sdp:(this.sdp=i.parse(this.body||""),this.sdp)},toString:function(){var a,b,c,d="",e=[];d+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(a in this.headers)for(b=this.headers[a].length,c=0;c<b;c++)d+=a+": "+this.headers[a][c]+"\r\n";for(b=this.extraHeaders.length,c=0;c<b;c++)d+=this.extraHeaders[c].trim()+"\r\n";switch(this.method){case k.REGISTER:e.push("path","gruu");break;case k.INVITE:this.ua.configuration.session_timers&&e.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&e.push("gruu"),e.push("ice","replaces");break;case k.UPDATE:this.ua.configuration.session_timers&&e.push("timer"),e.push("ice")}return e.push("outbound"),d+="Allow: "+k.ALLOWED_METHODS+"\r\n",d+="Supported: "+e+"\r\n",d+="User-Agent: "+k.USER_AGENT+"\r\n",this.body?(b=l.str_utf8_length(this.body),d+="Content-Length: "+b+"\r\n\r\n",d+=this.body):d+="Content-Length: 0\r\n\r\n",d}},e.prototype={addHeader:function(a,b){var c={raw:b};a=l.headerize(a),this.headers[a]?this.headers[a].push(c):this.headers[a]=[c]},getHeader:function(a){var b=this.headers[l.headerize(a)];if(b)return b[0]?b[0].raw:void 0},getHeaders:function(a){var b,c,d=this.headers[l.headerize(a)],e=[];if(!d)return[];for(c=d.length,b=0;b<c;b++)e.push(d[b].raw);return e},hasHeader:function(a){return!!this.headers[l.headerize(a)]},parseHeader:function(a,b){var c,d,e;return a=l.headerize(a),b=b||0,this.headers[a]?b>=this.headers[a].length?void h('not so many "'+a+'" headers present'):(c=this.headers[a][b],
d=c.raw,c.parsed?c.parsed:(e=n.parse(d,a.replace(/-/g,"_")),e===-1?(this.headers[a].splice(b,1),void h('error parsing "'+a+'" header field with value "'+d+'"')):(c.parsed=e,e))):void h('header "'+a+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(a,b){var c={raw:b};this.headers[l.headerize(a)]=[c]},parseSDP:function(a){return!a&&this.sdp?this.sdp:(this.sdp=i.parse(this.body||""),this.sdp)},toString:function(){return this.data}},f.prototype=new e,f.prototype.reply=function(a,b,c,d,e,f){var g,h,i,j,m,n=[],o=this.getHeader("To"),p=0,q=0;if(a=a||null,b=b||null,!a||a<100||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);if(b=b||k.REASON_PHRASE[a]||"",c=c&&c.slice()||[],m="SIP/2.0 "+a+" "+b+"\r\n",this.method===k.INVITE&&a>100&&a<=200)for(g=this.getHeaders("record-route"),i=g.length,p;p<i;p++)m+="Record-Route: "+g[p]+"\r\n";for(h=this.getHeaders("via"),i=h.length,q;q<i;q++)m+="Via: "+h[q]+"\r\n";for(!this.to_tag&&a>100?o+=";tag="+l.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(o+=";tag="+this.to_tag),m+="To: "+o+"\r\n",m+="From: "+this.getHeader("From")+"\r\n",m+="Call-ID: "+this.call_id+"\r\n",m+="CSeq: "+this.cseq+" "+this.method+"\r\n",i=c.length,j=0;j<i;j++)m+=c[j].trim()+"\r\n";switch(this.method){case k.INVITE:this.ua.configuration.session_timers&&n.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&n.push("gruu"),n.push("ice","replaces");break;case k.UPDATE:this.ua.configuration.session_timers&&n.push("timer"),d&&n.push("ice"),n.push("replaces")}n.push("outbound"),this.method===k.OPTIONS?(m+="Allow: "+k.ALLOWED_METHODS+"\r\n",m+="Accept: "+k.ACCEPTED_BODY_TYPES+"\r\n"):405===a?m+="Allow: "+k.ALLOWED_METHODS+"\r\n":415===a&&(m+="Accept: "+k.ACCEPTED_BODY_TYPES+"\r\n"),m+="Supported: "+n+"\r\n",d?(i=l.str_utf8_length(d),m+="Content-Type: application/sdp\r\n",m+="Content-Length: "+i+"\r\n\r\n",m+=d):m+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(a,m,e,f)},f.prototype.reply_sl=function(a,b){var c,d,e=0,f=this.getHeaders("via"),g=f.length;if(a=a||null,b=b||null,!a||a<100||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);for(b=b||k.REASON_PHRASE[a]||"",d="SIP/2.0 "+a+" "+b+"\r\n",e;e<g;e++)d+="Via: "+f[e]+"\r\n";c=this.getHeader("To"),!this.to_tag&&a>100?c+=";tag="+l.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(c+=";tag="+this.to_tag),d+="To: "+c+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",d+="Content-Length: 0\r\n\r\n",this.transport.send(d)},g.prototype=new e},{"./Constants":1,"./Grammar":6,"./NameAddrHeader":9,"./Utils":24,"./VoxboneLogger.js":25,debug:32,"sdp-transform":43}],19:[function(a,b,c){var d=500,e=4e3,f=5e3,g={T1:d,T2:e,T4:f,TIMER_B:64*d,TIMER_D:0*d,TIMER_F:64*d,TIMER_H:64*d,TIMER_I:0*d,TIMER_J:0*d,TIMER_K:0*f,TIMER_L:64*d,TIMER_M:64*d,PROVISIONAL_RESPONSE_INTERVAL:6e4};b.exports=g},{}],20:[function(a,b,c){function d(a,b,c){var d,e;this.type=j.NON_INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,e=a.ua.configuration.hack_via_tcp?"TCP":a.ua.configuration.hack_via_ws?"WS":c.server.scheme,d="SIP/2.0/"+e,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),l.EventEmitter.call(this)}function e(a,b,c){var d,e,f=this;this.type=j.INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,e=a.ua.configuration.hack_via_tcp?"TCP":a.ua.configuration.hack_via_ws?"WS":c.server.scheme,d="SIP/2.0/"+e,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),this.request.cancel=function(a){f.cancel_request(f,a)},l.EventEmitter.call(this)}function f(a,b,c){var d,e;this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,e=a.ua.configuration.hack_via_tcp?"TCP":a.ua.configuration.hack_via_ws?"WS":c.server.scheme,d="SIP/2.0/"+e,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),l.EventEmitter.call(this)}function g(a,b){this.type=j.NON_INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_TRYING,b.newTransaction(this),l.EventEmitter.call(this)}function h(a,b){this.type=j.INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_PROCEEDING,b.newTransaction(this),this.resendProvisionalTimer=null,a.reply(100),l.EventEmitter.call(this)}function i(a,b){var c;switch(b.method){case s.INVITE:if(c=a.transactions.ist[b.via_branch]){switch(c.state){case j.STATUS_PROCEEDING:c.transport.send(c.last_response);break;case j.STATUS_ACCEPTED:}return!0}break;case s.ACK:if(c=a.transactions.ist[b.via_branch],!c)return!1;if(c.state===j.STATUS_ACCEPTED)return!1;if(c.state===j.STATUS_COMPLETED)return c.state=j.STATUS_CONFIRMED,c.I=setTimeout(function(){c.timer_I()},t.TIMER_I),!0;break;case s.CANCEL:return c=a.transactions.ist[b.via_branch],c?(b.reply_sl(200),c.state!==j.STATUS_PROCEEDING):(b.reply_sl(481),!0);default:if(c=a.transactions.nist[b.via_branch]){switch(c.state){case j.STATUS_TRYING:break;case j.STATUS_PROCEEDING:case j.STATUS_COMPLETED:c.transport.send(c.last_response)}return!0}}}b.exports={C:null,NonInviteClientTransaction:d,InviteClientTransaction:e,AckClientTransaction:f,NonInviteServerTransaction:g,InviteServerTransaction:h,checkTransaction:i};var j={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};b.exports.C=j;var k=a("util"),l=a("events"),m=a("debug")("JsSIP:NonInviteClientTransaction"),n=a("debug")("JsSIP:InviteClientTransaction"),o=a("debug")("JsSIP:AckClientTransaction"),p=a("debug")("JsSIP:NonInviteServerTransaction"),q=a("debug")("JsSIP:InviteServerTransaction"),r=a("./VoxboneLogger.js");m.log=r.loginfo.bind(console),n.log=r.loginfo.bind(console),o.log=r.loginfo.bind(console),p.log=r.loginfo.bind(console),q.log=r.loginfo.bind(console);var s=a("./Constants"),t=a("./Timers");k.inherits(d,l.EventEmitter),d.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},d.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_TRYING),this.F=setTimeout(function(){a.timer_F()},t.TIMER_F),this.transport.send(this.request)||this.onTransportError()},d.prototype.onTransportError=function(){m("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},d.prototype.timer_F=function(){m("Timer F expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},d.prototype.timer_K=function(){this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},d.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c<200)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a)}else switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),clearTimeout(this.F),408===c?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(a),this.K=setTimeout(function(){b.timer_K()},t.TIMER_K);break;case j.STATUS_COMPLETED:}},k.inherits(e,l.EventEmitter),e.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},e.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_CALLING),this.B=setTimeout(function(){a.timer_B()},t.TIMER_B),this.transport.send(this.request)||this.onTransportError()},e.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==j.STATUS_ACCEPTED&&(n("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.timer_M=function(){n("Timer M expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},e.prototype.timer_B=function(){n("Timer B expired for transaction "+this.id),this.state===j.STATUS_CALLING&&(this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},e.prototype.timer_D=function(){n("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.sendACK=function(a){var b=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+a.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){b.timer_D()},t.TIMER_D),this.transport.send(this.ack)},e.prototype.cancel_request=function(a,b){var c=a.request;this.cancel=s.CANCEL+" "+c.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+c.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+c.headers.Route.toString()+"\r\n"),this.cancel+="To: "+c.headers.To.toString()+"\r\n",this.cancel+="From: "+c.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+c.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+c.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",b&&(this.cancel+="Reason: "+b+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===j.STATUS_PROCEEDING&&this.transport.send(this.cancel)},e.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c>=100&&c<=199)switch(this.state){case j.STATUS_CALLING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a);break;case j.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(c>=200&&c<=299)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.M=setTimeout(function(){b.timer_M()},t.TIMER_M),this.request_sender.receiveResponse(a);break;case j.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(c>=300&&c<=699)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.sendACK(a),this.request_sender.receiveResponse(a);break;case j.STATUS_COMPLETED:this.sendACK(a)}},k.inherits(f,l.EventEmitter),f.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},f.prototype.onTransportError=function(){o("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},k.inherits(g,l.EventEmitter),g.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},g.prototype.timer_J=function(){p("Timer J expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},g.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,p("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},g.prototype.receiveResponse=function(a,b,c,d){var e=this;if(100===a)switch(this.state){case j.STATUS_TRYING:this.stateChanged(j.STATUS_PROCEEDING),this.transport.send(b)||this.onTransportError();break;case j.STATUS_PROCEEDING:this.last_response=b,this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=200&&a<=699)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.last_response=b,this.J=setTimeout(function(){e.timer_J()},t.TIMER_J),this.transport.send(b)?c&&c():(this.onTransportError(),d&&d());break;case j.STATUS_COMPLETED:}},k.inherits(h,l.EventEmitter),h.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},h.prototype.timer_H=function(){q("Timer H expired for transaction "+this.id),this.state===j.STATUS_COMPLETED&&q("ACK not received, dialog will be terminated"),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},h.prototype.timer_I=function(){this.stateChanged(j.STATUS_TERMINATED)},h.prototype.timer_L=function(){q("Timer L expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,q("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},h.prototype.receiveResponse=function(a,b,c,d){var e=this;if(a>=100&&a<=199)switch(this.state){case j.STATUS_PROCEEDING:this.transport.send(b)||this.onTransportError(),this.last_response=b}if(a>100&&a<=199&&this.state===j.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){e.resend_provisional()},t.PROVISIONAL_RESPONSE_INTERVAL));else if(a>=200&&a<=299)switch(this.state){case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.last_response=b,this.L=setTimeout(function(){e.timer_L()},t.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case j.STATUS_ACCEPTED:this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=300&&a<=699)switch(this.state){case j.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(b)?(this.stateChanged(j.STATUS_COMPLETED),this.H=setTimeout(function(){e.timer_H()},t.TIMER_H),c&&c()):(this.onTransportError(),d&&d())}}},{"./Constants":1,"./Timers":19,"./VoxboneLogger.js":25,debug:32,events:27,util:31}],21:[function(a,b,c){function d(a,b){this.ua=a,this.ws=null,this.server=b,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.node_websocket_options=this.ua.configuration.node_websocket_options||{},this.node_websocket_options.headers=this.node_websocket_options.headers||{},this.node_websocket_options.headers["User-Agent"]=i.USER_AGENT}b.exports=d;var e={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};d.C=e;var f=a("debug")("JsSIP:Transport"),g=a("debug")("JsSIP:ERROR:Transport"),h=a("./VoxboneLogger.js");f.log=h.loginfo.bind(console),g.log=h.logerror.bind(console);var i=a("./Constants"),j=a("./Parser"),k=a("./UA"),l=a("./SIPMessage"),m=a("./sanityCheck"),n=a("websocket").w3cwebsocket;d.prototype={connect:function(){var a=this;if(this.ws&&(this.ws.readyState===this.ws.OPEN||this.ws.readyState===this.ws.CONNECTING))return f("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),f("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{n.length>3?this.ws=new n(this.server.ws_uri,"sip",this.node_websocket_options.origin,this.node_websocket_options.headers,this.node_websocket_options.requestOptions,this.node_websocket_options.clientConfig):this.ws=new n(this.server.ws_uri,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(b){a.onClose(b)},this.ws.onmessage=function(b){a.onMessage(b)},this.ws.onerror=function(b){a.onError(b)}}catch(b){g("error connecting to WebSocket "+this.server.ws_uri+": "+b),this.lastTransportError.code=null,this.lastTransportError.reason=b.message,this.ua.onTransportError(this)}},disconnect:function(){this.ws&&(clearTimeout(this.reconnectTimer),this.closed=!0,f("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.onTransportDisconnected({transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},send:function(a){var b=a.toString();return this.ws&&this.ws.readyState===this.ws.OPEN?(f("sending WebSocket message:\n%s\n",b),this.ws.send(b),!0):(g("unable to send message, WebSocket is not open"),!1)},onOpen:function(){this.connected=!0,f("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(a){var b=this.connected;this.connected=!1,this.lastTransportError.code=a.code,this.lastTransportError.reason=a.reason,f("WebSocket disconnected (code: "+a.code+(a.reason?"| reason: "+a.reason:"")+")"),a.wasClean===!1&&g("WebSocket abrupt disconnection"),b===!0?(this.ua.onTransportClosed(this),this.closed||this.reConnect()):this.ua.onTransportError(this)},onMessage:function(a){var b,c,d=a.data;if("\r\n"===d)return void f("received WebSocket message with CRLF Keep Alive response");if("string"!=typeof d){try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){return void g("received WebSocket binary message failed to be converted into string, message discarded")}f("received WebSocket binary message:\n%s\n",d)}else f("received WebSocket text message:\n%s\n",d);if(b=j.parseMessage(d,this.ua),b&&!(this.ua.status===k.C.STATUS_USER_CLOSED&&b instanceof l.IncomingRequest)&&m(b,this.ua,this))if(b instanceof l.IncomingRequest)b.transport=this,this.ua.receiveRequest(b);else if(b instanceof l.IncomingResponse)switch(b.method){case i.INVITE:c=this.ua.transactions.ict[b.via_branch],c&&c.receiveResponse(b);break;case i.ACK:break;default:c=this.ua.transactions.nict[b.via_branch],c&&c.receiveResponse(b)}},onError:function(a){g("WebSocket connection error: %o",a)},reConnect:function(){var a=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(g("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(f("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=setTimeout(function(){a.connect(),a.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}}},{"./Constants":1,"./Parser":10,"./SIPMessage":18,"./UA":22,"./VoxboneLogger.js":25,"./sanityCheck":26,debug:32,websocket:46}],22:[function(a,b,c){function d(a){if(this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=e.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var a,b=["nist","nict","ist","ict"],c=0;for(a in b)c+=Object.keys(this.transactions[b[a]]).length;return c}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a)}catch(b){throw this.status=e.STATUS_NOT_READY,this.error=e.CONFIGURATION_ERROR,b}this._registrator=new m(this),g.EventEmitter.call(this),k.called||k()}b.exports=d;var e={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};d.C=e;var f=a("util"),g=a("events"),h=a("debug")("JsSIP:UA"),i=a("./VoxboneLogger.js"),j=a("debug")("JsSIP:ERROR:UA");h.log=i.loginfo.bind(console),j.log=i.logerror.bind(console);var k=a("rtcninja"),l=a("./Constants"),m=a("./Registrator"),n=a("./RTCSession"),o=a("./Message"),p=a("./Transport"),q=a("./Transactions"),q=a("./Transactions"),r=a("./Utils"),s=a("./Exceptions"),t=a("./URI"),u=a("./Grammar");f.inherits(d,g.EventEmitter),d.prototype.start=function(){function a(){h("restarting UA"),c.status=e.STATUS_READY,c.transport.connect()}h("start()");var b,c=this;this.status===e.STATUS_INIT?(b=this.getNextWsServer(),this.transport=new p(this,b),this.transport.connect()):this.status===e.STATUS_USER_CLOSED?this.isConnected()?this.once("disconnected",a):a():h(this.status===e.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},d.prototype.register=function(){h("register()"),this.dynConfiguration.register=!0,this._registrator.register()},d.prototype.unregister=function(a){h("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(a)},d.prototype.registrator=function(){return this._registrator},d.prototype.isRegistered=function(){return!!this._registrator.registered},d.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},d.prototype.call=function(a,b){h("call()");var c;return c=new n(this),c.connect(a,b),c},d.prototype.sendMessage=function(a,b,c){h("sendMessage()");var d;return d=new o(this),d.send(a,b,c),d},d.prototype.terminateSessions=function(a){h("terminateSessions()");for(var b in this.sessions)this.sessions[b].isEnded()||this.sessions[b].terminate(a)},d.prototype.stop=function(){h("stop()");var a,b,c,d=this;if(this.dynConfiguration={},this.status===e.STATUS_USER_CLOSED)return void h("UA already closed");clearTimeout(this.transportRecoveryTimer),this._registrator.close(),c=Object.keys(this.sessions).length;for(a in this.sessions){h("closing session "+a);try{this.sessions[a].terminate()}catch(f){}}for(b in this.applicants)try{this.applicants[b].close()}catch(f){}this.status=e.STATUS_USER_CLOSED,setTimeout(function(){d.transport.disconnect()},2e3)},d.prototype.normalizeTarget=function(a){return r.normalizeTarget(a,this.configuration.hostport_params)},d.prototype.set=function(a,b){switch(a){case"password":this.configuration.password=String(b);break;default:return j('set() | cannot set "%s" parameter in runtime',a),!1}return!0},d.prototype.onTransportClosed=function(a){var b,c,d,e=["nict","ict","nist","ist"];for(a.server.status=p.C.STATUS_DISCONNECTED,d=e.length,b=0;b<d;b++)for(c in this.transactions[e[b]])this.transactions[e[b]][c].onTransportError();this.emit("disconnected",{transport:a,code:a.lastTransportError.code,reason:a.lastTransportError.reason})},d.prototype.onTransportError=function(a){var b;h("transport "+a.server.ws_uri+" failed | connection state set to "+p.C.STATUS_ERROR),a.server.status=p.C.STATUS_ERROR,this.emit("disconnected",{transport:a,code:a.lastTransportError.code,reason:a.lastTransportError.reason}),this.status!==e.STATUS_USER_CLOSED&&(b=this.getNextWsServer(),b?(this.transport=new p(this,b),this.transport.connect()):(this.closeSessionsOnTransportError(),this.error&&this.error===e.NETWORK_ERROR||(this.status=e.STATUS_NOT_READY,this.error=e.NETWORK_ERROR),this.recoverTransport()))},d.prototype.onTransportConnected=function(a){this.transport=a,this.transportRecoverAttempts=0,a.server.status=p.C.STATUS_READY,this.status!==e.STATUS_USER_CLOSED&&(this.status=e.STATUS_READY,this.error=null,this.dynConfiguration.register&&this._registrator.register(),this.emit("connected",{transport:a}))},d.prototype.onTransportConnecting=function(a,b){this.emit("connecting",{transport:a,attempts:b})},d.prototype.onTransportDisconnected=function(a){this.emit("disconnected",a)},d.prototype.newTransaction=function(a){this.transactions[a.type][a.id]=a,this.emit("newTransaction",{transaction:a})},d.prototype.destroyTransaction=function(a){delete this.transactions[a.type][a.id],this.emit("transactionDestroyed",{transaction:a})},d.prototype.newMessage=function(a){this.emit("newMessage",a)},d.prototype.newRTCSession=function(a){this.emit("newRTCSession",a)},d.prototype.registered=function(a){this.emit("registered",a)},d.prototype.unregistered=function(a){this.emit("unregistered",a)},d.prototype.registrationFailed=function(a){this.emit("registrationFailed",a)},d.prototype.receiveRequest=function(a){var b,c,d,e,f=a.method;if(a.ruri.user!==this.configuration.uri.user&&a.ruri.user!==this.contact.uri.user)return h("Request-URI does not point to us"),void(a.method!==l.ACK&&a.reply_sl(404));if(a.ruri.scheme===l.SIPS)return void a.reply_sl(416);if(!q.checkTransaction(this,a)){if(f===l.INVITE?new q.InviteServerTransaction(a,this):f!==l.ACK&&f!==l.CANCEL&&new q.NonInviteServerTransaction(a,this),f===l.OPTIONS)a.reply(200);else if(f===l.MESSAGE){if(0===this.listeners("newMessage").length)return void a.reply(405);d=new o(this),d.init_incoming(a)}else if(f===l.INVITE&&!a.to_tag&&0===this.listeners("newRTCSession").length)return void a.reply(405);if(a.to_tag)b=this.findDialog(a.call_id,a.from_tag,a.to_tag),b?b.receiveRequest(a):f===l.NOTIFY?(c=this.findSession(a),c?c.receiveRequest(a):(h("received NOTIFY request for a non existent subscription"),a.reply(481,"Subscription does not exist"))):f!==l.ACK&&a.reply(481);else switch(f){case l.INVITE:k.hasWebRTC()?a.hasHeader("replaces")?(e=a.replaces,b=this.findDialog(e.call_id,e.from_tag,e.to_tag),b?(c=b.owner,c.isEnded()?a.reply(603):c.receiveRequest(a)):a.reply(481)):(c=new n(this),c.init_incoming(a)):(h("INVITE received but WebRTC is not supported"),a.reply(488));break;case l.BYE:a.reply(481);break;case l.CANCEL:c=this.findSession(a),c?c.receiveRequest(a):h("received CANCEL request for a non existent session");break;case l.ACK:break;default:a.reply(405)}}},d.prototype.findSession=function(a){var b=a.call_id+a.from_tag,c=this.sessions[b],d=a.call_id+a.to_tag,e=this.sessions[d];return c?c:e?e:null},d.prototype.findDialog=function(a,b,c){var d=a+b+c,e=this.dialogs[d];return e?e:(d=a+c+b,e=this.dialogs[d],e?e:null)},d.prototype.getNextWsServer=function(){var a,b,c,d=[];for(b=this.configuration.ws_servers.length,a=0;a<b;a++)c=this.configuration.ws_servers[a],c.status!==p.C.STATUS_ERROR&&(0===d.length?d.push(c):c.weight>d[0].weight?d=[c]:c.weight===d[0].weight&&d.push(c));return a=Math.floor(Math.random()*d.length),d[a]},d.prototype.closeSessionsOnTransportError=function(){var a;for(a in this.sessions)this.sessions[a].onTransportError();this._registrator.onTransportClosed()},d.prototype.recoverTransport=function(a){var b,c,d,e,f,g;for(a=a||this,f=a.transportRecoverAttempts,c=a.configuration.ws_servers.length,b=0;b<c;b++)a.configuration.ws_servers[b].status=0;g=a.getNextWsServer(),d=Math.floor(Math.random()*Math.pow(2,f)+1),e=d*a.configuration.connection_recovery_min_interval,e>a.configuration.connection_recovery_max_interval&&(h("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),e=a.configuration.connection_recovery_min_interval,f=0),h("next connection attempt in "+e+" seconds"),this.transportRecoveryTimer=setTimeout(function(){a.transportRecoverAttempts=f+1,a.transport=new p(a,g),a.transport.connect()},1e3*e)},d.prototype.loadConfig=function(a){var b,c,e,f,g,i={via_host:r.createRandomToken(12)+".invalid",password:null,register_expires:600,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0,hack_via_tcp:!1,hack_via_ws:!1,hack_ip_in_contact:!1,node_websocket_options:{}};for(b in d.configuration_check.mandatory){if(!a.hasOwnProperty(b))throw new s.ConfigurationError(b);if(c=a[b],e=d.configuration_check.mandatory[b].call(this,c),void 0===e)throw new s.ConfigurationError(b,c);i[b]=e}for(b in d.configuration_check.optional)if(a.hasOwnProperty(b)){if(c=a[b],r.isEmpty(c))continue;if(e=d.configuration_check.optional[b].call(this,c),void 0===e)throw new s.ConfigurationError(b,c);i[b]=e}if(i.connection_recovery_max_interval<i.connection_recovery_min_interval)throw new s.ConfigurationError("connection_recovery_max_interval",i.connection_recovery_max_interval);0===i.display_name&&(i.display_name="0"),i.instance_id||(i.instance_id=r.newUUID()),i.jssip_id=r.createRandomToken(5),f=i.uri.clone(),f.user=null,i.hostport_params=f.toString().replace(/^sip:/i,""),i.authorization_user||(i.authorization_user=i.uri.user),i.registrar_server||(g=i.uri.clone(),g.user=null,g.clearParams(),g.clearHeaders(),i.registrar_server=g),i.no_answer_timeout=1e3*i.no_answer_timeout,i.hack_ip_in_contact&&(i.via_host=r.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new t("sip",r.createRandomToken(8),i.via_host,null,{transport:"ws"}),toString:function(a){a=a||{};var b=a.anonymous||null,c=a.outbound||null,d="<";return d+=b?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!c||(b?this.temp_gruu:this.pub_gruu)||(d+=";ob"),d+=">"}};for(b in i)d.configuration_skeleton[b].value=i[b];Object.defineProperties(this.configuration,d.configuration_skeleton);for(b in i)d.configuration_skeleton[b].value="";h("configuration parameters after validation:");for(b in i)switch(b){case"uri":case"registrar_server":h("- "+b+": "+i[b]);break;case"password":h("- "+b+": NOT SHOWN");break;default:h("- "+b+": "+JSON.stringify(i[b]))}},d.configuration_skeleton=function(){var a,b,c,d={},e=["jssip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","session_timers","node_websocket_options","password","register_expires","registrar_server","use_preloaded_route","via_core_value","via_host"];for(a in e)b=e[a],c=["password"].indexOf(b)!==-1,d[b]={value:"",writable:c,configurable:!1};return d.register={value:"",writable:!0,configurable:!1},d}(),d.configuration_check={mandatory:{uri:function(a){var b;return/^sip:/i.test(a)||(a=l.SIP+":"+a),b=t.parse(a),b&&b.user?b:void 0},ws_servers:function(a){var b,c,d;if("string"==typeof a)a=[{ws_uri:a}];else{if(!Array.isArray(a))return;for(c=a.length,b=0;b<c;b++)"string"==typeof a[b]&&(a[b]={ws_uri:a[b]})}if(0===a.length)return!1;for(c=a.length,b=0;b<c;b++){if(!a[b].ws_uri)return void h('ERROR: missing "ws_uri" attribute in ws_servers parameter');if(a[b].weight&&!Number(a[b].weight))return void h('ERROR: "weight" attribute in ws_servers parameter must be a Number');if(d=u.parse(a[b].ws_uri,"absoluteURI"),d===-1)return void h('ERROR: invalid "ws_uri" attribute in ws_servers parameter: '+a[b].ws_uri);if("wss"!==d.scheme&&"ws"!==d.scheme)return void h("ERROR: invalid URI scheme in ws_servers parameter: "+d.scheme);a[b].sip_uri="<sip:"+d.host+(d.port?":"+d.port:"")+";transport=ws;lr>",a[b].weight||(a[b].weight=0),a[b].status=0,a[b].scheme=d.scheme.toUpperCase()}return a}},optional:{authorization_user:function(a){return u.parse('"'+a+'"',"quoted_string")===-1?void 0:a;
},connection_recovery_max_interval:function(a){var b;if(r.isDecimal(a)&&(b=Number(a),b>0))return b},connection_recovery_min_interval:function(a){var b;if(r.isDecimal(a)&&(b=Number(a),b>0))return b},display_name:function(a){return u.parse('"'+a+'"',"display_name")===-1?void 0:a},hack_via_tcp:function(a){if("boolean"==typeof a)return a},hack_via_ws:function(a){if("boolean"==typeof a)return a},hack_ip_in_contact:function(a){if("boolean"==typeof a)return a},instance_id:function(a){return/^uuid:/i.test(a)&&(a=a.substr(5)),u.parse(a,"uuid")===-1?void 0:a},no_answer_timeout:function(a){var b;if(r.isDecimal(a)&&(b=Number(a),b>0))return b},session_timers:function(a){if("boolean"==typeof a)return a},node_websocket_options:function(a){return"object"==typeof a?a:{}},password:function(a){return String(a)},register:function(a){if("boolean"==typeof a)return a},register_expires:function(a){var b;if(r.isDecimal(a)&&(b=Number(a),b>0))return b},registrar_server:function(a){var b;return/^sip:/i.test(a)||(a=l.SIP+":"+a),b=t.parse(a),b?b.user?void 0:b:void 0},use_preloaded_route:function(a){if("boolean"==typeof a)return a}}}},{"./Constants":1,"./Exceptions":5,"./Grammar":6,"./Message":8,"./RTCSession":11,"./Registrator":16,"./Transactions":20,"./Transport":21,"./URI":23,"./Utils":24,"./VoxboneLogger.js":25,debug:32,events:27,rtcninja:37,util:31}],23:[function(a,b,c){function d(a,b,c,d,f,g){var h,i;if(!c)throw new TypeError('missing or invalid "host" parameter');a=a||e.SIP,this.parameters={},this.headers={};for(h in f)this.setParam(h,f[h]);for(i in g)this.setHeader(i,g[i]);Object.defineProperties(this,{scheme:{get:function(){return a},set:function(b){a=b.toLowerCase()}},user:{get:function(){return b},set:function(a){b=a}},host:{get:function(){return c},set:function(a){c=a.toLowerCase()}},port:{get:function(){return d},set:function(a){d=0===a?a:parseInt(a,10)||null}}})}b.exports=d;var e=a("./Constants"),f=a("./Utils"),g=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString().toLowerCase())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var b;if(a=a.toLowerCase(),this.parameters.hasOwnProperty(a))return b=this.parameters[a],delete this.parameters[a],b},clearParams:function(){this.parameters={}},setHeader:function(a,b){this.headers[f.headerize(a)]=Array.isArray(b)?b:[b]},getHeader:function(a){if(a)return this.headers[f.headerize(a)]},hasHeader:function(a){if(a)return this.headers.hasOwnProperty(f.headerize(a))&&!0||!1},deleteHeader:function(a){var b;if(a=f.headerize(a),this.headers.hasOwnProperty(a))return b=this.headers[a],delete this.headers[a],b},clearHeaders:function(){this.headers={}},clone:function(){return new d(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var a,b,c,d,e=[];d=this.scheme+":",this.user&&(d+=f.escapeUser(this.user)+"@"),d+=this.host,(this.port||0===this.port)&&(d+=":"+this.port);for(b in this.parameters)d+=";"+b,null!==this.parameters[b]&&(d+="="+this.parameters[b]);for(a in this.headers)for(c=0;c<this.headers[a].length;c++)e.push(a+"="+this.headers[a][c]);return e.length>0&&(d+="?"+e.join("&")),d},toAor:function(a){var b;return b=this.scheme+":",this.user&&(b+=f.escapeUser(this.user)+"@"),b+=this.host,a&&(this.port||0===this.port)&&(b+=":"+this.port),b}},d.parse=function(a){return a=g.parse(a,"SIP_URI"),a!==-1?a:void 0}},{"./Constants":1,"./Grammar":6,"./Utils":24}],24:[function(a,b,c){var d={};b.exports=d;var e=a("./Constants"),f=a("./URI"),g=a("./Grammar");d.str_utf8_length=function(a){return unescape(encodeURIComponent(a)).length},d.isFunction=function(a){return void 0!==a&&"[object Function]"===Object.prototype.toString.call(a)},d.isDecimal=function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},d.isEmpty=function(a){if(null===a||""===a||void 0===a||Array.isArray(a)&&0===a.length||"number"==typeof a&&isNaN(a))return!0},d.createRandomToken=function(a,b){var c,d,e="";for(b=b||32,c=0;c<a;c++)d=Math.random()*b|0,e+=d.toString(b);return e},d.newTag=function(){return d.createRandomToken(10)},d.newUUID=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a},d.hostType=function(a){if(a)return a=g.parse(a,"host"),a!==-1?a.host_type:void 0},d.normalizeTarget=function(a,b){var c,g,h,i;if(a){if(a instanceof f)return a;if("string"==typeof a){switch(g=a.split("@"),g.length){case 1:if(!b)return;h=a,i=b;break;case 2:h=g[0],i=g[1];break;default:h=g.slice(0,g.length-1).join("@"),i=g[g.length-1]}return h=h.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(h)&&(h=h.replace(/[\-\.\(\)]/g,"")),a=e.SIP+":"+d.escapeUser(h)+"@"+i,(c=f.parse(a))?c:void 0}}else;},d.escapeUser=function(a){return encodeURIComponent(decodeURIComponent(a)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},d.headerize=function(a){var b,c={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},d=a.toLowerCase().replace(/_/g,"-").split("-"),e="",f=d.length;for(b=0;b<f;b++)0!==b&&(e+="-"),e+=d[b].charAt(0).toUpperCase()+d[b].substring(1);return c[e]&&(e=c[e]),e},d.sipErrorCause=function(a){var b;for(b in e.SIP_ERROR_CAUSES)if(e.SIP_ERROR_CAUSES[b].indexOf(a)!==-1)return e.causes[b];return e.causes.SIP_FAILURE_CODE},d.getRandomTestNetIP=function(){function a(a,b){return Math.floor(Math.random()*(b-a+1)+a)}return"192.0.2."+a(1,254)},d.calculateMD5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=new Array(f-1),h=0,i=0;i<c;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;c<=3;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=[],y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()}},{"./Constants":1,"./Grammar":6,"./URI":23}],25:[function(a,b,c){var d=function(){},e=function(){};b.exports={loginfo:function(){var a=Array.prototype.slice.call(arguments);d.apply(console,a)},logerror:function(){var a=Array.prototype.slice.call(arguments);e.apply(console,a)},setError:function(a){e=a},setInfo:function(a){d=a}}},{}],26:[function(a,b,c){function d(a,b,c){var d,e;for(o=a,p=b,q=c,d=w.length;d--;)if(e=w[d](o),e===!1)return!1;if(o instanceof s.IncomingRequest){for(d=u.length;d--;)if(e=u[d](o),e===!1)return!1}else if(o instanceof s.IncomingResponse)for(d=v.length;d--;)if(e=v[d](o),e===!1)return!1;return!0}function e(){if("sip"!==o.s("to").uri.scheme)return l(416),!1}function f(){if(!o.to_tag&&o.call_id.substr(0,5)===p.configuration.jssip_id)return l(482),!1}function g(){var a=t.str_utf8_length(o.body),b=o.getHeader("content-length");if(a<b)return l(400),!1}function h(){var a,b,c=o.from_tag,d=o.call_id,e=o.cseq;if(!o.to_tag)if(o.method===r.INVITE){if(p.transactions.ist[o.via_branch])return!1;for(b in p.transactions.ist)if(a=p.transactions.ist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}else{if(p.transactions.nist[o.via_branch])return!1;for(b in p.transactions.nist)if(a=p.transactions.nist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}}function i(){if(o.getHeaders("via").length>1)return m("more than one Via header field present in the response, dropping the response"),!1}function j(){var a=t.str_utf8_length(o.body),b=o.getHeader("content-length");if(a<b)return m("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function k(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!o.hasHeader(a[b]))return m("missing mandatory header field : "+a[b]+", dropping the response"),!1}function l(a){var b,c="SIP/2.0 "+a+" "+r.REASON_PHRASE[a]+"\r\n",d=o.getHeaders("via"),e=d.length,f=0;for(f;f<e;f++)c+="Via: "+d[f]+"\r\n";b=o.getHeader("To"),o.to_tag||(b+=";tag="+t.newTag()),c+="To: "+b+"\r\n",c+="From: "+o.getHeader("From")+"\r\n",c+="Call-ID: "+o.call_id+"\r\n",c+="CSeq: "+o.cseq+" "+o.method+"\r\n",c+="\r\n",q.send(c)}b.exports=d;var m=a("debug")("JsSIP:sanityCheck"),n=a("./VoxboneLogger.js");m.log=n.loginfo.bind(console);var o,p,q,r=a("./Constants"),s=a("./SIPMessage"),t=a("./Utils"),u=[],v=[],w=[];u.push(e),u.push(f),u.push(g),u.push(h),v.push(i),v.push(j),w.push(k)},{"./Constants":1,"./SIPMessage":18,"./Utils":24,"./VoxboneLogger.js":25,debug:32}],27:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],28:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],29:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],30:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],31:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(d<0)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":30,_process:29,inherits:28}],32:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":33}],33:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:34}],34:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],35:[function(a,b,c){(function(c){"use strict";function d(a){function b(a){return function(){throw new Error("rtcninja: WebRTC not supported, missing "+a+" [browser: "+g.name+" "+g.version+"]")}}if(t&&g.chrome&&s>=32||g.android&&g.chrome&&s>=39||t&&g.opera&&s>=27||g.android&&g.opera&&s>=24||g.android&&g.webkit&&!g.chrome&&s>=37||f.webkitGetUserMedia&&e.webkitRTCPeerConnection)u=!0,j=f.webkitGetUserMedia.bind(f),k=e.webkitRTCPeerConnection,l=e.RTCSessionDescription,m=e.RTCIceCandidate,n=e.MediaStreamTrack,n&&n.getSources?o=n.getSources.bind(n):f.getMediaDevices&&(o=f.getMediaDevices.bind(f)),p=function(a,b){return a.src=URL.createObjectURL(b),a},q=!0,r=!1;else if(t&&g.firefox&&s>=22||g.android&&g.firefox&&s>=33||f.mozGetUserMedia&&e.mozRTCPeerConnection)u=!0,j=f.mozGetUserMedia.bind(f),k=e.mozRTCPeerConnection,l=e.mozRTCSessionDescription,m=e.mozRTCIceCandidate,n=e.MediaStreamTrack,p=function(a,b){return a.src=URL.createObjectURL(b),a},q=!1,r=!1;else if(a.plugin&&"function"==typeof a.plugin.isRequired&&a.plugin.isRequired()&&"function"==typeof a.plugin.isInstalled&&a.plugin.isInstalled()){var c=a.plugin["interface"];u=!0,j=c.getUserMedia,k=c.RTCPeerConnection,l=c.RTCSessionDescription,m=c.RTCIceCandidate,n=c.MediaStreamTrack,n&&n.getSources?o=n.getSources.bind(n):f.getMediaDevices&&(o=f.getMediaDevices.bind(f)),p=c.attachMediaStream,q=c.canRenegotiate,r=!0}else f.getUserMedia&&e.RTCPeerConnection&&(u=!0,j=f.getUserMedia.bind(f),k=e.RTCPeerConnection,l=e.RTCSessionDescription,m=e.RTCIceCandidate,n=e.MediaStreamTrack,n&&n.getSources?o=n.getSources.bind(n):f.getMediaDevices&&(o=f.getMediaDevices.bind(f)),p=e.attachMediaStream||function(a,b){return a.src=URL.createObjectURL(b),a},q=!1,r=!1);return d.hasWebRTC=function(){return u},j?d.getUserMedia=function(a,b,c){h("getUserMedia() | constraints: %o",a);try{j(a,function(a){h("getUserMedia() | success"),b&&b(a)},function(a){h("getUserMedia() | error:",a),c&&c(a)})}catch(d){i("getUserMedia() | error:",d),c&&c(d)}}:d.getUserMedia=function(a,c,d){i("getUserMedia() | WebRTC not supported"),d?d(new Error("rtcninja: WebRTC not supported, missing getUserMedia [browser: "+g.name+" "+g.version+"]")):b("getUserMedia")},d.RTCPeerConnection=k||b("RTCPeerConnection"),d.RTCSessionDescription=l||b("RTCSessionDescription"),d.RTCIceCandidate=m||b("RTCIceCandidate"),d.MediaStreamTrack=n||b("MediaStreamTrack"),d.getMediaDevices=o,d.attachMediaStream=p||b("attachMediaStream"),d.canRenegotiate=q,d.closeMediaStream=function(a){if(a)if(n&&n.prototype&&n.prototype.stop){h("closeMediaStream() | calling stop() on all the MediaStreamTrack");var b,c,d;if(a.getTracks)for(b=a.getTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop();else{for(b=a.getAudioTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop();for(b=a.getVideoTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop()}}else"function"==typeof a.stop&&(h("closeMediaStream() | calling stop() on the MediaStream"),a.stop())},d.fixPeerConnectionConfig=function(a){var b,c,d,e,f;for(Array.isArray(a.iceServers)||(a.iceServers=[]),b=0,c=a.iceServers.length;b<c;b+=1)d=a.iceServers[b],e=d.hasOwnProperty("urls"),f=d.hasOwnProperty("url"),"object"==typeof d&&(e&&!f?d.url=Array.isArray(d.urls)?d.urls[0]:d.urls:!e&&f&&(d.urls=Array.isArray(d.url)?d.url.slice():d.url),f&&Array.isArray(d.url)&&(d.url=d.url[0]))},d.fixRTCOfferOptions=function(a){a=a||{},r?(a.offerToReceiveAudio&&(a.mandatory=a.mandatory||{},a.mandatory.OfferToReceiveAudio=!0),a.offerToReceiveVideo&&(a.mandatory=a.mandatory||{},a.mandatory.OfferToReceiveVideo=!0)):(a.mandatory&&a.mandatory.OfferToReceiveAudio&&(a.offerToReceiveAudio=1),a.mandatory&&a.mandatory.OfferToReceiveVideo&&(a.offerToReceiveVideo=1),delete a.mandatory)},d}b.exports=d;var e,f,g=a("bowser"),h=a("debug")("rtcninja:Adapter"),i=a("debug")("rtcninja:ERROR:Adapter"),j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=!1,r=!1,s=Number(g.version)||0,t=!(g.mobile||g.tablet),u=!1;i.log=console.warn.bind(console),e=c.window||c,f=e.navigator||{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:39,debug:32}],36:[function(a,b,c){"use strict";function d(a,b){l("new | pcConfig: %o",a),e.call(this,a),this.pcConstraints=b,this.ourLocalDescription=null,this.ourSignalingState=null,this.ourIceConnectionState=null,this.ourIceGatheringState=null,this.timerGatheringTimeout=null,this.timerGatheringTimeoutAfterRelay=null,this.ignoreIceGathering=!1,this.closed=!1,h.call(this),j.call(this)}function e(a){this.pcConfig=k(!0,a),n.fixPeerConnectionConfig(this.pcConfig),this.options={iceTransportsRelay:"relay"===this.pcConfig.iceTransports,iceTransportsNone:"none"===this.pcConfig.iceTransports,gatheringTimeout:this.pcConfig.gatheringTimeout,gatheringTimeoutAfterRelay:this.pcConfig.gatheringTimeoutAfterRelay},delete this.pcConfig.gatheringTimeout,delete this.pcConfig.gatheringTimeoutAfterRelay,l("setConfigurationAndOptions | processed pcConfig: %o",this.pcConfig)}function f(){return this.closed||this.pc&&"closed"===this.pc.iceConnectionState}function g(){var a=this,b=this.pc;
b.onnegotiationneeded=function(b){f.call(a)||(l("onnegotiationneeded()"),a.onnegotiationneeded&&a.onnegotiationneeded(b))},b.onicecandidate=function(b){var c,d,e;if(!f.call(a)&&!a.ignoreIceGathering&&!a.options.iceTransportsNone)if(c=b.candidate){if(d=o.REGEXP_RELAY_CANDIDATE.test(c.candidate),a.options.iceTransportsRelay&&!d)return;d&&!a.timerGatheringTimeoutAfterRelay&&"number"==typeof a.options.gatheringTimeoutAfterRelay&&(l("onicecandidate() | first relay candidate found, ending gathering in %d ms",a.options.gatheringTimeoutAfterRelay),a.timerGatheringTimeoutAfterRelay=setTimeout(function(){f.call(a)||(l("forced end of candidates after timeout"),delete a.timerGatheringTimeoutAfterRelay,clearTimeout(a.timerGatheringTimeout),delete a.timerGatheringTimeout,a.ignoreIceGathering=!0,a.onicecandidate&&a.onicecandidate({candidate:null},null))},a.options.gatheringTimeoutAfterRelay)),e=new n.RTCIceCandidate({sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,candidate:c.candidate}),null===p.normalizeCandidate&&(o.REGEXP_NORMALIZED_CANDIDATE.test(c.candidate)?p.normalizeCandidate=!1:(l('onicecandidate() | normalizing ICE candidates syntax (remove "a=" and "\\r\\n")'),p.normalizeCandidate=!0)),p.normalizeCandidate&&(e.candidate=c.candidate.replace(o.REGEXP_FIX_CANDIDATE,"")),l("onicecandidate() | m%d(%s) %s",e.sdpMLineIndex,e.sdpMid||"no mid",e.candidate),a.onicecandidate&&a.onicecandidate(b,e)}else l("onicecandidate() | end of candidates"),clearTimeout(a.timerGatheringTimeout),delete a.timerGatheringTimeout,clearTimeout(a.timerGatheringTimeoutAfterRelay),delete a.timerGatheringTimeoutAfterRelay,a.onicecandidate&&a.onicecandidate(b,null)},b.onaddstream=function(b){f.call(a)||(l("onaddstream() | stream: %o",b.stream),a.onaddstream&&a.onaddstream(b,b.stream))},b.onremovestream=function(b){f.call(a)||(l("onremovestream() | stream: %o",b.stream),a.onremovestream&&a.onremovestream(b,b.stream))},b.ondatachannel=function(b){f.call(a)||(l("ondatachannel() | datachannel: %o",b.channel),a.ondatachannel&&a.ondatachannel(b,b.channel))},b.onsignalingstatechange=function(c){b.signalingState!==a.ourSignalingState&&(l("onsignalingstatechange() | signalingState: %s",b.signalingState),a.ourSignalingState=b.signalingState,a.onsignalingstatechange&&a.onsignalingstatechange(c,b.signalingState))},b.oniceconnectionstatechange=function(c){b.iceConnectionState!==a.ourIceConnectionState&&(l("oniceconnectionstatechange() | iceConnectionState: %s",b.iceConnectionState),a.ourIceConnectionState=b.iceConnectionState,a.oniceconnectionstatechange&&a.oniceconnectionstatechange(c,b.iceConnectionState))},b.onicegatheringstatechange=function(c){f.call(a)||b.iceGatheringState!==a.ourIceGatheringState&&(l("onicegatheringstatechange() | iceGatheringState: %s",b.iceGatheringState),a.ourIceGatheringState=b.iceGatheringState,a.onicegatheringstatechange&&a.onicegatheringstatechange(c,b.iceGatheringState))},b.onidentityresult=function(b){f.call(a)||(l("onidentityresult()"),a.onidentityresult&&a.onidentityresult(b))},b.onpeeridentity=function(b){f.call(a)||(l("onpeeridentity()"),a.onpeeridentity&&a.onpeeridentity(b))},b.onidpassertionerror=function(b){f.call(a)||(l("onidpassertionerror()"),a.onidpassertionerror&&a.onidpassertionerror(b))},b.onidpvalidationerror=function(b){f.call(a)||(l("onidpvalidationerror()"),a.onidpvalidationerror&&a.onidpvalidationerror(b))}}function h(){this.pcConstraints?this.pc=new n.RTCPeerConnection(this.pcConfig,this.pcConstraints):this.pc=new n.RTCPeerConnection(this.pcConfig),g.call(this)}function i(){var a=this.pc,b=this.options,c=null;return a.localDescription?(b.iceTransportsRelay?c=a.localDescription.sdp.replace(o.REGEXP_SDP_NON_RELAY_CANDIDATES,""):b.iceTransportsNone&&(c=a.localDescription.sdp.replace(o.REGEXP_SDP_CANDIDATES,"")),this.ourLocalDescription=new n.RTCSessionDescription({type:a.localDescription.type,sdp:c||a.localDescription.sdp}),this.ourLocalDescription):(this.ourLocalDescription=null,null)}function j(){var a=this;Object.defineProperties(this,{peerConnection:{get:function(){return a.pc}},signalingState:{get:function(){return a.pc.signalingState}},iceConnectionState:{get:function(){return a.pc.iceConnectionState}},iceGatheringState:{get:function(){return a.pc.iceGatheringState}},localDescription:{get:function(){return i.call(a)}},remoteDescription:{get:function(){return a.pc.remoteDescription}},peerIdentity:{get:function(){return a.pc.peerIdentity}}})}b.exports=d;var k=a("merge"),l=a("debug")("rtcninja:RTCPeerConnection"),m=a("debug")("rtcninja:ERROR:RTCPeerConnection"),n=a("./Adapter"),o={REGEXP_NORMALIZED_CANDIDATE:new RegExp(/^candidate:/i),REGEXP_FIX_CANDIDATE:new RegExp(/(^a=|\r|\n)/gi),REGEXP_RELAY_CANDIDATE:new RegExp(/ relay /i),REGEXP_SDP_CANDIDATES:new RegExp(/^a=candidate:.*\r\n/gim),REGEXP_SDP_NON_RELAY_CANDIDATES:new RegExp(/^a=candidate:(.(?!relay ))*\r\n/gim)},p={normalizeCandidate:null};m.log=console.warn.bind(console),d.prototype.createOffer=function(a,b,c){l("createOffer()");var d=this;n.fixRTCOfferOptions(c),this.pc.createOffer(function(b){f.call(d)||(l("createOffer() | success"),a&&a(b))},function(a){f.call(d)||(m("createOffer() | error:",a),b&&b(a))},c)},d.prototype.createAnswer=function(a,b,c){l("createAnswer()");var d=this;this.pc.createAnswer(function(b){f.call(d)||(l("createAnswer() | success"),a&&a(b))},function(a){f.call(d)||(m("createAnswer() | error:",a),b&&b(a))},c)},d.prototype.setLocalDescription=function(a,b,c){function d(){"number"==typeof e.options.gatheringTimeout&&"complete"!==e.pc.iceGatheringState&&(l("setLocalDescription() | ending gathering in %d ms (gatheringTimeout option)",e.options.gatheringTimeout),e.timerGatheringTimeout=setTimeout(function(){f.call(e)||(l("forced end of candidates after gatheringTimeout timeout"),delete e.timerGatheringTimeout,clearTimeout(e.timerGatheringTimeoutAfterRelay),delete e.timerGatheringTimeoutAfterRelay,e.ignoreIceGathering=!0,e.onicecandidate&&e.onicecandidate({candidate:null},null))},e.options.gatheringTimeout))}l("setLocalDescription()");var e=this;this.pc.setLocalDescription(a,function(){f.call(e)||(l("setLocalDescription() | success"),clearTimeout(e.timerGatheringTimeout),delete e.timerGatheringTimeout,clearTimeout(e.timerGatheringTimeoutAfterRelay),delete e.timerGatheringTimeoutAfterRelay,d(),b&&b())},function(a){f.call(e)||(m("setLocalDescription() | error:",a),c&&c(a))}),this.ignoreIceGathering=!1},d.prototype.setRemoteDescription=function(a,b,c){l("setRemoteDescription()");var d=this;this.pc.setRemoteDescription(a,function(){f.call(d)||(l("setRemoteDescription() | success"),b&&b())},function(a){f.call(d)||(m("setRemoteDescription() | error:",a),c&&c(a))})},d.prototype.updateIce=function(a){l("updateIce() | pcConfig: %o",a),e.call(this,a),this.pc.updateIce(this.pcConfig),this.ignoreIceGathering=!1},d.prototype.addIceCandidate=function(a,b,c){l("addIceCandidate() | candidate: %o",a);var d=this;this.pc.addIceCandidate(a,function(){f.call(d)||(l("addIceCandidate() | success"),b&&b())},function(a){f.call(d)||(m("addIceCandidate() | error:",a),c&&c(a))})},d.prototype.getConfiguration=function(){return l("getConfiguration()"),this.pc.getConfiguration()},d.prototype.getLocalStreams=function(){return l("getLocalStreams()"),this.pc.getLocalStreams()},d.prototype.getRemoteStreams=function(){return l("getRemoteStreams()"),this.pc.getRemoteStreams()},d.prototype.getStreamById=function(a){return l("getStreamById() | streamId: %s",a),this.pc.getStreamById(a)},d.prototype.addStream=function(a){l("addStream() | stream: %s",a),this.pc.addStream(a)},d.prototype.removeStream=function(a){l("removeStream() | stream: %o",a),this.pc.removeStream(a)},d.prototype.close=function(){l("close()"),this.closed=!0,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,this.pc.close()},d.prototype.createDataChannel=function(){return l("createDataChannel()"),this.pc.createDataChannel.apply(this.pc,arguments)},d.prototype.createDTMFSender=function(a){return l("createDTMFSender()"),this.pc.createDTMFSender(a)},d.prototype.getStats=function(){return l("getStats()"),this.pc.getStats.apply(this.pc,arguments)},d.prototype.setIdentityProvider=function(){return l("setIdentityProvider()"),this.pc.setIdentityProvider.apply(this.pc,arguments)},d.prototype.getIdentityAssertion=function(){return l("getIdentityAssertion()"),this.pc.getIdentityAssertion()},d.prototype.reset=function(a){l("reset() | pcConfig: %o",a);var b=this.pc;b.onnegotiationneeded=null,b.onicecandidate=null,b.onaddstream=null,b.onremovestream=null,b.ondatachannel=null,b.onsignalingstatechange=null,b.oniceconnectionstatechange=null,b.onicegatheringstatechange=null,b.onidentityresult=null,b.onpeeridentity=null,b.onidpassertionerror=null,b.onidpvalidationerror=null,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,l("reset() | closing current peerConnection"),b.close(),e.call(this,a),h.call(this)}},{"./Adapter":35,debug:32,merge:40}],37:[function(a,b,c){"use strict";function d(a){var b=i(a||{});return k=!0,d.RTCPeerConnection=j,d.getUserMedia=b.getUserMedia,d.RTCSessionDescription=b.RTCSessionDescription,d.RTCIceCandidate=b.RTCIceCandidate,d.MediaStreamTrack=b.MediaStreamTrack,d.getMediaDevices=b.getMediaDevices,d.attachMediaStream=b.attachMediaStream,d.closeMediaStream=b.closeMediaStream,d.canRenegotiate=b.canRenegotiate,b.hasWebRTC()?(f("WebRTC supported"),!0):(g("WebRTC not supported"),!1)}b.exports=d;var e=a("bowser"),f=a("debug")("rtcninja"),g=a("debug")("rtcninja:ERROR"),h=a("./version"),i=a("./Adapter"),j=a("./RTCPeerConnection"),k=!1;g.log=console.warn.bind(console),f("version %s",h),f("detected browser: %s %s [mobile:%s, tablet:%s, android:%s, ios:%s]",e.name,e.version,!!e.mobile,!!e.tablet,!!e.android,!!e.ios),d.hasWebRTC=function(){return k||d(),i.hasWebRTC()},Object.defineProperty(d,"version",{get:function(){return h}}),Object.defineProperty(d,"called",{get:function(){return k}}),d.debug=a("debug"),d.browser=e},{"./Adapter":35,"./RTCPeerConnection":36,"./version":38,bowser:39,debug:32}],38:[function(a,b,c){"use strict";b.exports=a("../package.json").version},{"../package.json":41}],39:[function(b,c,d){!function(b,d){"undefined"!=typeof c&&c.exports?c.exports=d():"function"==typeof a&&a.amd?a(d):this[b]=d()}("bowser",function(){function a(a){function c(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function d(b){var c=a.match(b);return c&&c.length>1&&c[2]||""}var e,f=c(/(ipod|iphone|ipad)/i).toLowerCase(),g=/like android/i.test(a),h=!g&&/android/i.test(a),i=/CrOS/.test(a),j=c(/edge\/(\d+(\.\d+)?)/i),k=c(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(a),m=!l&&/[^-]mobi/i.test(a);/opera|opr/i.test(a)?e={name:"Opera",opera:b,version:k||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(a)?e={name:"Yandex Browser",yandexbrowser:b,version:k||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(a)?(e={name:"Windows Phone",windowsphone:b},j?(e.msedge=b,e.version=j):(e.msie=b,e.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(a)?e={name:"Internet Explorer",msie:b,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:i?e={name:"Chrome",chromeBook:b,chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(a)?e={name:"Microsoft Edge",msedge:b,version:j}:/chrome|crios|crmo/i.test(a)?e={name:"Chrome",chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:f?(e={name:"iphone"==f?"iPhone":"ipad"==f?"iPad":"iPod"},k&&(e.version=k)):/sailfish/i.test(a)?e={name:"Sailfish",sailfish:b,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?e={name:"SeaMonkey",seamonkey:b,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(a)?(e={name:"Firefox",firefox:b,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(e.firefoxos=b)):/silk/i.test(a)?e={name:"Amazon Silk",silk:b,version:c(/silk\/(\d+(\.\d+)?)/i)}:h?e={name:"Android",version:k}:/phantom/i.test(a)?e={name:"PhantomJS",phantom:b,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?e={name:"BlackBerry",blackberry:b,version:k||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(a)?(e={name:"WebOS",webos:b,version:k||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(e.touchpad=b)):e=/bada/i.test(a)?{name:"Bada",bada:b,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(a)?{name:"Tizen",tizen:b,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||k}:/safari/i.test(a)?{name:"Safari",safari:b,version:k}:{name:c(/^(.*)\/(.*) /),version:d(/^(.*)\/(.*) /)},!e.msedge&&/(apple)?webkit/i.test(a)?(e.name=e.name||"Webkit",e.webkit=b,!e.version&&k&&(e.version=k)):!e.opera&&/gecko\//i.test(a)&&(e.name=e.name||"Gecko",e.gecko=b,e.version=e.version||c(/gecko\/(\d+(\.\d+)?)/i)),e.msedge||!h&&!e.silk?f&&(e[f]=b,e.ios=b):e.android=b;var n="";e.windowsphone?n=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):f?(n=c(/os (\d+([_\s]\d+)*) like mac os x/i),n=n.replace(/[_\s]/g,".")):h?n=c(/android[ \/-](\d+(\.\d+)*)/i):e.webos?n=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):e.blackberry?n=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):e.bada?n=c(/bada\/(\d+(\.\d+)*)/i):e.tizen&&(n=c(/tizen[\/\s](\d+(\.\d+)*)/i)),n&&(e.osversion=n);var o=n.split(".")[0];return l||"ipad"==f||h&&(3==o||4==o&&!m)||e.silk?e.tablet=b:(m||"iphone"==f||"ipod"==f||h||e.blackberry||e.webos||e.bada)&&(e.mobile=b),e.msedge||e.msie&&e.version>=10||e.yandexbrowser&&e.version>=15||e.chrome&&e.version>=20||e.firefox&&e.version>=20||e.safari&&e.version>=6||e.opera&&e.version>=10||e.ios&&e.osversion&&e.osversion.split(".")[0]>=6||e.blackberry&&e.version>=10.1?e.a=b:e.msie&&e.version<10||e.chrome&&e.version<20||e.firefox&&e.version<20||e.safari&&e.version<6||e.opera&&e.version<10||e.ios&&e.osversion&&e.osversion.split(".")[0]<6?e.c=b:e.x=b,e}var b=!0,c=a("undefined"!=typeof navigator?navigator.userAgent:"");return c.test=function(a){for(var b=0;b<a.length;++b){var d=a[b];if("string"==typeof d&&d in c)return!0}return!1},c._detect=a,c})},{}],40:[function(a,b,c){!function(a){function c(a,b){if("object"!==e(a))return b;for(var d in b)"object"===e(a[d])&&"object"===e(b[d])?a[d]=c(a[d],b[d]):a[d]=b[d];return a}function d(a,b,d){var g=d[0],h=d.length;(a||"object"!==e(g))&&(g={});for(var i=0;i<h;++i){var j=d[i],k=e(j);if("object"===k)for(var l in j){var m=a?f.clone(j[l]):j[l];b?g[l]=c(g[l],m):g[l]=m}}return g}function e(a){return{}.toString.call(a).slice(8,-1).toLowerCase()}var f=function(a){return d(a===!0,!1,arguments)},g="merge";f.recursive=function(a){return d(a===!0,!0,arguments)},f.clone=function(a){var b,c,d=a,g=e(a);if("array"===g)for(d=[],c=a.length,b=0;b<c;++b)d[b]=f.clone(a[b]);else if("object"===g){d={};for(b in a)d[b]=f.clone(a[b])}return d},a?b.exports=f:window[g]=f}("object"==typeof b&&b&&"object"==typeof b.exports&&b.exports)},{}],41:[function(a,b,c){b.exports={name:"rtcninja",version:"0.6.4",description:"WebRTC API wrapper to deal with different browsers",author:{name:"Iñaki Baz Castillo",email:"inaki.baz@eface2face.com",url:"http://eface2face.com"},contributors:[{name:"Jesús Pérez",email:"jesus.perez@eface2face.com"}],license:"MIT",main:"lib/rtcninja.js",homepage:"https://github.com/eface2face/rtcninja.js",repository:{type:"git",url:"https://github.com/eface2face/rtcninja.js.git"},keywords:["webrtc"],engines:{node:">=0.10.32"},dependencies:{bowser:"^1.0.0",debug:"^2.2.0",merge:"^1.2.0"},devDependencies:{browserify:"^11.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.7.1","gulp-jscs":"^2.0.0","gulp-jscs-stylish":"^1.1.2","gulp-jshint":"^1.11.2","gulp-rename":"^1.2.2","gulp-uglify":"^1.4.0","jshint-stylish":"^2.0.1",retire:"^1.1.1",shelljs:"^0.5.3","vinyl-source-stream":"^1.1.0"},gitHead:"18789cbefdb5a6c6c038ab4f1ce8e9e3813135b0",bugs:{url:"https://github.com/eface2face/rtcninja.js/issues"},_id:"rtcninja@0.6.4",scripts:{},_shasum:"7ede8577ce978cb431772d877967c53aadeb5e99",_from:"rtcninja@^0.6.4",_npmVersion:"2.5.1",_nodeVersion:"0.12.0",_npmUser:{name:"ibc",email:"ibc@aliax.net"},dist:{shasum:"7ede8577ce978cb431772d877967c53aadeb5e99",tarball:"http://registry.npmjs.org/rtcninja/-/rtcninja-0.6.4.tgz"},maintainers:[{name:"ibc",email:"ibc@aliax.net"}],directories:{},_resolved:"https://registry.npmjs.org/rtcninja/-/rtcninja-0.6.4.tgz",readme:"ERROR: No README data found!"}},{}],42:[function(a,b,c){var d=b.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: tcptype (\S*))?(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","tcptype","raddr","rport","generation"],format:function(a){var b="candidate:%s %d %s %d %s %d typ %s";return b+=null!=a.tcptype?" tcptype %s":"%v",b+=null!=a.raddr?" raddr %s rport %d":"%v%v",null!=a.generation&&(b+=" generation %d"),b}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{push:"invalid",names:["value"]}]};Object.keys(d).forEach(function(a){var b=d[a];b.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})})},{}],43:[function(a,b,c){var d=a("./parser"),e=a("./writer");c.write=e,c.parse=d.parse,c.parseFmtpConfig=d.parseFmtpConfig,c.parsePayloads=d.parsePayloads,c.parseRemoteCandidates=d.parseRemoteCandidates},{"./parser":44,"./writer":45}],44:[function(a,b,c){var d=function(a){return String(Number(a))===a?Number(a):a},e=function(a,b,c,e){if(e&&!c)b[e]=d(a[1]);else for(var f=0;f<c.length;f+=1)null!=a[f+1]&&(b[c[f]]=d(a[f+1]))},f=function(a,b,c){var d=a.name&&a.names;a.push&&!b[a.push]?b[a.push]=[]:d&&!b[a.name]&&(b[a.name]={});var f=a.push?{}:d?b[a.name]:b;e(c.match(a.reg),f,a.names,a.name),a.push&&b[a.push].push(f)},g=a("./grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(a){var b={},c=[],d=b;return a.split(/(\r\n|\r|\n)/).filter(h).forEach(function(a){var b=a[0],e=a.slice(2);"m"===b&&(c.push({rtp:[],fmtp:[]}),d=c[c.length-1]);for(var h=0;h<(g[b]||[]).length;h+=1){var i=g[b][h];if(i.reg.test(e))return f(i,d,e)}}),b.media=c,b};var i=function(a,b){var c=b.split("=");return 2===c.length&&(a[c[0]]=d(c[1])),a};c.parseFmtpConfig=function(a){return a.split(/\;\s?/).reduce(i,{})},c.parsePayloads=function(a){return a.split(" ").map(Number)},c.parseRemoteCandidates=function(a){for(var b=[],c=a.split(" ").map(d),e=0;e<c.length;e+=3)b.push({component:c[e],ip:c[e+1],port:c[e+2]});return b}},{"./grammar":42}],45:[function(a,b,c){var d=a("./grammar"),e=/%[sdv%]/g,f=function(a){var b=1,c=arguments,d=c.length;return a.replace(e,function(a){if(b>=d)return a;var e=c[b];switch(b+=1,a){case"%%":return"%";case"%s":return String(e);case"%d":return Number(e);case"%v":return""}})},g=function(a,b,c){var d=b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format,e=[a+"="+d];if(b.names)for(var g=0;g<b.names.length;g+=1){var h=b.names[g];b.name?e.push(c[b.name][h]):e.push(c[b.names[g]])}else e.push(c[b.name]);return f.apply(null,e)},h=["v","o","s","i","u","e","p","c","b","t","r","z","a"],i=["i","c","b","a"];b.exports=function(a,b){b=b||{},null==a.version&&(a.version=0),null==a.name&&(a.name=" "),a.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var c=b.outerOrder||h,e=b.innerOrder||i,f=[];return c.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})}),a.media.forEach(function(a){f.push(g("m",d.m[0],a)),e.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})})}),f.join("\r\n")+"\r\n"}},{"./grammar":42}],46:[function(a,b,c){function d(a,b){var c;return c=b?new f(a,b):new f(a)}var e=function(){return this}(),f=e.WebSocket||e.MozWebSocket,g=a("./version");b.exports={w3cwebsocket:f?d:null,version:g}},{"./version":47}],47:[function(a,b,c){b.exports=a("../package.json").version},{"../package.json":48}],48:[function(a,b,c){b.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],version:"1.0.22",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=0.8.0"},dependencies:{debug:"~2.2.0",nan:"~2.0.5","typedarray-to-buffer":"~3.0.3",yaeti:"~0.0.4"},devDependencies:{"buffer-equal":"^0.0.1",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.11.2","jshint-stylish":"^1.0.2",tape:"^4.0.1"},config:{verbose:!1},scripts:{install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0",gitHead:"19108bbfd7d94a5cd02dbff3495eafee9e901ca4",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},_id:"websocket@1.0.22",_shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",_from:"websocket@^1.0.22",_npmVersion:"2.14.3",_nodeVersion:"3.3.1",_npmUser:{name:"theturtle32",email:"brian@worlize.com"},maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],dist:{shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",tarball:"http://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz"},_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz",readme:"ERROR: No README data found!"}},{}],49:[function(a,b,c){b.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"0.7.9",homepage:"http://jssip.net",author:"José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iñaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Saúl Ibarra Corretgé <saghul@gmail.com> (https://github.com/saghul)"],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.2.0",rtcninja:"^0.6.4","sdp-transform":"~1.5.0",websocket:"^1.0.22"},devDependencies:{browserify:"^11.2.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-header":"^1.7.1","gulp-jshint":"^1.11.2","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^1.4.2","gulp-util":"^3.0.6","jshint-stylish":"^2.0.1",pegjs:"0.7.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"}}},{}]},{},[7])(7)}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.io=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":2}],2:[function(a,b,c){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(a,b,c){(function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);b=b||{},a&&"object"==typeof a&&(b=a,a=null),a?(a=k(a),b.hostname=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)):b.host&&(b.hostname=k(b.host).host),this.secure=null!=b.secure?b.secure:c.location&&"https:"==location.protocol,b.hostname&&!b.port&&(b.port=this.secure?"443":"80"),this.agent=b.agent||!1,this.hostname=b.hostname||(c.location?location.hostname:"localhost"),this.port=b.port||(c.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=m.decode(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.jsonp=!1!==b.jsonp,this.forceBase64=!!b.forceBase64,this.enablesXDR=!!b.enablesXDR,this.timestampParam=b.timestampParam||"t",this.timestampRequests=b.timestampRequests,this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=b.policyPort||843,this.rememberUpgrade=b.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=b.onlyBinaryUpgrades,this.perMessageDeflate=!1!==b.perMessageDeflate&&(b.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=b.pfx||null,this.key=b.key||null,this.passphrase=b.passphrase||null,this.cert=b.cert||null,this.ca=b.ca||null,this.ciphers=b.ciphers||null,this.rejectUnauthorized=void 0===b.rejectUnauthorized?null:b.rejectUnauthorized;var e="object"==typeof c&&c;e.global===e&&b.extraHeaders&&Object.keys(b.extraHeaders).length>0&&(this.extraHeaders=b.extraHeaders),this.open()}function e(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var f=a("./transports"),g=a("component-emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser"),k=a("parseuri"),l=a("parsejson"),m=a("parseqs");b.exports=d,d.priorWebsocketSuccess=!1,g(d.prototype),d.protocol=j.protocol,d.Socket=d,d.Transport=a("./transport"),d.transports=a("./transports"),d.parser=a("engine.io-parser"),d.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=e(this.query);b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id);var c=new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return c},d.prototype.open=function(){var a;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1)a="websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(c){return this.transports.shift(),void this.open()}a.open(),this.setTransport(a)},d.prototype.setTransport=function(a){h("setting transport %s",a.name);var b=this;this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},d.prototype.probe=function(a){function b(){if(m.onlyBinaryUpgrades){var b=!this.supportsBinary&&m.transport.supportsBinary;l=l||b}l||(h('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!l)if("pong"==b.type&&"probe"==b.data){if(h('probe transport "%s" pong',a),m.upgrading=!0,m.emit("upgrading",k),!k)return;d.priorWebsocketSuccess="websocket"==k.name,h('pausing current transport "%s"',m.transport.name),m.transport.pause(function(){l||"closed"!=m.readyState&&(h("changing transport and sending upgrade packet"),j(),m.setTransport(k),k.send([{type:"upgrade"}]),m.emit("upgrade",k),k=null,m.upgrading=!1,m.flush())})}else{h('probe transport "%s" failed',a);var c=new Error("probe error");c.transport=k.name,m.emit("upgradeError",c)}}))}function c(){l||(l=!0,j(),k.close(),k=null)}function e(b){var d=new Error("probe error: "+b);d.transport=k.name,c(),h('probe transport "%s" failed because of error: %s',a,b),m.emit("upgradeError",d)}function f(){e("transport closed")}function g(){e("socket closed")}function i(a){k&&a.name!=k.name&&(h('"%s" works - aborting "%s"',a.name,k.name),c())}function j(){k.removeListener("open",b),k.removeListener("error",e),k.removeListener("close",f),m.removeListener("close",g),m.removeListener("upgrading",i)}h('probing transport "%s"',a);
var k=this.createTransport(a,{probe:1}),l=!1,m=this;d.priorWebsocketSuccess=!1,k.once("open",b),k.once("error",e),k.once("close",f),this.once("close",g),this.once("upgrading",i),k.open()},d.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}},d.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(l(a.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var b=new Error("server error");b.code=a.data,this.onError(b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else h('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},d.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})},d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this},d.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=c,c=null),"closing"!=this.readyState&&"closed"!=this.readyState){c=c||{},c.compress=!1!==c.compress;var e={type:a,data:b,options:c};this.emit("packetCreate",e),this.writeBuffer.push(e),d&&this.once("flush",d),this.flush()}},d.prototype.close=function(){function a(){d.onClose("forced close"),h("socket closing - telling transport to close"),d.transport.close()}function b(){d.removeListener("upgrade",b),d.removeListener("upgradeError",b),a()}function c(){d.once("upgrade",b),d.once("upgradeError",b)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this},d.prototype.onError=function(a){h("socket error %j",a),d.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},d.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),c.writeBuffer=[],c.prevBufferLen=0}},d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(a,b,c){function d(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.extraHeaders=a.extraHeaders}var e=a("engine.io-parser"),f=a("component-emitter");b.exports=d,f(d.prototype),d.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},d.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},d.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},d.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},d.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},d.prototype.onData=function(a){var b=e.decodePacket(a,this.socket.binaryType);this.onPacket(b)},d.prototype.onPacket=function(a){this.emit("packet",a)},d.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(a,b,c){(function(b){function d(a){var c,d=!1,h=!1,i=!1!==a.jsonp;if(b.location){var j="https:"==location.protocol,k=location.port;k||(k=j?443:80),d=a.hostname!=location.hostname||k!=a.port,h=a.secure!=j}if(a.xdomain=d,a.xscheme=h,c=new e(a),"open"in c&&!a.forceJSONP)return new f(a);if(!i)throw new Error("JSONP disabled");return new g(a)}var e=a("xmlhttprequest-ssl"),f=a("./polling-xhr"),g=a("./polling-jsonp"),h=a("./websocket");c.polling=d,c.websocket=h}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(a,b,c){(function(c){function d(){}function e(a){f.call(this,a),this.query=this.query||{},h||(c.___eio||(c.___eio=[]),h=c.___eio),this.index=h.length;var b=this;h.push(function(a){b.onData(a)}),this.query.j=this.index,c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=d)},!1)}var f=a("./polling"),g=a("component-inherit");b.exports=e;var h,i=/\n/g,j=/\\n/g;g(e,f),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),f.prototype.doClose.call(this)},e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b),this.script=b;var d="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);d&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},e.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var b='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(b)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),h=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=k,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.uri(),d(),a=a.replace(j,"\\\n"),this.area.value=a.replace(i,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-inherit":16}],7:[function(a,b,c){(function(c){function d(){}function e(a){if(i.call(this,a),c.location){var b="https:"==location.protocol,d=location.port;d||(d=b?443:80),this.xd=a.hostname!=c.location.hostname||d!=a.port,this.xs=a.secure!=b}else this.extraHeaders=a.extraHeaders}function f(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.xs=!!a.xs,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.isBinary=a.isBinary,this.supportsBinary=a.supportsBinary,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.extraHeaders=a.extraHeaders,this.create()}function g(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var h=a("xmlhttprequest-ssl"),i=a("./polling"),j=a("component-emitter"),k=a("component-inherit"),l=a("debug")("engine.io-client:polling-xhr");b.exports=e,b.exports.Request=f,k(e,i),e.prototype.supportsBinary=!0,e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.extraHeaders=this.extraHeaders,new f(a)},e.prototype.doWrite=function(a,b){var c="string"!=typeof a&&void 0!==a,d=this.request({method:"POST",data:a,isBinary:c}),e=this;d.on("success",b),d.on("error",function(a){e.onError("xhr post error",a)}),this.sendXhr=d},e.prototype.doPoll=function(){l("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},j(f.prototype),f.prototype.create=function(){var a={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new h(a),d=this;try{l("xhr open %s: %s",this.method,this.uri),b.open(this.method,this.uri,this.async);try{if(this.extraHeaders){b.setDisableHeaderCheck(!0);for(var e in this.extraHeaders)this.extraHeaders.hasOwnProperty(e)&&b.setRequestHeader(e,this.extraHeaders[e])}}catch(g){}if(this.supportsBinary&&(b.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(g){}"withCredentials"in b&&(b.withCredentials=!0),this.hasXDR()?(b.onload=function(){d.onLoad()},b.onerror=function(){d.onError(b.responseText)}):b.onreadystatechange=function(){4==b.readyState&&(200==b.status||1223==b.status?d.onLoad():setTimeout(function(){d.onError(b.status)},0))},l("xhr data %s",this.data),b.send(this.data)}catch(g){return void setTimeout(function(){d.onError(g)},0)}c.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},f.prototype.onError=function(a){this.emit("error",a),this.cleanup(!0)},f.prototype.cleanup=function(a){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,a)try{this.xhr.abort()}catch(b){}c.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var a;try{var b;try{b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(c){}if("application/octet-stream"===b)a=this.xhr.response;else if(this.supportsBinary)try{a=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(c){for(var d=new Uint8Array(this.xhr.response),e=[],f=0,g=d.length;f<g;f++)e.push(d[f]);a=String.fromCharCode.apply(null,e)}else a=this.xhr.responseText}catch(c){this.onError(c)}null!=a&&this.onData(a)},f.prototype.hasXDR=function(){return"undefined"!=typeof c.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},c.document&&(f.requestsCount=0,f.requests={},c.attachEvent?c.attachEvent("onunload",g):c.addEventListener&&c.addEventListener("beforeunload",g,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(a,b,c){function d(a){var b=a&&a.forceBase64;k&&!b||(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("parseqs"),g=a("engine.io-parser"),h=a("component-inherit"),i=a("yeast"),j=a("debug")("engine.io-client:polling");b.exports=d;var k=function(){var b=a("xmlhttprequest-ssl"),c=new b({xdomain:!1});return null!=c.responseType}();h(d,e),d.prototype.name="polling",d.prototype.doOpen=function(){this.poll()},d.prototype.pause=function(a){function b(){j("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(j("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){j("pre-pause polling complete"),--d||b()})),this.writable||(j("we are currently writing - waiting to pause"),d++,this.once("drain",function(){j("pre-pause writing complete"),--d||b()}))}else b()},d.prototype.poll=function(){j("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},d.prototype.onData=function(a){var b=this;j("polling got data %s",a);var c=function(a,c,d){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)};g.decodePayload(a,this.socket.binaryType,c),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():j('ignoring poll - transport state "%s"',this.readyState))},d.prototype.doClose=function(){function a(){j("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(j("transport open - closing"),a()):(j("transport not open - deferring close"),this.once("open",a))},d.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;g.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=i()),this.supportsBinary||a.sid||(a.b64=1),a=f.encode(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a);var d=this.hostname.indexOf(":")!==-1;return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(a,b,c){(function(c){function d(a){var b=a&&a.forceBase64;b&&(this.supportsBinary=!1),this.perMessageDeflate=a.perMessageDeflate,e.call(this,a)}var e=a("../transport"),f=a("engine.io-parser"),g=a("parseqs"),h=a("component-inherit"),i=a("yeast"),j=a("debug")("engine.io-client:websocket"),k=c.WebSocket||c.MozWebSocket,l=k;if(!l&&"undefined"==typeof window)try{l=a("ws")}catch(m){}b.exports=d,h(d,e),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=void 0,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx,c.key=this.key,c.passphrase=this.passphrase,c.cert=this.cert,c.ca=this.ca,c.ciphers=this.ciphers,c.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(c.headers=this.extraHeaders),this.ws=k?new l(a):new l(a,b,c),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(a){var b=this;setTimeout(function(){e.prototype.onData.call(b,a)},0)}),d.prototype.write=function(a){function b(){d.emit("flush"),setTimeout(function(){d.writable=!0,d.emit("drain")},0)}var d=this;this.writable=!1;for(var e=a.length,g=0,h=e;g<h;g++)!function(a){f.encodePacket(a,d.supportsBinary,function(f){if(!k){var g={};if(a.options&&(g.compress=a.options.compress),d.perMessageDeflate){var h="string"==typeof f?c.Buffer.byteLength(f):f.length;h<d.perMessageDeflate.threshold&&(g.compress=!1)}}try{k?d.ws.send(f):d.ws.send(f,g)}catch(i){j("websocket closed before onclose event")}--e||b()})}(a[g])},d.prototype.onClose=function(){e.prototype.onClose.call(this)},d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=i()),this.supportsBinary||(a.b64=1),a=g.encode(a),a.length&&(a="?"+a);var d=this.hostname.indexOf(":")!==-1;return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a},d.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===d.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(a,b,c){var d=a("has-cors");b.exports=function(a){var b=a.xdomain,c=a.xscheme,e=a.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||d))return new XMLHttpRequest}catch(f){}try{if("undefined"!=typeof XDomainRequest&&!c&&e)return new XDomainRequest}catch(f){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}},{"has-cors":22}],11:[function(a,b,c){function d(a,b,c){function d(a,e){if(d.count<=0)throw new Error("after called too many times");--d.count,a?(f=!0,b(a),b=c):0!==d.count||f||b(null,e)}var f=!1;return c=c||e,d.count=a,0===a?b():d}function e(){}b.exports=d},{}],12:[function(a,b,c){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,a.slice)return a.slice(b,c);if(b<0&&(b+=d),c<0&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);for(var e=new Uint8Array(a),f=new Uint8Array(c-b),g=b,h=0;g<c;g++,h++)f[h]=e[g];return f.buffer}},{}],13:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;c<e;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;c<i;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(a,b,c){(function(a){function c(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength)),d=e.buffer}a[b]=d}}}function d(a,b){b=b||{};var d=new f;c(a);for(var e=0;e<a.length;e++)d.append(a[e]);return b.type?d.getBlob(b.type):d.getBlob()}function e(a,b){return c(a),new Blob(a,b||{})}var f=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder,g=function(){try{var a=new Blob(["hi"]);return 2===a.size}catch(b){return!1}}(),h=g&&function(){try{var a=new Blob([new Uint8Array([1,2])]);return 2===a.size}catch(b){return!1}}(),i=f&&f.prototype.append&&f.prototype.getBlob;b.exports=function(){return g?h?a.Blob:e:i?d:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],15:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],16:[function(a,b,c){b.exports=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],17:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":18}],18:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:25}],19:[function(a,b,c){(function(b){function d(a,b){var d="b"+c.packets[a.type]+a.data.data;return b(d)}function e(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=a.data,f=new Uint8Array(e),g=new Uint8Array(1+e.byteLength);g[0]=r[a.type];for(var h=0;h<f.length;h++)g[h+1]=f[h];return d(g.buffer)}function f(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=new FileReader;return e.onload=function(){a.data=e.result,c.encodePacket(a,b,!0,d)},e.readAsArrayBuffer(a.data)}function g(a,b,d){if(!b)return c.encodeBase64Packet(a,d);if(q)return f(a,b,d);var e=new Uint8Array(1);e[0]=r[a.type];var g=new u([e.buffer,a.data]);return d(g)}function h(a,b,c){for(var d=new Array(a.length),e=m(a.length,c),f=function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})},g=0;g<a.length;g++)f(g,a[g],e)}var i=a("./keys"),j=a("has-binary"),k=a("arraybuffer.slice"),l=a("base64-arraybuffer"),m=a("after"),n=a("utf8"),o=navigator.userAgent.match(/Android/i),p=/PhantomJS/i.test(navigator.userAgent),q=o||p;c.protocol=3;var r=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=i(r),t={type:"error",data:"parser error"},u=a("blob");c.encodePacket=function(a,c,f,h){"function"==typeof c&&(h=c,c=!1),"function"==typeof f&&(h=f,f=null);var i=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&i instanceof ArrayBuffer)return e(a,c,h);if(u&&i instanceof b.Blob)return g(a,c,h);if(i&&i.base64)return d(a,h);var j=r[a.type];return void 0!==a.data&&(j+=f?n.encode(String(a.data)):String(a.data)),h(""+j)},c.encodeBase64Packet=function(a,d){var e="b"+c.packets[a.type];if(u&&a.data instanceof b.Blob){var f=new FileReader;return f.onload=function(){var a=f.result.split(",")[1];d(e+a)},f.readAsDataURL(a.data)}var g;try{g=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(h){for(var i=new Uint8Array(a.data),j=new Array(i.length),k=0;k<i.length;k++)j[k]=i[k];g=String.fromCharCode.apply(null,j)}return e+=b.btoa(g),d(e)},c.decodePacket=function(a,b,d){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return c.decodeBase64Packet(a.substr(1),b);if(d)try{a=n.decode(a)}catch(e){return t}var f=a.charAt(0);return Number(f)==f&&s[f]?a.length>1?{type:s[f],data:a.substring(1)}:{type:s[f]}:t}var g=new Uint8Array(a),f=g[0],h=k(a,1);return u&&"blob"===b&&(h=new u([h])),{type:s[f],data:h}},c.decodeBase64Packet=function(a,c){var d=s[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var e=l.decode(a.substr(1));return"blob"===c&&u&&(e=new u([e])),{type:d,data:e}},c.encodePayload=function(a,b,d){function e(a){return a.length+":"+a}function f(a,d){c.encodePacket(a,!!g&&b,!0,function(a){d(null,e(a))})}"function"==typeof b&&(d=b,b=null);var g=j(a);return b&&g?u&&!q?c.encodePayloadAsBlob(a,d):c.encodePayloadAsArrayBuffer(a,d):a.length?void h(a,f,function(a,b){return d(b.join(""))}):d("0:")},c.decodePayload=function(a,b,d){if("string"!=typeof a)return c.decodePayloadAsBinary(a,b,d);"function"==typeof b&&(d=b,b=null);var e;if(""==a)return d(t,0,1);for(var f,g,h="",i=0,j=a.length;i<j;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(f=Number(h)))return d(t,0,1);if(g=a.substr(i+1,f),h!=g.length)return d(t,0,1);if(g.length){if(e=c.decodePacket(g,b,!0),t.type==e.type&&t.data==e.data)return d(t,0,1);var l=d(e,i+f,j);if(!1===l)return}i+=f,h=""}}return""!=h?d(t,0,1):void 0},c.encodePayloadAsArrayBuffer=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){return b(null,a)})}return a.length?void h(a,d,function(a,c){var d=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var d=new Uint8Array(a.length),g=0;g<a.length;g++)d[g]=a.charCodeAt(g);c=d.buffer}b?e[f++]=0:e[f++]=1;for(var h=c.byteLength.toString(),g=0;g<h.length;g++)e[f++]=parseInt(h[g]);e[f++]=255;for(var d=new Uint8Array(c),g=0;g<d.length;g++)e[f++]=d[g]}),b(e.buffer)}):b(new ArrayBuffer(0))},c.encodePayloadAsBlob=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var f=a instanceof ArrayBuffer?a.byteLength:a.size,g=f.toString(),h=new Uint8Array(g.length+1),e=0;e<g.length;e++)h[e]=parseInt(g[e]);if(h[g.length]=255,u){var i=new u([c.buffer,h.buffer,a]);b(null,i)}})}h(a,d,function(a,c){return b(new u(c))})},c.decodePayloadAsBinary=function(a,b,d){"function"==typeof b&&(d=b,b=null);for(var e=a,f=[],g=!1;e.byteLength>0;){for(var h=new Uint8Array(e),i=0===h[0],j="",l=1;255!=h[l];l++){if(j.length>310){g=!0;break}j+=h[l]}if(g)return d(t,0,1);e=k(e,2+j.length),j=parseInt(j);var m=k(e,0,j);if(i)try{m=String.fromCharCode.apply(null,new Uint8Array(m))}catch(n){var o=new Uint8Array(m);m="";for(var l=0;l<o.length;l++)m+=String.fromCharCode(o[l])}f.push(m),e=k(e,j)}var p=f.length;f.forEach(function(a,e){d(c.decodePacket(a,b,!0),e,p)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(a,b,c){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],21:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:24}],22:[function(a,b,c){try{b.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(d){b.exports=!1}},{}],23:[function(a,b,c){var d=[].indexOf;b.exports=function(a,b){if(d)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},{}],24:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],25:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms";
}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],26:[function(a,b,c){(function(a){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,f=/(?:^|:|,)(?:\s*\[)+/g,g=/^\s+/,h=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(g,"").replace(h,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(d,"@").replace(e,"]").replace(f,""))?new Function("return "+b)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],27:[function(a,b,c){c.encode=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.decode=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;d<e;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],28:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){var b=a,c=a.indexOf("["),f=a.indexOf("]");c!=-1&&f!=-1&&(a=a.substring(0,c)+a.substring(c,f).replace(/:/g,";")+a.substring(f,a.length));for(var g=d.exec(a||""),h={},i=14;i--;)h[e[i]]=g[i]||"";return c!=-1&&f!=-1&&(h.source=b,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h}},{}],29:[function(b,c,d){(function(b){!function(e){function f(a){for(var b,c,d=[],e=0,f=a.length;e<f;)b=a.charCodeAt(e++),b>=55296&&b<=56319&&e<f?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function g(a){for(var b,c=a.length,d=-1,e="";++d<c;)b=a[d],b>65535&&(b-=65536,e+=u(b>>>10&1023|55296),b=56320|1023&b),e+=u(b);return e}function h(a){if(a>=55296&&a<=57343)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value")}function i(a,b){return u(a>>b&63|128)}function j(a){if(0==(4294967168&a))return u(a);var b="";return 0==(4294965248&a)?b=u(a>>6&31|192):0==(4294901760&a)?(h(a),b=u(a>>12&15|224),b+=i(a,6)):0==(4292870144&a)&&(b=u(a>>18&7|240),b+=i(a,12),b+=i(a,6)),b+=u(63&a|128)}function k(a){for(var b,c=f(a),d=c.length,e=-1,g="";++e<d;)b=c[e],g+=j(b);return g}function l(){if(t>=s)throw Error("Invalid byte index");var a=255&r[t];if(t++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function m(){var a,b,c,d,e;if(t>s)throw Error("Invalid byte index");if(t==s)return!1;if(a=255&r[t],t++,0==(128&a))return a;if(192==(224&a)){var b=l();if(e=(31&a)<<6|b,e>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=l(),c=l(),e=(15&a)<<12|b<<6|c,e>=2048)return h(e),e;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=l(),c=l(),d=l(),e=(15&a)<<18|b<<12|c<<6|d,e>=65536&&e<=1114111))return e;throw Error("Invalid UTF-8 detected")}function n(a){r=f(a),s=r.length,t=0;for(var b,c=[];(b=m())!==!1;)c.push(b);return g(c)}var o="object"==typeof d&&d,p="object"==typeof c&&c&&c.exports==o&&c,q="object"==typeof b&&b;q.global!==q&&q.window!==q||(e=q);var r,s,t,u=String.fromCharCode,v={version:"2.0.0",encode:k,decode:n};if("function"==typeof a&&"object"==typeof a.amd&&a.amd)a(function(){return v});else if(o&&!o.nodeType)if(p)p.exports=v;else{var w={},x=w.hasOwnProperty;for(var y in v)x.call(v,y)&&(o[y]=v[y])}else e.utf8=v}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],30:[function(a,b,c){"use strict";function d(a){var b="";do b=h[a%i]+b,a=Math.floor(a/i);while(a>0);return b}function e(a){var b=0;for(l=0;l<a.length;l++)b=b*i+j[a.charAt(l)];return b}function f(){var a=d(+new Date);return a!==g?(k=0,g=a):a+"."+d(k++)}for(var g,h="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,j={},k=0,l=0;l<i;l++)j[h[l]]=l;f.encode=d,f.decode=e,b.exports=f},{}],31:[function(a,b,c){function d(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d=e(a),f=d.source,j=d.id,k=d.path,l=i[j]&&k in i[j].nsps,m=b.forceNew||b["force new connection"]||!1===b.multiplex||l;return m?(h("ignoring socket cache for %s",f),c=g(f,b)):(i[j]||(h("new io instance for %s",f),i[j]=g(f,b)),c=i[j]),c.socket(d.path)}var e=a("./url"),f=a("socket.io-parser"),g=a("./manager"),h=a("debug")("socket.io-client");b.exports=c=d;var i=c.managers={};c.protocol=f.protocol,c.connect=d,c.Manager=a("./manager"),c.Socket=a("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(a,b,c){function d(a,b){return this instanceof d?(a&&"object"==typeof a&&(b=a,a=void 0),b=b||{},b.path=b.path||"/socket.io",this.nsps={},this.subs=[],this.opts=b,this.reconnection(b.reconnection!==!1),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor(b.randomizationFactor||.5),this.backoff=new m({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==b.timeout?2e4:b.timeout),this.readyState="closed",this.uri=a,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new h.Encoder,this.decoder=new h.Decoder,this.autoConnect=b.autoConnect!==!1,void(this.autoConnect&&this.open())):new d(a,b)}var e=a("engine.io-client"),f=a("./socket"),g=a("component-emitter"),h=a("socket.io-parser"),i=a("./on"),j=a("component-bind"),k=a("debug")("socket.io-client:manager"),l=a("indexof"),m=a("backo2"),n=Object.prototype.hasOwnProperty;b.exports=d,d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)n.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)},d.prototype.updateSocketIds=function(){for(var a in this.nsps)n.call(this.nsps,a)&&(this.nsps[a].id=this.engine.id)},g(d.prototype),d.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection},d.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax},d.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(a){if(k("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;k("opening %s",this.uri),this.engine=e(this.uri,this.opts);var b=this.engine,c=this;this.readyState="opening",this.skipReconnect=!1;var d=i(b,"open",function(){c.onopen(),a&&a()}),f=i(b,"error",function(b){if(k("connect_error"),c.cleanup(),c.readyState="closed",c.emitAll("connect_error",b),a){var d=new Error("Connection error");d.data=b,a(d)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var g=this._timeout;k("connect attempt will timeout after %d",g);var h=setTimeout(function(){k("connect attempt timed out after %d",g),d.destroy(),b.close(),b.emit("error","timeout"),c.emitAll("connect_timeout",g)},g);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(d),this.subs.push(f),this},d.prototype.onopen=function(){k("open"),this.cleanup(),this.readyState="open",this.emit("open");var a=this.engine;this.subs.push(i(a,"data",j(this,"ondata"))),this.subs.push(i(a,"ping",j(this,"onping"))),this.subs.push(i(a,"pong",j(this,"onpong"))),this.subs.push(i(a,"error",j(this,"onerror"))),this.subs.push(i(a,"close",j(this,"onclose"))),this.subs.push(i(this.decoder,"decoded",j(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(a){this.decoder.add(a)},d.prototype.ondecoded=function(a){this.emit("packet",a)},d.prototype.onerror=function(a){k("error",a),this.emitAll("error",a)},d.prototype.socket=function(a){function b(){~l(d.connecting,c)||d.connecting.push(c)}var c=this.nsps[a];if(!c){c=new f(this,a),this.nsps[a]=c;var d=this;c.on("connecting",b),c.on("connect",function(){c.id=d.engine.id}),this.autoConnect&&b()}return c},d.prototype.destroy=function(a){var b=l(this.connecting,a);~b&&this.connecting.splice(b,1),this.connecting.length||this.close()},d.prototype.packet=function(a){k("writing packet %j",a);var b=this;b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1,b.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}},d.prototype.cleanup=function(){k("cleanup");for(var a;a=this.subs.shift();)a.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){k("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(a){k("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",a),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)k("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();k("will wait %dms before reconnect attempt",b),this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(k("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),a.skipReconnect||a.open(function(b){b?(k("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(k("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}},d.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",a)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(a,b,c){function d(a,b,c){return a.on(b,c),{destroy:function(){a.removeListener(b,c)}}}b.exports=d},{}],34:[function(a,b,c){function d(a,b){this.io=a,this.nsp=b,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var e=a("socket.io-parser"),f=a("component-emitter"),g=a("to-array"),h=a("./on"),i=a("component-bind"),j=a("debug")("socket.io-client:socket"),k=a("has-binary");b.exports=c=d;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},m=f.prototype.emit;f(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[h(a,"open",i(this,"onopen")),h(a,"packet",i(this,"onpacket")),h(a,"close",i(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},d.prototype.send=function(){var a=g(arguments);return a.unshift("message"),this.emit.apply(this,a),this},d.prototype.emit=function(a){if(l.hasOwnProperty(a))return m.apply(this,arguments),this;var b=g(arguments),c=e.EVENT;k(b)&&(c=e.BINARY_EVENT);var d={type:c,data:b};return d.options={},d.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(j("emitting packet with ack id %d",this.ids),this.acks[this.ids]=b.pop(),d.id=this.ids++),this.connected?this.packet(d):this.sendBuffer.push(d),delete this.flags,this},d.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},d.prototype.onopen=function(){j("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:e.CONNECT})},d.prototype.onclose=function(a){j("close (%s)",a),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",a)},d.prototype.onpacket=function(a){if(a.nsp==this.nsp)switch(a.type){case e.CONNECT:this.onconnect();break;case e.EVENT:this.onevent(a);break;case e.BINARY_EVENT:this.onevent(a);break;case e.ACK:this.onack(a);break;case e.BINARY_ACK:this.onack(a);break;case e.DISCONNECT:this.ondisconnect();break;case e.ERROR:this.emit("error",a.data)}},d.prototype.onevent=function(a){var b=a.data||[];j("emitting event %j",b),null!=a.id&&(j("attaching ack callback to event"),b.push(this.ack(a.id))),this.connected?m.apply(this,b):this.receiveBuffer.push(b)},d.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=g(arguments);j("sending ack %j",d);var f=k(d)?e.BINARY_ACK:e.ACK;b.packet({type:f,id:a,data:d})}}},d.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(j("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):j("bad ack %s",a.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)m.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){j("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(j("performing disconnect (%s)",this.nsp),this.packet({type:e.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(a,b,c){(function(c){function d(a,b){var d=a,b=b||c.location;null==a&&(a=b.protocol+"//"+b.host),"string"==typeof a&&("/"==a.charAt(0)&&(a="/"==a.charAt(1)?b.protocol+a:b.host+a),/^(https?|wss?):\/\//.test(a)||(f("protocol-less url %s",a),a="undefined"!=typeof b?b.protocol+"//"+a:"https://"+a),f("parse %s",a),d=e(a)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";var g=d.host.indexOf(":")!==-1,h=g?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+h+":"+d.port,d.href=d.protocol+"://"+h+(b&&b.port==d.port?"":":"+d.port),d}var e=a("parseuri"),f=a("debug")("socket.io-client:url");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:39,parseuri:45}],36:[function(a,b,c){function d(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}b.exports=d,d.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)},d.prototype.reset=function(){this.attempts=0},d.prototype.setMin=function(a){this.ms=a},d.prototype.setMax=function(a){this.max=a},d.prototype.setJitter=function(a){this.jitter=a}},{}],37:[function(a,b,c){var d=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw new Error("bind() requires a function");var c=d.call(arguments,2);return function(){return b.apply(a,c.concat(d.call(arguments)))}}},{}],38:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],39:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{"./debug":40,dup:17}],40:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{dup:18,ms:44}],41:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&"function"==typeof a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:43}],42:[function(a,b,c){arguments[4][23][0].apply(c,arguments)},{dup:23}],43:[function(a,b,c){arguments[4][24][0].apply(c,arguments)},{dup:24}],44:[function(a,b,c){arguments[4][25][0].apply(c,arguments)},{dup:25}],45:[function(a,b,c){arguments[4][28][0].apply(c,arguments)},{dup:28}],46:[function(a,b,c){(function(b){var d=a("isarray"),e=a("./is-buffer");c.deconstructPacket=function(a){function b(a){if(!a)return a;if(e(a)){var f={_placeholder:!0,num:c.length};return c.push(a),f}if(d(a)){for(var g=new Array(a.length),h=0;h<a.length;h++)g[h]=b(a[h]);return g}if("object"==typeof a&&!(a instanceof Date)){var g={};for(var i in a)g[i]=b(a[i]);return g}return a}var c=[],f=a.data,g=a;return g.data=b(f),g.attachments=c.length,{packet:g,buffers:c}},c.reconstructPacket=function(a,b){function c(a){if(a&&a._placeholder){var e=b[a.num];return e}if(d(a)){for(var f=0;f<a.length;f++)a[f]=c(a[f]);return a}if(a&&"object"==typeof a){for(var g in a)a[g]=c(a[g]);return a}return a}return a.data=c(a.data),a.attachments=void 0,a},c.removeBlobs=function(a,c){function f(a,i,j){if(!a)return a;if(b.Blob&&a instanceof Blob||b.File&&a instanceof File){g++;var k=new FileReader;k.onload=function(){j?j[i]=this.result:h=this.result,--g||c(h)},k.readAsArrayBuffer(a)}else if(d(a))for(var l=0;l<a.length;l++)f(a[l],l,a);else if(a&&"object"==typeof a&&!e(a))for(var m in a)f(a[m],m,a)}var g=0,h=a;f(h),g||c(h)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":48,isarray:43}],47:[function(a,b,c){function d(){}function e(a){var b="",d=!1;return b+=a.type,c.BINARY_EVENT!=a.type&&c.BINARY_ACK!=a.type||(b+=a.attachments,b+="-"),a.nsp&&"/"!=a.nsp&&(d=!0,b+=a.nsp),null!=a.id&&(d&&(b+=",",d=!1),b+=a.id),null!=a.data&&(d&&(b+=","),b+=l.stringify(a.data)),k("encoded %j as %s",a,b),b}function f(a,b){function c(a){var c=n.deconstructPacket(a),d=e(c.packet),f=c.buffers;f.unshift(d),b(f)}n.removeBlobs(a,c)}function g(){this.reconstructor=null}function h(a){var b={},d=0;if(b.type=Number(a.charAt(0)),null==c.types[b.type])return j();if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type){for(var e="";"-"!=a.charAt(++d)&&(e+=a.charAt(d),d!=a.length););if(e!=Number(e)||"-"!=a.charAt(d))throw new Error("Illegal attachments");b.attachments=Number(e)}if("/"==a.charAt(d+1))for(b.nsp="";++d;){var f=a.charAt(d);if(","==f)break;if(b.nsp+=f,d==a.length)break}else b.nsp="/";var g=a.charAt(d+1);if(""!==g&&Number(g)==g){for(b.id="";++d;){var f=a.charAt(d);if(null==f||Number(f)!=f){--d;break}if(b.id+=a.charAt(d),d==a.length)break}b.id=Number(b.id)}if(a.charAt(++d))try{b.data=l.parse(a.substr(d))}catch(h){return j()}return k("decoded %s as %j",a,b),b}function i(a){this.reconPack=a,this.buffers=[]}function j(a){return{type:c.ERROR,data:"parser error"}}var k=a("debug")("socket.io-parser"),l=a("json3"),m=(a("isarray"),a("component-emitter")),n=a("./binary"),o=a("./is-buffer");c.protocol=4,c.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],c.CONNECT=0,c.DISCONNECT=1,c.EVENT=2,c.ACK=3,c.ERROR=4,c.BINARY_EVENT=5,c.BINARY_ACK=6,c.Encoder=d,c.Decoder=g,d.prototype.encode=function(a,b){if(k("encoding packet %j",a),c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)f(a,b);else{var d=e(a);b([d])}},m(g.prototype),g.prototype.add=function(a){var b;if("string"==typeof a)b=h(a),c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=new i(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b);else{if(!o(a)&&!a.base64)throw new Error("Unknown type: "+a);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");b=this.reconstructor.takeBinaryData(a),b&&(this.reconstructor=null,this.emit("decoded",b))}},g.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},i.prototype.takeBinaryData=function(a){if(this.buffers.push(a),this.buffers.length==this.reconPack.attachments){var b=n.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null},i.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(a,b,c){(function(a){function c(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}b.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],49:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{dup:15}],50:[function(b,c,d){(function(b){(function(){function e(a,b){function c(a){if(c[a]!==q)return c[a];var e;if("bug-string-char-index"==a)e="a"!="a"[0];else if("json"==a)e=c("json-stringify")&&c("json-parse");else{var g,h='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=b.stringify,k="function"==typeof i&&t;if(k){(g=function(){return 1}).toJSON=g;try{k="0"===i(0)&&"0"===i(new d)&&'""'==i(new f)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(g)&&"[1]"==i([g])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[g,!0,!1,null,"\0\b\n\f\r\t"]})==h&&"1"===i(null,g)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j((-864e13)))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j((-621987552e5)))&&'"1969-12-31T23:59:59.999Z"'==i(new j((-1)))}catch(l){k=!1}}e=k}if("json-parse"==a){var m=b.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){g=m(h);var n=5==g.a.length&&1===g.a[0];if(n){try{n=!m('"\t"')}catch(l){}if(n)try{n=1!==m("01")}catch(l){}if(n)try{n=1!==m("1.")}catch(l){}}}}catch(l){n=!1}e=n}}return c[a]=!!e}a||(a=i.Object()),b||(b=i.Object());var d=a.Number||i.Number,f=a.String||i.String,h=a.Object||i.Object,j=a.Date||i.Date,k=a.SyntaxError||i.SyntaxError,l=a.TypeError||i.TypeError,m=a.Math||i.Math,n=a.JSON||i.JSON;"object"==typeof n&&n&&(b.stringify=n.stringify,b.parse=n.parse);var o,p,q,r=h.prototype,s=r.toString,t=new j((-0xc782b5b800cec));try{t=t.getUTCFullYear()==-109252&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(u){}if(!c("json")){var v="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",z="[object Array]",A="[object Boolean]",B=c("bug-string-char-index");if(!t)var C=m.floor,D=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(a,b){return D[b]+365*(a-1970)+C((a-1969+(b=+(b>1)))/4)-C((a-1901+b)/100)+C((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var c,d,e,f=0;(c=function(){this.valueOf=0}).prototype.valueOf=0,d=new c;for(e in d)o.call(d,e)&&f++;return c=d=null,f?p=2==f?function(a,b){var c,d={},e=s.call(a)==v;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==v;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(d=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var c,e,f=s.call(a)==v,h=!f&&"function"!=typeof a.constructor&&g[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(c in a)f&&"prototype"==c||!h.call(a,c)||b(c);for(e=d.length;c=d[--e];h.call(a,c)&&b(c));}),p(a,b)},!c("json-stringify")){var F={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},G="000000",H=function(a,b){return(G+(b||0)).slice(-a)},I="\\u00",J=function(a){for(var b='"',c=0,d=a.length,e=!B||d>10,f=e&&(B?a.split(""):a);c<d;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=F[g];break;default:if(g<32){b+=I+H(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},K=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,v,B,D,F,G,I,L;try{h=b[a]}catch(M){}if("object"==typeof h&&h)if(i=s.call(h),i!=w||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=x&&i!=y&&i!=z||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&h<1/0){if(E){for(m=C(h/864e5),j=C(m/365.2425)+1970-1;E(j+1,0)<=m;j++);for(k=C((m-E(j,0))/30.42);E(j,k+1)<=m;k++);m=1+m-E(j,k),n=(h%864e5+864e5)%864e5,r=C(n/36e5)%24,t=C(n/6e4)%60,u=C(n/1e3)%60,v=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),v=h.getUTCMilliseconds();h=(j<=0||j>=1e4?(j<0?"-":"+")+H(6,j<0?-j:j):H(4,j))+"-"+H(2,k+1)+"-"+H(2,m)+"T"+H(2,r)+":"+H(2,t)+":"+H(2,u)+"."+H(3,v)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if(i=s.call(h),i==A)return""+h;if(i==x)return h>-1/0&&h<1/0?""+h:"null";if(i==y)return J(""+h);if("object"==typeof h){for(G=g.length;G--;)if(g[G]===h)throw l();if(g.push(h),B=[],I=f,f+=e,i==z){for(F=0,G=h.length;F<G;F++)D=K(F,h,c,d,e,f,g),B.push(D===q?"null":D);L=B.length?e?"[\n"+f+B.join(",\n"+f)+"\n"+I+"]":"["+B.join(",")+"]":"[]"}else p(d||h,function(a){var b=K(a,h,c,d,e,f,g);b!==q&&B.push(J(a)+":"+(e?" ":"")+b)}),L=B.length?e?"{\n"+f+B.join(",\n"+f)+"\n"+I+"}":"{"+B.join(",")+"}":"{}";return g.pop(),L}};b.stringify=function(a,b,c){var d,e,f,h;if(g[typeof b]&&b)if((h=s.call(b))==v)e=b;else if(h==z){f={};for(var i,j=0,k=b.length;j<k;i=b[j++],h=s.call(i),(h==y||h==x)&&(f[i]=1));}if(c)if((h=s.call(c))==x){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else h==y&&(d=c.length<=10?c:c.slice(0,10));return K("",(i={},i[""]=a,i),e,f,d,"",[])}}if(!c("json-parse")){var L,M,N=f.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},P=function(){throw L=M=null,k()},Q=function(){for(var a,b,c,d,e,f=M,g=f.length;L<g;)switch(e=f.charCodeAt(L)){case 9:case 10:case 13:case 32:L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=B?f.charAt(L):f[L],L++,a;case 34:for(a="@",L++;L<g;)if(e=f.charCodeAt(L),e<32)P();else if(92==e)switch(e=f.charCodeAt(++L)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=O[e],L++;break;case 117:for(b=++L,c=L+4;L<c;L++)e=f.charCodeAt(L),e>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70||P();a+=N("0x"+f.slice(b,L));break;default:P()}else{if(34==e)break;for(e=f.charCodeAt(L),b=L;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++L);a+=f.slice(b,L)}if(34==f.charCodeAt(L))return L++,a;P();default:if(b=L,45==e&&(d=!0,e=f.charCodeAt(++L)),e>=48&&e<=57){for(48==e&&(e=f.charCodeAt(L+1),e>=48&&e<=57)&&P(),d=!1;L<g&&(e=f.charCodeAt(L),e>=48&&e<=57);L++);if(46==f.charCodeAt(L)){for(c=++L;c<g&&(e=f.charCodeAt(c),e>=48&&e<=57);c++);c==L&&P(),L=c}if(e=f.charCodeAt(L),101==e||69==e){for(e=f.charCodeAt(++L),43!=e&&45!=e||L++,c=L;c<g&&(e=f.charCodeAt(c),e>=48&&e<=57);c++);c==L&&P(),L=c}return+f.slice(b,L)}if(d&&P(),"true"==f.slice(L,L+4))return L+=4,!0;if("false"==f.slice(L,L+5))return L+=5,!1;if("null"==f.slice(L,L+4))return L+=4,null;P()}return"$"},R=function(a){var b,c;if("$"==a&&P(),"string"==typeof a){if("@"==(B?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=Q(),"]"!=a;c||(c=!0))c&&(","==a?(a=Q(),"]"==a&&P()):P()),","==a&&P(),b.push(R(a));return b}if("{"==a){for(b={};a=Q(),"}"!=a;c||(c=!0))c&&(","==a?(a=Q(),"}"==a&&P()):P()),","!=a&&"string"==typeof a&&"@"==(B?a.charAt(0):a[0])&&":"==Q()||P(),b[a.slice(1)]=R(Q());return b}P()}return a},S=function(a,b,c){var d=T(a,b,c);d===q?delete a[b]:a[b]=d},T=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==z)for(d=e.length;d--;)S(e,d,c);else p(e,function(a){S(e,a,c)});return c.call(a,b,e)};b.parse=function(a,b){var c,d;return L=0,M=""+a,c=R(Q()),"$"!=Q()&&P(),L=M=null,b&&s.call(b)==v?T((d={},d[""]=c,d),"",b):c}}}return b.runInContext=e,b}var f="function"==typeof a&&a.amd,g={"function":!0,object:!0},h=g[typeof d]&&d&&!d.nodeType&&d,i=g[typeof window]&&window||this,j=h&&g[typeof c]&&c&&!c.nodeType&&"object"==typeof b&&b;if(!j||j.global!==j&&j.window!==j&&j.self!==j||(i=j),h&&!f)e(i,h);else{var k=i.JSON,l=i.JSON3,m=!1,n=e(i,i.JSON3={noConflict:function(){return m||(m=!0,i.JSON=k,i.JSON3=l,k=l=null),n}});i.JSON={parse:n.parse,stringify:n.stringify}}f&&a(function(){return n})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],51:[function(a,b,c){function d(a,b){var c=[];b=b||0;for(var d=b||0;d<a.length;d++)c[d-b]=a[d];return c}b.exports=d},{}]},{},[31])(31)}),function(a){function b(a,b,c){var j=0,k=[0],l="",m=null,l=c||"UTF8";if("UTF8"!==l&&"UTF16"!==l)throw"encoding must be UTF8 or UTF16";if("HEX"===b){if(0!==a.length%2)throw"srcString of HEX type must be in byte increments";m=e(a),j=m.binLen,k=m.value}else if("ASCII"===b||"TEXT"===b)m=d(a,l),j=m.binLen,k=m.value;else{if("B64"!==b)throw"inputFormat must be HEX, TEXT, ASCII, or B64";m=f(a),j=m.binLen,k=m.value}this.getHash=function(a,b,c,d){var e,f=null,l=k.slice(),m=j;
if(3===arguments.length?"number"!=typeof c&&(d=c,c=1):2===arguments.length&&(c=1),c!==parseInt(c,10)||1>c)throw"numRounds must a integer >= 1";switch(b){case"HEX":f=g;break;case"B64":f=h;break;default:throw"format must be HEX or B64"}if("SHA-1"===a)for(e=0;e<c;e++)l=G(l,m),m=160;else if("SHA-224"===a)for(e=0;e<c;e++)l=H(l,m,a),m=224;else if("SHA-256"===a)for(e=0;e<c;e++)l=H(l,m,a),m=256;else if("SHA-384"===a)for(e=0;e<c;e++)l=H(l,m,a),m=384;else{if("SHA-512"!==a)throw"Chosen SHA variant is not supported";for(e=0;e<c;e++)l=H(l,m,a),m=512}return f(l,i(d))},this.getHMAC=function(a,b,c,m,n){var o,p,q,r,s=[],t=[];switch(o=null,m){case"HEX":m=g;break;case"B64":m=h;break;default:throw"outputFormat must be HEX or B64"}if("SHA-1"===c)p=64,r=160;else if("SHA-224"===c)p=64,r=224;else if("SHA-256"===c)p=64,r=256;else if("SHA-384"===c)p=128,r=384;else{if("SHA-512"!==c)throw"Chosen SHA variant is not supported";p=128,r=512}if("HEX"===b)o=e(a),q=o.binLen,o=o.value;else if("ASCII"===b||"TEXT"===b)o=d(a,l),q=o.binLen,o=o.value;else{if("B64"!==b)throw"inputFormat must be HEX, TEXT, ASCII, or B64";o=f(a),q=o.binLen,o=o.value}for(a=8*p,b=p/4-1,p<q/8?(o="SHA-1"===c?G(o,q):H(o,q,c),o[b]&=4294967040):p>q/8&&(o[b]&=4294967040),p=0;p<=b;p+=1)s[p]=909522486^o[p],t[p]=1549556828^o[p];return c="SHA-1"===c?G(t.concat(G(s.concat(k),a+j)),a+r):H(t.concat(H(s.concat(k),a+j,c)),a+r,c),m(c,i(n))}}function c(a,b){this.a=a,this.b=b}function d(a,b){var c,d,e=[],f=[],g=0;if("UTF8"===b)for(d=0;d<a.length;d+=1)for(c=a.charCodeAt(d),f=[],2048<c?(f[0]=224|(61440&c)>>>12,f[1]=128|(4032&c)>>>6,f[2]=128|63&c):128<c?(f[0]=192|(1984&c)>>>6,f[1]=128|63&c):f[0]=c,c=0;c<f.length;c+=1)e[g>>>2]|=f[c]<<24-g%4*8,g+=1;else if("UTF16"===b)for(d=0;d<a.length;d+=1)e[g>>>2]|=a.charCodeAt(d)<<16-g%4*8,g+=2;return{value:e,binLen:8*g}}function e(a){var b,c,d=[],e=a.length;if(0!==e%2)throw"String of HEX type must be in byte increments";for(b=0;b<e;b+=2){if(c=parseInt(a.substr(b,2),16),isNaN(c))throw"String of HEX type contains invalid characters";d[b>>>3]|=c<<24-b%8*4}return{value:d,binLen:4*e}}function f(a){var b,c,d,e,f,g=[],h=0;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(b=a.indexOf("="),a=a.replace(/\=/g,""),-1!==b&&b<a.length)throw"Invalid '=' found in base-64 string";for(c=0;c<a.length;c+=4){for(f=a.substr(c,4),d=e=0;d<f.length;d+=1)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d]),e|=b<<18-6*d;for(d=0;d<f.length-1;d+=1)g[h>>2]|=(e>>>16-8*d&255)<<24-h%4*8,h+=1}return{value:g,binLen:8*h}}function g(a,b){var c,d,e="",f=4*a.length;for(c=0;c<f;c+=1)d=a[c>>>2]>>>8*(3-c%4),e+="0123456789abcdef".charAt(d>>>4&15)+"0123456789abcdef".charAt(15&d);return b.outputUpper?e.toUpperCase():e}function h(a,b){var c,d,e,f="",g=4*a.length;for(c=0;c<g;c+=3)for(e=(a[c>>>2]>>>8*(3-c%4)&255)<<16|(a[c+1>>>2]>>>8*(3-(c+1)%4)&255)<<8|a[c+2>>>2]>>>8*(3-(c+2)%4)&255,d=0;4>d;d+=1)f=8*c+6*d<=32*a.length?f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-d)&63):f+b.b64Pad;return f}function i(a){var b={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(b.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad)}catch(c){}if("boolean"!=typeof b.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof b.b64Pad)throw"Invalid b64Pad formatting option";return b}function j(a,b){return a<<b|a>>>32-b}function k(a,b){return a>>>b|a<<32-b}function l(a,b){var d=null,d=new c(a.a,a.b);return d=32>=b?new c(d.a>>>b|d.b<<32-b&4294967295,d.b>>>b|d.a<<32-b&4294967295):new c(d.b>>>b-32|d.a<<64-b&4294967295,d.a>>>b-32|d.b<<64-b&4294967295)}function m(a,b){var d=null;return d=32>=b?new c(a.a>>>b,a.b>>>b|a.a<<32-b&4294967295):new c(0,a.a>>>b-32)}function n(a,b,c){return a^b^c}function o(a,b,c){return a&b^~a&c}function p(a,b,d){return new c(a.a&b.a^~a.a&d.a,a.b&b.b^~a.b&d.b)}function q(a,b,c){return a&b^a&c^b&c}function r(a,b,d){return new c(a.a&b.a^a.a&d.a^b.a&d.a,a.b&b.b^a.b&d.b^b.b&d.b)}function s(a){return k(a,2)^k(a,13)^k(a,22)}function t(a){var b=l(a,28),d=l(a,34);return a=l(a,39),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function u(a){return k(a,6)^k(a,11)^k(a,25)}function v(a){var b=l(a,14),d=l(a,18);return a=l(a,41),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function w(a){return k(a,7)^k(a,18)^a>>>3}function x(a){var b=l(a,1),d=l(a,8);return a=m(a,7),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function y(a){return k(a,17)^k(a,19)^a>>>10}function z(a){var b=l(a,19),d=l(a,61);return a=m(a,6),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function A(a,b){var c=(65535&a)+(65535&b);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|65535&c}function B(a,b,c,d){var e=(65535&a)+(65535&b)+(65535&c)+(65535&d);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)&65535)<<16|65535&e}function C(a,b,c,d,e){var f=(65535&a)+(65535&b)+(65535&c)+(65535&d)+(65535&e);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16)&65535)<<16|65535&f}function D(a,b){var d,e,f;return d=(65535&a.b)+(65535&b.b),e=(a.b>>>16)+(b.b>>>16)+(d>>>16),f=(65535&e)<<16|65535&d,d=(65535&a.a)+(65535&b.a)+(e>>>16),e=(a.a>>>16)+(b.a>>>16)+(d>>>16),new c((65535&e)<<16|65535&d,f)}function E(a,b,d,e){var f,g,h;return f=(65535&a.b)+(65535&b.b)+(65535&d.b)+(65535&e.b),g=(a.b>>>16)+(b.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f>>>16),h=(65535&g)<<16|65535&f,f=(65535&a.a)+(65535&b.a)+(65535&d.a)+(65535&e.a)+(g>>>16),g=(a.a>>>16)+(b.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f>>>16),new c((65535&g)<<16|65535&f,h)}function F(a,b,d,e,f){var g,h,i;return g=(65535&a.b)+(65535&b.b)+(65535&d.b)+(65535&e.b)+(65535&f.b),h=(a.b>>>16)+(b.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f.b>>>16)+(g>>>16),i=(65535&h)<<16|65535&g,g=(65535&a.a)+(65535&b.a)+(65535&d.a)+(65535&e.a)+(65535&f.a)+(h>>>16),h=(a.a>>>16)+(b.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f.a>>>16)+(g>>>16),new c((65535&h)<<16|65535&g,i)}function G(a,b){var c,d,e,f,g,h,i,k,l,m=[],p=o,r=n,s=q,t=j,u=A,v=C,w=[1732584193,4023233417,2562383102,271733878,3285377520];for(a[b>>>5]|=128<<24-b%32,a[(b+65>>>9<<4)+15]=b,l=a.length,i=0;i<l;i+=16){for(c=w[0],d=w[1],e=w[2],f=w[3],g=w[4],k=0;80>k;k+=1)m[k]=16>k?a[k+i]:t(m[k-3]^m[k-8]^m[k-14]^m[k-16],1),h=20>k?v(t(c,5),p(d,e,f),g,1518500249,m[k]):40>k?v(t(c,5),r(d,e,f),g,1859775393,m[k]):60>k?v(t(c,5),s(d,e,f),g,2400959708,m[k]):v(t(c,5),r(d,e,f),g,3395469782,m[k]),g=f,f=e,e=t(d,30),d=c,c=h;w[0]=u(c,w[0]),w[1]=u(d,w[1]),w[2]=u(e,w[2]),w[3]=u(f,w[3]),w[4]=u(g,w[4])}return w}function H(a,b,d){var e,f,g,h,i,j,k,l,m,n,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W=[],X=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(n=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],f=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-224"===d||"SHA-256"===d)G=64,e=(b+65>>>9<<4)+15,J=16,K=1,U=Number,L=A,M=B,N=C,O=w,P=y,Q=s,R=u,T=q,S=o,n="SHA-224"===d?n:f;else{if("SHA-384"!==d&&"SHA-512"!==d)throw"Unexpected error in SHA-2 implementation";G=80,e=(b+128>>>10<<5)+31,J=32,K=2,U=c,L=D,M=E,N=F,O=x,P=z,Q=t,R=v,T=r,S=p,X=[new U(X[0],3609767458),new U(X[1],602891725),new U(X[2],3964484399),new U(X[3],2173295548),new U(X[4],4081628472),new U(X[5],3053834265),new U(X[6],2937671579),new U(X[7],3664609560),new U(X[8],2734883394),new U(X[9],1164996542),new U(X[10],1323610764),new U(X[11],3590304994),new U(X[12],4068182383),new U(X[13],991336113),new U(X[14],633803317),new U(X[15],3479774868),new U(X[16],2666613458),new U(X[17],944711139),new U(X[18],2341262773),new U(X[19],2007800933),new U(X[20],1495990901),new U(X[21],1856431235),new U(X[22],3175218132),new U(X[23],2198950837),new U(X[24],3999719339),new U(X[25],766784016),new U(X[26],2566594879),new U(X[27],3203337956),new U(X[28],1034457026),new U(X[29],2466948901),new U(X[30],3758326383),new U(X[31],168717936),new U(X[32],1188179964),new U(X[33],1546045734),new U(X[34],1522805485),new U(X[35],2643833823),new U(X[36],2343527390),new U(X[37],1014477480),new U(X[38],1206759142),new U(X[39],344077627),new U(X[40],1290863460),new U(X[41],3158454273),new U(X[42],3505952657),new U(X[43],106217008),new U(X[44],3606008344),new U(X[45],1432725776),new U(X[46],1467031594),new U(X[47],851169720),new U(X[48],3100823752),new U(X[49],1363258195),new U(X[50],3750685593),new U(X[51],3785050280),new U(X[52],3318307427),new U(X[53],3812723403),new U(X[54],2003034995),new U(X[55],3602036899),new U(X[56],1575990012),new U(X[57],1125592928),new U(X[58],2716904306),new U(X[59],442776044),new U(X[60],593698344),new U(X[61],3733110249),new U(X[62],2999351573),new U(X[63],3815920427),new U(3391569614,3928383900),new U(3515267271,566280711),new U(3940187606,3454069534),new U(4118630271,4000239992),new U(116418474,1914138554),new U(174292421,2731055270),new U(289380356,3203993006),new U(460393269,320620315),new U(685471733,587496836),new U(852142971,1086792851),new U(1017036298,365543100),new U(1126000580,2618297676),new U(1288033470,3409855158),new U(1501505948,4234509866),new U(1607167915,987167468),new U(1816402316,1246189591)],n="SHA-384"===d?[new U(3418070365,n[0]),new U(1654270250,n[1]),new U(2438529370,n[2]),new U(355462360,n[3]),new U(1731405415,n[4]),new U(41048885895,n[5]),new U(3675008525,n[6]),new U(1203062813,n[7])]:[new U(f[0],4089235720),new U(f[1],2227873595),new U(f[2],4271175723),new U(f[3],1595750129),new U(f[4],2917565137),new U(f[5],725511199),new U(f[6],4215389547),new U(f[7],327033209)]}for(a[b>>>5]|=128<<24-b%32,a[e]=b,V=a.length,H=0;H<V;H+=J){for(b=n[0],e=n[1],f=n[2],g=n[3],h=n[4],i=n[5],j=n[6],k=n[7],I=0;I<G;I+=1)W[I]=16>I?new U(a[I*K+H],a[I*K+H+1]):M(P(W[I-2]),W[I-7],O(W[I-15]),W[I-16]),l=N(k,R(h),S(h,i,j),X[I],W[I]),m=L(Q(b),T(b,e,f)),k=j,j=i,i=h,h=L(g,l),g=f,f=e,e=b,b=L(l,m);n[0]=L(b,n[0]),n[1]=L(e,n[1]),n[2]=L(f,n[2]),n[3]=L(g,n[3]),n[4]=L(h,n[4]),n[5]=L(i,n[5]),n[6]=L(j,n[6]),n[7]=L(k,n[7])}if("SHA-224"===d)a=[n[0],n[1],n[2],n[3],n[4],n[5],n[6]];else if("SHA-256"===d)a=n;else if("SHA-384"===d)a=[n[0].a,n[0].b,n[1].a,n[1].b,n[2].a,n[2].b,n[3].a,n[3].b,n[4].a,n[4].b,n[5].a,n[5].b];else{if("SHA-512"!==d)throw"Unexpected error in SHA-2 implementation";a=[n[0].a,n[0].b,n[1].a,n[1].b,n[2].a,n[2].b,n[3].a,n[3].b,n[4].a,n[4].b,n[5].a,n[5].b,n[6].a,n[6].b,n[7].a,n[7].b]}return a}"function"==typeof define?define(function(){return b}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=exports=b:exports=b:a.jsSHA=b}(this),!function(a){"use strict";var b=function(a,b,c){function d(){}function e(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function f(){var a=g();return a+bb.currentOffset}function g(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function h(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){wa=a})}function i(){return wa?wa.level:void 0}function j(){return wa?wa.charging:void 0}function k(){navigator.mediaDevices.enumerateDevices().then(function(a){va=a})}function l(a){var b=a.toString();return null!==a.localDescription&&null!==a.localDescription.sdp&&a.localDescription.sdp.split("\r\n").filter(function(a){return 0===a.indexOf("o=")}).forEach(function(a){var d=a.split(" ")[1],e=new c(d,"TEXT");b=e.getHash("SHA-1","B64")}),b}function m(a){var b=new c(a,"TEXT");return b.getHash("SHA-1","B64")}function n(a,b){var c=l(a),d=l(b);return c===d}function o(a){var b=0;return null!==a.localDescription&&null!==a.localDescription.sdp&&""!==a.localDescription.sdp&&(b=a.localDescription.sdp.split("\r\n").filter(function(a){return 0===a.indexOf("o=")})),b.length}function p(){Ka||window.addEventListener("beforeunload",function(a){var b;for(b in _a)_a.hasOwnProperty(b)&&Ub(nb.userLeft,null,b,_a[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function q(a,b){setTimeout(function(){var b=f(),c=b-a.data.apiTS;a.data.timeShift=c,na(a.type,a.action,a.data,a.callback)},b)}function r(a,b,c,d,e){var f=l(d);Ub(nb.mediaPlaybackStartEvent,b,c,a,{ssrc:e},f,null)}function s(a,b,c,d,e){var f=l(d);Ub(nb.mediaSuspendedEvent,b,c,a,{ssrc:e},f,null)}function t(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=_a[b].ucID;f.oncanplay=function(){r(g,a,b,d,e)},f.onsuspend=function(){s(g,a,b,d,e)}}}function u(a){var b=Ya.codebase,c=!1;return null===a?c=!1:b===Hb.firefox?"undefined"!=typeof mozRTCPeerConnection&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!=typeof RTCPeerConnection&&a instanceof RTCPeerConnection&&(c=!0):("function"==typeof a||a instanceof lb||b===Hb.edge)&&(c=!0),c}function v(a,b){var d,e;return a&&(b===Hb.chrome?(d=a.googLocalAddress,d.concat(":",a.googRemoteAddress)):b===Hb.firefox&&(d=a.localAddr,d.concat(":",a.remoteAddr))),e=new c(d,"TEXT"),e.getHash("SHA-1","B64")}function w(){var a;return a=navigator.onLine===!0?"online":"offline"}function x(a,b){var c=Ib.unknown,d=null;if(b===Hb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=Ib.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=Ib.audio),d=a.data.googCodecName);else{if(b!==Hb.firefox)return;void 0!==a&&(void 0!==a.data.mediaType?c=a.data.mediaType:void 0!==a.data.framerateMean&&(c=Ib.video))}return a.data.ssrc in db&&(db[a.data.ssrc].mediaType=c,db[a.data.ssrc].codec=d),c}function y(a,b){return b===Hb.chrome&&void 0!==a.data.googCurrentDelayMs?a.data.googCurrentDelayMs:void 0}function z(a,b){var c;return b===Hb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===Hb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function A(a,b){var c="unavailable";if(b===Hb.chrome){var d,e,f;d=z(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===Hb.firefox;return c}function B(a){var b;return b=isNaN(a)||0>a?null:a}function C(a,b){var c;if(b===Hb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=B(parseInt(a.data.googRtt,10))}else if(b===Hb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=B(parseInt(a.data.mozRtt,10))}else if(b===Hb.edge&&a&&a.data.roundTripTime)return c=B(parseInt(a.data.roundTripTime,10))}function D(a,b){var c;if(b===Hb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=K(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===Hb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=K(parseInt(a.data.jitter,10))}function E(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function F(a,b,c){var d;return b===Ib.audio?a<c.audio.gThreshold?d=xb.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=xb.fair:a>c.audio.rThreshold&&(d=xb.bad):b===Ib.video&&(a<c.video.gThreshold?d=xb.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=xb.fair:a>c.video.rThreshold&&(d=xb.bad)),d}function G(a,b,c){var d;return b===Ib.audio?a>c.audio.gThreshold?d=xb.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=xb.fair:a<c.audio.rThreshold&&(d=xb.bad):b===Ib.video&&(a>c.video.gThreshold?d=xb.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=xb.fair:a<c.video.rThreshold&&(d=xb.bad)),d}function H(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===xb.excellent?b=yb.excellent:c===xb.fair?b=yb.fair:c===xb.bad&&(b=yb.bad)),b}function I(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(k={},h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k.hash=b[d].hash,l=c-g,l>0&&(k.receivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/l,k.sentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/l,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(k.sentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(l/1e3)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(k.receivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(l/1e3))),k.rtt=b[d].googRtt,m.push(k))}return m}function J(a,b,c,d){var e=[];return c===Hb.firefox?e=null:c===Hb.chrome&&(e=I(a,b,d)),e}function K(a){var b=isNaN(a)?null:a;return b}function L(a){if(a=K(a),null!==a){var b=0>a?null:a;return b}}function M(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function N(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,B,D,I,J,N,O,P,Q=null,R=null,S=null,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null;for(o in b.streams[c].outbound)if(b.streams[c].outbound.hasOwnProperty(o)){var aa=b.streams[c].outbound[o].data;void 0!==e.streams[c]&&void 0!==e.streams[c].outbound&&void 0!==e.streams[c].outbound[o]?(j=K(parseInt(e.streams[c].outbound[o].data.bytesSent,10)),k=a.lastStatsSent.apiTS,D=K(parseInt(e.streams[c].outbound[o].data.packetsSent,10)),J=K(parseInt(e.streams[c].outbound[o].data.packetsLost,10)),N=K(parseInt(e.streams[c].outbound[o].data.discardedPackets,10))):(j=0,k=g,J=0,D=0,N=0),m=g,u=m-k,p=x(b.streams[c].outbound[o],f),q=A(b.streams[c].outbound[o],f),r=z(b.streams[c].outbound[o],f),v=y(b.streams[c].outbound[o],f),void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].outbound&&(d.streams[c].outbound={}),d.streams[c].outbound[o]={},n=C(b.streams[c].outbound[o],f),l=K(parseInt(aa.bytesSent,10)),null!==l&&null!==j&&j>l&&(j=0,pc(Da,Ea,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:h,ucID:i})),void 0!==aa.droppedFrames&&(O=L(parseInt(aa.droppedFrames,10)),null!==O&&null!==N&&N>O&&(N=0),null!==O&&null!==N&&(P=O-N)),I=L(parseInt(aa.packetsLost,10)),null!==I&&null!==J&&(R=I-J),B=L(parseInt(aa.packetsSent,10)),null!==B&&null!==D&&(w=B-D),void 0!==R&&void 0!==w&&w+R>0&&(S=R/(w+R)),u>0&&(null!==l&&null!==j&&(Q=8*(l-j)/u),void 0!==w&&(_=w/(u/1e3))),a=M(a,c,"rttInfo",o,"outbound","rttArray",!0),a=M(a,c,"fractionalLossInfo",o,"outbound","fractionalLossArray",!0),a=M(a,c,"timeElapse",o,"outbound","totalTimeMs",!1),void 0!==n&&null!==n&&a.rttInfo.streams[c].outbound[o].rttArray.push(parseInt(n,10)),void 0!==S&&null!==S&&a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray.push(S),T=E(95,a.rttInfo.streams[c].outbound[o].rttArray),W=E(95,a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].outbound[o].totalTimeMs=a.timeElapse.streams[c].outbound[o].totalTimeMs+u),a.timeElapse.streams[c].outbound[o].totalTimeMs>0&&null!==l&&($=8*l/a.timeElapse.streams[c].outbound[o].totalTimeMs),d.streams[c].outbound[o]={csioIntMs:u,csioIntFL:S,csioIntPR:_,csioIntBRKbps:Q,csioMediaType:p,csioSig2Latency:T,csioAvgBRKbps:$,csioTimeElapseMs:a.timeElapse.streams[c].outbound[o].totalTimeMs,csioRes:q,csioPercentileFl:W,csioIntFramesDropped:P};for(var ba in aa)aa.hasOwnProperty(ba)&&(d.streams[c].outbound[o][ba]=aa[ba]);if(p===Ib.audio){var ca=T+40;U=F(ca,p,Gb),V=G(Q,p,Cb),s=H(U,V),d.streams[c].outbound[o].csioMark=s,d.streams[c].outbound[o].csioeM=ca}else p===Ib.video&&(t=parseInt(a.rttInfo.streams[c].outbound[o].frameRate,10),X=G(t/r,p,Db),Y=F(n,p,Eb),Z=G(Q,p,Cb),s=H(X,Y,Z),a.rttInfo.streams[c].outbound[o].frameRate=r,d.streams[c].outbound[o].csioMark=s)}}function O(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,B,I,J,N,O,P,Q,R,S,T,U,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null;for(q in b.streams[c].inbound)if(b.streams[c].inbound.hasOwnProperty(q)){var ea=b.streams[c].inbound[q].data;void 0!==e.streams[c]&&void 0!==e.streams[c].inbound&&void 0!==e.streams[c].inbound[q]?(j=K(parseInt(e.streams[c].inbound[q].data.bytesReceived,10)),n=K(parseInt(e.streams[c].inbound[q].data.packetsLost,10)),Q=K(parseInt(e.streams[c].inbound[q].data.packetsReceived,10)),k=a.lastStatsSent.apiTS,T=K(parseInt(e.streams[c].inbound[q].data.discardedPackets,10))):(j=0,k=g,n=0,Q=0,T=0),r=x(b.streams[c].inbound[q],f),s=A(b.streams[c].inbound[q],f),u=z(b.streams[c].inbound[q],f),t=D(b.streams[c].inbound[q],f),R=y(b.streams[c].inbound[q],f),p=C(b.streams[c].inbound[q],f),l=K(parseInt(ea.bytesReceived,10)),null!==l&&null!==j&&j>l&&(j=0,n=0,Q=0,pc(Da,Ea,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:h,ucID:i})),o=L(parseInt(ea.packetsLost,10)),m=g,void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].inbound&&(d.streams[c].inbound={}),d.streams[c].inbound[q]={},null!==o&&null!==n&&(W=o-n),void 0!==ea.discardedPackets&&(S=L(parseInt(ea.discardedPackets,10)),null!==S&&null!==T&&T>S&&(T=0),null!==S&&null!==T&&(U=S-T)),P=L(parseInt(ea.packetsReceived,10)),v=P-Q,void 0!==W&&null!==v&&v+W>0&&(Y=W/(v+W)),O=m-k,O>0&&(null!==l&&null!==j&&(V=8*(l-j)/O),null!==v&&(X=v/(O/1e3))),a=M(a,c,"rttInfo",q,"inbound","rttArray",!0),a=M(a,c,"timeElapse",q,"inbound","totalTimeMs",!1),a=M(a,c,"jitterInfo",q,"inbound","jitterArray",!0),a=M(a,c,"fractionalLossInfo",q,"inbound","fractionalLossArray",!0),void 0!==p&&null!==p&&a.rttInfo.streams[c].inbound[q].rttArray.push(parseInt(p,10)),void 0!==t&&null!==t&&a.jitterInfo.streams[c].inbound[q].jitterArray.push(parseInt(t,10)),void 0!==Y&&null!==Y&&a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray.push(Y),Z=E(95,a.rttInfo.streams[c].inbound[q].rttArray),$=E(95,a.jitterInfo.streams[c].inbound[q].jitterArray),_=E(95,a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].inbound[q].totalTimeMs=a.timeElapse.streams[c].inbound[q].totalTimeMs+O),null!==l&&a.timeElapse.streams[c].inbound[q].totalTimeMs>0&&(da=8*l/a.timeElapse.streams[c].inbound[q].totalTimeMs),d.streams[c].inbound[q]={csioIntMs:O,csioIntFL:Y,csioIntPR:X,csioIntBRKbps:V,csioSig2Latency:Z,csioAvgBRKbps:da,csioMediaType:r,csioTimeElapseMs:a.timeElapse.streams[c].inbound[q].totalTimeMs,csioIntPktRcv:v,csioIntPktLoss:W,csioPercentileJitter:$,csioRes:s,csioPercentileFl:_,csioIntPktDiscarded:U};for(var fa in ea)ea.hasOwnProperty(fa)&&(d.streams[c].inbound[q][fa]=ea[fa]);if(r===Ib.audio){var ga=Z+40;aa=F(ga,r,Gb),ba=F(Y,r,Fb),ca=G(V,r,Cb),w=H(aa,ba,ca),d.streams[c].inbound[q].csioMark=w,d.streams[c].inbound[q].csioeM=ga}else r===Ib.video&&(B=a.rttInfo.streams[c].inbound[q].frameRate,I=G(B/u,r,Db),J=F(p,r,Eb),N=G(V,r,Cb),w=H(I,J,N),a.rttInfo.streams[c].inbound[q].frameRate=u,d.streams[c].inbound[q].csioMark=w)}}function P(a,b,c,d,e,f){var g={streams:{}};g.fabricState=a.pcState,g.connectionState=w();var h=null;h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:{}};var i;for(i in b.streams)b.streams.hasOwnProperty(i)&&(void 0!==b.streams[i].inbound&&O(a,b,i,g,h,c,d,e,f),void 0!==b.streams[i].outbound&&N(a,b,i,g,h,c,d,e,f),void 0===g.streams[i]&&(g.streams[i]={}),b.streams[i].cname&&(g.streams[i].cname=b.streams[i].cname),b.streams[i].usage&&(g.streams[i].usage=b.streams[i].usage),b.streams[i].msid&&(g.streams[i].msid=b.streams[i].msid),b.streams[i].userID&&(g.streams[i].userID=b.streams[i].userID),b.streams[i].associatedVideoTag&&(g.streams[i].associatedVideoTag=b.streams[i].associatedVideoTag));if(c===Hb.firefox)for(i in g.streams)void 0!==g.streams[i].inbound&&void 0!==g.streams[i].inbound[wb.remote]&&(void 0===g.streams[i].outbound&&(g.streams[i].outbound={}),void 0===g.streams[i].outbound[wb.local]&&(g.streams[i].outbound[wb.local]={}),g.streams[i].outbound[wb.local].rtt=g.streams[i].inbound[wb.remote].rtt);return g}function Q(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===yb.bad?a.streams[b].inbound[d].mark=2:c===yb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===yb.bad?a.streams[b].outbound[d].mark=2:c===yb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function R(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function S(a){var b={};a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),Ja&&(b.conferenceURL=Ja);var c,d,e,f;b.streams={};for(c in a.streams)if(a.streams.hasOwnProperty(c)){if(void 0===b.streams[c]&&(b.streams[c]={}),a.streams[c].cname&&(b.streams[c].cname=a.streams[c].cname),a.streams[c].msid&&(b.streams[c].msid=a.streams[c].msid),a.streams[c].userID&&(b.streams[c].remoteUserID=a.streams[c].userID),a.streams[c].usage&&(b.streams[c].usageLabel=a.streams[c].usage),a.streams[c].associatedVideoTag&&(b.streams[c].associatedVideoTag=a.streams[c].associatedVideoTag),void 0!==a.streams[c].inbound)for(d in a.streams[c].inbound)a.streams[c].inbound.hasOwnProperty(d)&&(e=a.streams[c].inbound[d],d===wb.local&&(b.streams[c].reportType=wb.inbound,e.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=e.csioIntFL),e.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=e.csioIntBRKbps),e.hasOwnProperty("csioMark")&&(b.streams[c].quality=e.csioMark),e.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=e.csioMediaType),e.hasOwnProperty("googRtt")&&(b.streams[c].rtt=e.googRtt),e.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=e.mozRtt),e.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=e.roundTripTime),e.hasOwnProperty("jitter")&&(b.streams[c].jitter=e.jitter),e.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=e.googJitterReceived),e.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=e.audioOutputLevel),e.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=e.audioInputLevel)));if(void 0!==a.streams[c].outbound)for(d in a.streams[c].outbound)a.streams[c].outbound.hasOwnProperty(d)&&d===wb.local&&(f=a.streams[c].outbound[d],b.streams[c].reportType=wb.outbound,f.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=f.csioIntFL),f.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=f.csioIntBRKbps),f.hasOwnProperty("csioMark")&&(b.streams[c].quality=f.csioMark),f.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=f.csioMediaType),f.hasOwnProperty("googRtt")&&(b.streams[c].rtt=f.googRtt),f.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=f.mozRtt),f.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=f.roundTripTime),f.hasOwnProperty("jitter")&&(b.streams[c].jitter=f.jitter),f.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=f.googJitterReceived),f.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=f.audioInputLevel),f.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=f.audioOutputLevel))}return b}function T(a,b,c,e,g,h){var i=f();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&ma()&&!cb?(d("Pushing to the cloud ",a),na(ob.processedStats,mb.fabricStats,a,h),b.latestEventSent=i,b.lastFabricState=b.pcState):(a.clockUnsynced=cb,Pb({type:ob.processedStats,action:mb.fabricStats,data:a}),a.hasOwnProperty("token")||rc(Da,Ga,g))}function U(a,b,c,d,e,h,k){function l(l){var m=f(),n=g();void 0===e.lastRawStatsSentInterval||null===e.lastRawStatsSentInterval?e.lastRawStatsSentInterval=n-e.statsPollingStart:e.lastRawStatsSentInterval=n-e.rawstatsTS+e.lastRawStatsSentInterval,void 0===e.lastProcessedStatsSentInterval||null===e.lastProcessedStatsSentInterval?e.lastProcessedStatsSentInterval=n-e.statsPollingStart:e.lastProcessedStatsSentInterval=n-e.rawstatsTS+e.lastProcessedStatsSentInterval,e.rawstatsTS=n;var o={},p=Ya.codebase;o.version=Aa,o.appID=Da,o.conferenceID=encodeURIComponent(c),o.apiTS=m,o.timeShift=0,o.fabricState=e.pcState,o.pcID=e.pcHash,void 0!==d&&(o.ucID=d),Ha?o.token=Ha.challenge.token:rc(Da,Ga,a),o.localID=encodeURIComponent(a),o.remoteID=encodeURIComponent(b),o.deviceID=Ia;var q,r,s,t,u,w,x,y={streams:{}},z=null,A=!1,B=!1,C={},D={};if(p===Hb.firefox&&"Safari"!==Ya.name)z=[],l.forEach(function(a){z.push(a)});else if(p===Hb.chrome&&"Safari"!==Ya.name)z=l.result();else{z=[];for(q in l)z.push(l[q])}for(q=0;q<z.length;++q)if(r=Z(z[q]),s=W(JSON.parse(r),p),!$(s))if(s.hasOwnProperty("Transport"))t="Transport",y.hasOwnProperty(t)||(y[t]=[]),p!==Hb.firefox?(parseInt(s[t].bytesReceived,10)>0||parseInt(s[t].bytesSent,10)>0)&&(y[t].push(s[t]),"true"===s[t].googActiveConnection&&(o.activeConnectionIndex=y[t].length)):(y[t].push(s[t]),"true"===s[t].selected&&(o.activeConnectionIndex=y[t].length));else if(s.hasOwnProperty("localCandidate"))C[s.localCandidate.id]=s.localCandidate;else if(s.hasOwnProperty("remoteCandidate"))D[s.remoteCandidate.id]=s.remoteCandidate;else if(s.hasOwnProperty("bwe"))y.bwe=s.bwe;else{if(w=Rb(s.ssrc),void 0===w||!w.localStartTime){var E=Tb(b,c,d,e,h,null);E&&(B=!0),w=Rb(s.ssrc)}w&&(u=w.remoteUserID),void 0===u&&(u=b),void 0===y.streams[s.ssrc]&&(y.streams[s.ssrc]={userID:u},void 0!==w&&(y.streams[s.ssrc].cname=w.cname,y.streams[s.ssrc].msid=w.msid)),s.inbound?(void 0===y.streams[s.ssrc].inbound&&(y.streams[s.ssrc].inbound={}),x=y.streams[s.ssrc].inbound,x[s.reportType]={data:s.data},w&&(y.streams[s.ssrc].usage=w.usage,y.streams[s.ssrc].associatedVideoTag=w.associatedVideoTag)):(void 0===y.streams[s.ssrc].outbound&&(y.streams[s.ssrc].outbound={}),y.streams[s.ssrc].outbound[s.reportType]={data:s.data})}p===Hb.firefox&&(y.Transport=R(y.Transport,C,D));var F;if(y.Transport)for(F=0;F<y.Transport.length;F++)y.Transport[F].hash=v(y.Transport[F],p);o.statistics=y,y.Transport&&(A=Y(y.Transport,e)),A&&_b(h,nb.updatedConfiguration,c),e.pcState===zb.disrupted&&ba(o);var G=P(e,y,p,m,c,d);if(y.Transport&&(G.Transport=J(e,y.Transport,p,m)),y.bwe&&(G.bwe=y.bwe),void 0===e.processedStatsTupleArray&&(e.processedStatsTupleArray=[]),xa){var H=S(G);xa(H)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=i(),G.batteryStatus.isBatteryCharging=j(),G=Q(G),e.processedStatsTupleArray.push(G),o.processedStatistics=e.processedStatsTupleArray,e.lastStatsSent=o;var I=ra(o),K=ra(o);delete I.processedStatistics,delete K.statistics,B&&Ub(nb.ssrcMap,b,c,d,Sb(),e.pcHash),(e.lastProcessedStatsSentInterval>=Na||e.initialPhaseOver)&&(e.processedStatsTupleArray=[],T(K,e,c,b,a,k),e.lastProcessedStatsSentInterval=0)}return l}function V(a){var b;return Ab.hasOwnProperty(a)?a===Ab.createOffer||a===Ab.createAnswer||a===Ab.setRemoteDescription?b=Bb.negotiationFailure:a===Ab.setLocalDescription?b=Bb.sdpError:a===Ab.addIceCandidate?b=Bb.sdpError:a===Ab.getUserMedia?b=Bb.mediaConfigError:a===Ab.iceConnectionFailure?b=Bb.iceFailure:a===Ab.signalingError?b=Bb.signalingError:(a===Ab.applicationLog||Ab.applicationError)&&(b=Bb.applicationLog):b=Jb.invalidWebRTCFunctionName,
b}function W(a,b){var c={};return b===Hb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inboundrtp"===a.type,c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===Hb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.inbound=!1:c.inbound=!0,c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"VideoBwe"===a.type&&(c.bwe=a):b===Hb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inbound-rtp"===a.type,c.data=a,c.reportType="local"):"transport"===a.type&&(c.Transport=a)),c}function X(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function Y(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c&&(b>=0&&2>=b&&(l=X(b)),!0)};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function Z(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function $(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function _(a){return{magicKey:a,statsSubmissionInterval:Sa,endpoint:$a,localUserName:Fa}}function aa(a,b,c){var d=_a[a];void 0===d&&(_a[a]={},_a[a].participants={},c&&(_a[a].userJoinedSent=!0),b&&(_a[a].refreshPresence=b))}function ba(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function ca(a){return clearInterval(a),null}function da(){var a;for(a in _a)_a.hasOwnProperty(a)&&(_a[a].refreshPresence=ca(_a[a].refreshPresence),delete _a[a].refreshPresence);ta()}function ea(){var a,b=function(a){return setInterval(function(){Wb(a)},Ua)};for(a in _a)_a.hasOwnProperty(a)&&(Wb(a),_a[a].refreshPresence=b(a));ua()}function fa(a){var b,c=_a[a],d=!1;if(void 0!==c)if(Object.keys(c.participants).length>0)d=!0;else for(b=0;b<eb.length;b++)if(eb[b].confID===a){d=!0;break}return d}function ga(a,b,c){var d,e=_a[a];if(void 0===e)d=new Hashtable({hashCode:l,equals:n}),d.put(c.pc,c),_a[a].participants[b]=d;else{var f=e.participants[b];if(void 0===f)d=new Hashtable({hashCode:l,equals:n}),d.put(c.pc,c),e.participants[b]=d;else{if(f.containsKey(c.pc))return;f.put(c.pc,c)}}}function ha(a,b){var c=!1;if(!_a[a])return{conferenceFinished:c,ucID:null};var d=_a[a].ucID;return 0===_a[a].participants[b].size()&&delete _a[a].participants[b],0===Object.keys(_a[a].participants).length&&(ca(_a[a].refreshPresence),ta(),delete _a[a],c=!0),{conferenceFinished:c,ucID:d}}function ia(a,b){Ub(nb.userLeft,null,a,b,null,null,null),gb=ca(gb),ta(),fb=Mb,Mb=null}function ja(a,b,c){var d=!1;if(null!==a&&void 0===a.challenge)return d;if(null!==a&&a.challenge.appID===b&&a.challenge.userID===encodeURIComponent(c)){var e=null;if(navigator.mozGetUserMedia){var g=a.challenge.expires.split(" ").join("T");e=Date.parse(g)}else e=new Date(a.challenge.expires);var h=new Date(f());e>h&&(d=!0)}return d}function ka(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),Ja[a]=Ca+encodeURIComponent(a)+"&ucid="+b}function la(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ma(){return Pa}function na(a,b,c,d){a===ob.clockSync?ma()?(bb.syncStartTime=g(),c.syncStartTime=bb.syncStartTime,c.offsetResultsLength=bb.offsetResults.length,Oa.emit(a,JSON.stringify(c)),d&&b!==mb.fabricStats&&d(qb.success,b+" sent to the backend.")):setTimeout(function(){sc()},100):ja(Ha,Da,Ea)?cb&&c.action!==nb.userJoined&&c.action!==nb.refreshPresence&&c.action!==nb.fabricSetupFailed||!ma()?(c.clockUnsynced=cb,Pb({type:b,action:a,data:c,callback:d})):(Oa.emit(a,JSON.stringify(c)),d&&b!==mb.fabricStats&&d(qb.success,b+" sent to the backend.")):rc(Da,Ga,Ea,function(e,f){e!==qb.success?(e===sb.authOngoing&&(c.clockUnsynced=cb,Pb({type:b,action:a,data:c,callback:d})),d&&e!==sb.authOngoing&&d(e,f)):e===qb.success&&"SDK authentication successful."===f&&(cb&&b!==nb.userJoined&&c.action!==nb.refreshPresence&&c.action!==nb.fabricSetupFailed||!ma()?(c.clockUnsynced=cb,Pb({type:b,action:a,data:c,callback:d})):(c.token=Ha.challenge.token,Oa.emit(a,JSON.stringify(c)),d&&b!==mb.fabricStats&&d(qb.success,b+" sent to the backend.")))})}function oa(a,b,d,e,f){var g=new c(b,"TEXT"),h=g.getHMAC(a,"TEXT","SHA-1","B64"),i={};i.version=Aa,i.challenge={},i.challenge.response=h,i.challenge.original=b,i.appID=d,i.userID=encodeURIComponent(e),i.authType=Ba;var j=ya+"o/challenge";qc(j,JSON.stringify(i),function(c){var g;if(200===c.status)g=JSON.parse(c.response),void 0!==g.challenge.status&&g.challenge.status!==qb.ok?g.challenge.reason===rb.csProtoError?(Wa=!1,pa(f)):g.challenge.reason===rb.csNoAuthState&&(Xa||(Xa=setTimeout(function(){rc(Da,Ga,Ea,f)},Va))):(g.appID=d,window.localStorage.setItem("auth_data",JSON.stringify(g)),Da=d,Ga=a,Ea=e,Ha=g,Wa=!1,Sa=parseInt(g.challenge.submissionInterval,10),Ta=g.challenge.collectSDP,f&&f(qb.success,"SDK authentication successful."),ma()?(Ob(),f&&f(qb.success,"WebSocket establishment successful.")):uc(ya+Ra,function(a,b){void 0!==f&&f(a,b)}));else if(200!==c.status&&((502===c.status||0===c.status)&&setTimeout(function(){oa(a,b,d,e,f)},Va),f)){var h;400===c.status?(h=c.responseText,f(qb.authError,h)):502===c.status||0===c.status?(h="HTTP "+c.status+", "+c.statusText+". Server temporarily unavailable. Retrying in "+Va+"ms",f(qb.appConnectivityError,h)):(h="HTTP "+c.status+", "+c.statusText+". "+c.responseText,f(qb.httpError,h))}})}function pa(a){return a?void a(qb.csProtoError,"Fatal authentication error. Invalid auth protocol message."):void console.error("Fatal authentication error. Invalid auth protocol message.")}function qa(a){a&&a(sb.authOngoing,null)}function ra(a){if(null===a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)b[c]=ra(a[c]);return b}function sa(){var a={};Object.keys(_a).forEach(function(b){var c=_a[b];if(!c)return!0;var d={ucID:c.ucID,userJoinedSent:c.userJoinedSent},e={};c.participants&&Object.keys(c.participants).forEach(function(a){for(var b=c.participants[a].values(),d=[],f=0;f<b.length;f++){var g=b[f];d.push({pcID:g.pcHash,pcState:g.pcState,iceConnectionState:g.iceConnectionState,iceGatheringState:g.iceGatheringState,iceCandidatesNumber:g.iceCandidates.length})}e[a]=d}),d.participants=e,a[b]=d});var b={authStatus:!!Ha,clockSync:!cb,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:Aa};pc(Da,Ea,"stateMachine",b)}function ta(){hb||(hb=setInterval(function(){sa()},ib))}function ua(){ca(hb),hb=null}var va,wa,xa,ya="https://collector.callstats.io:443/",za="443",Aa="3.12.3",Ba="BasicAuth",Ca="https://dashboard.callstats.io/search?confid=",Da=-1,Ea="",Fa=null,Ga=null,Ha=null,Ia=null,Ja={},Ka=!1,La=!1,Ma=3e4,Na=1e4,Oa=null,Pa=!1,Qa=!1,Ra="collectCallStats",Sa=15e3,Ta=!1,Ua=1e4,Va=5e3,Wa=!1,Xa=null,Ya=detectBrowserInfo(),Za=measureAppLoadingPerformance(Ya),$a={type:"browser",name:Ya.name,ver:Ya.ver,os:Ya.os},_a={},ab={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},bb={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},cb=!0,db={},eb=[],fb=null,gb=null,hb=null,ib=2e4,jb=[],kb=100,lb=null;"Firefox"===Ya.name?lb=mozRTCPeerConnection:"Chrome"===Ya.name||"Opera"===Ya.name?lb=webkitRTCPeerConnection:"Safari"===Ya.name?d("Browser type Safari"):"Edge"===Ya.name&&(lb=window.RTCPeerConnection);var mb={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},nb={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},ob={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},pb={success:"success",failure:"failure"},qb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",ok:"OK"},rb={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},sb={authOngoing:"authOngoing"},tb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},ub={local:"local",remote:"remote"},vb={excellent:5,good:4,fair:3,poor:2,bad:1},wb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},xb={excellent:3,fair:2,bad:1},yb={excellent:"excellent",fair:"fair",bad:"bad"},zb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},Ab={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},Bb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},Cb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},Db={video:{gThreshold:.8,rThreshold:.3}},Eb={video:{gThreshold:400,rThreshold:1e3}},Fb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},Gb={audio:{gThreshold:240,rThreshold:400}},Hb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},Ib={unknown:"unknown",audio:"audio",video:"video"};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:Aa,eventType:"error",message:a.message,pageURL:window.location.href};for(b in _a)_a.hasOwnProperty(b)&&(d.conferenceID=b,pc(Da,Ea,"onErrorLog",d),c=!0);c||pc(Da,Ea,"onErrorLog",d)}});var Jb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Kb="fabricSetupFailed error reported by the developer",Lb="Connectivity Failure",Mb=e(),Nb=function(a,b){if(!Ha)return void rc(Da,Ga,Ea);if(!cb){var c,d,e,g=f(),h=[],i=Math.max(Sa/jb.length,kb);for(c=0;c<jb.length;c++)if(d=jb[c],d.data.action!==nb.userJoined){if(d.data.token=Ha.challenge.token,(a&&d.data.apiTS>=g-b||!d.data.ucID)&&(e=decodeURIComponent(d.data.conferenceID),d.data.ucID=_a[e].ucID),d.data.clockUnsynced&&(d.data.apiTS+=bb.currentOffset),d.action===mb.fabricStats&&d.data.clockUnsynced&&d.data.processedStatistics&&d.data.processedStatistics.length>0)for(var j=0;j<d.data.processedStatistics.length;j++)d.data.processedStatistics[j].apiTS+=bb.currentOffset;delete d.data.clockUnsynced,q(d,i*(c+1))}else h.push(jb[c]);jb=h}},Ob=function(){if(!Ha)return void rc(Da,Ga,Ea);var a,b,c=[],d=Math.max(Sa/jb.length,kb);for(a=0;a<jb.length;a++)b=jb[a],b.type!==ob.callStatsEvent||b.data.action!==nb.userJoined&&b.data.action!==mb.fabricSetupFailed?c.push(jb[a]):(b.data.token=Ha.challenge.token,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+bb.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Sa),q(b,d*(a+1)));jb=c},Pb=function(a){jb.push(a)},Qb=function(a,b){var c=RegExp.prototype.test.bind(/^([a-z])=(.*)/),d=/^ssrc:(\d*) ([\w_]*):(.*)/;a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],e=a.slice(2);if("a"===c&&d.test(e)){var h=e.match(d),i=h[1];void 0===db[i]&&(db[i]={}),db[i][h[2]]=h[3],db[i].localStartTime=g(),db[i].syncedStartTime=f(),db[i].streamType=b}})},Rb=function(a){return db[a]},Sb=function(){return db},Tb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Qb(g,wb.outbound),Qb(h,wb.inbound),Ta){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Vb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Ub=function(a,b,c,d,e,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=f(),j={version:Aa,apiTS:i,action:a,localID:encodeURIComponent(Ea),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:Da,ucID:d,pcID:g,deviceID:Ia,value:e};return null===b&&(j.remoteID=null),null===c?void pc(Da,Ea,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(Ha&&ma()&&(d&&!cb||a===nb.userJoined||a===mb.fabricSetupFailed||a===nb.refreshPresence)?(j.token=Ha.challenge.token,na(ob.callStatsEvent,a,j,h)):(j.clockUnsynced=cb,Ha||rc(Da,Ga,Ea),a!==nb.fabricStatsCaching&&a!==nb.refreshPresence&&Pb({type:ob.callStatsEvent,action:ob.callStatsEvent,data:j,callback:h})))},Vb=function(a,b,c,d,e,g){var h=f(),i={version:Aa,appID:Da,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(Ea),remoteID:encodeURIComponent(a),pcID:e,deviceID:Ia,sdpPayload:d};Ha&&ma()&&c&&!cb?(i.token=Ha.challenge.token,na(ob.sdpSubmission,ob.sdpSubmission,i,g)):(i.clockUnsynced=cb,Pb({type:ob.sdpSubmission,action:ob.sdpSubmission,data:i,callback:g}),Ha||rc(Da,Ga,Ea))},Wb=function(a){var b={ucID:_a[a].ucID,magicKey:Mb,endpoint:$a,fabricState:{},connectedDevices:va},c=_a[a];if(c){var d,e,f=c.participants,g=0;for(d in f){e=f[d];for(var h=e.keys(),i=0;i<h.length;i++){var j=e.get(h[i]),k=j.pcHash;b.fabricState[g]={},b.fabricState[g].pc=k,b.fabricState[g].userId=d,b.fabricState[g].pcState=j.pcState,b.fabricState[g].iceConnectionState=j.pc.iceConnectionState,b.fabricState[g].iceGatheringState=j.pc.iceGatheringState,b.fabricState[g].iceCandidatesNumber=j.iceCandidates.length,b.fabricState[g].numNegotiationNeededCalls=j.numNegotiationNeededCalls,g++}}}cb||(b.clockSyncOffset=bb.currentOffset),Ub(nb.refreshPresence,null,a,_a[a].ucID,b,null)},Xb=function(a){var b={appID:Da,userID:encodeURIComponent(Ea),version:Aa,endpoint:$a,pagePerf:Za,endpointID:Ia,wsID:a.io.engine.id};-1!==Da&&Ha&&(b.token=Ha.challenge.token,a.emit(ob.registerPresence,JSON.stringify(b)))},Yb=function(){var a=window.localStorage.getItem("feedback"),b=JSON.parse(window.localStorage.getItem("auth_data"));if(null!==a){var c=JSON.parse(a),d=b.challenge.token===c.token;d||Ea!==c.userID||(c.token=b.challenge.token,d=!0),d?na(ob.userFeedback,ob.userFeedback,c):window.localStorage.removeItem("feedback")}},Zb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},$b=function(a,b,d,e,f,h){if(!a||!b||null===d||void 0===d||0>=a)return console.error("initialize: Argument missing/invalid"),Zb(pb.failure,"initialize: Argument missing/invalid");if("string"==typeof a&&(a=parseInt(a,10)),Da=a,Ga=b,"object"==typeof d?(Fa=d.userName,Ea=d.displayName):Ea=d,h&&(h.disableBeforeUnloadHandler===!0&&(Ka=!0),(null!==h.applicationVersion||void 0!==h.applicationVersion)&&($a.appVer=h.applicationVersion)),p(),Ia=window.localStorage.getItem("endpointID"),null===Ia){var i=g(),j=Math.random()*i,l=new c(j.toString(),"TEXT");Ia=l.getHash("SHA-1","B64"),window.localStorage.setItem("endpointID",Ia)}k(),xa=f;var m=JSON.parse(window.localStorage.getItem("auth_data"));return ja(m,a,d)?(e&&e(qb.success,"SDK already authenticated."),Sa=parseInt(m.challenge.submissionInterval,10),Ta=m.challenge.collectSDP,Ha=m,ma()||uc(ya+Ra,e)):rc(a,b,d,e),Zb(pb.success)},_b=function(a,b,c,d){if(!a||!b||!c)return console.error("sendFabricEvent: Arguments missing/Invalid"),Zb(pb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!Da||0>Da||!Ga||""===Ea||!_a[c])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Zb(pb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===mb.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Zb(pb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!u(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Zb(pb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!mb.hasOwnProperty(b)&&!nb.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Zb(pb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var e=null,f=null,h=g(),i=_a[c],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Zb(pb.failure,"sendFabricEvent: Conference ID not found!");if(Object.keys(_a[c].participants).length>0&&(f=gc(i,a),null!==f&&(j=_a[c].participants[f].get(a))),null===j){var k=l(a),m=ic(k);if(null===m)return console.error("sendFabricEvent: pcObject is null"),Zb(pb.failure,"sendFabricEvent: pcObject is null");f=m.remoteID,j=m.fabricData}var n=j.startTime;if(!(b===mb.fabricSetup||b===nb.autoFabricSetup&&j.fabricSetupSent)){if(b===nb.autoFabricSetup){var o=h-j.startTime;e={setupDelay:o,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.pcState=zb.established,j.fabricSetupSent=!0}else if(b===nb.autoFabricSetupFailed)e={failureDelay:j.setupFailureTime,reason:Bb.iceFailure,domError:Lb};else if(b===nb.fabricDisrupted)e={disruptionDelay:j.connectivityIceStatusDelay};else if(b===nb.updatedConfiguration)e=j.transportData;else if(b===mb.fabricSetupFailed){var p=h-n;e={failureDelay:p,reason:Bb.iceFailure,domError:Kb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":Ab.iceConnectionFailure,magicKey:Mb,endpoint:$a}}else if(b===mb.activeDeviceList){if(!d||!d.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Zb(pb.failure,"sendFabricEvent: Arguments missing/Invalid");e={magicKey:Mb,endpoint:$a,activeDevicelist:d.deviceList}}if(Ub(b,f,c,i.ucID,e,j.pcHash,j.pcCallback),(b===mb.fabricTerminated||b===nb.autoFabricSetupFailed||b===mb.fabricSetupFailed)&&_a[c].participants[f]){j&&(j.statsInterval=ca(j.statsInterval)),_a[c].participants[f].remove(a);var q=ha(c,f);q.conferenceFinished&&ia(c,q.ucID)}if((b===mb.fabricSetup||b===mb.fabricUsageEvent)&&!j.fabricUsageSent){var r=j.fabricUsage;j.fabricUsageSent=!0,Ub(mb.fabricUsageEvent,f,c,i.ucID,r,j.pcHash,null)}return Zb(pb.success)}},ac=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},bc=function(a,b,c,d,f,h){if(void 0===a||!c||!b)return console.error("reportError: Arguments missing/invalid"),Zb(pb.error,"reportError: Arguments missing/invalid");if(0>Da||!Da||!Ga||""===Ea)return console.error("reportError: SDK is not initialized"),Zb(pb.error,"reportError: SDK is not initialized");if(!Ab.hasOwnProperty(c))return console.error("reportError: Invalid webRTC functionName value: %o",c),Zb(pb.error,"reportError: Invalid webRTC functionName value: "+c);void 0===d&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=g(),n=_a[b],o=null;if(i=V(c),d&&d instanceof DOMException)d={message:d.message,name:d.name};else if(d&&"object"==typeof d){var p={};"message"in d&&(p.message=d.message),"name"in d&&(p.name=d.name),"constraintName"in d&&(p.constraintName=d.constraintName),"stack"in d&&(p.stack=d.stack),d=p}if(u(a)){if(void 0===n)return console.error("reportError: Conference ID not found!"),Zb(pb.error,"reportError: Conference ID not found!");if(Object.keys(_a[b].participants).length>0&&(k=gc(n,a),null!==k&&(o=_a[b].participants[k].get(a))),null===o){var q=hc(a);if(null===q)return console.error("reportError: Invalid pcObject passed as argument"),Zb(pb.error,"reportError: Invalid pcObject passed as argument");k=q.remoteID,o=q.fabricData,o.pcHash=m(k.concat(":",b))}var r=o.startTime,s=l-r;if(j={failureDelay:s,reason:i,domError:d,fabricState:o.pcState,iceConnectionState:o.pc.iceConnectionState,"function":c,magicKey:Mb,endpoint:$a},c===Ab.applicationLog||c===Ab.applicationError?Ub(mb.applicationErrorLog,k,b,n.ucID,j,o.pcHash,o.pcCallback):Ub(mb.fabricSetupFailed,k,b,n.ucID,j,o.pcHash,o.pcCallback),f||h||a&&a.localDescription||a&&a.remoteDescription){var t={sdp:{}};t.sdp.localSDP=ac(a,f,"localDescription"),t.sdp.remoteSDP=ac(a,h,"remoteDescription"),Vb(k,b,n.ucID,t,o.pcHash)}}else{null===Mb&&(Mb=e());var v=e();j={failureDelay:0,reason:i,domError:d,"function":c,magicKey:Mb,endpoint:$a},c===Ab.applicationLog||c===Ab.applicationError?Ub(mb.applicationErrorLog,k,b,null,j,v,null):Ub(mb.fabricSetupFailed,k,b,null,j,v,null)}return Zb(pb.success)},cc=function(a,b,c){if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Zb(pb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Zb(pb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Zb(pb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Zb(pb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var d=_a[a],e=null;void 0!==d&&void 0!==d.ucID&&(e=d.ucID);var f=null;if(f=null===Mb?fb:Mb,null===e&&(e=la(a)),null===e)return console.error("sendUserFeedback: ucID unavailable"),Zb(pb.error,"sendUserFeedback: ucID unavailable");var g={conferenceID:encodeURIComponent(a),magicKey:f,appID:Da,version:Aa,ucID:e,userID:encodeURIComponent(b.userID),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?g.userQoe.video=b.video:g.userQoe.video=-1,b.hasOwnProperty("audio")?g.userQoe.audio=b.audio:g.userQoe.audio=-1,b.hasOwnProperty("screen")?g.userQoe.screen=b.screen:g.userQoe.screen=-1,b.hasOwnProperty("comment")?g.userQoe.comment=b.comment:g.userQoe.comment=-1,Ha&&!cb?(g.token=Ha.challenge.token,window.localStorage.setItem("feedback",JSON.stringify(g)),na(ob.userFeedback,ob.userFeedback,g,c)):(g.clockUnsynced=cb,Pb({type:ob.userFeedback,action:ob.userFeedback,data:g,callback:c}),rc(Da,Ga,Ea)),Zb(pb.success)},dc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.displayName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Zb(pb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Zb(pb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!u(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Zb(pb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=_a[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Zb(pb.error,"associateMstWithUserID: conferenceID doesn't exist");var i,j,k=h.participants,l=null;for(i in k)if(k.hasOwnProperty(i)&&(j=k[i],l=j.get(a)))break;if(null===l){var m=hc(a);if(null===m)return console.error("associateMstWithUserID: Unknown pcObject passed"),Zb(pb.error,"associateMstWithUserID: Unknown pcObject passed");l=m.fabricData}var n=Rb(d);return void 0===n&&(db[d]={},n=Rb(d)),n.remoteUserID=g,n.ssrc=d,n.associatedVideoTag=f,n.usageLabel=e,f&&g!==Ea&&t(g,c,f,a,d),Zb(pb.success)},ec=function(a,b,c,d,f){var h=null,i={authStatus:!!Ha,clockSync:!cb,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:d,version:Aa};if(pc(Da,Ea,"stateMachine",i),h="object"==typeof b?b.displayName:b,!(a&&h&&c&&d))return console.error("addNewFabric: Arguments missing/Invalid"),Zb(pb.error,"addNewFabric: Arguments missing/Invalid");if(0>Da||!Da||!Ga||""===Ea)return console.error("addNewFabric: SDK not initialized."),Zb(pb.error,"addNewFabric: SDK not initialized");if(""===d||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Zb(pb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!u(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Zb(pb.error,"addNewFabric: Invalid PeerConnection object passed");if(!tb.hasOwnProperty(c)||c instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Zb(pb.error,"addNewFabric: Invalid fabricUsage value");var j=g();null===Mb&&(Mb=e());var k=null,m=!1;if(!fa(d)){var n=_(Mb);Ub(nb.userJoined,null,d,null,n,null,null),m=!0,i={authStatus:!!Ha,clockSync:!cb,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:d,version:Aa},pc(Da,Ea,"stateMachine",i)}a.addEventListener("icecandidate",nc,!1),a.addEventListener("iceconnectionstatechange",mc,!1),a.addEventListener("signalingstatechange",jc,!1),a.addEventListener("negotiationneeded",lc,!1);var p=l(a),q={pc:a,fabricUsage:c,magicKey:Mb,startTime:j,pcCallback:f,pcState:zb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:j,pcHash:p,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};if("function"==typeof a&&(a.callstatsID=e()),("connected"===a.iceConnectionState||"completed"===a.iceConnectionState)&&(q.pcState=zb.established),aa(d,k,m),o(a))ga(d,h,q);else{var r={confID:d,remoteID:h,fabricData:q};a.callstatsID&&(r.callstatsID=a.callstatsID),eb.push(r)}return q.pcState===zb.established&&(_b(a,nb.autoFabricSetup,d),kc(q,a,d,h)),Zb(pb.success)},fc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Zb(pb.error,"reportUserIDChange: Arguments missing/Invalid");if(0>Da||!Da||!Ga||""===Ea)return console.error("reportUserIDChange: SDK not initialized."),Zb(pb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Zb(pb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!u(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Zb(pb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=_a[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Zb(pb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),pc(Da,Ea,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Zb(pb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,Object.keys(_a[b].participants).length>0&&(e=gc(g,a),null!==e&&(f=_a[b].participants[e].get(a))),null===f){var i=hc(a);if(null===i)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Zb(pb.error,"reportUserIDChange: Invalid pcObject passed as argument");e=i.remoteID,f=i.fabricData}var j={id:c,idType:d};return Ub(mb.userIDChangedEvent,e,b,g.ucID,j,null,f.pcCallback),Zb(pb.success)},gc=function(a,b){var c;for(c in a.participants)if(a.participants.hasOwnProperty(c)&&a.participants[c].containsKey(b))return c;return null},hc=function(a){var b;for(b=0;b<eb.length;b++)if(a===eb[b].fabricData.pc||a.callstatsID&&a.callstatsID===eb[b].callstatsID)return eb[b];return null},ic=function(a){var b;for(b=0;b<eb.length;b++)if(eb[b].fabricData.pcHash===a)return eb[b];return null},jc=function(a){if(a){var b,c=Ya.codebase;if(c===Hb.firefox)b=a.target;else if(c===Hb.chrome)b=a.srcElement;else{if(c!==Hb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var d=b.signalingState;if("closed"===d){var e,f;for(e in _a)if(_a.hasOwnProperty(e))for(f in _a[e].participants)if(_a[e].participants.hasOwnProperty(f)&&_a[e].participants[f].containsKey(b))return void _b(b,mb.fabricTerminated,e)}else if("have-local-offer"===d||"have-remote-offer"===d||"stable"===d){var g,h,i,j,k=-1;for(g=0;g<eb.length;g++)if(j=eb[g].fabricData,(b===j.pc||b.callstatsID===j.pc.callstatsID)&&o(b)){h=eb[g].confID,i=eb[g].remoteID,k=g,j.pcHash=l(j.pc),ga(h,i,j);break}-1!==k&&eb.splice(k,1)}}}},kc=function(a,b,c,d){null===a.statsInterval&&(a.statsPollingStart=g(),oc(b,c,d),a.statsInterval=setInterval(oc,ab.statsSubmissionIntervalInMS[ab.currentActivePhaseIndex],b,c,d))},lc=function(a){if(a){var b,c=Ya.codebase;if(c===Hb.firefox)b=a.target;else if(c===Hb.chrome)b=a.srcElement;else{if(c!==Hb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,f;for(d in _a)if(_a.hasOwnProperty(d))for(e in _a[d].participants)if(_a[d].participants.hasOwnProperty(e)&&_a[d].participants[e].containsKey(b)){f=_a[d].participants[e].get(b);break}null==f&&(f=hc(b)),null!=f&&f.numNegotiationNeededCalls++}}},mc=function(a){if(a){var b,c=Ya.codebase;if(c===Hb.firefox)b=a.target;else if(c===Hb.chrome)b=a.srcElement;else{if(c!==Hb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,f,h,i;for(d in _a)if(_a.hasOwnProperty(d))for(e in _a[d].participants)if(_a[d].participants.hasOwnProperty(e)&&_a[d].participants[e].containsKey(b)){f=_a[d].participants[e].get(b),h=g(),i=h-f.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(f.gatheringIceCandidatesDelay=i),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(f.connectivityIceStatusDelay=i,f.pcState===zb.initializing?f.fabricSetupSent||_b(f.pc,nb.autoFabricSetup,d):f.pcState===zb.disrupted&&_b(f.pc,nb.fabricDisrupted,d),f.pcState=zb.established,kc(f,b,d,e)):"failed"===b.iceConnectionState?(f.setupFailureTime=i,_b(f.pc,nb.autoFabricSetupFailed,d),f.pcState=zb.failed):"disconnected"===b.iceConnectionState&&(f.startTime=g(),f.pcState=zb.disrupted,f.pcCallback&&f.pcCallback(qb.appConnectivityError,"Connectivity check for PC object to "+e+" failed.")),f.iceConnectionState=b.iceConnectionState;break}}}},nc=function(a){var b,c,d;
if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Ya.codebase;if(h===Hb.firefox)g=a.target;else if(h===Hb.chrome)g=a.srcElement;else{if(h!==Hb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i,j,k;for(i in _a)if(_a.hasOwnProperty(i))for(j in _a[i].participants)if(_a[i].participants.hasOwnProperty(j)&&_a[i].participants[j].containsKey(g))return k=_a[i].participants[j].get(g),void(void 0!==b&&-1===k.iceCandidates.indexOf(b)&&k.iceCandidates.push(b))}},oc=function(a,b,c){if(!_a.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!_a[b].participants.hasOwnProperty(c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return _b(a,mb.fabricTerminated,b),!0;var d=_a[b].participants[c].get(a);if(d.pcState!==zb.established&&d.lastFabricState===d.pcState)return!0;var e=Ya.codebase,f=Ya.name,h=_a[b].ucID;e===Hb.firefox||"Safari"===f?a.getStats(null,U(Ea,c,b,h,d,a,d.pcCallback),function(a){pc(Da,Ea,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})}):e===Hb.chrome?a.getStats(U(Ea,c,b,h,d,a,d.pcCallback)):e===Hb.edge&&a.getStats().then(U(Ea,c,b,h,d,a,d.pcCallback))["catch"](function(a){pc(Da,Ea,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})});var i,j=g(),k=j-d.statsPollingStart,l=5e3;(k>ab.statsSubmissionPhaseDurationInMS[ab.currentActivePhaseIndex]&&d.intervalAdaptionPhase||La===!0)&&(ca(d.statsInterval),La?(i=Ma,d.intervalAdaptionPhase=!1,La=!1):ab.currentActivePhaseIndex<ab.statsSubmissionIntervalInMS.length-1?(ab.currentActivePhaseIndex+=1,i=ab.statsSubmissionIntervalInMS[ab.currentActivePhaseIndex]):(i=Sa,d.intervalAdaptionPhase=!1),i>l&&(d.initialPhaseOver=!0),d.statsInterval=setInterval(oc,i,a,b,c))},pc=function(a,b,c,d){var e=ya+"generics",f={appID:a,userID:encodeURIComponent(b),version:Aa,eventType:c,data:d};qc(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})},qc=function(a,b,c){var d=new XMLHttpRequest;d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b)},rc=function(a,b,c,d){if(!(void 0===a||void 0===b||void 0===c||0>=a||0>c)){if(Wa)return void qa(d);Xa&&(clearTimeout(Xa),Xa=null),Wa=!0;var e=ya+"o/authorize",f={appID:a,userID:encodeURIComponent(c),version:Aa,authType:Ba};qc(e,JSON.stringify(f),function(e){var f;if(200===e.status)f=JSON.parse(e.response),void 0!==f.authorize.status&&f.authorize.status!==qb.ok?f.reason===rb.csProtoError&&(Wa=!1,pa(d)):oa(b,f.authorize.challenge,a,c,d);else if(200!==e.status&&(Wa=!1,(502===e.status||0===e.status||500===e.status)&&(Xa||(Xa=setTimeout(function(){rc(a,b,c,d)},Va))),void 0!==d)){var g;400===e.status?(g=e.responseText,d(qb.authError,g)):502===e.status||0===e.status||500===e.status?(g="HTTP "+e.status+", "+e.statusText+". Server temporarily unavailable. Retrying in "+Va+"ms",d(qb.appConnectivityError,g)):(g="HTTP "+e.status+", "+e.statusText+". "+e.responseText,d(qb.httpError,g))}})}},sc=function(){na(ob.clockSync,ob.clockSync,{userID:Ea},null)},tc=function(a,b){if(cb){var c=(b-bb.syncStartTime)/2;if(c>bb.maxAllowedLatency)bb.offsetResults=[],pc(Da,Ea,"log",{msg:"clockSync restarting"});else{var d=a.now+c,e=d-b;bb.offsetResults.push(e)}if(bb.offsetResults.length>=bb.syncAttempts){var f=bb.offsetResults.reduce(function(a,b){return a+b});bb.currentOffset=f/bb.offsetResults.length,bb.offsetResults=[],cb=!1,pc(Da,Ea,"log",{msg:"clockSync Done"})}else cb&&setTimeout(function(){sc()},100)}},uc=function(a,c){return Pa?(pc(Da,Ea,"log",{msg:"### _setupChannel is called when already connected!"}),void(c&&c(qb.success,"WebSocket establishment successful."))):Oa?void pc(Da,Ea,"log",{msg:"### _setupChannel is called when _connection is not null and not connected! Let's rely on auto reconnect!"}):(Oa=b.connect(a,{port:za,reconnect:!0,"reconnection delay":500,"max reconnection attempts":500,reconnectionDelayMax:8e3}),Oa.on("connect",function(){pc(Da,Ea,"log",{msg:"Successfully connected to the backend",io_ver:b.protocol}),Pa=!0,bb.syncHandler||(pc(Da,Ea,"log",{msg:"start clockSync"}),bb.offsetResults=[],sc(),bb.syncHandler=!0),Ob(),Qa?ea():Xb(Oa),Qa=!1}),Oa.on("disconnect",function(){Pa=!1,da(),cb&&(bb.offsetResults=[],bb.syncHandler=null,cb=!1),c&&c(qb.httpError,"Connection to the server disappeared.")}),Oa.on("connect_failed",function(){Pa=!1,c&&c(qb.wsChannelFailure,"WebSocket establishment failed.")}),Oa.on("reconnect",function(){Qa=!0}),Oa.on("reconnect_failed",function(){Pa=!1}),void Oa.on("response",function(a){var b=g(),d=JSON.parse(a);if("Error"===d.status)"Invalid client token."===d.reason&&(Ha=null,rc(Da,Ga,Ea)),c&&c(qb.csProtoError,a.reason);else if("200 OK"===d.status)if("feedback"===d.event)window.localStorage.removeItem("feedback");else if(d.event===nb.userJoined||d.event===nb.refreshPresence){var e,f=!1,h=null,i=decodeURIComponent(d.conferenceID),j=function(a){return setInterval(function(){Wb(a)},Ua)};for(e in _a)if(_a.hasOwnProperty(e)&&e===i){_a[e].ucID!==d.ucID&&(f=!0,ka(e,d.ucID),h=d.conferenceCreationTS?d.conferenceCreationTS:d.conferenceDuration),d.event!==nb.userJoined||_a[e].refreshPresence||(_a[e].refreshPresence=j(i),ua()),_a[e].ucID=d.ucID;break}Yb(),Nb(f,h)}else d.event===ob.clockSync&&tc(d,b)}))};return h(),uc(ya+Ra),ta(),{version:Aa,initialize:$b,fabricEvent:mb,addNewFabric:ec,sendFabricEvent:_b,sendUserFeedback:cc,associateMstWithUserID:dc,csError:qb,fabricUsage:tb,qualityRating:vb,webRTCFunctions:Ab,reportError:bc,reportUserIDChange:fc,userIDType:ub,callStatsAPIReturnStatus:pb}};"function"==typeof define&&define.amd?define("callstats",["jquery","socketio","sha"],b):a.callstats=b}(this);/**
 * @license jahashtable, a JavaScript implementation of a hash table. It creates a single constructor function called
 * Hashtable in the global scope.
 *
 * http://www.timdown.co.uk/jshashtable/
 * Copyright 2013 Tim Down.
 * Version: 3.0
 * Build date: 17 July 2013
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Hashtable=function(a){function b(a){return typeof a==o?a:""+a}function c(a){var d;return typeof a==o?a:typeof a.hashCode==n?(d=a.hashCode(),typeof d==o?d:c(d)):b(a)}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function e(a,b){return a.equals(b)}function f(a,b){return typeof b.equals==n?b.equals(a):a===b}function g(b){return function(c){if(null===c)throw new Error("null is not a valid "+b);if(c===a)throw new Error(b+" must not be undefined")}}function h(a,b,c,d){this[0]=a,this.entries=[],this.addEntry(b,c),null!==d&&(this.getEqualityFunction=function(){return d})}function i(a){return function(b){for(var c,d=this.entries.length,e=this.getEqualityFunction(b);d--;)if(c=this.entries[d],e(b,c[0]))switch(a){case s:return!0;case t:return c;case u:return[d,c[1]]}return!1}}function j(a){return function(b){for(var c=b.length,d=0,e=this.entries,f=e.length;f>d;++d)b[c+d]=e[d][a]}}function k(a,b){for(var c,d=a.length;d--;)if(c=a[d],b===c[0])return d;return null}function l(a,b){var c=a[b];return c&&c instanceof h?c:null}function m(){var b=[],e={},f={replaceDuplicateKey:!0,hashCode:c,equals:null},g=arguments[0],i=arguments[1];i!==a?(f.hashCode=g,f.equals=i):g!==a&&d(f,g);var j=f.hashCode,m=f.equals;this.properties=f,this.put=function(a,c){q(a),r(c);var d,g,i=j(a),k=null;return d=l(e,i),d?(g=d.getEntryForKey(a),g?(f.replaceDuplicateKey&&(g[0]=a),k=g[1],g[1]=c):d.addEntry(a,c)):(d=new h(i,a,c,m),b.push(d),e[i]=d),k},this.get=function(a){q(a);var b=j(a),c=l(e,b);if(c){var d=c.getEntryForKey(a);if(d)return d[1]}return null},this.containsKey=function(a){q(a);var b=j(a),c=l(e,b);return!!c&&c.containsKey(a)},this.containsValue=function(a){r(a);for(var c=b.length;c--;)if(b[c].containsValue(a))return!0;return!1},this.clear=function(){b.length=0,e={}},this.isEmpty=function(){return!b.length};var n=function(a){return function(){for(var c=[],d=b.length;d--;)b[d][a](c);return c}};this.keys=n("keys"),this.values=n("values"),this.entries=n("getEntries"),this.remove=function(a){q(a);var c,d=j(a),f=null,g=l(e,d);return g&&(f=g.removeEntryForKey(a),null!==f&&0==g.entries.length&&(c=k(b,d),b.splice(c,1),delete e[d])),f},this.size=function(){for(var a=0,c=b.length;c--;)a+=b[c].entries.length;return a}}var n="function",o="string",p="undefined";if(typeof encodeURIComponent==p||Array.prototype.splice===a||Object.prototype.hasOwnProperty===a)return null;var q=g("key"),r=g("value"),s=0,t=1,u=2;return h.prototype={getEqualityFunction:function(a){return typeof a.equals==n?e:f},getEntryForKey:i(t),getEntryAndIndexForKey:i(u),removeEntryForKey:function(a){var b=this.getEntryAndIndexForKey(a);return b?(this.entries.splice(b[0],1),b[1]):null},addEntry:function(a,b){this.entries.push([a,b])},keys:j(0),values:j(1),getEntries:function(a){for(var b=a.length,c=0,d=this.entries,e=d.length;e>c;++c)a[b+c]=d[c].slice(0)},containsKey:i(s),containsValue:function(a){for(var b=this.entries,c=b.length;c--;)if(a===b[c][1])return!0;return!1}},m.prototype={each:function(a){for(var b,c=this.entries(),d=c.length;d--;)b=c[d],a(b[0],b[1])},equals:function(a){var b,c,d,e=this.size();if(e==a.size()){for(b=this.keys();e--;)if(c=b[e],d=a.get(c),null===d||d!==this.get(c))return!1;return!0}return!1},putAll:function(a,b){for(var c,d,e,f,g=a.entries(),h=g.length,i=typeof b==n;h--;)c=g[h],d=c[0],e=c[1],i&&(f=this.get(d))&&(e=b(d,f,e)),this.put(d,e)},clone:function(){var a=new m(this.properties);return a.putAll(this),a}},m.prototype.toQueryString=function(){for(var a,c=this.entries(),d=c.length,e=[];d--;)a=c[d],e[d]=encodeURIComponent(b(a[0]))+"="+encodeURIComponent(b(a[1]));return e.join("&")},m}(),voxbone=voxbone||{};JsSIP.VoxboneLogger.setInfo(function(){var a=Array.prototype.slice.call(arguments);voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.INFO&&console.log.apply(console,a),5==a.length?(voxbone.Logger.addLogToBuffer("INFO: "+a[0]),voxbone.Logger.addLogToBuffer("INFO: "+a[3])):voxbone.Logger.addLogToBuffer("INFO: "+a[0])}),JsSIP.VoxboneLogger.setError=function(){var a=Array.prototype.slice.call(arguments);voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.ERROR&&console.error.apply(console,a),5==a.length?(voxbone.Logger.addLogToBuffer("ERROR: "+a[0]),voxbone.Logger.addLogToBuffer("ERROR: "+a[3])):voxbone.Logger.addLogToBuffer("ERROR: "+a[0])},extend(voxbone,{Logger:{loginfo:function(a){voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.INFO&&console.log(a),voxbone.Logger.addLogToBuffer("INFO: "+a)},logerror:function(a){voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.ERROR&&console.log(a),voxbone.Logger.addLogToBuffer("ERROR: "+a)},addLogToBuffer:function(a){voxbone.WebRTC.webrtcLogs=voxbone.WebRTC.webrtcLogs.concat("\r\n"),voxbone.WebRTC.webrtcLogs=voxbone.WebRTC.webrtcLogs.concat(a)},log_level:{NONE:0,ERROR:1,INFO:2}}}),extend(voxbone,{Pinger:{pingResults:[],ping:function(a,b){var c=(new Date).getTime(),d=this,e=this.recordPingResult;this.img=new Image,d.inUse=!0,this.img.onload=function(){var b=(new Date).getTime()-c;e(a,b),d.inUse=!1},this.img.onerror=function(b){d.inUse=!1,e(a,-1)},this.img.src=b+"?"+(new Date).getTime(),this.timer=setTimeout(function(){d.inUse&&(d.inUse=!1,e(a,-1))},1500)},recordPingResult:function(a,b){voxbone.Logger.loginfo("[ping] "+a+" replied in "+b);var c={name:a,ping:b};voxbone.Pinger.pingResults.push(c)},getBestPop:function(){var a=void 0;if(0==this.pingResults.length)a={name:"BE",ping:-1};else for(var b=0;b<this.pingResults.length;b++){var c=this.pingResults[b];(void 0==a||c.ping>0&&(a.ping<0||c.ping<a.ping))&&(a=c)}return a}}}),extend(voxbone,{WebRTC:{callStats:void 0,audioComponentName:"peer-audio",videoComponentName:"peer-video",allowVideo:!1,authServerURL:"https://webrtc.voxbone.com/rest/authentication/createToken",basicAuthServerURL:"https://webrtc.voxbone.com/rest/authentication/basicToken",webrtcLogs:"",rtcSession:{},callid:"",previous_callid:"",audioContext:void 0,localVolume:0,localVolumeTimer:void 0,dtmfTimer:void 0,audioScriptProcessor:{},preferedPop:void 0,configuration:{authorization_user:void 0,password:void 0,ws_servers:void 0,stun_servers:void 0,turn_servers:void 0,log_level:voxbone.Logger.log_level.INFO,post_logs:!1,post_logs_nocall:!1,webrtc_log:void 0,uri:"sip:voxrtc@voxbone.com",trace_sip:!0,register:!1,dialer_string:void 0,digit_duration:100,digit_gap:500},customEventHandler:{progress:function(a){},accepted:function(a){},getUserMediaFailed:function(a){alert("Failed to access mic/camera")},localMediaVolume:function(a){},failed:function(a){},ended:function(a){},authExpired:function(a){},getUserMediaAccepted:function(a){voxbone.Logger.loginfo("local media accepted")}},phone:void 0,context:void 0,init:function(a){voxbone.Logger.loginfo("auth server: "+this.authServerURL),$.ajax({type:"GET",url:this.authServerURL,headers:{Accept:"application/json"},contentType:"application/json; charset=utf-8",crossDomain:!0,cache:!1,data:{username:a.username,key:a.key,expires:a.expires,jsonp:"voxbone.WebRTC.processAuthData"},jsonp:!1,dataType:"jsonp"})},basicAuthInit:function(a,b){voxbone.Logger.loginfo("auth server: "+this.basicAuthServerURL),$.ajax({type:"GET",url:this.basicAuthServerURL,headers:{Accept:"application/json"},contentType:"application/json; charset=utf-8",crossDomain:!0,cache:!1,data:{username:a,key:b,jsonp:"voxbone.WebRTC.processAuthData"},jsonp:!1,dataType:"jsonp"})},processAuthData:function(a){this.configuration.ws_servers=a.wss,this.configuration.stun_servers=a.stunServers,this.configuration.turn_servers=a.turnServers,this.configuration.webrtc_log=a.log,this.configuration.authorization_user=a.username,this.configuration.password=a.password,void 0==this.preferedPop?(voxbone.Logger.loginfo("prefered pop undefined, pinging...."),this.pingServers=a.pingServers,$.each(this.pingServers,function(a,b){voxbone.Pinger.ping(a,b)})):voxbone.Logger.loginfo("preferred pop already set to "+this.preferedPop);var b=this.getAuthExpiration();b>0&&(voxbone.Logger.loginfo("Credential expires in "+b+" seconds"),setTimeout(this.customEventHandler.authExpired,750*b));var c=a.callStatsCredentials;voxbone.WebRTC.callStats=new callstats(null,io,jsSHA);var d=function(a,b){voxbone.Logger.loginfo("callStats Status: errCode= "+a+" errMsg= "+b)},e=a.username.split(":")[1];voxbone.WebRTC.callStats.initialize(c.appId,c.appSecret,e,d,null,null)},getAuthExpiration:function(a){var b=Math.floor((new Date).getTime()/1e3),c=this.configuration.authorization_user.split(/:/);return c[0]-b},initAudioElement:function(a,b){var c=document.getElementById(a);return c||(c=document.createElement("audio"),c.id=a,c.hidden=!1,c.autoplay=!0,document.body.appendChild(c)),c.src=(window.URL?URL:webkitURL).createObjectURL(b),c},initVideoElement:function(a,b){var c=document.getElementById(a);return c||(c=document.createElement("video"),c.id=a,c.hidden=!1,c.autoplay=!0,document.body.appendChild(c)),c.src=(window.URL?URL:webkitURL).createObjectURL(b),c},sendPreConfiguredDtmf:function(a){var b=void 0,c=0,d=!1;if(void 0!==voxbone.WebRTC.dtmfTimer&&(clearTimeout(voxbone.WebRTC.dtmfTimer),voxbone.WebRTC.dtmfTime=void 0),a.length>0){if(a[0].indexOf("ms")!=-1?c=parseInt(a[0].substring(0,a[0].indexOf("ms"))):b=a[0],a=a.slice(1,a.length),void 0!==b){Date.now();voxbone.WebRTC.rtcSession.sendDTMF(b),d=!0}if(a.length>0){var e=c>0?c-voxbone.WebRTC.configuration.digit_gap:voxbone.WebRTC.configuration.digit_gap+voxbone.WebRTC.configuration.digit_duration;e<0&&(e=0),voxbone.WebRTC.dtmfTimer=setTimeout(function(){voxbone.WebRTC.sendPreConfiguredDtmf(a)},e)}}},postCallRating:function(a,b,c,d){void 0!==voxbone.WebRTC.previous_callid&&($.ajax({type:"POST",url:voxbone.WebRTC.configuration.webrtc_log,crossDomain:!0,data:{payload_type:"webrtc_call_rating",username:voxbone.WebRTC.configuration.authorization_user,password:voxbone.WebRTC.configuration.password,callid:voxbone.WebRTC.previous_callid,e164:a,url:d,rating:b,comment:c}}),voxbone.WebRTC.previous_callid=void 0)},postLogsToServer:function(){1==voxbone.WebRTC.configuration.post_logs&&void 0!==voxbone.WebRTC.configuration.webrtc_log&&$.ajax({type:"POST",url:voxbone.WebRTC.configuration.webrtc_log,crossDomain:!0,data:{payload_type:"webrtc_logs",username:voxbone.WebRTC.configuration.authorization_user,password:voxbone.WebRTC.configuration.password,callid:voxbone.WebRTC.callid,pop:voxbone.WebRTC.preferedPop,context:voxbone.WebRTC.context,uri:voxbone.WebRTC.configuration.uri,logs:voxbone.WebRTC.webrtcLogs}})},cleanUp:function(){void 0!==voxbone.WebRTC.localVolumeTimer&&(clearInterval(voxbone.WebRTC.localVolumeTimer),voxbone.WebRTC.localVolumeTimer=void 0),void 0!==voxbone.WebRTC.audioScriptProcessor&&(void 0!==voxbone.WebRTC.audioContext&&void 0!==voxbone.WebRTC.audioContext.destination&&voxbone.WebRTC.audioScriptProcessor.disconnect(voxbone.WebRTC.audioContext.destination),voxbone.WebRTC.audioScriptProcessor=void 0),void 0!==voxbone.WebRTC.dtmfTimer&&(clearTimeout(voxbone.WebRTC.dtmfTimer),voxbone.WebRTC.dtmfTimer=void 0),voxbone.WebRTC.previous_callid=voxbone.WebRTC.callid,voxbone.WebRTC.callid="",voxbone.WebRTC.webrtcLogs="",voxbone.WebRTC.rtcSession={}},call:function(a){var b=new JsSIP.URI("sip",a,"voxout.voxbone.com");void 0==this.preferedPop&&(this.preferedPop=voxbone.Pinger.getBestPop().name),voxbone.Logger.loginfo("prefered pop: ",this.preferedPop);var c=[];c.push("X-Voxbone-Pop: "+this.preferedPop),this.context&&c.push("X-Voxbone-Context: "+this.context);var d={eventHandlers:{peerconnection:function(a){var b=a.peerconnection.getLocalStreams();voxbone.Logger.loginfo("streams "+b.length);for(var c=0;c<b.length;c++)if(b[c].getAudioTracks().length>0){try{void 0===voxbone.WebRTC.audioContext&&(voxbone.WebRTC.audioContext=new AudioContext)}catch(a){voxbone.Logger.logerror("Web Audio API not supported "+a)}voxbone.WebRTC.audioScriptProcessor=voxbone.WebRTC.audioContext.createScriptProcessor(0,1,1);var d=voxbone.WebRTC.audioContext.createMediaStreamSource(b[c]);d.connect(voxbone.WebRTC.audioScriptProcessor),voxbone.WebRTC.audioScriptProcessor.connect(voxbone.WebRTC.audioContext.destination),voxbone.WebRTC.audioScriptProcessor.onaudioprocess=function(a){var b,c=a.inputBuffer.getChannelData(0),d=0;for(b=0;b<c.length;++b)d+=c[b]*c[b];voxbone.WebRTC.localVolume=Math.sqrt(d/c.length)},voxbone.WebRTC.localVolumeTimer=setInterval(function(){var a={localVolume:voxbone.WebRTC.localVolume.toFixed(2)};voxbone.WebRTC.customEventHandler.localMediaVolume(a)},200);break}},sending:function(a){voxbone.WebRTC.callid=a.request.call_id;var b=voxbone.WebRTC.rtcSession.connection.pc,c=voxbone.WebRTC.rtcSession.remote_identity.uri.user;voxbone.WebRTC.callStats.addNewFabric(b,c,voxbone.WebRTC.callStats.fabricUsage.audio,voxbone.WebRTC.callid,null)},progress:function(a){voxbone.WebRTC.customEventHandler.progress(a)},failed:function(a){voxbone.Logger.logerror("Call failed, Failure cause is "+a.cause),voxbone.WebRTC.postLogsToServer(),voxbone.WebRTC.cleanUp(),a.cause==JsSIP.C.causes.USER_DENIED_MEDIA_ACCESS&&voxbone.WebRTC.customEventHandler.getUserMediaFailed(a),voxbone.WebRTC.customEventHandler.failed(a)},accepted:function(a){voxbone.WebRTC.customEventHandler.accepted(a)},addstream:function(a){if(voxbone.WebRTC.allowVideo?voxbone.WebRTC.initVideoElement(voxbone.WebRTC.videoComponentName,a.stream):voxbone.WebRTC.initAudioElement(voxbone.WebRTC.audioComponentName,a.stream),void 0!==voxbone.WebRTC.configuration.dialer_string&&voxbone.WebRTC.configuration.dialer_string.length>0){var b=voxbone.WebRTC.configuration.dialer_string.split(",");voxbone.WebRTC.sendPreConfiguredDtmf(b)}},ended:function(a){voxbone.WebRTC.postLogsToServer(),voxbone.WebRTC.cleanUp(),voxbone.WebRTC.customEventHandler.ended(a)}},extraHeaders:[],pcConfig:{},mediaConstraints:{audio:!0,video:voxbone.WebRTC.allowVideo}};if(void 0!==this.configuration.stun_servers||void 0!==this.configuration.turn_servers){for(var e=[],f=0;f<this.configuration.stun_servers.length;f++)e.push(this.configuration.stun_servers[f]);for(var f=0;f<this.configuration.turn_servers.length;f++)e.push(this.configuration.turn_servers[f]);d.pcConfig.iceServers=e,d.pcConfig.gatheringTimeoutAfterRelay=5e3}d.pcConfig.iceCandidatePoolSize=10,d.extraHeaders=c,void 0==this.phone?(this.phone=new JsSIP.UA(this.configuration),this.phone.once("connected",function(){voxbone.WebRTC.rtcSession=voxbone.WebRTC.phone.call(b.toAor(),d)}),this.phone.on("newRTCSession",function(a){a.session.on("connecting",function(a){voxbone.WebRTC.customEventHandler.getUserMediaAccepted(a)})}),this.phone.start()):(this.phone.configuration=this.configuration,this.rtcSession=this.phone.call(b.toAor(),d))},isCallOpen:function(){return"function"==typeof voxbone.WebRTC.rtcSession.isEstablished&&"function"==typeof voxbone.WebRTC.rtcSession.isInProgress&&(1==voxbone.WebRTC.rtcSession.isInProgress()||1==voxbone.WebRTC.rtcSession.isEstablished())},sendDTMF:function(a){this.rtcSession.sendDTMF(a)},hangup:function(){void 0!=this.rtcSession&&this.rtcSession.terminate()},isMuted:!1,mute:function(){for(var a=this.rtcSession.connection.getLocalStreams(),b=0;b<a.length;b++)for(var c=0;c<a[b].getAudioTracks().length;c++)a[b].getAudioTracks()[c].enabled=!1;this.isMuted=!0,voxbone.WebRTC.callStats.sendFabricEvent(this.rtcSession.connection.pc,voxbone.WebRTC.callStats.fabricEvent.audioMute,voxbone.WebRTC.callid)},unmute:function(){for(var a=this.rtcSession.connection.getLocalStreams(),b=0;b<a.length;b++)for(var c=0;c<a[b].getAudioTracks().length;c++)a[b].getAudioTracks()[c].enabled=!0;this.isMuted=!1,voxbone.WebRTC.callStats.sendFabricEvent(this.rtcSession.connection.pc,voxbone.WebRTC.callStats.fabricEvent.audioUnmute,voxbone.WebRTC.callid)},unloadHandler:function(){"function"==typeof voxbone.WebRTC.rtcSession.hangup?(voxbone.Logger.loginfo("Page unloading while a call was in progress, hanging up"),voxbone.WebRTC.hangup(),voxbone.WebRTC.postLogsToServer()):1==voxbone.WebRTC.configuration.post_logs_nocall&&voxbone.WebRTC.postLogsToServer()},isWebRTCSupported:function(){if(window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia){var a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(a){var b=new RegExp("firefox/([0-9])+"),c=new RegExp("([0-9])+"),d=b.exec(navigator.userAgent.toLowerCase())[0],e=c.exec(d)[0];if(e<23)return!1}return!0}return!1}}});