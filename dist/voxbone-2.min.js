/*!
 * @license Voxbone v2.1.6
 * Copyright 2017 Voxbone. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License") 
 */
/**
 * @license JsSIP v2.0.6
 * the Javascript SIP library
 * Copyright: 2012-2016 José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)
 * Homepage: http://jssip.net
 * License: MIT
 */
function handleSessionTimersInIncomingRequest(a,b){if(this.sessionTimers.enabled){var c;a.session_expires&&a.session_expires>=JsSIP.C.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,c=a.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,c="uas"),b.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+c),this.sessionTimers.refresher="uas"===c,runSessionTimer.call(this)}}function handleSessionTimersInIncomingResponse(a){if(this.sessionTimers.enabled){var b;a.session_expires&&a.session_expires>=JsSIP_C.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,b=a.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,b="uac"),this.sessionTimers.refresher="uac"===b,runSessionTimer.call(this)}}function runSessionTimer(){var a=this,b=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){a.status!==JsSIP.C.STATUS_TERMINATED&&sendUpdate.call(a,{eventHandlers:{succeeded:function(b){handleSessionTimersInIncomingResponse.call(a,b)}}})},500*b):this.sessionTimers.timer=setTimeout(function(){a.status!==JsSIP.C.STATUS_TERMINATED&&a.terminate({cause:JsSIP_C.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"})},1100*b)}function setInvite2xxTimer(a,b){var c=this,d=Timers.T1;this.timers.invite2xxTimer=setTimeout(function e(){c.status===JsSIP.C.STATUS_WAITING_FOR_ACK&&(a.reply(200,null,["Contact: "+c.contact],b),d<Timers.T2&&(d*=2,d>Timers.T2&&(d=Timers.T2)),c.timers.invite2xxTimer=setTimeout(e,d))},d)}function setACKTimer(){var a=this;this.timers.ackTimer=setTimeout(function(){a.status===JsSIP.C.STATUS_WAITING_FOR_ACK&&(clearTimeout(a.timers.invite2xxTimer),sendRequest.call(a,JsSIP.C.BYE),ended.call(a,"remote",null,JsSIP.C.causes.NO_ACK))},Timers.TIMER_H)}function ended(a,b,c){this.end_time=new Date,this.close(),this.emit("ended",{originator:a,message:b||null,cause:c})}function extend(a,b){var c=Object.prototype.toString,d=c.call({});for(var e in b)b[e]&&d===c.call(b[e])?(a[e]=a[e]||{},extend(a[e],b[e])):a[e]=b[e];return a}!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JsSIP=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("../package.json"),e={USER_AGENT:d.title+" "+d.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60};b.exports=e},{"../package.json":40}],2:[function(a,b,c){function d(a,b,c,d){var h;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,b.hasHeader("contact")?(d=b instanceof g.IncomingResponse?b.status_code<200?e.STATUS_EARLY:e.STATUS_CONFIRMED:d||e.STATUS_CONFIRMED,h=b.parseHeader("contact"),"UAS"===c?(this.id={call_id:b.call_id,local_tag:b.to_tag,remote_tag:b.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.remote_seqnum=b.cseq,this.local_uri=b.parseHeader("to").uri,this.remote_uri=b.parseHeader("from").uri,this.remote_target=h.uri,this.route_set=b.getHeaders("record-route")):"UAC"===c&&(this.id={call_id:b.call_id,local_tag:b.from_tag,remote_tag:b.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.local_seqnum=b.cseq,this.local_uri=b.parseHeader("from").uri,this.remote_uri=b.parseHeader("to").uri,this.remote_target=h.uri,this.route_set=b.getHeaders("record-route").reverse()),this.owner=a,a.ua.dialogs[this.id.toString()]=this,void f("new "+c+" dialog created with status "+(this.state===e.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}b.exports=d;var e={STATUS_EARLY:1,STATUS_CONFIRMED:2};d.C=e;var f=a("debug")("JsSIP:Dialog"),g=a("./SIPMessage"),h=a("./Constants"),i=a("./Transactions"),j=a("./Dialog/RequestSender");d.prototype={update:function(a,b){this.state=e.STATUS_CONFIRMED,f("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===b&&(this.route_set=a.getHeaders("record-route").reverse())},terminate:function(){f("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(a,b,c){var d,e;return b=b&&b.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),d=a===h.CANCEL||a===h.ACK?this.local_seqnum:this.local_seqnum+=1,e=new g.OutgoingRequest(a,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},b,c),e.dialog=this,e},checkInDialogRequest:function(a){var b=this;if(this.remote_seqnum){if(a.cseq<this.remote_seqnum)return a.method!==h.ACK&&a.reply(500),!1;a.cseq>this.remote_seqnum&&(this.remote_seqnum=a.cseq)}else this.remote_seqnum=a.cseq;if(a.method===h.INVITE||a.method===h.UPDATE&&a.body){if(this.uac_pending_reply===!0)a.reply(491);else{if(this.uas_pending_reply===!0){var c=(10*Math.random()|0)+1;return a.reply(500,null,["Retry-After:"+c]),!1}this.uas_pending_reply=!0,a.server_transaction.on("stateChanged",function c(){this.state!==i.C.STATUS_ACCEPTED&&this.state!==i.C.STATUS_COMPLETED&&this.state!==i.C.STATUS_TERMINATED||(a.server_transaction.removeListener("stateChanged",c),b.uas_pending_reply=!1)})}a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(){this.state===i.C.STATUS_ACCEPTED&&(b.remote_target=a.parseHeader("contact").uri)})}else a.method===h.NOTIFY&&a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(){this.state===i.C.STATUS_COMPLETED&&(b.remote_target=a.parseHeader("contact").uri)});return!0},sendRequest:function(a,b,c){c=c||{};var d=c.extraHeaders&&c.extraHeaders.slice()||[],e=c.body||null,f=this.createRequest(b,d,e),g=new j(this,a,f);return g.send(),f},receiveRequest:function(a){this.checkInDialogRequest(a)&&this.owner.receiveRequest(a)}}},{"./Constants":1,"./Dialog/RequestSender":3,"./SIPMessage":18,"./Transactions":21,debug:33}],3:[function(a,b,c){function d(a,b,c){this.dialog=a,this.applicant=b,this.request=c,this.reattempt=!1,this.reattemptTimer=null}b.exports=d;var e=a("../Constants"),f=a("../Transactions"),g=a("../RTCSession"),h=a("../RequestSender");d.prototype={send:function(){var a=this,b=new h(this,this.dialog.owner.ua);b.send(),(this.request.method===e.INVITE||this.request.method===e.UPDATE&&this.request.body)&&b.clientTransaction.state!==f.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,b.clientTransaction.on("stateChanged",function c(){this.state!==f.C.STATUS_ACCEPTED&&this.state!==f.C.STATUS_COMPLETED&&this.state!==f.C.STATUS_TERMINATED||(b.clientTransaction.removeListener("stateChanged",c),a.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b=this;408===a.status_code||481===a.status_code?this.applicant.onDialogError(a):a.method===e.INVITE&&491===a.status_code?this.reattempt?this.applicant.receiveResponse(a):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){b.applicant.owner.status!==g.C.STATUS_TERMINATED&&(b.reattempt=!0,b.request_sender.send())},1e3)):this.applicant.receiveResponse(a)}}},{"../Constants":1,"../RTCSession":11,"../RequestSender":17,"../Transactions":21}],4:[function(a,b,c){function d(a){this.credentials=a,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.algorithm=null,this.realm=null,this.nonce=null,this.opaque=null,this.stale=null,this.qop=null,this.method=null,this.uri=null,this.ha1=null,this.response=null}b.exports=d;var e=a("debug")("JsSIP:DigestAuthentication"),f=a("debug")("JsSIP:ERROR:DigestAuthentication");f.log=console.warn.bind(console);var g=a("./Utils");d.prototype.get=function(a){switch(a){case"realm":return this.realm;case"ha1":return this.ha1;default:return void f('get() | cannot get "%s" parameter',a)}},d.prototype.authenticate=function(a,b){var c,d;if(this.algorithm=b.algorithm,this.realm=b.realm,this.nonce=b.nonce,this.opaque=b.opaque,this.stale=b.stale,this.algorithm){if("MD5"!==this.algorithm)return f('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.nonce)return f("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this.realm)return f("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this.credentials.password){if(!this.credentials.ha1)return f("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this.credentials.realm!==this.realm)return f('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this.credentials.realm,this.realm),!1}if(b.qop)if(b.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(b.qop.indexOf("auth-int")>-1))return f('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=a.method,this.uri=a.ruri,this.cnonce=g.createRandomToken(12),this.nc+=1,d=Number(this.nc).toString(16),this.ncHex="00000000".substr(0,8-d.length)+d,4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.credentials.password?this.ha1=g.calculateMD5(this.credentials.username+":"+this.realm+":"+this.credentials.password):this.ha1=this.credentials.ha1,"auth"===this.qop?(c=g.calculateMD5(this.method+":"+this.uri),this.response=g.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+c)):"auth-int"===this.qop?(c=g.calculateMD5(this.method+":"+this.uri+":"+g.calculateMD5(this.body?this.body:"")),this.response=g.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+c)):null===this.qop&&(c=g.calculateMD5(this.method+":"+this.uri),this.response=g.calculateMD5(this.ha1+":"+this.nonce+":"+c)),e("authenticate() | response generated"),!0},d.prototype.toString=function(){var a=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return a.push("algorithm="+this.algorithm),a.push('username="'+this.credentials.username+'"'),a.push('realm="'+this.realm+'"'),a.push('nonce="'+this.nonce+'"'),a.push('uri="'+this.uri+'"'),a.push('response="'+this.response+'"'),this.opaque&&a.push('opaque="'+this.opaque+'"'),this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex)),"Digest "+a.join(", ")}},{"./Utils":25,debug:33}],5:[function(a,b,c){var d={ConfigurationError:function(){var a=function(a,b){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=a,this.value=b,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return a.prototype=new Error,a}(),InvalidStateError:function(){var a=function(a){this.code=2,this.name="INVALID_STATE_ERROR",this.status=a,this.message="Invalid status: "+a};return a.prototype=new Error,a}(),NotSupportedError:function(){var a=function(a){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=a};return a.prototype=new Error,a}(),NotReadyError:function(){var a=function(a){this.code=4,this.name="NOT_READY_ERROR",this.message=a};return a.prototype=new Error,a}()};b.exports=d},{}],6:[function(a,b,c){b.exports=function(){function b(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(c,d){function e(a){rd<td||(rd>td&&(td=rd,ud=[]),ud.push(a))}function f(){var a;return"\r\n"===c.substr(rd,2)?(a="\r\n",rd+=2):(a=null,0===sd&&e('"\\r\\n"')),a}function g(){var a;return/^[0-9]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[0-9]")),a}function h(){var a;return/^[a-zA-Z]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[a-zA-Z]")),a}function i(){var a;return/^[0-9a-fA-F]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[0-9a-fA-F]")),a}function j(){var a;return a=m(),null===a&&(a=n()),a}function k(){var a;return/^[\0-\xFF]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\0-\\xFF]")),a}function l(){var a;return/^["]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e('["]')),a}function m(){var a;return 32===c.charCodeAt(rd)?(a=" ",rd++):(a=null,0===sd&&e('" "')),a}function n(){var a;return 9===c.charCodeAt(rd)?(a="\t",rd++):(a=null,0===sd&&e('"\\t"')),a}function o(){var a;return/^[a-zA-Z0-9]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[a-zA-Z0-9]")),a}function p(){var a;return 59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","'))))))))))),a}function q(){var a;return a=o(),null===a&&(a=r()),a}function r(){var a;return 45===c.charCodeAt(rd)?(a="-",rd++):(a=null,0===sd&&e('"-"')),null===a&&(95===c.charCodeAt(rd)?(a="_",rd++):(a=null,0===sd&&e('"_"')),null===a&&(46===c.charCodeAt(rd)?(a=".",rd++):(a=null,0===sd&&e('"."')),null===a&&(33===c.charCodeAt(rd)?(a="!",rd++):(a=null,0===sd&&e('"!"')),null===a&&(126===c.charCodeAt(rd)?(a="~",rd++):(a=null,0===sd&&e('"~"')),null===a&&(42===c.charCodeAt(rd)?(a="*",rd++):(a=null,0===sd&&e('"*"')),null===a&&(39===c.charCodeAt(rd)?(a="'",rd++):(a=null,0===sd&&e('"\'"')),null===a&&(40===c.charCodeAt(rd)?(a="(",rd++):(a=null,0===sd&&e('"("')),null===a&&(41===c.charCodeAt(rd)?(a=")",rd++):(a=null,0===sd&&e('")"')))))))))),a}function s(){var a,b,d,f,g;return f=rd,g=rd,37===c.charCodeAt(rd)?(a="%",rd++):(a=null,0===sd&&e('"%"')),null!==a?(b=i(),null!==b?(d=i(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){return b.join("")}(f,a)),null===a&&(rd=f),a}function t(){var a,b,c,d,e,g;for(d=rd,e=rd,g=rd,a=[],b=j();null!==b;)a.push(b),b=j();if(null!==a?(b=f(),null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),a=null!==a?a:"",null!==a){if(c=j(),null!==c)for(b=[];null!==c;)b.push(c),c=j();else b=null;null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return null!==a&&(a=function(a){return" "}(d)),null===a&&(rd=d),a}function u(){var a;return a=t(),a=null!==a?a:""}function v(){var a,b,d,f,g;for(f=rd,g=rd,a=[],b=m(),null===b&&(b=n());null!==b;)a.push(b),b=m(),null===b&&(b=n());return null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(rd=f),a}function w(){var a,b,d,e,f,g,h;if(f=rd,g=rd,b=x(),null!==b)for(a=[];null!==b;)a.push(b),b=x();else a=null;if(null!==a){for(b=[],h=rd,d=[],e=t();null!==e;)d.push(e),e=t();for(null!==d?(e=x(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h);null!==d;){for(b.push(d),h=rd,d=[],e=t();null!==e;)d.push(e),e=t();null!==d?(e=x(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h)}null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return null!==a&&(a=function(a){return c.substring(rd,a)}(f)),null===a&&(rd=f),a}function x(){var a;return/^[!-~]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[!-~]")),null===a&&(a=y()),a}function y(){var a;return/^[\x80-\uFFFF]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\x80-\\uFFFF]")),a}function z(){var a;return/^[\x80-\xBF]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\x80-\\xBF]")),a}function A(){var a;return a=g(),null===a&&(/^[a-f]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[a-f]"))),a}function B(){var a,b,d;if(d=rd,b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"'))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(rd,a)}(d)),null===a&&(rd=d),a}function C(){var a,b,d;if(d=rd,b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(rd,a)}(d)),null===a&&(rd=d),a}function D(){var a;return 40===c.charCodeAt(rd)?(a="(",rd++):(a=null,0===sd&&e('"("')),null===a&&(41===c.charCodeAt(rd)?(a=")",rd++):(a=null,0===sd&&e('")"')),null===a&&(60===c.charCodeAt(rd)?(a="<",rd++):(a=null,0===sd&&e('"<"')),null===a&&(62===c.charCodeAt(rd)?(a=">",rd++):(a=null,0===sd&&e('">"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","')),null===a&&(59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(92===c.charCodeAt(rd)?(a="\\",rd++):(a=null,0===sd&&e('"\\\\"')),null===a&&(a=l(),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null===a&&(93===c.charCodeAt(rd)?(a="]",rd++):(a=null,0===sd&&e('"]"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(123===c.charCodeAt(rd)?(a="{",rd++):(a=null,0===sd&&e('"{"')),null===a&&(125===c.charCodeAt(rd)?(a="}",rd++):(a=null,0===sd&&e('"}"')),null===a&&(a=m(),null===a&&(a=n())))))))))))))))))),a}function E(){var a,b,d;if(d=rd,b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')),null===b&&(40===c.charCodeAt(rd)?(b="(",rd++):(b=null,0===sd&&e('"("')),null===b&&(41===c.charCodeAt(rd)?(b=")",rd++):(b=null,0===sd&&e('")"')),null===b&&(60===c.charCodeAt(rd)?(b="<",rd++):(b=null,0===sd&&e('"<"')),null===b&&(62===c.charCodeAt(rd)?(b=">",rd++):(b=null,0===sd&&e('">"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(92===c.charCodeAt(rd)?(b="\\",rd++):(b=null,0===sd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null===b&&(91===c.charCodeAt(rd)?(b="[",rd++):(b=null,0===sd&&e('"["')),null===b&&(93===c.charCodeAt(rd)?(b="]",rd++):(b=null,0===sd&&e('"]"')),null===b&&(63===c.charCodeAt(rd)?(b="?",rd++):(b=null,0===sd&&e('"?"')),null===b&&(123===c.charCodeAt(rd)?(b="{",rd++):(b=null,0===sd&&e('"{"')),null===b&&(125===c.charCodeAt(rd)?(b="}",rd++):(b=null,0===sd&&e('"}"'))))))))))))))))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')),null===b&&(40===c.charCodeAt(rd)?(b="(",rd++):(b=null,0===sd&&e('"("')),null===b&&(41===c.charCodeAt(rd)?(b=")",rd++):(b=null,0===sd&&e('")"')),null===b&&(60===c.charCodeAt(rd)?(b="<",rd++):(b=null,0===sd&&e('"<"')),null===b&&(62===c.charCodeAt(rd)?(b=">",rd++):(b=null,0===sd&&e('">"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(92===c.charCodeAt(rd)?(b="\\",rd++):(b=null,0===sd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null===b&&(91===c.charCodeAt(rd)?(b="[",rd++):(b=null,0===sd&&e('"["')),null===b&&(93===c.charCodeAt(rd)?(b="]",rd++):(b=null,0===sd&&e('"]"')),null===b&&(63===c.charCodeAt(rd)?(b="?",rd++):(b=null,0===sd&&e('"?"')),null===b&&(123===c.charCodeAt(rd)?(b="{",rd++):(b=null,0===sd&&e('"{"')),null===b&&(125===c.charCodeAt(rd)?(b="}",rd++):(b=null,0===sd&&e('"}"')))))))))))))))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(rd,a)}(d)),null===a&&(rd=d),a}function F(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return"*"}(f)),null===a&&(rd=f),a}function G(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return"/"}(f)),null===a&&(rd=f),a}function H(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return"="}(f)),null===a&&(rd=f),a}function I(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(40===c.charCodeAt(rd)?(b="(",rd++):(b=null,0===sd&&e('"("')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return"("}(f)),null===a&&(rd=f),a}function J(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(41===c.charCodeAt(rd)?(b=")",rd++):(b=null,0===sd&&e('")"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return")"}(f)),null===a&&(rd=f),a}function K(){var a,b,d,f;return d=rd,f=rd,62===c.charCodeAt(rd)?(a=">",rd++):(a=null,0===sd&&e('">"')),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a){return">"}(d)),null===a&&(rd=d),a}function L(){var a,b,d,f;return d=rd,f=rd,a=u(),null!==a?(60===c.charCodeAt(rd)?(b="<",rd++):(b=null,0===sd&&e('"<"')),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a){return"<"}(d)),null===a&&(rd=d),a}function M(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return","}(f)),null===a&&(rd=f),a}function N(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return";"}(f)),null===a&&(rd=f),a}function O(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(rd=f),a}function P(){var a,b,c,d;return c=rd,d=rd,a=u(),null!==a?(b=l(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(rd=c),a}function Q(){var a,b,c,d;return c=rd,d=rd,a=l(),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(rd=c),a}function R(){var a,b,c,d;if(d=rd,a=I(),null!==a){for(b=[],c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==c;)b.push(c),c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==b?(c=J(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)}else a=null,rd=d;return a}function S(){var a;return/^[!-']/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[!-']")),null===a&&(/^[*-[]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[*-[]")),null===a&&(/^[\]-~]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\]-~]")),null===a&&(a=y(),null===a&&(a=t())))),a}function T(){var a,b,d,e,f,g;if(f=rd,g=rd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,rd=g)):(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;return null!==a&&(a=function(a){return c.substring(rd,a)}(f)),null===a&&(rd=f),a}function U(){var a,b,d,e,f,g;if(f=rd,g=rd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,rd=g)):(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;return null!==a&&(a=function(a){return c.substring(rd-1,a+1)}(f)),null===a&&(rd=f),a}function V(){var a;return a=t(),null===a&&(33===c.charCodeAt(rd)?(a="!",rd++):(a=null,0===sd&&e('"!"')),null===a&&(/^[#-[]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[#-[]")),null===a&&(/^[\]-~]/.test(c.charAt(rd))?(a=c.charAt(rd),
rd++):(a=null,0===sd&&e("[\\]-~]")),null===a&&(a=y())))),a}function W(){var a,b,d;return d=rd,92===c.charCodeAt(rd)?(a="\\",rd++):(a=null,0===sd&&e('"\\\\"')),null!==a?(/^[\0-\t]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[\\0-\\t]")),null===b&&(/^[\x0B-\f]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[\\x0B-\\f]")),null===b&&(/^[\x0E-]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[\\x0E-]")))),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function X(){var a,b,d,f,g,h;return g=rd,h=rd,a=Z(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=aa(),d=null!==d?d:"",null!==d?(f=ea(),null!==f?a=[a,b,d,f]:(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h),null!==a&&(a=function(a){try{xd.uri=new vd(xd.scheme,xd.user,xd.host,xd.port),delete xd.scheme,delete xd.user,delete xd.host,delete xd.host_type,delete xd.port}catch(a){xd=-1}}(g)),null===a&&(rd=g),a}function Y(){var a,b,f,g,h,i,j,k;return j=rd,k=rd,a=Z(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(f=aa(),f=null!==f?f:"",null!==f?(g=ea(),null!==g?(h=qa(),null!==h?(i=Da(),i=null!==i?i:"",null!==i?a=[a,b,f,g,h,i]:(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k),null!==a&&(a=function(a){try{xd.uri=new vd(xd.scheme,xd.user,xd.host,xd.port,xd.uri_params,xd.uri_headers),delete xd.scheme,delete xd.user,delete xd.host,delete xd.host_type,delete xd.port,delete xd.uri_params,"SIP_URI"===d&&(xd=xd.uri)}catch(a){xd=-1}}(j)),null===a&&(rd=j),a}function Z(){var a;return a=$(),null===a&&(a=_()),a}function $(){var a,b;return b=rd,"sips"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"sips"')),null!==a&&(a=function(a,b){xd.scheme=b.toLowerCase()}(b,a)),null===a&&(rd=b),a}function _(){var a,b;return b=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"sip"')),null!==a&&(a=function(a,b){xd.scheme=b.toLowerCase()}(b,a)),null===a&&(rd=b),a}function aa(){var a,b,d,f,g,h;return f=rd,g=rd,a=ba(),null!==a?(h=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=da(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?(64===c.charCodeAt(rd)?(d="@",rd++):(d=null,0===sd&&e('"@"')),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd.user=decodeURIComponent(c.substring(rd-1,a))}(f)),null===a&&(rd=f),a}function ba(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(b=ca())),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(b=ca()));else a=null;return a}function ca(){var a;return 38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","')),null===a&&(59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"'))))))))),a}function da(){var a,b,d;for(d=rd,a=[],b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","'))))))));null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","'))))))));return null!==a&&(a=function(a){xd.password=c.substring(rd,a)}(d)),null===a&&(rd=d),a}function ea(){var a,b,d,f,g;return f=rd,a=fa(),null!==a?(g=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,rd=g)):(b=null,rd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),a}function fa(){var a,b;return b=rd,a=ga(),null===a&&(a=na(),null===a&&(a=ja())),null!==a&&(a=function(a){return xd.host=c.substring(rd,a).toLowerCase(),xd.host}(b)),null===a&&(rd=b),a}function ga(){var a,b,d,f,g,h;for(f=rd,g=rd,a=[],h=rd,b=ha(),null!==b?(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h);null!==b;)a.push(b),h=rd,b=ha(),null!==b?(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h);return null!==a?(b=ia(),null!==b?(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return xd.host_type="domain",c.substring(rd,a)}(f)),null===a&&(rd=f),a}function ha(){var a,b,d,f;if(f=rd,a=o(),null!==a){for(b=[],d=o(),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==d;)b.push(d),d=o(),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return a}function ia(){var a,b,d,f;if(f=rd,a=h(),null!==a){for(b=[],d=o(),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==d;)b.push(d),d=o(),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return a}function ja(){var a,b,d,f,g;return f=rd,g=rd,91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null!==a?(b=ka(),null!==b?(93===c.charCodeAt(rd)?(d="]",rd++):(d=null,0===sd&&e('"]"')),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return xd.host_type="IPv6",c.substring(rd,a)}(f)),null===a&&(rd=f),a}function ka(){var a,b,d,f,g,h,i,j,k,l,m,n,o,p,q,r;return p=rd,q=rd,a=la(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?(58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?(58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?(58===c.charCodeAt(rd)?(j=":",rd++):(j=null,0===sd&&e('":"')),null!==j?(k=la(),null!==k?(58===c.charCodeAt(rd)?(l=":",rd++):(l=null,0===sd&&e('":"')),null!==l?(m=la(),null!==m?(58===c.charCodeAt(rd)?(n=":",rd++):(n=null,0===sd&&e('":"')),null!==n?(o=ma(),null!==o?a=[a,b,d,f,g,h,i,j,k,l,m,n,o]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?(58===c.charCodeAt(rd)?(k=":",rd++):(k=null,0===sd&&e('":"')),null!==k?(l=la(),null!==l?(58===c.charCodeAt(rd)?(m=":",rd++):(m=null,0===sd&&e('":"')),null!==m?(n=ma(),null!==n?a=[a,b,d,f,g,h,i,j,k,l,m,n]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?(58===c.charCodeAt(rd)?(k=":",rd++):(k=null,0===sd&&e('":"')),null!==k?(l=ma(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=ma(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=ma(),null!==h?a=[a,b,d,f,g,h]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=ma(),null!==f?a=[a,b,d,f]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=ma(),null!==b?a=[a,b]:(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?a=[a,b]:(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?("::"===c.substr(rd,2)?(b="::",rd+=2):(b=null,0===sd&&e('"::"')),null!==b?(d=la(),null!==d?(58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?(58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?(58===c.charCodeAt(rd)?(j=":",rd++):(j=null,0===sd&&e('":"')),null!==j?(k=la(),null!==k?(58===c.charCodeAt(rd)?(l=":",rd++):(l=null,0===sd&&e('":"')),null!==l?(m=ma(),null!==m?a=[a,b,d,f,g,h,i,j,k,l,m]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?("::"===c.substr(rd,2)?(d="::",rd+=2):(d=null,0===sd&&e('"::"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?(58===c.charCodeAt(rd)?(k=":",rd++):(k=null,0===sd&&e('":"')),null!==k?(l=ma(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?("::"===c.substr(rd,2)?(f="::",rd+=2):(f=null,0===sd&&e('"::"')),null!==f?(g=la(),null!==g?(58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?(58===c.charCodeAt(rd)?(j=":",rd++):(j=null,0===sd&&e('":"')),null!==j?(k=ma(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?("::"===c.substr(rd,2)?(g="::",rd+=2):(g=null,0===sd&&e('"::"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=ma(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?(r=rd,58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,rd=r)):(g=null,rd=r),g=null!==g?g:"",null!==g?("::"===c.substr(rd,2)?(h="::",rd+=2):(h=null,0===sd&&e('"::"')),null!==h?(i=ma(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?(r=rd,58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,rd=r)):(g=null,rd=r),g=null!==g?g:"",null!==g?(r=rd,58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?h=[h,i]:(h=null,rd=r)):(h=null,rd=r),h=null!==h?h:"",null!==h?("::"===c.substr(rd,2)?(i="::",rd+=2):(i=null,0===sd&&e('"::"')),null!==i?(j=la(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?(r=rd,58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,rd=r)):(g=null,rd=r),g=null!==g?g:"",null!==g?(r=rd,58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?h=[h,i]:(h=null,rd=r)):(h=null,rd=r),h=null!==h?h:"",null!==h?(r=rd,58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?i=[i,j]:(i=null,rd=r)):(i=null,rd=r),i=null!==i?i:"",null!==i?("::"===c.substr(rd,2)?(j="::",rd+=2):(j=null,0===sd&&e('"::"')),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q))))))))))))))),null!==a&&(a=function(a){return xd.host_type="IPv6",c.substring(rd,a)}(p)),null===a&&(rd=p),a}function la(){var a,b,c,d,e;return e=rd,a=i(),null!==a?(b=i(),b=null!==b?b:"",null!==b?(c=i(),c=null!==c?c:"",null!==c?(d=i(),d=null!==d?d:"",null!==d?a=[a,b,c,d]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),a}function ma(){var a,b,d,f;return f=rd,a=la(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),null===a&&(a=na()),a}function na(){var a,b,d,f,g,h,i,j,k;return j=rd,k=rd,a=oa(),null!==a?(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null!==b?(d=oa(),null!==d?(46===c.charCodeAt(rd)?(f=".",rd++):(f=null,0===sd&&e('"."')),null!==f?(g=oa(),null!==g?(46===c.charCodeAt(rd)?(h=".",rd++):(h=null,0===sd&&e('"."')),null!==h?(i=oa(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k),null!==a&&(a=function(a){return xd.host_type="IPv4",c.substring(rd,a)}(j)),null===a&&(rd=j),a}function oa(){var a,b,d,f;return f=rd,"25"===c.substr(rd,2)?(a="25",rd+=2):(a=null,0===sd&&e('"25"')),null!==a?(/^[0-5]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[0-5]")),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null===a&&(f=rd,50===c.charCodeAt(rd)?(a="2",rd++):(a=null,0===sd&&e('"2"')),null!==a?(/^[0-4]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[0-4]")),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),null===a&&(f=rd,49===c.charCodeAt(rd)?(a="1",rd++):(a=null,0===sd&&e('"1"')),null!==a?(b=g(),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),null===a&&(f=rd,/^[1-9]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[1-9]")),null!==a?(b=g(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null===a&&(a=g())))),a}function pa(){var a,b,c,d,e,f,h;return f=rd,h=rd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h),null!==a&&(a=function(a,b){return b=parseInt(b.join("")),xd.port=b,b}(f,a)),null===a&&(rd=f),a}function qa(){var a,b,d,f;for(a=[],f=rd,59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null!==b?(d=ra(),null!==d?b=[b,d]:(b=null,rd=f)):(b=null,rd=f);null!==b;)a.push(b),f=rd,59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null!==b?(d=ra(),null!==d?b=[b,d]:(b=null,rd=f)):(b=null,rd=f);return a}function ra(){var a;return a=sa(),null===a&&(a=ta(),null===a&&(a=ua(),null===a&&(a=va(),null===a&&(a=wa(),null===a&&(a=xa(),null===a&&(a=ya())))))),a}function sa(){var a,b,d,f;return d=rd,f=rd,"transport="===c.substr(rd,10).toLowerCase()?(a=c.substr(rd,10),rd+=10):(a=null,0===sd&&e('"transport="')),null!==a?("udp"===c.substr(rd,3).toLowerCase()?(b=c.substr(rd,3),rd+=3):(b=null,0===sd&&e('"udp"')),null===b&&("tcp"===c.substr(rd,3).toLowerCase()?(b=c.substr(rd,3),rd+=3):(b=null,0===sd&&e('"tcp"')),null===b&&("sctp"===c.substr(rd,4).toLowerCase()?(b=c.substr(rd,4),rd+=4):(b=null,0===sd&&e('"sctp"')),null===b&&("tls"===c.substr(rd,3).toLowerCase()?(b=c.substr(rd,3),rd+=3):(b=null,0===sd&&e('"tls"')),null===b&&(b=B())))),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.transport=b.toLowerCase()}(d,a[1])),null===a&&(rd=d),a}function ta(){var a,b,d,f;return d=rd,f=rd,"user="===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"user="')),null!==a?("phone"===c.substr(rd,5).toLowerCase()?(b=c.substr(rd,5),rd+=5):(b=null,0===sd&&e('"phone"')),null===b&&("ip"===c.substr(rd,2).toLowerCase()?(b=c.substr(rd,2),rd+=2):(b=null,0===sd&&e('"ip"')),null===b&&(b=B())),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.user=b.toLowerCase()}(d,a[1])),null===a&&(rd=d),a}function ua(){var a,b,d,f;return d=rd,f=rd,"method="===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"method="')),null!==a?(b=jb(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.method=b}(d,a[1])),null===a&&(rd=d),a}function va(){var a,b,d,f;return d=rd,f=rd,"ttl="===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"ttl="')),null!==a?(b=Vc(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.params||(xd.params={}),xd.params.ttl=b}(d,a[1])),null===a&&(rd=d),a}function wa(){var a,b,d,f;return d=rd,f=rd,"maddr="===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"maddr="')),null!==a?(b=fa(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.maddr=b}(d,a[1])),null===a&&(rd=d),a}function xa(){var a,b,d,f,g,h;return f=rd,g=rd,"lr"===c.substr(rd,2).toLowerCase()?(a=c.substr(rd,2),rd+=2):(a=null,0===sd&&e('"lr"')),null!==a?(h=rd,61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=B(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd.uri_params||(xd.uri_params={}),xd.uri_params.lr=void 0}(f)),null===a&&(rd=f),a}function ya(){var a,b,d,f,g,h;return f=rd,g=rd,a=za(),null!==a?(h=rd,61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=Aa(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b,c){xd.uri_params||(xd.uri_params={}),c="undefined"==typeof c?void 0:c[1],xd.uri_params[b.toLowerCase()]=c}(f,a[0],a[1])),null===a&&(rd=f),a}function za(){var a,b,c;if(c=rd,b=Ba(),null!==b)for(a=[];null!==b;)a.push(b),b=Ba();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(rd=c),a}function Aa(){var a,b,c;if(c=rd,b=Ba(),null!==b)for(a=[];null!==b;)a.push(b),b=Ba();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(rd=c),a}function Ba(){var a;return a=Ca(),null===a&&(a=q(),null===a&&(a=s())),a}function Ca(){var a;return 91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null===a&&(93===c.charCodeAt(rd)?(a="]",rd++):(a=null,0===sd&&e('"]"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')))))))),a}function Da(){var a,b,d,f,g,h,i;if(h=rd,63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null!==a)if(b=Ea(),null!==b){for(d=[],i=rd,38===c.charCodeAt(rd)?(f="&",rd++):(f=null,0===sd&&e('"&"')),null!==f?(g=Ea(),null!==g?f=[f,g]:(f=null,rd=i)):(f=null,rd=i);null!==f;)d.push(f),i=rd,38===c.charCodeAt(rd)?(f="&",rd++):(f=null,0===sd&&e('"&"')),null!==f?(g=Ea(),null!==g?f=[f,g]:(f=null,rd=i)):(f=null,rd=i);null!==d?a=[a,b,d]:(a=null,rd=h)}else a=null,rd=h;else a=null,rd=h;return a}function Ea(){var a,b,d,f,g;return f=rd,g=rd,a=Fa(),null!==a?(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=Ga(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b,c){b=b.join("").toLowerCase(),c=c.join(""),xd.uri_headers||(xd.uri_headers={}),xd.uri_headers[b]?xd.uri_headers[b].push(c):xd.uri_headers[b]=[c]}(f,a[0],a[2])),null===a&&(rd=f),a}function Fa(){var a,b;if(b=Ha(),null===b&&(b=q(),null===b&&(b=s())),null!==b)for(a=[];null!==b;)a.push(b),b=Ha(),null===b&&(b=q(),null===b&&(b=s()));else a=null;return a}function Ga(){var a,b;for(a=[],b=Ha(),null===b&&(b=q(),null===b&&(b=s()));null!==b;)a.push(b),b=Ha(),null===b&&(b=q(),null===b&&(b=s()));return a}function Ha(){var a;return 91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null===a&&(93===c.charCodeAt(rd)?(a="]",rd++):(a=null,0===sd&&e('"]"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')))))))),a}function Ia(){var a;return a=kb(),null===a&&(a=Ja()),a}function Ja(){var a,b,c,d,e,f;return f=rd,a=jb(),null!==a?(b=m(),null!==b?(c=Ka(),null!==c?(d=m(),null!==d?(e=_a(),null!==e?a=[a,b,c,d,e]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Ka(){var a;return a=Y(),null===a&&(a=La()),a}function La(){var a,b,d,f;return f=rd,a=Wa(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=Ma(),null===d&&(d=Pa()),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Ma(){var a,b,d,f,g;return f=rd,a=Na(),null===a&&(a=Oa()),null!==a?(g=rd,63===c.charCodeAt(rd)?(b="?",rd++):(b=null,0===sd&&e('"?"')),null!==b?(d=$a(),null!==d?b=[b,d]:(b=null,rd=g)):(b=null,rd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),a}function Na(){var a,b,d,f;return f=rd,"//"===c.substr(rd,2)?(a="//",rd+=2):(a=null,0===sd&&e('"//"')),null!==a?(b=Xa(),null!==b?(d=Oa(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Oa(){var a,b,d;return d=rd,47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null!==a?(b=Sa(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function Pa(){var a,b,c,d;if(d=rd,a=Ra(),null!==a){for(b=[],c=Qa();null!==c;)b.push(c),c=Qa();null!==b?a=[a,b]:(a=null,rd=d)}else a=null,rd=d;return a}function Qa(){var a;return a=p(),null===a&&(a=q(),null===a&&(a=s())),a}function Ra(){var a;return a=q(),null===a&&(a=s(),null===a&&(59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","')))))))))))),a}function Sa(){var a,b,d,f,g,h;if(g=rd,a=Ta(),null!==a){for(b=[],h=rd,47===c.charCodeAt(rd)?(d="/",rd++):(d=null,0===sd&&e('"/"')),null!==d?(f=Ta(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,47===c.charCodeAt(rd)?(d="/",rd++):(d=null,0===sd&&e('"/"')),null!==d?(f=Ta(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return a}function Ta(){var a,b,d,f,g,h;for(g=rd,a=[],b=Va();null!==b;)a.push(b),b=Va();if(null!==a){for(b=[],h=rd,59===c.charCodeAt(rd)?(d=";",rd++):(d=null,0===sd&&e('";"')),null!==d?(f=Ua(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,59===c.charCodeAt(rd)?(d=";",rd++):(d=null,0===sd&&e('";"')),null!==d?(f=Ua(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return a}function Ua(){var a,b;for(a=[],b=Va();null!==b;)a.push(b),b=Va();return a}function Va(){var a;return a=q(),null===a&&(a=s(),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","')))))))))),a}function Wa(){var a,b,d,f,i;if(f=rd,i=rd,a=h(),null!==a){for(b=[],d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(rd)?(d="+",rd++):(d=null,0===sd&&e('"+"')),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."'))))));null!==d;)b.push(d),d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(rd)?(d="+",rd++):(d=null,0===sd&&e('"+"')),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."'))))));null!==b?a=[a,b]:(a=null,rd=i)}else a=null,rd=i;return null!==a&&(a=function(a){xd.scheme=c.substring(rd,a)}(f)),null===a&&(rd=f),a}function Xa(){var a;return a=Ya(),null===a&&(a=Za()),a}function Ya(){var a,b,d,f;return d=rd,f=rd,a=aa(),null!==a?(64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),a=null!==a?a:"",null!==a?(b=ea(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a=null!==a?a:""}function Za(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')),null===b&&(59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null===b&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')),null===b&&(59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null===b&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')))))))))));else a=null;return a}function $a(){var a,b;for(a=[],b=Qa();null!==b;)a.push(b),b=Qa();return a}function _a(){var a,b,d,f,h,i,j,k;if(j=rd,k=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"SIP"')),null!==a)if(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null!==b){if(f=g(),null!==f)for(d=[];null!==f;)d.push(f),f=g();else d=null;if(null!==d)if(46===c.charCodeAt(rd)?(f=".",rd++):(f=null,0===sd&&e('"."')),null!==f){if(i=g(),null!==i)for(h=[];null!==i;)h.push(i),i=g();else h=null;null!==h?a=[a,b,d,f,h]:(a=null,rd=k)}else a=null,rd=k;else a=null,rd=k}else a=null,rd=k;else a=null,rd=k;return null!==a&&(a=function(a){xd.sip_version=c.substring(rd,a)}(j)),null===a&&(rd=j),a}function ab(){var a;return"INVITE"===c.substr(rd,6)?(a="INVITE",rd+=6):(a=null,0===sd&&e('"INVITE"')),a}function bb(){var a;return"ACK"===c.substr(rd,3)?(a="ACK",rd+=3):(a=null,0===sd&&e('"ACK"')),a}function cb(){var a;return"OPTIONS"===c.substr(rd,7)?(a="OPTIONS",rd+=7):(a=null,0===sd&&e('"OPTIONS"')),a}function db(){var a;return"BYE"===c.substr(rd,3)?(a="BYE",rd+=3):(a=null,0===sd&&e('"BYE"')),a}function eb(){var a;return"CANCEL"===c.substr(rd,6)?(a="CANCEL",rd+=6):(a=null,0===sd&&e('"CANCEL"')),a}function fb(){var a;return"REGISTER"===c.substr(rd,8)?(a="REGISTER",rd+=8):(a=null,0===sd&&e('"REGISTER"')),a}function gb(){var a;return"SUBSCRIBE"===c.substr(rd,9)?(a="SUBSCRIBE",rd+=9):(a=null,0===sd&&e('"SUBSCRIBE"')),
a}function hb(){var a;return"NOTIFY"===c.substr(rd,6)?(a="NOTIFY",rd+=6):(a=null,0===sd&&e('"NOTIFY"')),a}function ib(){var a;return"REFER"===c.substr(rd,5)?(a="REFER",rd+=5):(a=null,0===sd&&e('"REFER"')),a}function jb(){var a,b;return b=rd,a=ab(),null===a&&(a=bb(),null===a&&(a=cb(),null===a&&(a=db(),null===a&&(a=eb(),null===a&&(a=fb(),null===a&&(a=gb(),null===a&&(a=hb(),null===a&&(a=ib(),null===a&&(a=B()))))))))),null!==a&&(a=function(a){return xd.method=c.substring(rd,a),xd.method}(b)),null===a&&(rd=b),a}function kb(){var a,b,c,d,e,f;return f=rd,a=_a(),null!==a?(b=m(),null!==b?(c=lb(),null!==c?(d=m(),null!==d?(e=nb(),null!==e?a=[a,b,c,d,e]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function lb(){var a,b;return b=rd,a=mb(),null!==a&&(a=function(a,b){xd.status_code=parseInt(b.join(""))}(b,a)),null===a&&(rd=b),a}function mb(){var a,b,c,d;return d=rd,a=g(),null!==a?(b=g(),null!==b?(c=g(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function nb(){var a,b,d;for(d=rd,a=[],b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));null!==b;)a.push(b),b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));return null!==a&&(a=function(a){xd.reason_phrase=c.substring(rd,a)}(d)),null===a&&(rd=d),a}function ob(){var a,b,c,d,e,f;if(e=rd,a=Vb(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function pb(){var a,b,d,f,g,h;return f=rd,g=rd,a=E(),null!==a?(h=rd,64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd=c.substring(rd,a)}(f)),null===a&&(rd=f),a}function qb(){var a,b,c,d,e,f,g;if(e=rd,a=F(),null===a)if(f=rd,a=rb(),null!==a){for(b=[],g=rd,c=M(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=M(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b,c;for(c=xd.multi_header.length,b=0;b<c;b++)if(null===xd.multi_header[b].parsed){xd=null;break}xd=null!==xd?xd.multi_header:-1}(e)),null===a&&(rd=e),a}function rb(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=ub(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=ub(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b;xd.multi_header||(xd.multi_header=[]);try{b=new wd(xd.uri,xd.display_name,xd.params),delete xd.uri,delete xd.display_name,delete xd.params}catch(a){b=null}xd.multi_header.push({possition:rd,offset:a,parsed:b})}(e)),null===a&&(rd=e),a}function sb(){var a,b,c,d,e;return e=rd,a=tb(),a=null!==a?a:"",null!==a?(b=L(),null!==b?(c=Y(),null!==c?(d=K(),null!==d?a=[a,b,c,d]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),a}function tb(){var a,b,d,e,f,g,h;if(f=rd,g=rd,a=B(),null!==a){for(b=[],h=rd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return null===a&&(a=T()),null!==a&&(a=function(a,b){b=c.substring(rd,a).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),xd.display_name=b}(f,a)),null===a&&(rd=f),a}function ub(){var a;return a=vb(),null===a&&(a=wb(),null===a&&(a=zb())),a}function vb(){var a,b,d,f,g;return f=rd,g=rd,"q"===c.substr(rd,1).toLowerCase()?(a=c.substr(rd,1),rd++):(a=null,0===sd&&e('"q"')),null!==a?(b=H(),null!==b?(d=yb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.params||(xd.params={}),xd.params.q=b}(f,a[2])),null===a&&(rd=f),a}function wb(){var a,b,d,f,g;return f=rd,g=rd,"expires"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.params||(xd.params={}),xd.params.expires=b}(f,a[2])),null===a&&(rd=f),a}function xb(){var a,b,c;if(c=rd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){return parseInt(b.join(""))}(c,a)),null===a&&(rd=c),a}function yb(){var a,b,d,f,h,i,j,k;return i=rd,j=rd,48===c.charCodeAt(rd)?(a="0",rd++):(a=null,0===sd&&e('"0"')),null!==a?(k=rd,46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null!==b?(d=g(),d=null!==d?d:"",null!==d?(f=g(),f=null!==f?f:"",null!==f?(h=g(),h=null!==h?h:"",null!==h?b=[b,d,f,h]:(b=null,rd=k)):(b=null,rd=k)):(b=null,rd=k)):(b=null,rd=k),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=j)):(a=null,rd=j),null!==a&&(a=function(a){return parseFloat(c.substring(rd,a))}(i)),null===a&&(rd=i),a}function zb(){var a,b,c,d,e,f;return d=rd,e=rd,a=B(),null!==a?(f=rd,b=H(),null!==b?(c=Ab(),null!==c?b=[b,c]:(b=null,rd=f)):(b=null,rd=f),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=e)):(a=null,rd=e),null!==a&&(a=function(a,b,c){xd.params||(xd.params={}),c="undefined"==typeof c?void 0:c[1],xd.params[b.toLowerCase()]=c}(d,a[0],a[1])),null===a&&(rd=d),a}function Ab(){var a;return a=B(),null===a&&(a=fa(),null===a&&(a=T())),a}function Bb(){var a,b,c,d,e,f;if(e=rd,a=Cb(),null!==a){for(b=[],f=rd,c=N(),null!==c?(d=Db(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=Db(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Cb(){var a;return"render"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"render"')),null===a&&("session"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"session"')),null===a&&("icon"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"icon"')),null===a&&("alert"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"alert"')),null===a&&(a=B())))),a}function Db(){var a;return a=Eb(),null===a&&(a=zb()),a}function Eb(){var a,b,d,f;return f=rd,"handling"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"handling"')),null!==a?(b=H(),null!==b?("optional"===c.substr(rd,8).toLowerCase()?(d=c.substr(rd,8),rd+=8):(d=null,0===sd&&e('"optional"')),null===d&&("required"===c.substr(rd,8).toLowerCase()?(d=c.substr(rd,8),rd+=8):(d=null,0===sd&&e('"required"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Fb(){var a,b,c,d,e,f;if(e=rd,a=B(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Gb(){var a,b,c;if(c=rd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){xd=parseInt(b.join(""))}(c,a)),null===a&&(rd=c),a}function Hb(){var a,b;return b=rd,a=Ib(),null!==a&&(a=function(a){xd=c.substring(rd,a)}(b)),null===a&&(rd=b),a}function Ib(){var a,b,c,d,e,f,g,h;if(g=rd,a=Jb(),null!==a)if(b=G(),null!==b)if(c=Ob(),null!==c){for(d=[],h=rd,e=N(),null!==e?(f=Pb(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==e;)d.push(e),h=rd,e=N(),null!==e?(f=Pb(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==d?a=[a,b,c,d]:(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;else a=null,rd=g;return a}function Jb(){var a;return a=Kb(),null===a&&(a=Lb()),a}function Kb(){var a;return"text"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"text"')),null===a&&("image"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"image"')),null===a&&("audio"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"audio"')),null===a&&("video"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"video"')),null===a&&("application"===c.substr(rd,11).toLowerCase()?(a=c.substr(rd,11),rd+=11):(a=null,0===sd&&e('"application"')),null===a&&(a=Mb()))))),a}function Lb(){var a;return"message"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"message"')),null===a&&("multipart"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"multipart"')),null===a&&(a=Mb())),a}function Mb(){var a;return a=B(),null===a&&(a=Nb()),a}function Nb(){var a,b,d;return d=rd,"x-"===c.substr(rd,2).toLowerCase()?(a=c.substr(rd,2),rd+=2):(a=null,0===sd&&e('"x-"')),null!==a?(b=B(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function Ob(){var a;return a=Mb(),null===a&&(a=B()),a}function Pb(){var a,b,c,d;return d=rd,a=B(),null!==a?(b=H(),null!==b?(c=Qb(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function Qb(){var a;return a=B(),null===a&&(a=T()),a}function Rb(){var a,b,c,d;return d=rd,a=Sb(),null!==a?(b=t(),null!==b?(c=jb(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function Sb(){var a,b,c;if(c=rd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){xd.value=parseInt(b.join(""))}(c,a)),null===a&&(rd=c),a}function Tb(){var a,b;return b=rd,a=xb(),null!==a&&(a=function(a,b){xd=b}(b,a)),null===a&&(rd=b),a}function Ub(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=Vb(),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a,b){xd.event=b.join("").toLowerCase()}(e,a[0])),null===a&&(rd=e),a}function Vb(){var a,b,d,f,g,h;if(g=rd,a=C(),null!==a){for(b=[],h=rd,46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return a}function Wb(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=Xb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=Xb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b=xd.tag;try{xd=new wd(xd.uri,xd.display_name,xd.params),b&&xd.setParam("tag",b)}catch(a){xd=-1}}(e)),null===a&&(rd=e),a}function Xb(){var a;return a=Yb(),null===a&&(a=zb()),a}function Yb(){var a,b,d,f,g;return f=rd,g=rd,"tag"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.tag=b}(f,a[2])),null===a&&(rd=f),a}function Zb(){var a,b,c;if(c=rd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){xd=parseInt(b.join(""))}(c,a)),null===a&&(rd=c),a}function $b(){var a,b;return b=rd,a=xb(),null!==a&&(a=function(a,b){xd=b}(b,a)),null===a&&(rd=b),a}function _b(){var a,b,c,d,e,f,g,h,i,j;for(h=rd,i=rd,a=[],b=tb();null!==b;)a.push(b),b=tb();if(null!==a)if(b=L(),null!==b)if(c=Y(),null!==c)if(d=K(),null!==d){for(e=[],j=rd,f=N(),null!==f?(g=zb(),null!==g?f=[f,g]:(f=null,rd=j)):(f=null,rd=j);null!==f;)e.push(f),j=rd,f=N(),null!==f?(g=zb(),null!==g?f=[f,g]:(f=null,rd=j)):(f=null,rd=j);null!==e?a=[a,b,c,d,e]:(a=null,rd=i)}else a=null,rd=i;else a=null,rd=i;else a=null,rd=i;else a=null,rd=i;return null!==a&&(a=function(a){try{xd=new wd(xd.uri,xd.display_name,xd.params)}catch(a){xd=-1}}(h)),null===a&&(rd=h),a}function ac(){var a;return a=bc()}function bc(){var a,b,d,f,g,h,i,j;if(i=rd,"digest"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"Digest"')),null!==a)if(b=t(),null!==b)if(d=ec(),null!==d){for(f=[],j=rd,g=M(),null!==g?(h=ec(),null!==h?g=[g,h]:(g=null,rd=j)):(g=null,rd=j);null!==g;)f.push(g),j=rd,g=M(),null!==g?(h=ec(),null!==h?g=[g,h]:(g=null,rd=j)):(g=null,rd=j);null!==f?a=[a,b,d,f]:(a=null,rd=i)}else a=null,rd=i;else a=null,rd=i;else a=null,rd=i;return null===a&&(a=cc()),a}function cc(){var a,b,c,d,e,f,g,h;if(g=rd,a=B(),null!==a)if(b=t(),null!==b)if(c=dc(),null!==c){for(d=[],h=rd,e=M(),null!==e?(f=dc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==e;)d.push(e),h=rd,e=M(),null!==e?(f=dc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==d?a=[a,b,c,d]:(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;else a=null,rd=g;return a}function dc(){var a,b,c,d;return d=rd,a=B(),null!==a?(b=H(),null!==b?(c=B(),null===c&&(c=T()),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function ec(){var a;return a=fc(),null===a&&(a=hc(),null===a&&(a=jc(),null===a&&(a=lc(),null===a&&(a=mc(),null===a&&(a=nc(),null===a&&(a=oc(),null===a&&(a=dc()))))))),a}function fc(){var a,b,d,f;return f=rd,"realm"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"realm"')),null!==a?(b=H(),null!==b?(d=gc(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function gc(){var a,b;return b=rd,a=U(),null!==a&&(a=function(a,b){xd.realm=b}(b,a)),null===a&&(rd=b),a}function hc(){var a,b,d,f,g,h,i,j,k;if(j=rd,"domain"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"domain"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d)if(f=ic(),null!==f){if(g=[],k=rd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;for(null!==h?(i=ic(),null!==i?h=[h,i]:(h=null,rd=k)):(h=null,rd=k);null!==h;){if(g.push(h),k=rd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;null!==h?(i=ic(),null!==i?h=[h,i]:(h=null,rd=k)):(h=null,rd=k)}null!==g?(h=Q(),null!==h?a=[a,b,d,f,g,h]:(a=null,rd=j)):(a=null,rd=j)}else a=null,rd=j;else a=null,rd=j;else a=null,rd=j;else a=null,rd=j;return a}function ic(){var a;return a=La(),null===a&&(a=Oa()),a}function jc(){var a,b,d,f;return f=rd,"nonce"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"nonce"')),null!==a?(b=H(),null!==b?(d=kc(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function kc(){var a,b;return b=rd,a=U(),null!==a&&(a=function(a,b){xd.nonce=b}(b,a)),null===a&&(rd=b),a}function lc(){var a,b,d,f,g;return f=rd,g=rd,"opaque"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"opaque"')),null!==a?(b=H(),null!==b?(d=U(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.opaque=b}(f,a[2])),null===a&&(rd=f),a}function mc(){var a,b,d,f,g;return f=rd,"stale"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"stale"')),null!==a?(b=H(),null!==b?(g=rd,"true"===c.substr(rd,4).toLowerCase()?(d=c.substr(rd,4),rd+=4):(d=null,0===sd&&e('"true"')),null!==d&&(d=function(a){xd.stale=!0}(g)),null===d&&(rd=g),null===d&&(g=rd,"false"===c.substr(rd,5).toLowerCase()?(d=c.substr(rd,5),rd+=5):(d=null,0===sd&&e('"false"')),null!==d&&(d=function(a){xd.stale=!1}(g)),null===d&&(rd=g)),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function nc(){var a,b,d,f,g;return f=rd,g=rd,"algorithm"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"algorithm"')),null!==a?(b=H(),null!==b?("md5"===c.substr(rd,3).toLowerCase()?(d=c.substr(rd,3),rd+=3):(d=null,0===sd&&e('"MD5"')),null===d&&("md5-sess"===c.substr(rd,8).toLowerCase()?(d=c.substr(rd,8),rd+=8):(d=null,0===sd&&e('"MD5-sess"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.algorithm=b.toUpperCase()}(f,a[2])),null===a&&(rd=f),a}function oc(){var a,b,d,f,g,h,i,j,k,l;if(j=rd,"qop"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"qop"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d){if(k=rd,f=pc(),null!==f){for(g=[],l=rd,44===c.charCodeAt(rd)?(h=",",rd++):(h=null,0===sd&&e('","')),null!==h?(i=pc(),null!==i?h=[h,i]:(h=null,rd=l)):(h=null,rd=l);null!==h;)g.push(h),l=rd,44===c.charCodeAt(rd)?(h=",",rd++):(h=null,0===sd&&e('","')),null!==h?(i=pc(),null!==i?h=[h,i]:(h=null,rd=l)):(h=null,rd=l);null!==g?f=[f,g]:(f=null,rd=k)}else f=null,rd=k;null!==f?(g=Q(),null!==g?a=[a,b,d,f,g]:(a=null,rd=j)):(a=null,rd=j)}else a=null,rd=j;else a=null,rd=j;else a=null,rd=j;return a}function pc(){var a,b;return b=rd,"auth-int"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"auth-int"')),null===a&&("auth"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"auth"')),null===a&&(a=B())),null!==a&&(a=function(a,b){xd.qop||(xd.qop=[]),xd.qop.push(b.toLowerCase())}(b,a)),null===a&&(rd=b),a}function qc(){var a,b,c,d,e,f;if(e=rd,a=B(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function rc(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=sc(),null!==a){for(b=[],g=rd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b,c;for(c=xd.multi_header.length,b=0;b<c;b++)if(null===xd.multi_header[b].parsed){xd=null;break}xd=null!==xd?xd.multi_header:-1}(e)),null===a&&(rd=e),a}function sc(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=sb(),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b;xd.multi_header||(xd.multi_header=[]);try{b=new wd(xd.uri,xd.display_name,xd.params),delete xd.uri,delete xd.display_name,delete xd.params}catch(a){b=null}xd.multi_header.push({possition:rd,offset:a,parsed:b})}(e)),null===a&&(rd=e),a}function tc(){var a,b,d,f,g,h,i;if(g=rd,h=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"SIP"')),null===a&&(a=B()),null!==a){for(b=[],i=rd,d=N(),null!==d?(f=uc(),null!==f?d=[d,f]:(d=null,rd=i)):(d=null,rd=i);null!==d;)b.push(d),i=rd,d=N(),null!==d?(f=uc(),null!==f?d=[d,f]:(d=null,rd=i)):(d=null,rd=i);null!==b?a=[a,b]:(a=null,rd=h)}else a=null,rd=h;return null!==a&&(a=function(a,b){if(xd.protocol=b.toLowerCase(),xd.params||(xd.params={}),xd.params.text&&'"'===xd.params.text[0]){var c=xd.params.text;xd.text=c.substring(1,c.length-1),delete xd.params.text}}(g,a[0])),null===a&&(rd=g),a}function uc(){var a;return a=vc(),null===a&&(a=zb()),a}function vc(){var a,b,d,f,h,i;if(h=rd,i=rd,"cause"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"cause"')),null!==a)if(b=H(),null!==b){if(f=g(),null!==f)for(d=[];null!==f;)d.push(f),f=g();else d=null;null!==d?a=[a,b,d]:(a=null,rd=i)}else a=null,rd=i;else a=null,rd=i;return null!==a&&(a=function(a,b){xd.cause=parseInt(b.join(""))}(h,a[2])),null===a&&(rd=h),a}function wc(){var a,b,c,d,e,f;if(e=rd,a=B(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function xc(){var a,b,c,d,e,f;if(e=rd,a=yc(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=yc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=yc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function yc(){var a,b,c,d,e,f;if(e=rd,a=sb(),null!==a){for(b=[],f=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function zc(){var a,b,c,d,e,f;if(e=rd,a=Ac(),null!==a){for(b=[],f=rd,c=N(),null!==c?(d=Bc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=Bc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Ac(){var a,b;return b=rd,"active"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"active"')),null===a&&("pending"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"pending"')),null===a&&("terminated"===c.substr(rd,10).toLowerCase()?(a=c.substr(rd,10),rd+=10):(a=null,0===sd&&e('"terminated"')),null===a&&(a=B()))),null!==a&&(a=function(a){xd.state=c.substring(rd,a)}(b)),null===a&&(rd=b),a}function Bc(){var a,b,d,f,g;return f=rd,g=rd,"reason"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"reason"')),null!==a?(b=H(),null!==b?(d=Cc(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(xd.reason=b)}(f,a[2])),null===a&&(rd=f),null===a&&(f=rd,g=rd,"expires"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(xd.expires=b)}(f,a[2])),null===a&&(rd=f),null===a&&(f=rd,g=rd,"retry_after"===c.substr(rd,11).toLowerCase()?(a=c.substr(rd,11),rd+=11):(a=null,0===sd&&e('"retry_after"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(xd.retry_after=b)}(f,a[2])),null===a&&(rd=f),null===a&&(a=zb()))),a}function Cc(){var a;return"deactivated"===c.substr(rd,11).toLowerCase()?(a=c.substr(rd,11),rd+=11):(a=null,0===sd&&e('"deactivated"')),null===a&&("probation"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"probation"')),null===a&&("rejected"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"rejected"')),null===a&&("timeout"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"timeout"')),null===a&&("giveup"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"giveup"')),null===a&&("noresource"===c.substr(rd,10).toLowerCase()?(a=c.substr(rd,10),rd+=10):(a=null,0===sd&&e('"noresource"')),null===a&&("invariant"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"invariant"')),null===a&&(a=B()))))))),a}function Dc(){var a;return a=w(),a=null!==a?a:""}function Ec(){var a,b,c,d,e,f;if(e=rd,a=B(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a=null!==a?a:""}function Fc(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=Gc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=Gc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b=xd.tag;try{xd=new wd(xd.uri,xd.display_name,xd.params),b&&xd.setParam("tag",b)}catch(a){xd=-1}}(e)),null===a&&(rd=e),a}function Gc(){var a;return a=Yb(),null===a&&(a=zb()),a}function Hc(){var a,b,c,d,e,f;if(e=rd,a=Ic(),null!==a){for(b=[],f=rd,c=M(),null!==c?(d=Ic(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=Ic(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Ic(){var a,b,c,d,e,f,g,h;if(g=rd,a=Pc(),null!==a)if(b=t(),null!==b)if(c=Sc(),null!==c){for(d=[],h=rd,e=N(),null!==e?(f=Jc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==e;)d.push(e),h=rd,e=N(),null!==e?(f=Jc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==d?a=[a,b,c,d]:(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;else a=null,rd=g;return a}function Jc(){var a;return a=Kc(),null===a&&(a=Lc(),null===a&&(a=Mc(),null===a&&(a=Nc(),null===a&&(a=Oc(),null===a&&(a=zb()))))),a}function Kc(){var a,b,d,f,g;return f=rd,g=rd,"ttl"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"ttl"')),null!==a?(b=H(),null!==b?(d=Vc(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.ttl=b}(f,a[2])),null===a&&(rd=f),a}function Lc(){var a,b,d,f,g;return f=rd,g=rd,"maddr"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"maddr"')),null!==a?(b=H(),null!==b?(d=fa(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.maddr=b}(f,a[2])),null===a&&(rd=f),a}function Mc(){var a,b,d,f,g;return f=rd,g=rd,"received"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"received"')),null!==a?(b=H(),null!==b?(d=na(),null===d&&(d=ka()),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.received=b}(f,a[2])),null===a&&(rd=f),a}function Nc(){var a,b,d,f,g;return f=rd,g=rd,"branch"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"branch"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.branch=b}(f,a[2])),null===a&&(rd=f),a}function Oc(){var a,b,d,f,h,i,j;if(h=rd,i=rd,"rport"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"rport"')),null!==a){if(j=rd,b=H(),null!==b){for(d=[],f=g();null!==f;)d.push(f),f=g();null!==d?b=[b,d]:(b=null,rd=j)}else b=null,rd=j;b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=i)}else a=null,rd=i;return null!==a&&(a=function(a){"undefined"!=typeof response_port&&(xd.rport=response_port.join(""))}(h)),null===a&&(rd=h),a}function Pc(){var a,b,c,d,e,f;return f=rd,a=Qc(),null!==a?(b=G(),null!==b?(c=B(),null!==c?(d=G(),null!==d?(e=Rc(),null!==e?a=[a,b,c,d,e]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Qc(){var a,b;return b=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"SIP"')),null===a&&(a=B()),null!==a&&(a=function(a,b){xd.protocol=b}(b,a)),null===a&&(rd=b),a}function Rc(){var a,b;return b=rd,"udp"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"UDP"')),null===a&&("tcp"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"TCP"')),null===a&&("tls"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"TLS"')),null===a&&("sctp"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"SCTP"')),null===a&&(a=B())))),null!==a&&(a=function(a,b){xd.transport=b}(b,a)),null===a&&(rd=b),a}function Sc(){var a,b,c,d,e;return d=rd,a=Tc(),null!==a?(e=rd,b=O(),null!==b?(c=Uc(),null!==c?b=[b,c]:(b=null,rd=e)):(b=null,rd=e),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function Tc(){var a,b;return b=rd,a=na(),null===a&&(a=ja(),null===a&&(a=ga())),null!==a&&(a=function(a){xd.host=c.substring(rd,a)}(b)),null===a&&(rd=b),a}function Uc(){var a,b,c,d,e,f,h;return f=rd,h=rd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h),null!==a&&(a=function(a,b){xd.port=parseInt(b.join(""))}(f,a)),null===a&&(rd=f),a}function Vc(){var a,b,c,d,e;return d=rd,e=rd,a=g(),null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),null!==a&&(a=function(a,b){return parseInt(b.join(""))}(d,a)),null===a&&(rd=d),a}function Wc(){var a;return a=bc()}function Xc(){var a,b,c,d,e,f;if(e=rd,a=Yc(),null!==a){for(b=[],f=rd,c=N(),null!==c?(d=Zc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=Zc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Yc(){var a,b;return b=rd,a=xb(),null!==a&&(a=function(a,b){xd.expires=b}(b,a)),null===a&&(rd=b),a}function Zc(){var a;return a=$c(),null===a&&(a=zb()),a}function $c(){var a,b,d,f,g;return f=rd,g=rd,"refresher"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"refresher"')),null!==a?(b=H(),null!==b?("uac"===c.substr(rd,3).toLowerCase()?(d=c.substr(rd,3),rd+=3):(d=null,0===sd&&e('"uac"')),null===d&&("uas"===c.substr(rd,3).toLowerCase()?(d=c.substr(rd,3),rd+=3):(d=null,0===sd&&e('"uas"'))),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.refresher=b.toLowerCase()}(f,a[2])),null===a&&(rd=f),a}function _c(){var a,b,c,d;return d=rd,a=B(),null!==a?(b=v(),null!==b?(c=ad(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function ad(){var a,b;for(a=[],b=x(),null===b&&(b=z(),null===b&&(b=t()));null!==b;)a.push(b),b=x(),null===b&&(b=z(),null===b&&(b=t()));return a}function bd(){var a,b;for(a=[],b=k();null!==b;)a.push(b),b=k();return a}function cd(){var a,b,d;return d=rd,"uuid:"===c.substr(rd,5)?(a="uuid:",rd+=5):(a=null,0===sd&&e('"uuid:"')),null!==a?(b=dd(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function dd(){var a,b,d,f,g,h,i,j,k,l,m;return l=rd,m=rd,a=fd(),null!==a?(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null!==b?(d=ed(),null!==d?(45===c.charCodeAt(rd)?(f="-",rd++):(f=null,0===sd&&e('"-"')),null!==f?(g=ed(),null!==g?(45===c.charCodeAt(rd)?(h="-",rd++):(h=null,0===sd&&e('"-"')),null!==h?(i=ed(),null!==i?(45===c.charCodeAt(rd)?(j="-",rd++):(j=null,0===sd&&e('"-"')),null!==j?(k=gd(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m),null!==a&&(a=function(a,b){xd=c.substring(rd+5,a)}(l,a[0])),null===a&&(rd=l),a}function ed(){var a,b,c,d,e;return e=rd,a=i(),null!==a?(b=i(),null!==b?(c=i(),null!==c?(d=i(),null!==d?a=[a,b,c,d]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),a}function fd(){var a,b,c;return c=rd,a=ed(),null!==a?(b=ed(),null!==b?a=[a,b]:(a=null,rd=c)):(a=null,rd=c),a}function gd(){var a,b,c,d;return d=rd,a=ed(),null!==a?(b=ed(),null!==b?(c=ed(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function hd(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){try{xd=new wd(xd.uri,xd.display_name,xd.params)}catch(a){xd=-1}}(e)),null===a&&(rd=e),a}function id(){var a,b,c,d,e,f;if(e=rd,a=jd(),null!==a){for(b=[],f=rd,c=N(),null!==c?(d=kd(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=kd(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function jd(){var a,b,d,f,g,h;return f=rd,g=rd,a=E(),null!==a?(h=rd,64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd.call_id=c.substring(rd,a)}(f)),null===a&&(rd=f),a}function kd(){var a;return a=ld(),null===a&&(a=md(),null===a&&(a=nd(),null===a&&(a=zb()))),a}function ld(){var a,b,d,f,g;return f=rd,g=rd,"to-tag"===c.substr(rd,6)?(a="to-tag",rd+=6):(a=null,0===sd&&e('"to-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,
rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.to_tag=b}(f,a[2])),null===a&&(rd=f),a}function md(){var a,b,d,f,g;return f=rd,g=rd,"from-tag"===c.substr(rd,8)?(a="from-tag",rd+=8):(a=null,0===sd&&e('"from-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.from_tag=b}(f,a[2])),null===a&&(rd=f),a}function nd(){var a,b;return b=rd,"early-only"===c.substr(rd,10)?(a="early-only",rd+=10):(a=null,0===sd&&e('"early-only"')),null!==a&&(a=function(a){xd.early_only=!0}(b)),null===a&&(rd=b),a}function od(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function pd(){for(var a=1,b=1,d=!1,e=0;e<Math.max(rd,td);e++){var f=c.charAt(e);"\n"===f?(d||a++,b=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,b=1,d=!0):(b++,d=!1)}return{line:a,column:b}}var qd={CRLF:f,DIGIT:g,ALPHA:h,HEXDIG:i,WSP:j,OCTET:k,DQUOTE:l,SP:m,HTAB:n,alphanum:o,reserved:p,unreserved:q,mark:r,escaped:s,LWS:t,SWS:u,HCOLON:v,TEXT_UTF8_TRIM:w,TEXT_UTF8char:x,UTF8_NONASCII:y,UTF8_CONT:z,LHEX:A,token:B,token_nodot:C,separators:D,word:E,STAR:F,SLASH:G,EQUAL:H,LPAREN:I,RPAREN:J,RAQUOT:K,LAQUOT:L,COMMA:M,SEMI:N,COLON:O,LDQUOT:P,RDQUOT:Q,comment:R,ctext:S,quoted_string:T,quoted_string_clean:U,qdtext:V,quoted_pair:W,SIP_URI_noparams:X,SIP_URI:Y,uri_scheme:Z,uri_scheme_sips:$,uri_scheme_sip:_,userinfo:aa,user:ba,user_unreserved:ca,password:da,hostport:ea,host:fa,hostname:ga,domainlabel:ha,toplabel:ia,IPv6reference:ja,IPv6address:ka,h16:la,ls32:ma,IPv4address:na,dec_octet:oa,port:pa,uri_parameters:qa,uri_parameter:ra,transport_param:sa,user_param:ta,method_param:ua,ttl_param:va,maddr_param:wa,lr_param:xa,other_param:ya,pname:za,pvalue:Aa,paramchar:Ba,param_unreserved:Ca,headers:Da,header:Ea,hname:Fa,hvalue:Ga,hnv_unreserved:Ha,Request_Response:Ia,Request_Line:Ja,Request_URI:Ka,absoluteURI:La,hier_part:Ma,net_path:Na,abs_path:Oa,opaque_part:Pa,uric:Qa,uric_no_slash:Ra,path_segments:Sa,segment:Ta,param:Ua,pchar:Va,scheme:Wa,authority:Xa,srvr:Ya,reg_name:Za,query:$a,SIP_Version:_a,INVITEm:ab,ACKm:bb,OPTIONSm:cb,BYEm:db,CANCELm:eb,REGISTERm:fb,SUBSCRIBEm:gb,NOTIFYm:hb,REFERm:ib,Method:jb,Status_Line:kb,Status_Code:lb,extension_code:mb,Reason_Phrase:nb,Allow_Events:ob,Call_ID:pb,Contact:qb,contact_param:rb,name_addr:sb,display_name:tb,contact_params:ub,c_p_q:vb,c_p_expires:wb,delta_seconds:xb,qvalue:yb,generic_param:zb,gen_value:Ab,Content_Disposition:Bb,disp_type:Cb,disp_param:Db,handling_param:Eb,Content_Encoding:Fb,Content_Length:Gb,Content_Type:Hb,media_type:Ib,m_type:Jb,discrete_type:Kb,composite_type:Lb,extension_token:Mb,x_token:Nb,m_subtype:Ob,m_parameter:Pb,m_value:Qb,CSeq:Rb,CSeq_value:Sb,Expires:Tb,Event:Ub,event_type:Vb,From:Wb,from_param:Xb,tag_param:Yb,Max_Forwards:Zb,Min_Expires:$b,Name_Addr_Header:_b,Proxy_Authenticate:ac,challenge:bc,other_challenge:cc,auth_param:dc,digest_cln:ec,realm:fc,realm_value:gc,domain:hc,URI:ic,nonce:jc,nonce_value:kc,opaque:lc,stale:mc,algorithm:nc,qop_options:oc,qop_value:pc,Proxy_Require:qc,Record_Route:rc,rec_route:sc,Reason:tc,reason_param:uc,reason_cause:vc,Require:wc,Route:xc,route_param:yc,Subscription_State:zc,substate_value:Ac,subexp_params:Bc,event_reason_value:Cc,Subject:Dc,Supported:Ec,To:Fc,to_param:Gc,Via:Hc,via_param:Ic,via_params:Jc,via_ttl:Kc,via_maddr:Lc,via_received:Mc,via_branch:Nc,response_port:Oc,sent_protocol:Pc,protocol_name:Qc,transport:Rc,sent_by:Sc,via_host:Tc,via_port:Uc,ttl:Vc,WWW_Authenticate:Wc,Session_Expires:Xc,s_e_expires:Yc,s_e_params:Zc,s_e_refresher:$c,extension_header:_c,header_value:ad,message_body:bd,uuid_URI:cd,uuid:dd,hex4:ed,hex8:fd,hex12:gd,Refer_To:hd,Replaces:id,call_id:jd,replaces_param:kd,to_tag:ld,from_tag:md,early_flag:nd};if(void 0!==d){if(void 0===qd[d])throw new Error("Invalid rule name: "+b(d)+".")}else d="CRLF";var rd=0,sd=0,td=0,ud=[],vd=a("./URI"),wd=a("./NameAddrHeader"),xd={},yd=qd[d]();if(null===yd||rd!==c.length){var zd=Math.max(rd,td),Ad=zd<c.length?c.charAt(zd):null,Bd=pd();return new this.SyntaxError(od(ud),Ad,zd,Bd.line,Bd.column),-1}return xd},toSource:function(){return this._source}};return c.SyntaxError=function(a,c,d,e,f){function g(a,c){var d,e;switch(a.length){case 0:d="end of input";break;case 1:d=a[0];break;default:d=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return e=c?b(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=a,this.found=c,this.message=g(a,c),this.offset=d,this.line=e,this.column=f},c.SyntaxError.prototype=Error.prototype,c}()},{"./NameAddrHeader":9,"./URI":24}],7:[function(a,b,c){var d=a("debug")("JsSIP"),e=a("../package.json");d("version %s",e.version);var f=a("rtcninja"),g=a("./Constants"),h=a("./Exceptions"),i=a("./Utils"),j=a("./UA"),k=a("./URI"),l=a("./NameAddrHeader"),m=a("./Grammar"),n=a("./WebSocketInterface"),o=b.exports={C:g,Exceptions:h,Utils:i,UA:j,URI:k,NameAddrHeader:l,WebSocketInterface:n,Grammar:m,debug:a("debug"),rtcninja:f};Object.defineProperties(o,{name:{get:function(){return e.title}},version:{get:function(){return e.version}}})},{"../package.json":40,"./Constants":1,"./Exceptions":5,"./Grammar":6,"./NameAddrHeader":9,"./UA":23,"./URI":24,"./Utils":25,"./WebSocketInterface":26,debug:33,rtcninja:43}],8:[function(a,b,c){function d(a){this.ua=a,this.data={},f.EventEmitter.call(this)}b.exports=d;var e=a("util"),f=a("events"),g=a("./Constants"),h=a("./SIPMessage"),i=a("./Utils"),j=a("./RequestSender"),k=a("./Transactions"),l=a("./Exceptions");e.inherits(d,f.EventEmitter),d.prototype.send=function(a,b,c){var d,e,f,i,k,l=a;if(void 0===a||void 0===b)throw new TypeError("Not enough arguments");if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+l);c=c||{},k=c.extraHeaders&&c.extraHeaders.slice()||[],i=c.eventHandlers||{},f=c.contentType||"text/plain",this.content_type=f;for(e in i)this.on(e,i[e]);this.closed=!1,this.ua.applicants[this]=this,k.push("Content-Type: "+f),this.request=new h.OutgoingRequest(g.MESSAGE,a,this.ua,null,k),b?(this.request.body=b,this.content=b):this.content=null,d=new j(this,this.ua),this.newMessage("local",this.request),d.send()},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:a});break;default:delete this.ua.applicants[this],b=i.sipErrorCause(a.status_code),this.emit("failed",{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:g.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:g.causes.CONNECTION_ERROR})},d.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},d.prototype.init_incoming=function(a){var b;this.request=a,this.content_type=a.getHeader("Content-Type"),a.body?this.content=a.body:this.content=null,this.newMessage("remote",a),b=this.ua.transactions.nist[a.via_branch],!b||b.state!==k.C.STATUS_TRYING&&b.state!==k.C.STATUS_PROCEEDING||a.reply(200)},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body;if("incoming"!==this.direction)throw new l.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,b,c)},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders&&a.extraHeaders.slice()||[],e=a.body;if("incoming"!==this.direction)throw new l.NotSupportedError('"reject" not supported for outgoing Message');if(b<300||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e)},d.prototype.newMessage=function(a,b){"remote"===a?(this.direction="incoming",this.local_identity=b.to,this.remote_identity=b.from):"local"===a&&(this.direction="outgoing",this.local_identity=b.from,this.remote_identity=b.to),this.ua.newMessage({originator:a,message:this,request:b})}},{"./Constants":1,"./Exceptions":5,"./RequestSender":17,"./SIPMessage":18,"./Transactions":21,"./Utils":25,events:28,util:32}],9:[function(a,b,c){function d(a,b,c){var d;if(!(a&&a instanceof e))throw new TypeError('missing or invalid "uri" parameter');this.uri=a,this.parameters={};for(d in c)this.setParam(d,c[d]);Object.defineProperties(this,{display_name:{get:function(){return b},set:function(a){b=0===a?"0":a}}})}b.exports=d;var e=a("./URI"),f=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var b;if(a=a.toLowerCase(),this.parameters.hasOwnProperty(a))return b=this.parameters[a],delete this.parameters[a],b},clearParams:function(){this.parameters={}},clone:function(){return new d(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var a,b;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",a+="<"+this.uri.toString()+">";for(b in this.parameters)a+=";"+b,null!==this.parameters[b]&&(a+="="+this.parameters[b]);return a}},d.parse=function(a){return a=f.parse(a,"Name_Addr_Header"),a!==-1?a:void 0}},{"./Grammar":6,"./URI":24}],10:[function(a,b,c){function d(a,b){var c=b,d=0,e=0;if(a.substring(c,c+2).match(/(^\r\n)/))return-2;for(;0===d;){if(e=a.indexOf("\r\n",c),e===-1)return e;!a.substring(e+2,e+4).match(/(^\r\n)/)&&a.charAt(e+2).match(/(^\s+)/)?c=e+2:d=e}return d}function e(a,b,c,d){var e,f,g,j,k=b.indexOf(":",c),l=b.substring(c,k).trim(),m=b.substring(k+1,d).trim();switch(l.toLowerCase()){case"via":case"v":a.addHeader("via",m),1===a.getHeaders("via").length?(j=a.parseHeader("Via"),j&&(a.via=j,a.via_branch=j.branch)):j=0;break;case"from":case"f":a.setHeader("from",m),j=a.parseHeader("from"),j&&(a.from=j,a.from_tag=j.getParam("tag"));break;case"to":case"t":a.setHeader("to",m),j=a.parseHeader("to"),j&&(a.to=j,a.to_tag=j.getParam("tag"));break;case"record-route":for(j=h.parse(m,"Record_Route"),j===-1&&(j=void 0),g=j.length,f=0;f<g;f++)e=j[f],a.addHeader("record-route",m.substring(e.possition,e.offset)),a.headers["Record-Route"][a.getHeaders("record-route").length-1].parsed=e.parsed;break;case"call-id":case"i":a.setHeader("call-id",m),j=a.parseHeader("call-id"),j&&(a.call_id=m);break;case"contact":case"m":for(j=h.parse(m,"Contact"),j===-1&&(j=void 0),g=j.length,f=0;f<g;f++)e=j[f],a.addHeader("contact",m.substring(e.possition,e.offset)),a.headers.Contact[a.getHeaders("contact").length-1].parsed=e.parsed;break;case"content-length":case"l":a.setHeader("content-length",m),j=a.parseHeader("content-length");break;case"content-type":case"c":a.setHeader("content-type",m),j=a.parseHeader("content-type");break;case"cseq":a.setHeader("cseq",m),j=a.parseHeader("cseq"),j&&(a.cseq=j.value),a instanceof i.IncomingResponse&&(a.method=j.method);break;case"max-forwards":a.setHeader("max-forwards",m),j=a.parseHeader("max-forwards");break;case"www-authenticate":a.setHeader("www-authenticate",m),j=a.parseHeader("www-authenticate");break;case"proxy-authenticate":a.setHeader("proxy-authenticate",m),j=a.parseHeader("proxy-authenticate");break;case"session-expires":case"x":a.setHeader("session-expires",m),j=a.parseHeader("session-expires"),j&&(a.session_expires=j.expires,a.session_expires_refresher=j.refresher);break;case"refer-to":case"r":a.setHeader("refer-to",m),j=a.parseHeader("refer-to"),j&&(a.refer_to=j);break;case"replaces":a.setHeader("replaces",m),j=a.parseHeader("replaces"),j&&(a.replaces=j);break;case"event":case"o":a.setHeader("event",m),j=a.parseHeader("event"),j&&(a.event=j);break;default:a.setHeader(l,m),j=0}return void 0!==j||{error:'error parsing header "'+l+'"'}}var f={};b.exports=f;var g=a("debug")("JsSIP:ERROR:Parser");g.log=console.warn.bind(console);var h=a("./Grammar"),i=a("./SIPMessage");f.parseMessage=function(a,b){var c,f,j,k,l,m=0,n=a.indexOf("\r\n");if(n===-1)return void g("parseMessage() | no CRLF found, not a SIP message");if(f=a.substring(0,n),l=h.parse(f,"Request_Response"),l===-1)return void g('parseMessage() | error parsing first line of SIP message: "'+f+'"');for(l.status_code?(c=new i.IncomingResponse,c.status_code=l.status_code,c.reason_phrase=l.reason_phrase):(c=new i.IncomingRequest(b),c.method=l.method,c.ruri=l.uri),c.data=a,m=n+2;;){if(n=d(a,m),n===-2){k=m+2;break}if(n===-1)return void g("parseMessage() | malformed message");if(l=e(c,a,m,n),l!==!0)return void g("parseMessage() |",l.error);m=n+2}return c.hasHeader("content-length")?(j=c.getHeader("content-length"),c.body=a.substr(k,j)):c.body=a.substring(k),c}},{"./Grammar":6,"./SIPMessage":18,debug:33}],11:[function(a,b,c){function d(a){P("new"),this.ua=a,this.status=M.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:T.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.referSubscribers={},this.data={},O.EventEmitter.call(this)}function e(a,b){var c=this,d=X.T1;this.timers.invite2xxTimer=setTimeout(function e(){c.status===M.STATUS_WAITING_FOR_ACK&&(a.reply(200,null,["Contact: "+c.contact],b),d<X.T2&&(d*=2,d>X.T2&&(d=X.T2)),c.timers.invite2xxTimer=setTimeout(e,d))},d)}function f(){var a=this;this.timers.ackTimer=setTimeout(function(){a.status===M.STATUS_WAITING_FOR_ACK&&(P("no ACK received, terminating the session"),clearTimeout(a.timers.invite2xxTimer),t.call(a,T.BYE),G.call(a,"remote",null,T.causes.NO_ACK))},X.TIMER_H)}function g(a,b){var c=this;this.connection=new R.RTCPeerConnection(a,b),this.connection.onaddstream=function(a,b){c.emit("addstream",{stream:b})},this.connection.onremovestream=function(a,b){c.emit("removestream",{stream:b})},this.connection.oniceconnectionstatechange=function(a,b){c.emit("iceconnectionstatechange",{state:b}),"failed"===b&&c.terminate({cause:T.causes.RTP_TIMEOUT,status_code:200,reason_phrase:T.causes.RTP_TIMEOUT})}}function h(a,b,c,d){function e(d){g.onicecandidate=function(c,d){if(!d){if(g.onicecandidate=null,f.rtcReady=!0,b){var e={originator:"local",type:a,sdp:g.localDescription.sdp};f.emit("sdp",e),b(e.sdp)}b=null}},g.setLocalDescription(d,function(){if("complete"===g.iceGatheringState){if(f.rtcReady=!0,b){var c={originator:"local",type:a,sdp:g.localDescription.sdp};f.emit("sdp",c),b(c.sdp)}b=null}},function(a){f.rtcReady=!0,c&&c(a)})}P("createLocalDescription()");var f=this,g=this.connection;if(this.rtcReady=!1,"offer"===a)g.createOffer(e,function(a){f.rtcReady=!0,c&&c(a)},d);else{if("answer"!==a)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+a+'" was given');g.createAnswer(e,function(a){f.rtcReady=!0,c&&c(a)},d)}}function i(a,b,c){var d,e,f="UAS"===b?a.to_tag:a.from_tag,g="UAS"===b?a.from_tag:a.to_tag,h=a.call_id+f+g;return e=this.earlyDialogs[h],c?!!e||(e=new Z(this,a,b,Z.C.STATUS_EARLY),e.error?(P(e.error),H.call(this,"remote",a,T.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[h]=e,!0)):(this.from_tag=a.from_tag,this.to_tag=a.to_tag,e?(e.update(a,b),this.dialog=e,delete this.earlyDialogs[h],!0):(d=new Z(this,a,b),d.error?(P(d.error),H.call(this,"remote",a,T.causes.INTERNAL_ERROR),!1):(this.dialog=d,!0)))}function j(a){function b(b){b=b||{},o=!0;var c=b.status_code||403,d=b.reason_phrase||"",e=b.extraHeaders&&b.extraHeaders.slice()||[];if(this.status!==M.STATUS_CONFIRMED)return!1;if(c<300||c>=700)throw new TypeError("Invalid status_code: "+c);a.reply(c,d,e)}function c(){d(function(b){var c=["Contact: "+l.contact];w.call(l,a,c),l.late_sdp&&(b=u.call(l,b)),a.reply(200,null,c,b,function(){l.status=M.STATUS_WAITING_FOR_ACK,e.call(l,a,b),f.call(l)}),"function"==typeof p.callback&&p.callback()},function(){a.reply(500)})}function d(a,b){l.late_sdp?h.call(l,"offer",a,b,l.rtcOfferConstraints):(l.remoteHold===!0&&n===!1?(l.remoteHold=!1,J.call(l,"remote")):l.remoteHold===!1&&n===!0&&(l.remoteHold=!0,I.call(l,"remote")),h.call(l,"answer",a,b,l.rtcAnswerConstraints))}P("receiveReinvite()");var g,i,j,k,l=this,m=a.getHeader("Content-Type"),n=!1,o=!1,p={request:a,callback:void 0,reject:b.bind(this)};if(this.emit("reinvite",p),!o)if(a.body){if(this.late_sdp=!1,"application/sdp"!==m)return P("invalid Content-Type"),void a.reply(415);for(g=a.parseSDP(),i=0;i<g.media.length;i++)if(k=g.media[i],da.indexOf(k.type)!==-1){if(j=k.direction||g.direction||"sendrecv","sendonly"!==j&&"inactive"!==j){n=!1;break}n=!0}var q={originator:"remote",type:"offer",sdp:a.body};this.emit("sdp",q),this.connection.setRemoteDescription(new R.RTCSessionDescription({type:"offer",sdp:q.sdp}),c,function(){a.reply(488)})}else this.late_sdp=!0,c()}function k(a){function b(b){b=b||{},j=!0;var c=b.status_code||403,d=b.reason_phrase||"",e=b.extraHeaders&&b.extraHeaders.slice()||[];if(this.status!==M.STATUS_CONFIRMED)return!1;if(c<300||c>=700)throw new TypeError("Invalid status_code: "+c);a.reply(c,d,e)}P("receiveUpdate()");var c,d,e,f,g=this,i=a.getHeader("Content-Type"),j=!1,k=!1,l={request:a,callback:void 0,reject:b.bind(this)};if(this.emit("update",l),!j){if(!a.body){var m=[];return w.call(this,a,m),void a.reply(200,null,m)}if("application/sdp"!==i)return P("invalid Content-Type"),void a.reply(415);for(c=a.parseSDP(),d=0;d<c.media.length;d++)if(f=c.media[d],da.indexOf(f.type)!==-1){if(e=f.direction||c.direction||"sendrecv","sendonly"!==e&&"inactive"!==e){k=!1;break}k=!0}var n={originator:"remote",type:"offer",sdp:a.body};this.emit("sdp",n),this.connection.setRemoteDescription(new R.RTCSessionDescription({type:"offer",sdp:n.sdp}),function(){g.remoteHold===!0&&k===!1?(g.remoteHold=!1,J.call(g,"remote")):g.remoteHold===!1&&k===!0&&(g.remoteHold=!0,I.call(g,"remote")),h.call(g,"answer",function(b){var c=["Contact: "+g.contact];w.call(g,a,c),a.reply(200,null,c,b),"function"==typeof l.callback&&l.callback()},function(){a.reply(500)})},function(){a.reply(488)},this.rtcAnswerConstraints)}}function l(a){function b(b,c){var f,g;return c=c||{},b="function"==typeof b?b:null,(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(f=new d(this.ua),f.on("progress",function(a){e.notify(a.response.status_code,a.response.reason_phrase)}),f.on("accepted",function(a){e.notify(a.response.status_code,a.response.reason_phrase)}),f.on("failed",function(a){a.message?e.notify(a.message.status_code,a.message.reason_phrase):e.notify(487,a.cause)}),a.refer_to.uri.hasHeader("replaces")&&(g=decodeURIComponent(a.refer_to.uri.getHeader("replaces")),c.extraHeaders=c.extraHeaders||[],c.extraHeaders.push("Replaces: "+g)),void f.connect(a.refer_to.uri.toAor(),c,b))}function c(){e.notify(603)}P("receiveRefer()");var e,f=this;return void 0===typeof a.refer_to?(P("no Refer-To header field present in REFER"),void a.reply(400)):a.refer_to.uri.scheme!==T.SIP?(P("Refer-To header field points to a non-SIP URI scheme"),void a.reply(416)):(a.reply(202),e=new ba(this,a.cseq),void this.emit("refer",{request:a,accept:function(a,c){b.call(f,a,c)},reject:function(){c.call(f)}}))}function m(a){switch(P("receiveNotify()"),void 0===typeof a.event&&a.reply(400),a.event.event){case"refer":var b=a.event.params.id,c=this.referSubscribers[b];if(!c)return void a.reply(481,"Subscription does not exist");c.receiveNotify(a),a.reply(200);break;default:a.reply(489)}}function n(a){function b(b){var c;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(c=new d(this.ua),c.on("confirmed",function(){e.terminate()}),void c.init_incoming(a,b))}function c(){P("Replaced INVITE rejected by the user"),a.reply(486)}P("receiveReplaces()");var e=this;this.emit("replaces",{request:a,accept:function(a){b.call(e,a)},reject:function(){c.call(e)}})}function o(a,b,c){function d(a){i.status!==M.STATUS_TERMINATED&&(i.localMediaStream=a,a&&i.connection.addStream(a),i.emit("peerconnection",{peerconnection:i.connection}),C.call(i,i.request),h.call(i,"offer",f,g,b))}function e(){i.status!==M.STATUS_TERMINATED&&H.call(i,"local",null,T.causes.USER_DENIED_MEDIA_ACCESS)}function f(a){i.isCanceled||i.status===M.STATUS_TERMINATED||(i.request.body=a,i.status=M.STATUS_INVITE_SENT,i.emit("sending",{request:i.request}),j.send())}function g(){i.status!==M.STATUS_TERMINATED&&H.call(i,"system",null,T.causes.WEBRTC_ERROR)}var i=this,j=new $(i,this.ua);this.receiveResponse=function(a){p.call(i,a)},c?setTimeout(function(){d(c)}):a.audio||a.video?(this.localMediaStreamLocallyGenerated=!0,R.getUserMedia(a,d,e)):d(null)}function p(a){P("receiveInviteResponse()");var b,c,d,e=this;if(this.dialog&&a.status_code>=200&&a.status_code<=299)return this.dialog.id.call_id===a.call_id&&this.dialog.id.local_tag===a.from_tag&&this.dialog.id.remote_tag===a.to_tag?void t.call(this,T.ACK):(c=new Z(this,a,"UAC"),void 0!==c.error?void P(c.error):(c.sendRequest({owner:{status:M.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},T.ACK),void c.sendRequest({owner:{status:M.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},T.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(a.status_code>=100&&a.status_code<200?this.request.cancel(this.cancelReason):a.status_code>=200&&a.status_code<299&&s.call(this,a));if(this.status===M.STATUS_INVITE_SENT||this.status===M.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(a.status_code):this.status=M.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(a.status_code):if(!a.to_tag){P("1xx response received without to tag");break}if(a.hasHeader("contact")&&!i.call(this,a,"UAC",!0))break;if(this.status=M.STATUS_1XX_RECEIVED,D.call(this,"remote",a),!a.body)break;d={originator:"remote",type:"pranswer",sdp:a.body},this.emit("sdp",d),this.connection.setRemoteDescription(new R.RTCSessionDescription({type:"pranswer",sdp:d.sdp}),null,null);break;case/^2[0-9]{2}$/.test(a.status_code):if(this.status=M.STATUS_CONFIRMED,!a.body){s.call(this,a,400,T.causes.MISSING_SDP),H.call(this,"remote",a,T.causes.BAD_MEDIA_DESCRIPTION);break}if(!i.call(this,a,"UAC"))break;d={originator:"remote",type:"answer",sdp:a.body},this.emit("sdp",d),this.connection.setRemoteDescription(new R.RTCSessionDescription({type:"answer",sdp:d.sdp}),function(){x.call(e,a),E.call(e,"remote",a),t.call(e,T.ACK),F.call(e,"local",null)},function(){s.call(e,a,488,"Not Acceptable Here"),H.call(e,"remote",a,T.causes.BAD_MEDIA_DESCRIPTION)});break;default:b=W.sipErrorCause(a.status_code),H.call(this,"remote",a,b)}}function q(a){function b(a){if(d.status!==M.STATUS_TERMINATED&&(t.call(d,T.ACK),!i)){if(x.call(d,a),!a.body)return void c();if("application/sdp"!==a.getHeader("Content-Type"))return void c();var b={originator:"remote",type:"answer",sdp:a.body};d.emit("sdp",b),d.connection.setRemoteDescription(new R.RTCSessionDescription({type:"answer",sdp:b.sdp}),function(){f.succeeded&&f.succeeded(a)},function(){c()})}}function c(a){f.failed&&f.failed(a)}P("sendReinvite()"),a=a||{};var d=this,e=a.extraHeaders||[],f=a.eventHandlers||{},g=a.rtcOfferConstraints||this.rtcOfferConstraints||null,i=!1;e.push("Contact: "+this.contact),e.push("Content-Type: application/sdp"),this.sessionTimers.running&&e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),h.call(this,"offer",function(a){a=u.call(d,a);var f=new _(d,T.INVITE);f.send({extraHeaders:e,body:a,eventHandlers:{onSuccessResponse:function(a){b(a),i=!0},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){c()},g)}function r(a){function b(a){if(d.status!==M.STATUS_TERMINATED&&!j)if(x.call(d,a),i){if(!a.body)return void c();if("application/sdp"!==a.getHeader("Content-Type"))return void c();var b={originator:"remote",type:"answer",sdp:a.body};d.emit("sdp",b),d.connection.setRemoteDescription(new R.RTCSessionDescription({type:"answer",sdp:b.sdp}),function(){f.succeeded&&f.succeeded(a)},function(){c()})}else f.succeeded&&f.succeeded(a)}function c(a){f.failed&&f.failed(a)}P("sendUpdate()"),a=a||{};var d=this,e=a.extraHeaders||[],f=a.eventHandlers||{},g=a.rtcOfferConstraints||this.rtcOfferConstraints||null,i=a.sdpOffer||!1,j=!1;if(e.push("Contact: "+this.contact),this.sessionTimers.running&&e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),i)e.push("Content-Type: application/sdp"),h.call(this,"offer",function(a){a=u.call(d,a);var f=new _(d,T.UPDATE);f.send({extraHeaders:e,body:a,eventHandlers:{onSuccessResponse:function(a){b(a),j=!0},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){c()},g);else{var k=new _(d,T.UPDATE);k.send({extraHeaders:e,eventHandlers:{onSuccessResponse:function(a){b(a)},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})}}function s(a,b,c){P("acceptAndTerminate()");var d=[];b&&(c=c||T.REASON_PHRASE[b]||"",d.push("Reason: SIP ;cause="+b+'; text="'+c+'"')),(this.dialog||i.call(this,a,"UAC"))&&(t.call(this,T.ACK),t.call(this,T.BYE,{extraHeaders:d})),this.status=M.STATUS_TERMINATED}function t(a,b){P("sendRequest()");var c=new _(this,a);c.send(b)}function u(a){var b,c,d;if(!this.localHold&&!this.remoteHold)return a;if(a=S.parse(a),this.localHold&&!this.remoteHold)for(P("mangleOffer() | me on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],da.indexOf(d.type)!==-1&&(d.direction?"sendrecv"===d.direction?d.direction="sendonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="sendonly");else if(this.localHold&&this.remoteHold)for(P("mangleOffer() | both on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],da.indexOf(d.type)!==-1&&(d.direction="inactive");else if(this.remoteHold)for(P("mangleOffer() | remote on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],da.indexOf(d.type)!==-1&&(d.direction?"sendrecv"===d.direction?d.direction="recvonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="recvonly");return S.write(a)}function v(){var a=!0,b=!0;(this.localHold||this.remoteHold)&&(a=!1,b=!1),this.audioMuted&&(a=!1),this.videoMuted&&(b=!1),z.call(this,!a),A.call(this,!b)}function w(a,b){if(this.sessionTimers.enabled){var c;a.session_expires&&a.session_expires>=T.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,c=a.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,c="uas"),b.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+c),this.sessionTimers.refresher="uas"===c,y.call(this)}}function x(a){if(this.sessionTimers.enabled){var b;a.session_expires&&a.session_expires>=T.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,b=a.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,b="uac"),this.sessionTimers.refresher="uac"===b,y.call(this)}}function y(){var a=this,b=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){a.status!==M.STATUS_TERMINATED&&(P("runSessionTimer() | sending session refresh request"),r.call(a,{eventHandlers:{succeeded:function(b){x.call(a,b)}}}))},500*b):this.sessionTimers.timer=setTimeout(function(){a.status!==M.STATUS_TERMINATED&&(Q("runSessionTimer() | timer expired, terminating the session"),a.terminate({cause:T.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*b)}function z(a){var b,c,d,e,f,g=this.connection.getLocalStreams();for(d=g.length,b=0;b<d;b++)for(f=g[b].getAudioTracks(),e=f.length,c=0;c<e;c++)f[c].enabled=!a}function A(a){var b,c,d,e,f,g=this.connection.getLocalStreams();for(d=g.length,b=0;b<d;b++)for(f=g[b].getVideoTracks(),e=f.length,c=0;c<e;c++)f[c].enabled=!a}function B(a,b){P("newRTCSession"),this.ua.newRTCSession({originator:a,session:this,request:b})}function C(a){P("session connecting"),this.emit("connecting",{request:a})}function D(a,b){P("session progress"),this.emit("progress",{originator:a,response:b||null})}function E(a,b){P("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:a,response:b||null})}function F(a,b){P("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:a,ack:b||null})}function G(a,b,c){P("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:a,message:b||null,cause:c})}function H(a,b,c){P("session failed"),this.close(),this.emit("failed",{originator:a,message:b||null,cause:c})}function I(a){P("session onhold"),v.call(this),this.emit("hold",{originator:a})}function J(a){P("session onunhold"),v.call(this),this.emit("unhold",{originator:a})}function K(a){P("session onmute"),v.call(this),this.emit("muted",{audio:a.audio,video:a.video})}function L(a){P("session onunmute"),v.call(this),this.emit("unmuted",{audio:a.audio,video:a.video})}b.exports=d;var M={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};d.C=M;var N=a("util"),O=a("events"),P=a("debug")("JsSIP:RTCSession"),Q=a("debug")("JsSIP:ERROR:RTCSession");Q.log=console.warn.bind(console);var R=a("rtcninja"),S=a("sdp-transform"),T=a("./Constants"),U=a("./Exceptions"),V=a("./Transactions"),W=a("./Utils"),X=a("./Timers"),Y=a("./SIPMessage"),Z=a("./Dialog"),$=a("./RequestSender"),_=a("./RTCSession/Request"),aa=a("./RTCSession/DTMF"),ba=a("./RTCSession/ReferNotifier"),ca=a("./RTCSession/ReferSubscriber"),da=["audio","video"];N.inherits(d,O.EventEmitter),d.prototype.isInProgress=function(){switch(this.status){case M.STATUS_NULL:case M.STATUS_INVITE_SENT:case M.STATUS_1XX_RECEIVED:case M.STATUS_INVITE_RECEIVED:case M.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},d.prototype.isEstablished=function(){switch(this.status){case M.STATUS_ANSWERED:case M.STATUS_WAITING_FOR_ACK:case M.STATUS_CONFIRMED:return!0;default:return!1}},d.prototype.isEnded=function(){switch(this.status){case M.STATUS_CANCELED:case M.STATUS_TERMINATED:return!0;default:return!1}},d.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},d.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},d.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?this.dialog.uac_pending_reply!==!0&&this.dialog.uas_pending_reply!==!0||(P("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(P("isReadyToReOffer() | session not established yet"),!1):(P("isReadyToReOffer() | internal WebRTC status not ready"),!1)},d.prototype.connect=function(a,b,c){P("connect()"),b=b||{};var d,e,f=a,h=b.eventHandlers||{},i=b.extraHeaders&&b.extraHeaders.slice()||[],j=b.mediaConstraints||{audio:!0,video:!0},k=b.mediaStream||null,l=b.pcConfig||{iceServers:[]},m=b.rtcConstraints||null,n=b.rtcOfferConstraints||null;if(this.rtcOfferConstraints=n,this.rtcAnswerConstraints=b.rtcAnswerConstraints||null,
this.sessionTimers.enabled&&W.isDecimal(b.sessionTimersExpires)&&(b.sessionTimersExpires>=T.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=b.sessionTimersExpires:this.sessionTimers.defaultExpires=T.SESSION_EXPIRES),this.data=b.data||this.data,void 0===a)throw new TypeError("Not enough arguments");if(!R.hasWebRTC())throw new U.NotSupportedError("WebRTC not supported");if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+f);if(this.status!==M.STATUS_NULL)throw new U.InvalidStateError(this.status);for(d in h)this.on(d,h[d]);this.from_tag=W.newTag(),this.anonymous=b.anonymous||!1,this.isCanceled=!1,e={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(e.from_display_name="Anonymous",e.from_uri="sip:anonymous@anonymous.invalid",i.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),i.push("Privacy: id")),i.push("Contact: "+this.contact),i.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&i.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new Y.OutgoingRequest(T.INVITE,a,this.ua,e,i),this.id=this.request.call_id+this.from_tag,g.call(this,l,m),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,c?c(this):B.call(this,"local",this.request),o.call(this,j,n,k)},d.prototype.init_incoming=function(a,b){P("init_incoming()");var c,d=this,e=a.getHeader("Content-Type");return a.body&&"application/sdp"!==e?void a.reply(415):(this.status=M.STATUS_INVITE_RECEIVED,this.from_tag=a.from_tag,this.id=a.call_id+this.from_tag,this.request=a,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,a.hasHeader("expires")&&(c=1e3*a.getHeader("expires")),a.to_tag=W.newTag(),i.call(this,a,"UAS",!0)?(a.body?this.late_sdp=!1:this.late_sdp=!0,this.status=M.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){a.reply(408),H.call(d,"local",null,T.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),c&&(this.timers.expiresTimer=setTimeout(function(){d.status===M.STATUS_WAITING_FOR_ANSWER&&(a.reply(487),H.call(d,"system",null,T.causes.EXPIRES))},c)),this.direction="incoming",this.local_identity=a.to,this.remote_identity=a.from,b?b(this):B.call(this,"remote",a),void(this.status!==M.STATUS_TERMINATED&&(a.reply(180,null,["Contact: "+d.contact]),D.call(d,"local",null)))):void a.reply(500,"Missing Contact header field"))},d.prototype.answer=function(a){function b(a){if(t.status!==M.STATUS_TERMINATED)if(t.localMediaStream=a,a&&t.connection.addStream(a),t.request.body||t.emit("peerconnection",{peerconnection:t.connection}),t.late_sdp)d();else{var b={originator:"remote",type:"offer",sdp:u.body};t.emit("sdp",b),t.connection.setRemoteDescription(new R.RTCSessionDescription({type:"offer",sdp:b.sdp}),d,function(){u.reply(488),H.call(t,"system",null,T.causes.WEBRTC_ERROR)})}}function c(){t.status!==M.STATUS_TERMINATED&&(u.reply(480),H.call(t,"local",null,T.causes.USER_DENIED_MEDIA_ACCESS))}function d(){C.call(t,u),t.late_sdp?h.call(t,"offer",j,k,t.rtcOfferConstraints):h.call(t,"answer",j,k,B)}function j(a){function b(){t.status=M.STATUS_WAITING_FOR_ACK,e.call(t,u,a),f.call(t),E.call(t,"local")}function c(){H.call(t,"system",null,T.causes.CONNECTION_ERROR)}t.status!==M.STATUS_TERMINATED&&(w.call(t,u,v),u.reply(200,null,v,a,b,c))}function k(){t.status!==M.STATUS_TERMINATED&&(u.reply(500),H.call(t,"system",null,T.causes.WEBRTC_ERROR))}P("answer()"),a=a||{};var l,m,n,o,p=!1,q=!1,r=!1,s=!1,t=this,u=this.request,v=a.extraHeaders&&a.extraHeaders.slice()||[],x=a.mediaConstraints||{},y=a.mediaStream||null,z=a.pcConfig||{iceServers:[]},A=a.rtcConstraints||null,B=a.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=B,this.rtcOfferConstraints=a.rtcOfferConstraints||null,this.sessionTimers.enabled&&W.isDecimal(a.sessionTimersExpires)&&(a.sessionTimersExpires>=T.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=a.sessionTimersExpires:this.sessionTimers.defaultExpires=T.SESSION_EXPIRES),this.data=a.data||this.data,"incoming"!==this.direction)throw new U.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==M.STATUS_WAITING_FOR_ANSWER)throw new U.InvalidStateError(this.status);if(this.status=M.STATUS_ANSWERED,!i.call(this,u,"UAS"))return void u.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),v.unshift("Contact: "+t.contact),n=u.parseSDP(),Array.isArray(n.media)||(n.media=[n.media]),l=n.media.length;l--;){var D=n.media[l];"audio"===D.type&&(p=!0,D.direction&&"sendrecv"!==D.direction||(r=!0)),"video"===D.type&&(q=!0,D.direction&&"sendrecv"!==D.direction||(s=!0))}if(y&&x.audio===!1)for(o=y.getAudioTracks(),m=o.length,l=0;l<m;l++)y.removeTrack(o[l]);if(y&&x.video===!1)for(o=y.getVideoTracks(),m=o.length,l=0;l<m;l++)y.removeTrack(o[l]);y||void 0!==x.audio||(x.audio=r),y||void 0!==x.video||(x.video=s),y||p||(x.audio=!1),y||q||(x.video=!1),g.call(this,z,A),y?b(y):x.audio||x.video?(t.localMediaStreamLocallyGenerated=!0,R.getUserMedia(x,b,c)):b(null)},d.prototype.terminate=function(a){P("terminate()"),a=a||{};var b,c,d=a.cause||T.causes.BYE,e=a.status_code,f=a.reason_phrase,g=a.extraHeaders&&a.extraHeaders.slice()||[],h=a.body,i=this;if(this.status===M.STATUS_TERMINATED)throw new U.InvalidStateError(this.status);switch(this.status){case M.STATUS_NULL:case M.STATUS_INVITE_SENT:case M.STATUS_1XX_RECEIVED:if(P("canceling session"),e&&(e<200||e>=700))throw new TypeError("Invalid status_code: "+e);e&&(f=f||T.REASON_PHRASE[e]||"",b="SIP ;cause="+e+' ;text="'+f+'"'),this.status===M.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=b):this.status===M.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=b):this.status===M.STATUS_1XX_RECEIVED&&this.request.cancel(b),this.status=M.STATUS_CANCELED,H.call(this,"local",null,T.causes.CANCELED);break;case M.STATUS_WAITING_FOR_ANSWER:case M.STATUS_ANSWERED:if(P("rejecting session"),e=e||480,e<300||e>=700)throw new TypeError("Invalid status_code: "+e);this.request.reply(e,f,g,h),H.call(this,"local",null,T.causes.REJECTED);break;case M.STATUS_WAITING_FOR_ACK:case M.STATUS_CONFIRMED:if(P("terminating session"),f=a.reason_phrase||T.REASON_PHRASE[e]||"",e&&(e<200||e>=700))throw new TypeError("Invalid status_code: "+e);e&&g.push("Reason: SIP ;cause="+e+'; text="'+f+'"'),this.status===M.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==V.C.STATUS_TERMINATED?(c=this.dialog,this.receiveRequest=function(a){a.method===T.ACK&&(t.call(this,T.BYE,{extraHeaders:g,body:h}),c.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===V.C.STATUS_TERMINATED&&(t.call(i,T.BYE,{extraHeaders:g,body:h}),c.terminate())}),G.call(this,"local",null,d),this.dialog=c,this.ua.dialogs[c.id.toString()]=c):(t.call(this,T.BYE,{extraHeaders:g,body:h}),G.call(this,"local",null,d))}},d.prototype.close=function(){P("close()");var a;if(this.status!==M.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(a){Q("close() | error closing the RTCPeerConnection: %o",a)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(P("close() | closing local MediaStream"),R.closeMediaStream(this.localMediaStream));for(a in this.timers)clearTimeout(this.timers[a]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a];this.status=M.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},d.prototype.sendDTMF=function(a,b){function c(){var a,h;if(g.status===M.STATUS_TERMINATED||!g.tones||f>=g.tones.length)return void(g.tones=null);if(a=g.tones[f],f+=1,","===a)h=2e3;else{var i=new aa(g);b.eventHandlers={failed:function(){g.tones=null}},i.send(a,b),h=d+e}setTimeout(c,h)}P("sendDTMF() | tones: %s",a);var d,e,f=0,g=this;if(b=b||{},d=b.duration||null,e=b.interToneGap||null,void 0===a)throw new TypeError("Not enough arguments");if(this.status!==M.STATUS_CONFIRMED&&this.status!==M.STATUS_WAITING_FOR_ACK)throw new U.InvalidStateError(this.status);if("number"==typeof a&&(a=a.toString()),!a||"string"!=typeof a||!a.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+a);if(d&&!W.isDecimal(d))throw new TypeError("Invalid tone duration: "+d);if(d?d<aa.C.MIN_DURATION?(P('"duration" value is lower than the minimum allowed, setting it to '+aa.C.MIN_DURATION+" milliseconds"),d=aa.C.MIN_DURATION):d>aa.C.MAX_DURATION?(P('"duration" value is greater than the maximum allowed, setting it to '+aa.C.MAX_DURATION+" milliseconds"),d=aa.C.MAX_DURATION):d=Math.abs(d):d=aa.C.DEFAULT_DURATION,b.duration=d,e&&!W.isDecimal(e))throw new TypeError("Invalid interToneGap: "+e);return e?e<aa.C.MIN_INTER_TONE_GAP?(P('"interToneGap" value is lower than the minimum allowed, setting it to '+aa.C.MIN_INTER_TONE_GAP+" milliseconds"),e=aa.C.MIN_INTER_TONE_GAP):e=Math.abs(e):e=aa.C.DEFAULT_INTER_TONE_GAP,this.tones?void(this.tones+=a):(this.tones=a,void c())},d.prototype.mute=function(a){P("mute()"),a=a||{audio:!0,video:!1};var b=!1,c=!1;this.audioMuted===!1&&a.audio&&(b=!0,this.audioMuted=!0,z.call(this,!0)),this.videoMuted===!1&&a.video&&(c=!0,this.videoMuted=!0,A.call(this,!0)),b!==!0&&c!==!0||K.call(this,{audio:b,video:c})},d.prototype.unmute=function(a){P("unmute()"),a=a||{audio:!0,video:!0};var b=!1,c=!1;this.audioMuted===!0&&a.audio&&(b=!0,this.audioMuted=!1,this.localHold===!1&&z.call(this,!1)),this.videoMuted===!0&&a.video&&(c=!0,this.videoMuted=!1,this.localHold===!1&&A.call(this,!1)),b!==!0&&c!==!0||L.call(this,{audio:b,video:c})},d.prototype.hold=function(a,b){P("hold()"),a=a||{};var c,d=this;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(this.localHold!==!0&&(!!this.isReadyToReOffer()&&(this.localHold=!0,I.call(this,"local"),c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:T.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},a.useUpdate?r.call(this,{sdpOffer:!0,eventHandlers:c,extraHeaders:a.extraHeaders}):q.call(this,{eventHandlers:c,extraHeaders:a.extraHeaders}),!0)))},d.prototype.unhold=function(a,b){P("unhold()"),a=a||{};var c,d=this;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(this.localHold!==!1&&(!!this.isReadyToReOffer()&&(this.localHold=!1,J.call(this,"local"),c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:T.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},a.useUpdate?r.call(this,{sdpOffer:!0,eventHandlers:c,extraHeaders:a.extraHeaders}):q.call(this,{eventHandlers:c,extraHeaders:a.extraHeaders}),!0)))},d.prototype.renegotiate=function(a,b){P("renegotiate()"),a=a||{};var c,d=this,e=a.rtcOfferConstraints||null;return(this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:T.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},v.call(this),a.useUpdate?r.call(this,{sdpOffer:!0,eventHandlers:c,rtcOfferConstraints:e,extraHeaders:a.extraHeaders}):q.call(this,{eventHandlers:c,rtcOfferConstraints:e,extraHeaders:a.extraHeaders}),!0))},d.prototype.refer=function(a,b){P("refer()");var c,d,e=this,f=a;if(this.status!==M.STATUS_WAITING_FOR_ACK&&this.status!==M.STATUS_CONFIRMED)return!1;if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+f);return c=new ca(this),c.sendRefer(a,b),d=c.outgoingRequest.cseq,this.referSubscribers[d]=c,c.on("requestFailed",function(){delete e.referSubscribers[d]}),c.on("accepted",function(){delete e.referSubscribers[d]}),c.on("failed",function(){delete e.referSubscribers[d]}),c},d.prototype.receiveRequest=function(a){P("receiveRequest()");var b,c=this;if(a.method===T.CANCEL)this.status!==M.STATUS_WAITING_FOR_ANSWER&&this.status!==M.STATUS_ANSWERED||(this.status=M.STATUS_CANCELED,this.request.reply(487),H.call(this,"remote",a,T.causes.CANCELED));else switch(a.method){case T.ACK:if(this.status!==M.STATUS_WAITING_FOR_ACK)return;if(this.status=M.STATUS_CONFIRMED,clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!a.body){this.terminate({cause:T.causes.MISSING_SDP,status_code:400});break}var d={originator:"remote",type:"answer",sdp:a.body};this.emit("sdp",d),this.connection.setRemoteDescription(new R.RTCSessionDescription({type:"answer",sdp:d.sdp}),function(){c.is_confirmed||F.call(c,"remote",a)},function(){c.terminate({cause:T.causes.BAD_MEDIA_DESCRIPTION,status_code:488})})}else this.is_confirmed||F.call(this,"remote",a);break;case T.BYE:this.status===M.STATUS_CONFIRMED?(a.reply(200),G.call(this,"remote",a,T.causes.BYE)):this.status===M.STATUS_INVITE_RECEIVED?(a.reply(200),this.request.reply(487,"BYE Received"),G.call(this,"remote",a,T.causes.BYE)):a.reply(403,"Wrong Status");break;case T.INVITE:this.status===M.STATUS_CONFIRMED?a.hasHeader("replaces")?n.call(this,a):j.call(this,a):a.reply(403,"Wrong Status");break;case T.INFO:this.status===M.STATUS_CONFIRMED||this.status===M.STATUS_WAITING_FOR_ACK||this.status===M.STATUS_INVITE_RECEIVED?(b=a.getHeader("content-type"),b&&b.match(/^application\/dtmf-relay/i)?new aa(this).init_incoming(a):a.reply(415)):a.reply(403,"Wrong Status");break;case T.UPDATE:this.status===M.STATUS_CONFIRMED?k.call(this,a):a.reply(403,"Wrong Status");break;case T.REFER:this.status===M.STATUS_CONFIRMED?l.call(this,a):a.reply(403,"Wrong Status");break;case T.NOTIFY:this.status===M.STATUS_CONFIRMED?m.call(this,a):a.reply(403,"Wrong Status");break;default:a.reply(501)}},d.prototype.onTransportError=function(){Q("onTransportError()"),this.status!==M.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:T.causes.CONNECTION_ERROR,cause:T.causes.CONNECTION_ERROR})},d.prototype.onRequestTimeout=function(){P("onRequestTimeout"),this.status!==M.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:T.causes.REQUEST_TIMEOUT,cause:T.causes.REQUEST_TIMEOUT})},d.prototype.onDialogError=function(){Q("onDialogError()"),this.status!==M.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:T.causes.DIALOG_ERROR,cause:T.causes.DIALOG_ERROR})},d.prototype.newDTMF=function(a){P("newDTMF()"),this.emit("newDTMF",a)},d.prototype.resetLocalMedia=function(){P("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,v.call(this)}},{"./Constants":1,"./Dialog":2,"./Exceptions":5,"./RTCSession/DTMF":12,"./RTCSession/ReferNotifier":13,"./RTCSession/ReferSubscriber":14,"./RTCSession/Request":15,"./RequestSender":17,"./SIPMessage":18,"./Timers":20,"./Transactions":21,"./Utils":25,debug:33,events:28,rtcninja:43,"sdp-transform":37,util:32}],12:[function(a,b,c){function d(a){this.owner=a,this.direction=null,this.tone=null,this.duration=null}b.exports=d;var e={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};d.C=e;var f=a("debug")("JsSIP:RTCSession:DTMF"),g=a("debug")("JsSIP:ERROR:RTCSession:DTMF");g.log=console.warn.bind(console);var h=a("../Constants"),i=a("../Exceptions"),j=a("../RTCSession");d.prototype.send=function(a,b){var c,d;if(void 0===a)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==j.C.STATUS_CONFIRMED&&this.owner.status!==j.C.STATUS_WAITING_FOR_ACK)throw new i.InvalidStateError(this.owner.status);if(b=b||{},c=b.extraHeaders?b.extraHeaders.slice():[],this.eventHandlers=b.eventHandlers||{},"string"==typeof a)a=a.toUpperCase();else{if("number"!=typeof a)throw new TypeError("Invalid tone: "+a);a=a.toString()}if(!a.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+a);this.tone=a,this.duration=b.duration,c.push("Content-Type: application/dtmf-relay"),d="Signal="+this.tone+"\r\n",d+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,h.INFO,{extraHeaders:c,body:d})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):f("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(a);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(a)}},d.prototype.onRequestTimeout=function(){g("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},d.prototype.onTransportError=function(){g("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},d.prototype.onDialogError=function(){g("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},d.prototype.init_incoming=function(a){var b,c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,d=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=a,a.reply(200),a.body&&(b=a.body.split("\n"),b.length>=1&&c.test(b[0])&&(this.tone=b[0].replace(c,"$2")),b.length>=2&&d.test(b[1])&&(this.duration=parseInt(b[1].replace(d,"$2"),10))),this.duration||(this.duration=e.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:a}):f("invalid INFO DTMF received, discarded")}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:33}],13:[function(a,b,c){function d(a,b,c){this.session=a,this.id=b,this.expires=c||e.expires,this.active=!0,this.notify(100)}b.exports=d;var e={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},f=a("debug")("JsSIP:RTCSession:ReferNotifier"),g=a("../Constants"),h=a("./Request");d.prototype.notify=function(a,b){f("notify()");var c,d=this;if(this.active!==!1){b=b||g.REASON_PHRASE[a]||"",c=a>=200?"terminated;reason=noresource":"active;expires="+this.expires;var i=new h(this.session,g.NOTIFY);i.send({extraHeaders:["Event: "+e.event_type+";id="+d.id,"Subscription-State: "+c,"Content-Type: "+e.body_type],body:"SIP/2.0 "+a+" "+b,eventHandlers:{onErrorResponse:function(){d.active=!1}}})}}},{"../Constants":1,"./Request":15,debug:33}],14:[function(a,b,c){function d(a){this.session=a,this.timer=null,this.outgoingRequest=null,h.EventEmitter.call(this)}function e(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}b.exports=d;var f={expires:120},g=a("util"),h=a("events"),i=a("debug")("JsSIP:RTCSession:ReferSubscriber"),j=a("../Constants"),k=a("../Grammar"),l=a("./Request");g.inherits(d,h.EventEmitter),d.prototype.sendRefer=function(a,b){i("sendRefer()");var c,d,g,h=null,k=this;b=b||{},c=b.extraHeaders?b.extraHeaders.slice():[],d=b.eventHandlers||{};for(var m in d)this.on(m,d[m]);b.replaces&&(h=b.replaces.request.call_id,h+=";to-tag="+b.replaces.to_tag,h+=";from-tag="+b.replaces.from_tag,h=encodeURIComponent(h)),g="Refer-To: <"+a+(h?"?Replaces="+h:"")+">",c.push(g);var n=new l(this.session,j.REFER);this.timer=setTimeout(function(){e.call(k)},1e3*f.expires),n.send({extraHeaders:c,eventHandlers:{onSuccessResponse:function(a){k.emit("requestSucceeded",{response:a})},onErrorResponse:function(a){k.emit("requestFailed",{response:a,cause:j.causes.REJECTED})},onTransportError:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.CONNECTION_ERROR})},onRequestTimeout:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.REQUEST_TIMEOUT})},onDialogError:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.DIALOG_ERROR})}}}),this.outgoingRequest=n.outgoingRequest},d.prototype.receiveNotify=function(a){i("receiveNotify()");var b;if(a.body){if(b=k.parse(a.body,"Status_Line"),b===-1)return void i('receiveNotify() | error parsing NOTIFY body: "'+a.body+'"');switch(!0){case/^100$/.test(b.status_code):this.emit("trying",{request:a,status_line:b});break;case/^1[0-9]{2}$/.test(b.status_code):this.emit("progress",{request:a,status_line:b});break;case/^2[0-9]{2}$/.test(b.status_code):e.call(this),this.emit("accepted",{request:a,status_line:b});break;default:e.call(this),this.emit("failed",{request:a,status_line:b})}}}},{"../Constants":1,"../Grammar":6,"./Request":15,debug:33,events:28,util:32}],15:[function(a,b,c){function d(a,b){if(e("new | %s",b),this.session=a,this.method=b,this.outgoingRequest=null,this.session.status!==i.C.STATUS_1XX_RECEIVED&&this.session.status!==i.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==i.C.STATUS_WAITING_FOR_ACK&&this.session.status!==i.C.STATUS_CONFIRMED&&this.session.status!==i.C.STATUS_TERMINATED)throw new h.InvalidStateError(this.session.status);if(this.session.status===i.C.STATUS_TERMINATED&&b!==g.BYE)throw new h.InvalidStateError(this.session.status)}b.exports=d;var e=a("debug")("JsSIP:RTCSession:Request"),f=a("debug")("JsSIP:ERROR:RTCSession:Request");f.log=console.warn.bind(console);var g=a("../Constants"),h=a("../Exceptions"),i=a("../RTCSession");d.prototype.send=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body||null;this.eventHandlers=a.eventHandlers||{},this.outgoingRequest=this.session.dialog.sendRequest(this,this.method,{extraHeaders:b,body:c})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):e("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(a);break;case/^2[0-9]{2}$/.test(a.status_code):e("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(a);break;default:e("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(a)}},d.prototype.onRequestTimeout=function(){f("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},d.prototype.onTransportError=function(){f("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},d.prototype.onDialogError=function(){f("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:33}],16:[function(a,b,c){function d(a,b){var c=1;this.ua=a,this.transport=b,this.registrar=a.configuration.registrar_server,this.expires=a.configuration.register_expires,this.call_id=f.createRandomToken(22),this.cseq=0,this.to_uri=a.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",c&&(this.contact+=";reg-id="+c,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}b.exports=d;var e=a("debug")("JsSIP:Registrator"),f=a("./Utils"),g=a("./Constants"),h=a("./SIPMessage"),i=a("./RequestSender");d.prototype={setExtraHeaders:function(a){Array.isArray(a)||(a=[]),this.extraHeaders=a.slice()},setExtraContactParams:function(a){a instanceof Object||(a={}),this.extraContactParams="";for(var b in a){var c=a[b];this.extraContactParams+=";"+b,c&&(this.extraContactParams+="="+c)}},register:function(){var a,b,c,d=this;c=this.extraHeaders.slice(),c.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),c.push("Expires: "+this.expires),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},c),a=new i(this,this.ua),this.receiveResponse=function(a){var c,h,i=a.getHeaders("contact").length;if(a.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):if(a.hasHeader("expires")&&(h=a.getHeader("expires")),!i){e("no Contact header in response to REGISTER, response ignored");break}for(;i--;){if(c=a.parseHeader("contact",i),c.uri.user===this.ua.contact.uri.user){h=c.getParam("expires");break}c=null}if(!c){e("no Contact header pointing to us, response ignored");break}h||(h=this.expires),this.registrationTimer=setTimeout(function(){d.registrationTimer=null,d.register()},1e3*h-3e3),c.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=c.getParam("temp-gruu").replace(/"/g,"")),c.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=c.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:a}));break;case/^423$/.test(a.status_code):a.hasHeader("min-expires")?(this.expires=a.getHeader("min-expires"),this.register()):(e("423 response received for REGISTER without Min-Expires"),this.registrationFailure(a,g.causes.SIP_FAILURE_CODE));break;default:b=f.sipErrorCause(a.status_code),this.registrationFailure(a,b)}},this.onRequestTimeout=function(){this.registrationFailure(null,g.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,g.causes.CONNECTION_ERROR)},a.send()},unregister:function(a){var b;if(!this.registered)return void e("already unregistered");a=a||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),b=this.extraHeaders.slice(),a.all?(b.push("Contact: *"+this.extraContactParams),b.push("Expires: 0"),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b)):(b.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),b.push("Expires: 0"),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b));var c=new i(this,this.ua);this.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.unregistered(a);break;default:b=f.sipErrorCause(a.status_code),this.unregistered(a,b)}},this.onRequestTimeout=function(){this.unregistered(null,g.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,g.causes.CONNECTION_ERROR)},c.send()},registrationFailure:function(a,b){this.ua.registrationFailed({response:a||null,cause:b}),this.registered&&(this.registered=!1,this.ua.unregistered({response:a||null,cause:b}))},unregistered:function(a,b){this.registered=!1,this.ua.unregistered({response:a||null,cause:b||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":1,"./RequestSender":17,"./SIPMessage":18,"./Utils":25,debug:33}],17:[function(a,b,c){function d(a,b){this.ua=b,this.applicant=a,this.method=a.request.method,this.request=a.request,this.auth=null,this.challenged=!1,this.staled=!1,b.status!==g.C.STATUS_USER_CLOSED||this.method===f.BYE&&this.method===f.ACK||this.onTransportError()}b.exports=d;var e=a("debug")("JsSIP:RequestSender"),f=a("./Constants"),g=a("./UA"),h=a("./DigestAuthentication"),i=a("./Transactions");d.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new i.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new i.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new i.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b,c,d,g=a.status_code;if(401!==g&&407!==g||null===this.ua.configuration.password&&null===this.ua.configuration.ha1)this.applicant.receiveResponse(a);else{if(401===a.status_code?(c=a.parseHeader("www-authenticate"),d="authorization"):(c=a.parseHeader("proxy-authenticate"),d="proxy-authorization"),!c)return e(a.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(a);if(!this.challenged||!this.staled&&c.stale===!0){if(this.auth||(this.auth=new h({username:this.ua.configuration.authorization_user,password:this.ua.configuration.password,realm:this.ua.configuration.realm,ha1:this.ua.configuration.ha1})),!this.auth.authenticate(this.request,c))return void this.applicant.receiveResponse(a);this.challenged=!0,this.ua.set("realm",this.auth.get("realm")),this.ua.set("ha1",this.auth.get("ha1")),c.stale&&(this.staled=!0),b=a.method===f.REGISTER?this.applicant.cseq+=1:this.request.dialog?this.request.dialog.local_seqnum+=1:this.request.cseq+1,this.request=this.applicant.request=this.request.clone(),this.request.cseq=b,this.request.setHeader("cseq",b+" "+this.method),this.request.setHeader(d,this.auth.toString()),this.send()}else this.applicant.receiveResponse(a)}}}},{"./Constants":1,"./DigestAuthentication":4,"./Transactions":21,"./UA":23,debug:33}],18:[function(a,b,c){function d(a,b,c,d,e,f){var g,h,i,m;return d=d||{},a&&b&&c?(this.ua=c,this.headers={},this.method=a,this.ruri=b,this.body=f,this.extraHeaders=e&&e.slice()||[],d.route_set?this.setHeader("route",d.route_set):c.configuration.use_preloaded_route&&this.setHeader("route","<"+c.transport.sip_uri+";lr>"),this.setHeader("via",""),this.setHeader("max-forwards",j.MAX_FORWARDS),g=d.to_display_name||0===d.to_display_name?'"'+d.to_display_name+'" ':"",g+="<"+(d.to_uri||b)+">",g+=d.to_tag?";tag="+d.to_tag:"",this.to=new l.parse(g),this.setHeader("to",g),h=d.from_display_name||0===d.from_display_name?'"'+d.from_display_name+'" ':c.configuration.display_name?'"'+c.configuration.display_name+'" ':"",h+="<"+(d.from_uri||c.configuration.uri)+">;tag=",h+=d.from_tag||k.newTag(),this.from=new l.parse(h),this.setHeader("from",h),i=d.call_id||c.configuration.jssip_id+k.createRandomToken(15),this.call_id=i,this.setHeader("call-id",i),m=d.cseq||Math.floor(1e4*Math.random()),this.cseq=m,void this.setHeader("cseq",m+" "+a)):null}function e(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function f(a){this.ua=a,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function g(){this.headers={},this.status_code=null,this.reason_phrase=null}b.exports={OutgoingRequest:d,IncomingRequest:f,IncomingResponse:g};var h=a("debug")("JsSIP:SIPMessage"),i=a("sdp-transform"),j=a("./Constants"),k=a("./Utils"),l=a("./NameAddrHeader"),m=a("./Grammar");d.prototype={setHeader:function(a,b){var c,d;for(c=new RegExp("^\\s*"+a+"\\s*:","i"),d=0;d<this.extraHeaders.length;d++)c.test(this.extraHeaders[d])&&this.extraHeaders.splice(d,1);this.headers[k.headerize(a)]=Array.isArray(b)?b:[b]},getHeader:function(a){var b,c,d=this.extraHeaders.length,e=this.headers[k.headerize(a)];if(e){if(e[0])return e[0]}else for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(e=this.extraHeaders[c],b.test(e))return e.substring(e.indexOf(":")+1).trim()},getHeaders:function(a){var b,c,d,e=this.headers[k.headerize(a)],f=[];if(e){for(c=e.length,b=0;b<c;b++)f.push(e[b]);return f}for(c=this.extraHeaders.length,d=new RegExp("^\\s*"+a+"\\s*:","i"),b=0;b<c;b++)e=this.extraHeaders[b],d.test(e)&&f.push(e.substring(e.indexOf(":")+1).trim());return f},hasHeader:function(a){var b,c,d=this.extraHeaders.length;if(this.headers[k.headerize(a)])return!0;for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(b.test(this.extraHeaders[c]))return!0;return!1},parseSDP:function(a){return!a&&this.sdp?this.sdp:(this.sdp=i.parse(this.body||""),this.sdp)},toString:function(){var a,b,c,d="",e=[];d+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(a in this.headers)for(b=this.headers[a].length,c=0;c<b;c++)d+=a+": "+this.headers[a][c]+"\r\n";for(b=this.extraHeaders.length,c=0;c<b;c++)d+=this.extraHeaders[c].trim()+"\r\n";switch(this.method){case j.REGISTER:e.push("path","gruu");break;case j.INVITE:this.ua.configuration.session_timers&&e.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&e.push("gruu"),e.push("ice","replaces");break;case j.UPDATE:this.ua.configuration.session_timers&&e.push("timer"),
e.push("ice")}return e.push("outbound"),d+="Allow: "+j.ALLOWED_METHODS+"\r\n",d+="Supported: "+e+"\r\n",d+="User-Agent: "+j.USER_AGENT+"\r\n",this.body?(b=k.str_utf8_length(this.body),d+="Content-Length: "+b+"\r\n\r\n",d+=this.body):d+="Content-Length: 0\r\n\r\n",d},clone:function(){var a=new d(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(b){a.headers[b]=this.headers[b].slice()},this),a.body=this.body,a.extraHeaders=this.extraHeaders&&this.extraHeaders.slice()||[],a.to=this.to,a.from=this.from,a.call_id=this.call_id,a.cseq=this.cseq,a}},e.prototype={addHeader:function(a,b){var c={raw:b};a=k.headerize(a),this.headers[a]?this.headers[a].push(c):this.headers[a]=[c]},getHeader:function(a){var b=this.headers[k.headerize(a)];if(b)return b[0]?b[0].raw:void 0},getHeaders:function(a){var b,c,d=this.headers[k.headerize(a)],e=[];if(!d)return[];for(c=d.length,b=0;b<c;b++)e.push(d[b].raw);return e},hasHeader:function(a){return!!this.headers[k.headerize(a)]},parseHeader:function(a,b){var c,d,e;return a=k.headerize(a),b=b||0,this.headers[a]?b>=this.headers[a].length?void h('not so many "'+a+'" headers present'):(c=this.headers[a][b],d=c.raw,c.parsed?c.parsed:(e=m.parse(d,a.replace(/-/g,"_")),e===-1?(this.headers[a].splice(b,1),void h('error parsing "'+a+'" header field with value "'+d+'"')):(c.parsed=e,e))):void h('header "'+a+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(a,b){var c={raw:b};this.headers[k.headerize(a)]=[c]},parseSDP:function(a){return!a&&this.sdp?this.sdp:(this.sdp=i.parse(this.body||""),this.sdp)},toString:function(){return this.data}},f.prototype=new e,f.prototype.reply=function(a,b,c,d,e,f){var g,h,i,l,m,n=[],o=this.getHeader("To"),p=0,q=0;if(a=a||null,b=b||null,!a||a<100||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);if(b=b||j.REASON_PHRASE[a]||"",c=c&&c.slice()||[],m="SIP/2.0 "+a+" "+b+"\r\n",this.method===j.INVITE&&a>100&&a<=200)for(g=this.getHeaders("record-route"),i=g.length,p;p<i;p++)m+="Record-Route: "+g[p]+"\r\n";for(h=this.getHeaders("via"),i=h.length,q;q<i;q++)m+="Via: "+h[q]+"\r\n";for(!this.to_tag&&a>100?o+=";tag="+k.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(o+=";tag="+this.to_tag),m+="To: "+o+"\r\n",m+="From: "+this.getHeader("From")+"\r\n",m+="Call-ID: "+this.call_id+"\r\n",m+="CSeq: "+this.cseq+" "+this.method+"\r\n",i=c.length,l=0;l<i;l++)m+=c[l].trim()+"\r\n";switch(this.method){case j.INVITE:this.ua.configuration.session_timers&&n.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&n.push("gruu"),n.push("ice","replaces");break;case j.UPDATE:this.ua.configuration.session_timers&&n.push("timer"),d&&n.push("ice"),n.push("replaces")}n.push("outbound"),this.method===j.OPTIONS?(m+="Allow: "+j.ALLOWED_METHODS+"\r\n",m+="Accept: "+j.ACCEPTED_BODY_TYPES+"\r\n"):405===a?m+="Allow: "+j.ALLOWED_METHODS+"\r\n":415===a&&(m+="Accept: "+j.ACCEPTED_BODY_TYPES+"\r\n"),m+="Supported: "+n+"\r\n",d?(i=k.str_utf8_length(d),m+="Content-Type: application/sdp\r\n",m+="Content-Length: "+i+"\r\n\r\n",m+=d):m+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(a,m,e,f)},f.prototype.reply_sl=function(a,b){var c,d,e=0,f=this.getHeaders("via"),g=f.length;if(a=a||null,b=b||null,!a||a<100||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);for(b=b||j.REASON_PHRASE[a]||"",d="SIP/2.0 "+a+" "+b+"\r\n",e;e<g;e++)d+="Via: "+f[e]+"\r\n";c=this.getHeader("To"),!this.to_tag&&a>100?c+=";tag="+k.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(c+=";tag="+this.to_tag),d+="To: "+c+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",d+="Content-Length: 0\r\n\r\n",this.transport.send(d)},g.prototype=new e},{"./Constants":1,"./Grammar":6,"./NameAddrHeader":9,"./Utils":25,debug:33,"sdp-transform":37}],19:[function(a,b,c){function d(){}b.exports=d;var e=a("./Utils"),f=a("./Grammar"),g=a("debug")("JsSIP:ERROR:Socket");g.log=console.warn.bind(console),d.isSocket=function(a){if(Array.isArray(a))return!1;if("undefined"==typeof a)return g("undefined JsSIP.Socket instance"),!1;try{if(!e.isString(a.url))throw g("missing or invalid JsSIP.Socket url property"),new Error;if(!e.isString(a.via_transport))throw g("missing or invalid JsSIP.Socket via_transport property"),new Error;if(f.parse(a.sip_uri,"SIP_URI")===-1)throw g("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(a){return!1}try{["connect","disconnect","send"].forEach(function(b){if(!e.isFunction(a[b]))throw g("missing or invalid JsSIP.Socket method: "+b),new Error})}catch(a){return!1}return!0}},{"./Grammar":6,"./Utils":25,debug:33}],20:[function(a,b,c){var d=500,e=4e3,f=5e3,g={T1:d,T2:e,T4:f,TIMER_B:64*d,TIMER_D:0*d,TIMER_F:64*d,TIMER_H:64*d,TIMER_I:0*d,TIMER_J:0*d,TIMER_K:0*f,TIMER_L:64*d,TIMER_M:64*d,PROVISIONAL_RESPONSE_INTERVAL:6e4};b.exports=g},{}],21:[function(a,b,c){function d(a,b,c){var d;this.type=j.NON_INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+c.via_transport,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),l.EventEmitter.call(this)}function e(a,b,c){var d,e=this;this.type=j.INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+c.via_transport,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),this.request.cancel=function(a){e.cancel_request(e,a)},l.EventEmitter.call(this)}function f(a,b,c){var d;this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+c.via_transport,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),l.EventEmitter.call(this)}function g(a,b){this.type=j.NON_INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_TRYING,b.newTransaction(this),l.EventEmitter.call(this)}function h(a,b){this.type=j.INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_PROCEEDING,b.newTransaction(this),this.resendProvisionalTimer=null,a.reply(100),l.EventEmitter.call(this)}function i(a,b){var c;switch(b.method){case r.INVITE:if(c=a.transactions.ist[b.via_branch]){switch(c.state){case j.STATUS_PROCEEDING:c.transport.send(c.last_response);break;case j.STATUS_ACCEPTED:}return!0}break;case r.ACK:if(c=a.transactions.ist[b.via_branch],!c)return!1;if(c.state===j.STATUS_ACCEPTED)return!1;if(c.state===j.STATUS_COMPLETED)return c.state=j.STATUS_CONFIRMED,c.I=setTimeout(function(){c.timer_I()},s.TIMER_I),!0;break;case r.CANCEL:return c=a.transactions.ist[b.via_branch],c?(b.reply_sl(200),c.state!==j.STATUS_PROCEEDING):(b.reply_sl(481),!0);default:if(c=a.transactions.nist[b.via_branch]){switch(c.state){case j.STATUS_TRYING:break;case j.STATUS_PROCEEDING:case j.STATUS_COMPLETED:c.transport.send(c.last_response)}return!0}}}b.exports={C:null,NonInviteClientTransaction:d,InviteClientTransaction:e,AckClientTransaction:f,NonInviteServerTransaction:g,InviteServerTransaction:h,checkTransaction:i};var j={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};b.exports.C=j;var k=a("util"),l=a("events"),m=a("debug")("JsSIP:NonInviteClientTransaction"),n=a("debug")("JsSIP:InviteClientTransaction"),o=a("debug")("JsSIP:AckClientTransaction"),p=a("debug")("JsSIP:NonInviteServerTransaction"),q=a("debug")("JsSIP:InviteServerTransaction"),r=a("./Constants"),s=a("./Timers");k.inherits(d,l.EventEmitter),d.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},d.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_TRYING),this.F=setTimeout(function(){a.timer_F()},s.TIMER_F),this.transport.send(this.request)||this.onTransportError()},d.prototype.onTransportError=function(){m("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},d.prototype.timer_F=function(){m("Timer F expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},d.prototype.timer_K=function(){this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},d.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c<200)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a)}else switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),clearTimeout(this.F),408===c?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(a),this.K=setTimeout(function(){b.timer_K()},s.TIMER_K);break;case j.STATUS_COMPLETED:}},k.inherits(e,l.EventEmitter),e.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},e.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_CALLING),this.B=setTimeout(function(){a.timer_B()},s.TIMER_B),this.transport.send(this.request)||this.onTransportError()},e.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==j.STATUS_ACCEPTED&&(n("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.timer_M=function(){n("Timer M expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},e.prototype.timer_B=function(){n("Timer B expired for transaction "+this.id),this.state===j.STATUS_CALLING&&(this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},e.prototype.timer_D=function(){n("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.sendACK=function(a){var b=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+a.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){b.timer_D()},s.TIMER_D),this.transport.send(this.ack)},e.prototype.cancel_request=function(a,b){var c=a.request;this.cancel=r.CANCEL+" "+c.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+c.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+c.headers.Route.toString()+"\r\n"),this.cancel+="To: "+c.headers.To.toString()+"\r\n",this.cancel+="From: "+c.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+c.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+c.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",b&&(this.cancel+="Reason: "+b+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===j.STATUS_PROCEEDING&&this.transport.send(this.cancel)},e.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c>=100&&c<=199)switch(this.state){case j.STATUS_CALLING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a);break;case j.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(c>=200&&c<=299)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.M=setTimeout(function(){b.timer_M()},s.TIMER_M),this.request_sender.receiveResponse(a);break;case j.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(c>=300&&c<=699)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.sendACK(a),this.request_sender.receiveResponse(a);break;case j.STATUS_COMPLETED:this.sendACK(a)}},k.inherits(f,l.EventEmitter),f.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},f.prototype.onTransportError=function(){o("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},k.inherits(g,l.EventEmitter),g.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},g.prototype.timer_J=function(){p("Timer J expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},g.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,p("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},g.prototype.receiveResponse=function(a,b,c,d){var e=this;if(100===a)switch(this.state){case j.STATUS_TRYING:this.stateChanged(j.STATUS_PROCEEDING),this.transport.send(b)||this.onTransportError();break;case j.STATUS_PROCEEDING:this.last_response=b,this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=200&&a<=699)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.last_response=b,this.J=setTimeout(function(){e.timer_J()},s.TIMER_J),this.transport.send(b)?c&&c():(this.onTransportError(),d&&d());break;case j.STATUS_COMPLETED:}},k.inherits(h,l.EventEmitter),h.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},h.prototype.timer_H=function(){q("Timer H expired for transaction "+this.id),this.state===j.STATUS_COMPLETED&&q("ACK not received, dialog will be terminated"),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},h.prototype.timer_I=function(){this.stateChanged(j.STATUS_TERMINATED)},h.prototype.timer_L=function(){q("Timer L expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,q("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},h.prototype.receiveResponse=function(a,b,c,d){var e=this;if(a>=100&&a<=199)switch(this.state){case j.STATUS_PROCEEDING:this.transport.send(b)||this.onTransportError(),this.last_response=b}if(a>100&&a<=199&&this.state===j.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){e.resend_provisional()},s.PROVISIONAL_RESPONSE_INTERVAL));else if(a>=200&&a<=299)switch(this.state){case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.last_response=b,this.L=setTimeout(function(){e.timer_L()},s.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case j.STATUS_ACCEPTED:this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=300&&a<=699)switch(this.state){case j.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(b)?(this.stateChanged(j.STATUS_COMPLETED),this.H=setTimeout(function(){e.timer_H()},s.TIMER_H),c&&c()):(this.onTransportError(),d&&d())}}},{"./Constants":1,"./Timers":20,debug:33,events:28,util:32}],22:[function(a,b,c){function d(a,b){if(k("new()"),this.status=m.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=b||m.recovery_options,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,"undefined"==typeof a)throw new TypeError("Invalid argument. undefined 'sockets' argument");a instanceof Array||(a=[a]),a.forEach(function(a){if(!j.isSocket(a.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(a.weight&&!Number(a.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:a.socket,weight:a.weight||0,status:m.SOCKET_STATUS_READY})},this),Object.defineProperties(this,{via_transport:{get:function(){return this.socket.via_transport}},url:{get:function(){return this.socket.url}},sip_uri:{get:function(){return this.socket.sip_uri}}}),i.call(this)}function e(){this.recover_attempts=0,this.status=m.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}function f(a,b,c){this.status=m.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:a,code:b,reason:c}),this.close_requested||(a&&(this.socket.status=m.SOCKET_STATUS_ERROR),h.call(this,a))}function g(a){if("\r\n"===a)return void k("received message with CRLF Keep Alive response");if("string"!=typeof a){try{a=String.fromCharCode.apply(null,new Uint8Array(a))}catch(a){return void k("received binary message failed to be converted into string, message discarded")}k("received binary message:\n\n"+a+"\n")}else k("received text message:\n\n"+a+"\n");this.ondata({transport:this,message:a})}function h(){var a,b=this;this.recover_attempts+=1,a=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1),a<this.recovery_options.min_interval?a=this.recovery_options.min_interval:a>this.recovery_options.max_interval&&(a=this.recovery_options.max_interval),k("reconnection attempt: "+this.recover_attempts+". next connection attempt in "+a+" seconds"),this.recovery_timer=setTimeout(function(){b.close_requested||b.isConnected()||b.isConnecting()||(i.call(b),b.connect())},1e3*a)}function i(){var a=[];if(this.sockets.forEach(function(b){b.status!==m.SOCKET_STATUS_ERROR&&(0===a.length?a.push(b):b.weight>a[0].weight?a=[b]:b.weight===a[0].weight&&a.push(b))}),0===a.length)return this.sockets.forEach(function(a){a.status=m.SOCKET_STATUS_READY}),void i.call(this);var b=Math.floor(Math.random()*a.length);this.socket=a[b].socket}b.exports=d;var j=a("./Socket"),k=a("debug")("JsSIP:Transport"),l=a("debug")("JsSIP:ERROR:Transport"),m={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:2,max_interval:30}};d.prototype.connect=function(){return k("connect()"),this.isConnected()?void k("Transport is already connected"):this.isConnecting()?void k("Transport is connecting"):(this.close_requested=!1,this.status=m.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),void(this.close_requested||(this.socket.onconnect=e.bind(this),this.socket.ondisconnect=f.bind(this),this.socket.ondata=g.bind(this),this.socket.connect())))},d.prototype.disconnect=function(){k("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=m.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect()},d.prototype.send=function(a){if(k("send()"),!this.isConnected())return l("unable to send message, transport is not connected"),!1;var b=a.toString();return k("sending message:\n\n"+b+"\n"),this.socket.send(b)},d.prototype.isConnected=function(){return this.status===m.STATUS_CONNECTED},d.prototype.isConnecting=function(){return this.status===m.STATUS_CONNECTING}},{"./Socket":19,debug:33}],23:[function(a,b,c){function d(a){if(l("new() [configuration:%o]",a),this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=i.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},Object.defineProperties(this,{transactionsCount:{get:function(){var a,b=["nist","nict","ist","ict"],c=0;for(a in b)c+=Object.keys(this.transactions[b[a]]).length;return c}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a)}catch(a){throw this.status=i.STATUS_NOT_READY,this.error=i.CONFIGURATION_ERROR,a}this._registrator=new p(this),k.EventEmitter.call(this),n.called||n()}function e(a){this.emit("connecting",a)}function f(a){this.status!==i.STATUS_USER_CLOSED&&(this.status=i.STATUS_READY,this.error=null,this.emit("connected",a),this.dynConfiguration.register&&this._registrator.register())}function g(a){var b,c,d,e=["nict","ict","nist","ist"];for(d=e.length,b=0;b<d;b++)for(c in this.transactions[e[b]])this.transactions[e[b]][c].onTransportError();this.emit("disconnected",a),this._registrator.onTransportClosed(),this.status!==i.STATUS_USER_CLOSED&&(this.status=i.STATUS_NOT_READY,this.error=i.NETWORK_ERROR)}function h(a){var b,c=a.transport,e=a.message;if(e=A.parseMessage(e,this),e&&!(this.status===d.C.STATUS_USER_CLOSED&&e instanceof B.IncomingRequest)&&C(e,this,c))if(e instanceof B.IncomingRequest)e.transport=c,this.receiveRequest(e);else if(e instanceof B.IncomingResponse)switch(e.method){case o.INVITE:b=this.transactions.ict[e.via_branch],b&&b.receiveResponse(e);break;case o.ACK:break;default:b=this.transactions.nict[e.via_branch],b&&b.receiveResponse(e)}}b.exports=d;var i={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};d.C=i;var j=a("util"),k=a("events"),l=a("debug")("JsSIP:UA"),m=a("debug")("JsSIP:ERROR:UA");m.log=console.warn.bind(console);var n=a("rtcninja"),o=a("./Constants"),p=a("./Registrator"),q=a("./RTCSession"),r=a("./Message"),s=a("./Transactions"),t=a("./Transport"),u=a("./WebSocketInterface"),v=a("./Socket"),w=a("./Utils"),x=a("./Exceptions"),y=a("./URI"),z=a("./Grammar"),A=a("./Parser"),B=a("./SIPMessage"),C=a("./sanityCheck");j.inherits(d,k.EventEmitter),d.prototype.start=function(){function a(){l("restarting UA"),b.status=i.STATUS_READY,b.transport.connect()}l("start()");var b=this;this.status===i.STATUS_INIT?this.transport.connect():this.status===i.STATUS_USER_CLOSED?this.isConnected()?this.once("disconnected",a):a():l(this.status===i.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},d.prototype.register=function(){l("register()"),this.dynConfiguration.register=!0,this._registrator.register()},d.prototype.unregister=function(a){l("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(a)},d.prototype.registrator=function(){return this._registrator},d.prototype.isRegistered=function(){return!!this._registrator.registered},d.prototype.isConnected=function(){return this.transport.isConnected()},d.prototype.call=function(a,b){l("call()");var c;return c=new q(this),c.connect(a,b),c},d.prototype.sendMessage=function(a,b,c){l("sendMessage()");var d;return d=new r(this),d.send(a,b,c),d},d.prototype.terminateSessions=function(a){l("terminateSessions()");for(var b in this.sessions)this.sessions[b].isEnded()||this.sessions[b].terminate(a)},d.prototype.stop=function(){l("stop()");var a,b,c,d=this;if(this.dynConfiguration={},this.status===i.STATUS_USER_CLOSED)return void l("UA already closed");this._registrator.close(),c=Object.keys(this.sessions).length;for(a in this.sessions){l("closing session "+a);try{this.sessions[a].terminate()}catch(a){}}for(b in this.applicants)try{this.applicants[b].close()}catch(a){}this.status=i.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&0===this.ictTransactionsCount&&0===this.istTransactionsCount&&0===c?d.transport.disconnect():setTimeout(function(){d.transport.disconnect()},2e3)},d.prototype.normalizeTarget=function(a){return w.normalizeTarget(a,this.configuration.hostport_params)},d.prototype.get=function(a){switch(a){case"realm":return this.configuration.realm;case"ha1":return this.configuration.ha1;default:return void m('get() | cannot get "%s" parameter in runtime',a)}return!0},d.prototype.set=function(a,b){switch(a){case"password":this.configuration.password=String(b);break;case"realm":this.configuration.realm=String(b);break;case"ha1":this.configuration.ha1=String(b),this.configuration.password=null;break;case"display_name":if(z.parse('"'+b+'"',"display_name")===-1)return m('set() | wrong "display_name"'),!1;this.configuration.display_name=b;break;default:return m('set() | cannot set "%s" parameter in runtime',a),!1}return!0},d.prototype.newTransaction=function(a){this.transactions[a.type][a.id]=a,this.emit("newTransaction",{transaction:a})},d.prototype.destroyTransaction=function(a){delete this.transactions[a.type][a.id],this.emit("transactionDestroyed",{transaction:a})},d.prototype.newMessage=function(a){this.emit("newMessage",a)},d.prototype.newRTCSession=function(a){this.emit("newRTCSession",a)},d.prototype.registered=function(a){this.emit("registered",a)},d.prototype.unregistered=function(a){this.emit("unregistered",a)},d.prototype.registrationFailed=function(a){this.emit("registrationFailed",a)},d.prototype.receiveRequest=function(a){var b,c,d,e,f=a.method;if(a.ruri.user!==this.configuration.uri.user&&a.ruri.user!==this.contact.uri.user)return l("Request-URI does not point to us"),void(a.method!==o.ACK&&a.reply_sl(404));if(a.ruri.scheme===o.SIPS)return void a.reply_sl(416);if(!s.checkTransaction(this,a)){if(f===o.INVITE?new s.InviteServerTransaction(a,this):f!==o.ACK&&f!==o.CANCEL&&new s.NonInviteServerTransaction(a,this),f===o.OPTIONS)a.reply(200);else if(f===o.MESSAGE){if(0===this.listeners("newMessage").length)return void a.reply(405);d=new r(this),d.init_incoming(a)}else if(f===o.INVITE&&!a.to_tag&&0===this.listeners("newRTCSession").length)return void a.reply(405);if(a.to_tag)b=this.findDialog(a.call_id,a.from_tag,a.to_tag),b?b.receiveRequest(a):f===o.NOTIFY?(c=this.findSession(a),c?c.receiveRequest(a):(l("received NOTIFY request for a non existent subscription"),a.reply(481,"Subscription does not exist"))):f!==o.ACK&&a.reply(481);else switch(f){case o.INVITE:n.hasWebRTC()?a.hasHeader("replaces")?(e=a.replaces,b=this.findDialog(e.call_id,e.from_tag,e.to_tag),b?(c=b.owner,c.isEnded()?a.reply(603):c.receiveRequest(a)):a.reply(481)):(c=new q(this),c.init_incoming(a)):(l("INVITE received but WebRTC is not supported"),a.reply(488));break;case o.BYE:a.reply(481);break;case o.CANCEL:c=this.findSession(a),c?c.receiveRequest(a):l("received CANCEL request for a non existent session");break;case o.ACK:break;default:a.reply(405)}}},d.prototype.findSession=function(a){var b=a.call_id+a.from_tag,c=this.sessions[b],d=a.call_id+a.to_tag,e=this.sessions[d];return c?c:e?e:null},d.prototype.findDialog=function(a,b,c){var d=a+b+c,e=this.dialogs[d];return e?e:(d=a+c+b,e=this.dialogs[d],e?e:null)},d.prototype.loadConfig=function(a){var b,c,i,j,k,n={via_host:w.createRandomToken(12)+".invalid",contact_uri:null,password:null,realm:null,ha1:null,register_expires:600,register:!0,registrar_server:null,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0};for(b in d.configuration_check.mandatory){if(!a.hasOwnProperty(b))throw new x.ConfigurationError(b);if(c=a[b],i=d.configuration_check.mandatory[b].call(this,c),void 0===i)throw new x.ConfigurationError(b,c);n[b]=i}for(b in d.configuration_check.optional)if(a.hasOwnProperty(b)){if(c=a[b],w.isEmpty(c))continue;if(i=d.configuration_check.optional[b].call(this,c,a),void 0===i)throw new x.ConfigurationError(b,c);n[b]=i}0===n.display_name&&(n.display_name="0"),n.instance_id||(n.instance_id=w.newUUID()),n.jssip_id=w.createRandomToken(5),j=n.uri.clone(),j.user=null,n.hostport_params=j.toString().replace(/^sip:/i,"");var o=[];if(n.ws_servers&&Array.isArray(n.ws_servers)&&(o=o.concat(n.ws_servers)),n.sockets&&Array.isArray(n.sockets)&&(o=o.concat(n.sockets)),0===o.length)throw new x.ConfigurationError("sockets");try{this.transport=new t(o,{max_interval:n.connection_recovery_max_interval,min_interval:n.connection_recovery_min_interval}),this.transport.onconnecting=e.bind(this),this.transport.onconnect=f.bind(this),this.transport.ondisconnect=g.bind(this),this.transport.ondata=h.bind(this),delete n.connection_recovery_max_interval,delete n.connection_recovery_min_interval,delete n.ws_servers,delete n.sockets}catch(a){throw m(a),new x.ConfigurationError("sockets",o)}n.authorization_user||(n.authorization_user=n.uri.user),n.registrar_server||(k=n.uri.clone(),k.user=null,k.clearParams(),k.clearHeaders(),n.registrar_server=k),n.no_answer_timeout=1e3*n.no_answer_timeout,n.contact_uri?n.via_host=n.contact_uri.host:n.contact_uri=new y("sip",w.createRandomToken(8),n.via_host,null,{transport:"ws"}),this.contact={pub_gruu:null,temp_gruu:null,uri:n.contact_uri,toString:function(a){a=a||{};var b=a.anonymous||null,c=a.outbound||null,d="<";return d+=b?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!c||(b?this.temp_gruu:this.pub_gruu)||(d+=";ob"),d+=">"}};for(b in n)d.configuration_skeleton[b].value=n[b];Object.defineProperties(this.configuration,d.configuration_skeleton);for(b in n)d.configuration_skeleton[b].value="";l("configuration parameters after validation:");for(b in n)switch(b){case"uri":case"registrar_server":l("- "+b+": "+n[b]);break;case"password":case"ha1":l("- "+b+": NOT SHOWN");break;default:l("- "+b+": "+JSON.stringify(n[b]))}},d.configuration_skeleton=function(){var a,b,c,d={},e=["jssip_id","hostport_params","uri","authorization_user","contact_uri","display_name","instance_id","no_answer_timeout","session_timers","password","realm","ha1","register_expires","registrar_server","sockets","use_preloaded_route","ws_servers","via_core_value","via_host"],f=["password","realm","ha1","display_name"];for(a in e)b=e[a],c=f.indexOf(b)!==-1,d[b]={value:"",writable:c,configurable:!1};return d.register={value:"",writable:!0,configurable:!1},d}(),d.configuration_check={mandatory:{uri:function(a){var b;return/^sip:/i.test(a)||(a=o.SIP+":"+a),b=y.parse(a),b&&b.user?b:void 0}},optional:{authorization_user:function(a){return z.parse('"'+a+'"',"quoted_string")===-1?void 0:a},connection_recovery_max_interval:function(a){var b;if(w.isDecimal(a)&&(b=Number(a),b>0))return b},connection_recovery_min_interval:function(a){var b;if(w.isDecimal(a)&&(b=Number(a),b>0))return b},contact_uri:function(a){if("string"==typeof a){var b=z.parse(a,"SIP_URI");if(b!==-1)return b}},display_name:function(a){return z.parse('"'+a+'"',"display_name")===-1?void 0:a},instance_id:function(a){return/^uuid:/i.test(a)&&(a=a.substr(5)),z.parse(a,"uuid")===-1?void 0:a},no_answer_timeout:function(a){var b;if(w.isDecimal(a)&&(b=Number(a),b>0))return b},session_timers:function(a){if("boolean"==typeof a)return a},
password:function(a){return String(a)},realm:function(a){return String(a)},ha1:function(a){return String(a)},register:function(a){if("boolean"==typeof a)return a},register_expires:function(a){var b;if(w.isDecimal(a)&&(b=Number(a),b>0))return b},registrar_server:function(a){var b;return/^sip:/i.test(a)||(a=o.SIP+":"+a),b=y.parse(a),b?b.user?void 0:b:void 0},sockets:function(a){var b,c;if(v.isSocket(a))a=[{socket:a}];else{if(!Array.isArray(a)||!a.length)return;for(c=a.length,b=0;b<c;b++)v.isSocket(a[b])&&(a[b]={socket:a[b]})}return a},use_preloaded_route:function(a){if("boolean"==typeof a)return a},ws_servers:function(a){var b,c,d=[];if("string"==typeof a)a=[{ws_uri:a}];else{if(!Array.isArray(a)||!a.length)return;for(c=a.length,b=0;b<c;b++)"string"==typeof a[b]&&(a[b]={ws_uri:a[b]})}for(c=a.length,b=0;b<c;b++)try{d.push({socket:new u(a[b].ws_uri),weight:a[b].weight||0})}catch(a){return void m(a)}return d}}}},{"./Constants":1,"./Exceptions":5,"./Grammar":6,"./Message":8,"./Parser":10,"./RTCSession":11,"./Registrator":16,"./SIPMessage":18,"./Socket":19,"./Transactions":21,"./Transport":22,"./URI":24,"./Utils":25,"./WebSocketInterface":26,"./sanityCheck":27,debug:33,events:28,rtcninja:43,util:32}],24:[function(a,b,c){function d(a,b,c,d,f,g){var h,i;if(!c)throw new TypeError('missing or invalid "host" parameter');a=a||e.SIP,this.parameters={},this.headers={};for(h in f)this.setParam(h,f[h]);for(i in g)this.setHeader(i,g[i]);Object.defineProperties(this,{scheme:{get:function(){return a},set:function(b){a=b.toLowerCase()}},user:{get:function(){return b},set:function(a){b=a}},host:{get:function(){return c},set:function(a){c=a.toLowerCase()}},port:{get:function(){return d},set:function(a){d=0===a?a:parseInt(a,10)||null}}})}b.exports=d;var e=a("./Constants"),f=a("./Utils"),g=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var b;if(a=a.toLowerCase(),this.parameters.hasOwnProperty(a))return b=this.parameters[a],delete this.parameters[a],b},clearParams:function(){this.parameters={}},setHeader:function(a,b){this.headers[f.headerize(a)]=Array.isArray(b)?b:[b]},getHeader:function(a){if(a)return this.headers[f.headerize(a)]},hasHeader:function(a){if(a)return this.headers.hasOwnProperty(f.headerize(a))&&!0||!1},deleteHeader:function(a){var b;if(a=f.headerize(a),this.headers.hasOwnProperty(a))return b=this.headers[a],delete this.headers[a],b},clearHeaders:function(){this.headers={}},clone:function(){return new d(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var a,b,c,d,e=[];d=this.scheme+":",this.user&&(d+=f.escapeUser(this.user)+"@"),d+=this.host,(this.port||0===this.port)&&(d+=":"+this.port);for(b in this.parameters)d+=";"+b,null!==this.parameters[b]&&(d+="="+this.parameters[b]);for(a in this.headers)for(c=0;c<this.headers[a].length;c++)e.push(a+"="+this.headers[a][c]);return e.length>0&&(d+="?"+e.join("&")),d},toAor:function(a){var b;return b=this.scheme+":",this.user&&(b+=f.escapeUser(this.user)+"@"),b+=this.host,a&&(this.port||0===this.port)&&(b+=":"+this.port),b}},d.parse=function(a){return a=g.parse(a,"SIP_URI"),a!==-1?a:void 0}},{"./Constants":1,"./Grammar":6,"./Utils":25}],25:[function(a,b,c){var d={};b.exports=d;var e=a("./Constants"),f=a("./URI"),g=a("./Grammar");d.str_utf8_length=function(a){return unescape(encodeURIComponent(a)).length},d.isFunction=function(a){return void 0!==a&&"[object Function]"===Object.prototype.toString.call(a)},d.isString=function(a){return void 0!==a&&"[object String]"===Object.prototype.toString.call(a)},d.isDecimal=function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},d.isEmpty=function(a){if(null===a||""===a||void 0===a||Array.isArray(a)&&0===a.length||"number"==typeof a&&isNaN(a))return!0},d.hasMethods=function(a){for(var b,c=1;b=arguments[c++];)if(this.isFunction(a[b]))return!1;return!0},d.createRandomToken=function(a,b){var c,d,e="";for(b=b||32,c=0;c<a;c++)d=Math.random()*b|0,e+=d.toString(b);return e},d.newTag=function(){return d.createRandomToken(10)},d.newUUID=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a},d.hostType=function(a){if(a)return a=g.parse(a,"host"),a!==-1?a.host_type:void 0},d.normalizeTarget=function(a,b){var c,g,h,i;if(a){if(a instanceof f)return a;if("string"==typeof a){switch(g=a.split("@"),g.length){case 1:if(!b)return;h=a,i=b;break;case 2:h=g[0],i=g[1];break;default:h=g.slice(0,g.length-1).join("@"),i=g[g.length-1]}return h=h.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(h)&&(h=h.replace(/[\-\.\(\)]/g,"")),a=e.SIP+":"+d.escapeUser(h)+"@"+i,(c=f.parse(a))?c:void 0}}else;},d.escapeUser=function(a){return encodeURIComponent(decodeURIComponent(a)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},d.headerize=function(a){var b,c={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},d=a.toLowerCase().replace(/_/g,"-").split("-"),e="",f=d.length;for(b=0;b<f;b++)0!==b&&(e+="-"),e+=d[b].charAt(0).toUpperCase()+d[b].substring(1);return c[e]&&(e=c[e]),e},d.sipErrorCause=function(a){var b;for(b in e.SIP_ERROR_CAUSES)if(e.SIP_ERROR_CAUSES[b].indexOf(a)!==-1)return e.causes[b];return e.causes.SIP_FAILURE_CODE},d.getRandomTestNetIP=function(){function a(a,b){return Math.floor(Math.random()*(b-a+1)+a)}return"192.0.2."+a(1,254)},d.calculateMD5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=new Array(f-1),h=0,i=0;i<c;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;c<=3;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=[],y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()}},{"./Constants":1,"./Grammar":6,"./URI":24}],26:[function(a,b,c){function d(a){j('new() [url:"%s"]',a);var b=null,c=null;this.ws=null,Object.defineProperties(this,{via_transport:{get:function(){return c},set:function(a){c=a.toUpperCase()}},sip_uri:{get:function(){return b}},url:{get:function(){return a}}});var d=i.parse(a,"absoluteURI");if(d===-1)throw k("invalid WebSocket URI: "+a),new TypeError("Invalid argument: "+a);if("wss"!==d.scheme&&"ws"!==d.scheme)throw k("invalid WebSocket URI scheme: "+d.scheme),new TypeError("Invalid argument: "+a);b="sip:"+d.host+(d.port?":"+d.port:"")+";transport=ws",this.via_transport=d.scheme}function e(){j("WebSocket "+this.url+" connected"),this.onconnect()}function f(a){j("WebSocket "+this.url+" closed"),a.wasClean===!1&&j("WebSocket abrupt disconnection"),this.ondisconnect(a.wasClean,a.code,a.reason)}function g(a){j("received WebSocket message"),this.ondata(a.data)}function h(a){k("WebSocket "+this.url+" error: "+a)}b.exports=d;var i=a("./Grammar"),j=a("debug")("JsSIP:WebSocketInterface"),k=a("debug")("JsSIP:ERROR:WebSocketInterface");k.log=console.warn.bind(console),d.prototype.connect=function(){if(j("connect()"),this.isConnected())return void j("WebSocket "+this.url+" is already connected");if(this.isConnecting())return void j("WebSocket "+this.url+" is connecting");this.ws&&this.ws.close(),j("connecting to WebSocket "+this.url);try{this.ws=new WebSocket(this.url,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=e.bind(this),this.ws.onclose=f.bind(this),this.ws.onmessage=g.bind(this),this.ws.onerror=h.bind(this)}catch(a){h.call(this,a)}},d.prototype.disconnect=function(){j("disconnect()"),this.ws&&(this.ws.close(),this.ws=null)},d.prototype.send=function(a){return j("send()"),this.isConnected()?(this.ws.send(a),!0):(k("unable to send message, WebSocket is not open"),!1)},d.prototype.isConnected=function(){return this.ws&&this.ws.readyState===this.ws.OPEN},d.prototype.isConnecting=function(){return this.ws&&this.ws.readyState===this.ws.CONNECTING}},{"./Grammar":6,debug:33}],27:[function(a,b,c){function d(a,b,c){var d,e;for(m=a,n=b,o=c,d=v.length;d--;)if(e=v[d](m),e===!1)return!1;if(m instanceof r.IncomingRequest){for(d=t.length;d--;)if(e=t[d](m),e===!1)return!1}else if(m instanceof r.IncomingResponse)for(d=u.length;d--;)if(e=u[d](m),e===!1)return!1;return!0}function e(){if("sip"!==m.s("to").uri.scheme)return l(416),!1}function f(){if(!m.to_tag&&m.call_id.substr(0,5)===n.configuration.jssip_id)return l(482),!1}function g(){var a=s.str_utf8_length(m.body),b=m.getHeader("content-length");if(a<b)return l(400),!1}function h(){var a,b,c=m.from_tag,d=m.call_id,e=m.cseq;if(!m.to_tag)if(m.method===q.INVITE){if(n.transactions.ist[m.via_branch])return!1;for(b in n.transactions.ist)if(a=n.transactions.ist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}else{if(n.transactions.nist[m.via_branch])return!1;for(b in n.transactions.nist)if(a=n.transactions.nist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}}function i(){if(m.getHeaders("via").length>1)return p("more than one Via header field present in the response, dropping the response"),!1}function j(){var a=s.str_utf8_length(m.body),b=m.getHeader("content-length");if(a<b)return p("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function k(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!m.hasHeader(a[b]))return p("missing mandatory header field : "+a[b]+", dropping the response"),!1}function l(a){var b,c="SIP/2.0 "+a+" "+q.REASON_PHRASE[a]+"\r\n",d=m.getHeaders("via"),e=d.length,f=0;for(f;f<e;f++)c+="Via: "+d[f]+"\r\n";b=m.getHeader("To"),m.to_tag||(b+=";tag="+s.newTag()),c+="To: "+b+"\r\n",c+="From: "+m.getHeader("From")+"\r\n",c+="Call-ID: "+m.call_id+"\r\n",c+="CSeq: "+m.cseq+" "+m.method+"\r\n",c+="\r\n",o.send(c)}b.exports=d;var m,n,o,p=a("debug")("JsSIP:sanityCheck"),q=a("./Constants"),r=a("./SIPMessage"),s=a("./Utils"),t=[],u=[],v=[];t.push(e),t.push(f),t.push(g),t.push(h),u.push(i),u.push(j),v.push(k)},{"./Constants":1,"./SIPMessage":18,"./Utils":25,debug:33}],28:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],29:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],30:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],31:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],32:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(d<0)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":31,_process:29,inherits:30}],33:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(a){}}function h(){var a;try{a=c.storage.debug}catch(a){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":34}],34:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:35}],35:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b.long?f(a):e(a)}},{}],36:[function(a,b,c){var d=b.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,
names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(a){var b="candidate:%s %d %s %d %s %d typ %s";return b+=null!=a.raddr?" raddr %s rport %d":"%v%v",b+=null!=a.tcptype?" tcptype %s":"%v",null!=a.generation&&(b+=" generation %d"),b}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return null!=a.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{push:"invalid",names:["value"]}]};Object.keys(d).forEach(function(a){var b=d[a];b.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})})},{}],37:[function(a,b,c){var d=a("./parser"),e=a("./writer");c.write=e,c.parse=d.parse,c.parseFmtpConfig=d.parseFmtpConfig,c.parsePayloads=d.parsePayloads,c.parseRemoteCandidates=d.parseRemoteCandidates},{"./parser":38,"./writer":39}],38:[function(a,b,c){var d=function(a){return String(Number(a))===a?Number(a):a},e=function(a,b,c,e){if(e&&!c)b[e]=d(a[1]);else for(var f=0;f<c.length;f+=1)null!=a[f+1]&&(b[c[f]]=d(a[f+1]))},f=function(a,b,c){var d=a.name&&a.names;a.push&&!b[a.push]?b[a.push]=[]:d&&!b[a.name]&&(b[a.name]={});var f=a.push?{}:d?b[a.name]:b;e(c.match(a.reg),f,a.names,a.name),a.push&&b[a.push].push(f)},g=a("./grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(a){var b={},c=[],d=b;return a.split(/(\r\n|\r|\n)/).filter(h).forEach(function(a){var b=a[0],e=a.slice(2);"m"===b&&(c.push({rtp:[],fmtp:[]}),d=c[c.length-1]);for(var h=0;h<(g[b]||[]).length;h+=1){var i=g[b][h];if(i.reg.test(e))return f(i,d,e)}}),b.media=c,b};var i=function(a,b){var c=b.split(/=(.+)/,2);return 2===c.length&&(a[c[0]]=d(c[1])),a};c.parseFmtpConfig=function(a){return a.split(/\;\s?/).reduce(i,{})},c.parsePayloads=function(a){return a.split(" ").map(Number)},c.parseRemoteCandidates=function(a){for(var b=[],c=a.split(" ").map(d),e=0;e<c.length;e+=3)b.push({component:c[e],ip:c[e+1],port:c[e+2]});return b}},{"./grammar":36}],39:[function(a,b,c){var d=a("./grammar"),e=/%[sdv%]/g,f=function(a){var b=1,c=arguments,d=c.length;return a.replace(e,function(a){if(b>=d)return a;var e=c[b];switch(b+=1,a){case"%%":return"%";case"%s":return String(e);case"%d":return Number(e);case"%v":return""}})},g=function(a,b,c){var d=b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format,e=[a+"="+d];if(b.names)for(var g=0;g<b.names.length;g+=1){var h=b.names[g];b.name?e.push(c[b.name][h]):e.push(c[b.names[g]])}else e.push(c[b.name]);return f.apply(null,e)},h=["v","o","s","i","u","e","p","c","b","t","r","z","a"],i=["i","c","b","a"];b.exports=function(a,b){b=b||{},null==a.version&&(a.version=0),null==a.name&&(a.name=" "),a.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var c=b.outerOrder||h,e=b.innerOrder||i,f=[];return c.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})}),a.media.forEach(function(a){f.push(g("m",d.m[0],a)),e.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})})}),f.join("\r\n")+"\r\n"}},{"./grammar":36}],40:[function(a,b,c){b.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"2.0.6",homepage:"http://jssip.net",author:"José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iñaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Saúl Ibarra Corretgé <saghul@gmail.com> (https://github.com/saghul)"],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.2.0",rtcninja:"^0.7.0","sdp-transform":"^1.6.2"},devDependencies:{browserify:"^13.1.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-header":"1.8.8","gulp-jshint":"^2.0.1","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^2.0.0","gulp-util":"^3.0.7",jshint:"^2.9.3","jshint-stylish":"^2.2.1",pegjs:"0.7.0","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"}}},{}],41:[function(a,b,c){(function(c){"use strict";function d(a){function b(a){return function(){throw new Error("rtcninja: WebRTC not supported, missing "+a+" [browser: "+e.name+" "+e.version+"]")}}if(s&&e.chrome&&r>=32||e.android&&e.chrome&&r>=39||s&&e.opera&&r>=27||e.android&&e.opera&&r>=24||e.android&&e.webkit&&!e.chrome&&r>=37||v.webkitGetUserMedia&&u.webkitRTCPeerConnection)t=!0,h=v.webkitGetUserMedia.bind(v),i=v.mediaDevices,j=u.webkitRTCPeerConnection,k=u.RTCSessionDescription,l=u.RTCIceCandidate,m=u.MediaStreamTrack,m&&m.getSources?n=m.getSources.bind(m):v.getMediaDevices&&(n=v.getMediaDevices.bind(v)),o=function(a,b){return a.src=URL.createObjectURL(b),a},p=!0,q=!1;else if(e.firefox&&r<47||v.mozGetUserMedia&&u.mozRTCPeerConnection)t=!0,h=v.mozGetUserMedia.bind(v),i=v.mediaDevices,j=u.mozRTCPeerConnection,k=u.mozRTCSessionDescription,l=u.mozRTCIceCandidate,m=u.MediaStreamTrack,o=function(a,b){return a.src=URL.createObjectURL(b),a},p=!1,q=!1;else if((e.firefox||e.gecko)&&r>=47)t=!0,h=v.mozGetUserMedia.bind(v),i=v.mediaDevices,j=u.RTCPeerConnection,k=u.RTCSessionDescription,l=u.RTCIceCandidate,m=u.MediaStreamTrack,o=function(a,b){return a.src=URL.createObjectURL(b),a},p=!1,q=!1;else if(a.plugin&&"function"==typeof a.plugin.isRequired&&a.plugin.isRequired()&&"function"==typeof a.plugin.isInstalled&&a.plugin.isInstalled()){var c=a.plugin.interface;t=!0,h=c.getUserMedia,i=c.mediaDevices,j=c.RTCPeerConnection,k=c.RTCSessionDescription,l=c.RTCIceCandidate,m=c.MediaStreamTrack,m&&m.getSources?n=m.getSources.bind(m):v.getMediaDevices&&(n=v.getMediaDevices.bind(v)),o=c.attachMediaStream,p=c.canRenegotiate,q=!0}else v.getUserMedia&&u.RTCPeerConnection&&(t=!0,h=v.getUserMedia.bind(v),i=v.mediaDevices,j=u.RTCPeerConnection,k=u.RTCSessionDescription,l=u.RTCIceCandidate,m=u.MediaStreamTrack,m&&m.getSources?n=m.getSources.bind(m):v.getMediaDevices&&(n=v.getMediaDevices.bind(v)),o=u.attachMediaStream||function(a,b){return a.src=URL.createObjectURL(b),a},p=!0,q=!1);return d.hasWebRTC=function(){return t},h?d.getUserMedia=function(a,b,c){f("getUserMedia() | constraints: %o",a);try{h(a,function(a){f("getUserMedia() | success"),b&&b(a)},function(a){f("getUserMedia() | error:",a),c&&c(a)})}catch(a){g("getUserMedia() | error:",a),c&&c(a)}}:d.getUserMedia=function(a,c,d){g("getUserMedia() | WebRTC not supported"),d?d(new Error("rtcninja: WebRTC not supported, missing getUserMedia [browser: "+e.name+" "+e.version+"]")):b("getUserMedia")},d.mediaDevices=i,d.RTCPeerConnection=j||b("RTCPeerConnection"),d.RTCSessionDescription=k||b("RTCSessionDescription"),d.RTCIceCandidate=l||b("RTCIceCandidate"),d.MediaStreamTrack=m||b("MediaStreamTrack"),d.getMediaDevices=n,d.attachMediaStream=o||b("attachMediaStream"),d.canRenegotiate=p,d.closeMediaStream=function(a){if(a)try{f("closeMediaStream() | calling stop() on all the MediaStreamTrack");var b,c,d;if(a.getTracks)for(b=a.getTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop();else{for(b=a.getAudioTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop();for(b=a.getVideoTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop()}}catch(b){"function"!=typeof a.stop&&"object"!=typeof a.stop||(f("closeMediaStream() | calling stop() on the MediaStream"),a.stop())}},d.fixPeerConnectionConfig=function(a){var b,c,d,e,f;for(Array.isArray(a.iceServers)||(a.iceServers=[]),b=0,c=a.iceServers.length;b<c;b+=1)d=a.iceServers[b],e=d.hasOwnProperty("urls"),f=d.hasOwnProperty("url"),"object"==typeof d&&(e&&!f?d.url=Array.isArray(d.urls)?d.urls[0]:d.urls:!e&&f&&(d.urls=Array.isArray(d.url)?d.url.slice():d.url),f&&Array.isArray(d.url)&&(d.url=d.url[0]))},d.fixRTCOfferOptions=function(a){a=a||{},q?(a.hasOwnProperty("offerToReceiveAudio")&&(a.mandatory=a.mandatory||{},a.mandatory.OfferToReceiveAudio=!!a.offerToReceiveAudio),a.hasOwnProperty("offerToReceiveVideo")&&(a.mandatory=a.mandatory||{},a.mandatory.OfferToReceiveVideo=!!a.offerToReceiveVideo)):(a.mandatory&&a.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(a.offerToReceiveAudio=a.mandatory.OfferToReceiveAudio?1:0),a.mandatory&&a.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(a.offerToReceiveVideo=a.mandatory.OfferToReceiveVideo?1:0),delete a.mandatory)},d}b.exports=d;var e=a("bowser"),f=a("debug")("rtcninja:Adapter"),g=a("debug")("rtcninja:ERROR:Adapter"),h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=!1,q=!1,r=Number(e.version)||0,s=!(e.mobile||e.tablet&&!(e.msie&&r>=10)),t=!1,u=c.window||c,v=u.navigator||{};g.log=console.warn.bind(console)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:45,debug:46}],42:[function(a,b,c){"use strict";function d(a,b){l("new | [pcConfig:%o, pcConstraints:%o]",a,b),e.call(this,a),this.pcConstraints=b,this.ourLocalDescription=null,this.ourSignalingState=null,this.ourIceConnectionState=null,this.ourIceGatheringState=null,this.timerGatheringTimeout=null,this.timerGatheringTimeoutAfterRelay=null,this.ignoreIceGathering=!1,this.closed=!1,h.call(this),j.call(this)}function e(a){this.pcConfig=k(!0,a),n.fixPeerConnectionConfig(this.pcConfig),this.options={iceTransportsRelay:"relay"===this.pcConfig.iceTransports,iceTransportsNone:"none"===this.pcConfig.iceTransports,gatheringTimeout:this.pcConfig.gatheringTimeout,gatheringTimeoutAfterRelay:this.pcConfig.gatheringTimeoutAfterRelay},delete this.pcConfig.gatheringTimeout,delete this.pcConfig.gatheringTimeoutAfterRelay,l("setConfigurationAndOptions | processed pcConfig: %o",this.pcConfig)}function f(){return this.closed||this.pc&&"closed"===this.pc.iceConnectionState}function g(){var a=this,b=this.pc;b.onnegotiationneeded=function(b){f.call(a)||(l("onnegotiationneeded()"),a.onnegotiationneeded&&a.onnegotiationneeded(b))},b.onicecandidate=function(b){var c,d,e;if(!f.call(a)&&!a.ignoreIceGathering&&!a.options.iceTransportsNone)if(c=b.candidate){if(d=o.REGEXP_RELAY_CANDIDATE.test(c.candidate),a.options.iceTransportsRelay&&!d)return;d&&!a.timerGatheringTimeoutAfterRelay&&"number"==typeof a.options.gatheringTimeoutAfterRelay&&(l("onicecandidate() | first relay candidate found, ending gathering in %d ms",a.options.gatheringTimeoutAfterRelay),a.timerGatheringTimeoutAfterRelay=setTimeout(function(){f.call(a)||(l("forced end of candidates after timeout"),delete a.timerGatheringTimeoutAfterRelay,clearTimeout(a.timerGatheringTimeout),delete a.timerGatheringTimeout,a.ignoreIceGathering=!0,a.onicecandidate&&a.onicecandidate({candidate:null},null))},a.options.gatheringTimeoutAfterRelay)),e=new n.RTCIceCandidate({sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,candidate:c.candidate}),null===p.normalizeCandidate&&(o.REGEXP_NORMALIZED_CANDIDATE.test(c.candidate)?p.normalizeCandidate=!1:(l('onicecandidate() | normalizing ICE candidates syntax (remove "a=" and "\\r\\n")'),p.normalizeCandidate=!0)),p.normalizeCandidate&&(e.candidate=c.candidate.replace(o.REGEXP_FIX_CANDIDATE,"")),l("onicecandidate() | m%d(%s) %s",e.sdpMLineIndex,e.sdpMid||"no mid",e.candidate),a.onicecandidate&&a.onicecandidate(b,e)}else l("onicecandidate() | end of candidates"),clearTimeout(a.timerGatheringTimeout),delete a.timerGatheringTimeout,clearTimeout(a.timerGatheringTimeoutAfterRelay),delete a.timerGatheringTimeoutAfterRelay,a.onicecandidate&&a.onicecandidate(b,null)},b.onaddstream=function(b){f.call(a)||(l("onaddstream() | stream: %o",b.stream),a.onaddstream&&a.onaddstream(b,b.stream))},b.onremovestream=function(b){f.call(a)||(l("onremovestream() | stream: %o",b.stream),a.onremovestream&&a.onremovestream(b,b.stream))},b.ondatachannel=function(b){f.call(a)||(l("ondatachannel() | datachannel: %o",b.channel),a.ondatachannel&&a.ondatachannel(b,b.channel))},b.onsignalingstatechange=function(c){b.signalingState!==a.ourSignalingState&&(l("onsignalingstatechange() | signalingState: %s",b.signalingState),a.ourSignalingState=b.signalingState,a.onsignalingstatechange&&a.onsignalingstatechange(c,b.signalingState))},b.oniceconnectionstatechange=function(c){b.iceConnectionState!==a.ourIceConnectionState&&(l("oniceconnectionstatechange() | iceConnectionState: %s",b.iceConnectionState),a.ourIceConnectionState=b.iceConnectionState,a.oniceconnectionstatechange&&a.oniceconnectionstatechange(c,b.iceConnectionState))},b.onicegatheringstatechange=function(c){f.call(a)||b.iceGatheringState!==a.ourIceGatheringState&&(l("onicegatheringstatechange() | iceGatheringState: %s",b.iceGatheringState),a.ourIceGatheringState=b.iceGatheringState,a.onicegatheringstatechange&&a.onicegatheringstatechange(c,b.iceGatheringState))},b.onidentityresult=function(b){f.call(a)||(l("onidentityresult()"),a.onidentityresult&&a.onidentityresult(b))},b.onpeeridentity=function(b){f.call(a)||(l("onpeeridentity()"),a.onpeeridentity&&a.onpeeridentity(b))},b.onidpassertionerror=function(b){f.call(a)||(l("onidpassertionerror()"),a.onidpassertionerror&&a.onidpassertionerror(b))},b.onidpvalidationerror=function(b){f.call(a)||(l("onidpvalidationerror()"),a.onidpvalidationerror&&a.onidpvalidationerror(b))}}function h(){this.pcConstraints?this.pc=new n.RTCPeerConnection(this.pcConfig,this.pcConstraints):this.pc=new n.RTCPeerConnection(this.pcConfig),g.call(this)}function i(){var a=this.pc,b=this.options,c=null;return a.localDescription?(b.iceTransportsRelay?c=a.localDescription.sdp.replace(o.REGEXP_SDP_NON_RELAY_CANDIDATES,""):b.iceTransportsNone&&(c=a.localDescription.sdp.replace(o.REGEXP_SDP_CANDIDATES,"")),this.ourLocalDescription=new n.RTCSessionDescription({type:a.localDescription.type,sdp:c||a.localDescription.sdp}),this.ourLocalDescription):(this.ourLocalDescription=null,null)}function j(){var a=this;Object.defineProperties(this,{peerConnection:{get:function(){return a.pc}},signalingState:{get:function(){return a.pc.signalingState}},iceConnectionState:{get:function(){return a.pc.iceConnectionState}},iceGatheringState:{get:function(){return a.pc.iceGatheringState}},localDescription:{get:function(){return i.call(a)}},remoteDescription:{get:function(){return a.pc.remoteDescription}},peerIdentity:{get:function(){return a.pc.peerIdentity}}})}b.exports=d;var k=a("merge"),l=a("debug")("rtcninja:RTCPeerConnection"),m=a("debug")("rtcninja:ERROR:RTCPeerConnection"),n=a("./Adapter"),o={REGEXP_NORMALIZED_CANDIDATE:new RegExp(/^candidate:/i),REGEXP_FIX_CANDIDATE:new RegExp(/(^a=|\r|\n)/gi),REGEXP_RELAY_CANDIDATE:new RegExp(/ relay /i),REGEXP_SDP_CANDIDATES:new RegExp(/^a=candidate:.*\r\n/gim),REGEXP_SDP_NON_RELAY_CANDIDATES:new RegExp(/^a=candidate:(.(?!relay ))*\r\n/gim)},p={normalizeCandidate:null};m.log=console.warn.bind(console),d.prototype.createOffer=function(a,b,c){l("createOffer()");var d=this;n.fixRTCOfferOptions(c),this.pc.createOffer(function(b){f.call(d)||(l("createOffer() | success"),a&&a(b))},function(a){f.call(d)||(m("createOffer() | error:",a),b&&b(a))},c)},d.prototype.createAnswer=function(a,b,c){l("createAnswer()");var d=this;this.pc.createAnswer(function(b){f.call(d)||(l("createAnswer() | success"),a&&a(b))},function(a){f.call(d)||(m("createAnswer() | error:",a),b&&b(a))},c)},d.prototype.setLocalDescription=function(a,b,c){function d(){"number"==typeof e.options.gatheringTimeout&&"complete"!==e.pc.iceGatheringState&&(l("setLocalDescription() | ending gathering in %d ms (gatheringTimeout option)",e.options.gatheringTimeout),e.timerGatheringTimeout=setTimeout(function(){f.call(e)||(l("forced end of candidates after gatheringTimeout timeout"),delete e.timerGatheringTimeout,clearTimeout(e.timerGatheringTimeoutAfterRelay),delete e.timerGatheringTimeoutAfterRelay,e.ignoreIceGathering=!0,e.onicecandidate&&e.onicecandidate({candidate:null},null))},e.options.gatheringTimeout))}l("setLocalDescription()");var e=this;this.pc.setLocalDescription(a,function(){f.call(e)||(l("setLocalDescription() | success"),clearTimeout(e.timerGatheringTimeout),delete e.timerGatheringTimeout,clearTimeout(e.timerGatheringTimeoutAfterRelay),delete e.timerGatheringTimeoutAfterRelay,d(),b&&b())},function(a){f.call(e)||(m("setLocalDescription() | error:",a),c&&c(a))}),this.ignoreIceGathering=!1},d.prototype.setRemoteDescription=function(a,b,c){l("setRemoteDescription()");var d=this;this.pc.setRemoteDescription(a,function(){f.call(d)||(l("setRemoteDescription() | success"),b&&b())},function(a){f.call(d)||(m("setRemoteDescription() | error:",a),c&&c(a))})},d.prototype.updateIce=function(a){l("updateIce() | pcConfig: %o",a),e.call(this,a),this.pc.updateIce(this.pcConfig),this.ignoreIceGathering=!1},d.prototype.addIceCandidate=function(a,b,c){l("addIceCandidate() | candidate: %o",a);var d=this;this.pc.addIceCandidate(a,function(){f.call(d)||(l("addIceCandidate() | success"),b&&b())},function(a){f.call(d)||(m("addIceCandidate() | error:",a),c&&c(a))})},d.prototype.getConfiguration=function(){return l("getConfiguration()"),this.pc.getConfiguration()},d.prototype.getLocalStreams=function(){return l("getLocalStreams()"),this.pc.getLocalStreams()},d.prototype.getRemoteStreams=function(){return l("getRemoteStreams()"),this.pc.getRemoteStreams()},d.prototype.getStreamById=function(a){return l("getStreamById() | streamId: %s",a),this.pc.getStreamById(a)},d.prototype.addStream=function(a){l("addStream() | stream: %s",a),this.pc.addStream(a)},d.prototype.removeStream=function(a){l("removeStream() | stream: %o",a),this.pc.removeStream(a)},d.prototype.close=function(){l("close()"),this.closed=!0,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,this.pc.close()},d.prototype.createDataChannel=function(){return l("createDataChannel()"),this.pc.createDataChannel.apply(this.pc,arguments)},d.prototype.createDTMFSender=function(a){return l("createDTMFSender()"),this.pc.createDTMFSender?this.pc.createDTMFSender(a):null},d.prototype.getStats=function(){return l("getStats()"),this.pc.getStats.apply(this.pc,arguments)},d.prototype.setIdentityProvider=function(){return l("setIdentityProvider()"),this.pc.setIdentityProvider.apply(this.pc,arguments)},d.prototype.getIdentityAssertion=function(){return l("getIdentityAssertion()"),this.pc.getIdentityAssertion()},d.prototype.reset=function(a){l("reset() | pcConfig: %o",a);var b=this.pc;b.onnegotiationneeded=null,b.onicecandidate=null,b.onaddstream=null,b.onremovestream=null,b.ondatachannel=null,b.onsignalingstatechange=null,b.oniceconnectionstatechange=null,b.onicegatheringstatechange=null,b.onidentityresult=null,b.onpeeridentity=null,b.onidpassertionerror=null,b.onidpvalidationerror=null,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,l("reset() | closing current peerConnection"),b.close(),e.call(this,a),h.call(this)}},{"./Adapter":41,debug:46,merge:49}],43:[function(a,b,c){"use strict";function d(a){var b=i(a||{});return k=!0,d.RTCPeerConnection=j,d.getUserMedia=b.getUserMedia,d.mediaDevices=b.mediaDevices,d.RTCSessionDescription=b.RTCSessionDescription,d.RTCIceCandidate=b.RTCIceCandidate,d.MediaStreamTrack=b.MediaStreamTrack,d.getMediaDevices=b.getMediaDevices,d.attachMediaStream=b.attachMediaStream,d.closeMediaStream=b.closeMediaStream,d.canRenegotiate=b.canRenegotiate,b.hasWebRTC()?(f("WebRTC supported"),!0):(g("WebRTC not supported"),!1)}b.exports=d;var e=a("bowser"),f=a("debug")("rtcninja"),g=a("debug")("rtcninja:ERROR"),h=a("./version"),i=a("./Adapter"),j=a("./RTCPeerConnection"),k=!1;g.log=console.warn.bind(console),f("version %s",h),f("detected browser: %s %s [mobile:%s, tablet:%s, android:%s, ios:%s]",e.name,e.version,!!e.mobile,!!e.tablet,!!e.android,!!e.ios),d.hasWebRTC=function(){return k||d(),i.hasWebRTC()},Object.defineProperty(d,"version",{get:function(){return h}}),Object.defineProperty(d,"called",{get:function(){return k}}),d.debug=a("debug"),d.browser=e},{"./Adapter":41,"./RTCPeerConnection":42,"./version":44,bowser:45,debug:46}],44:[function(a,b,c){"use strict";b.exports=a("../package.json").version},{"../package.json":50}],45:[function(b,c,d){!function(b,d){"undefined"!=typeof c&&c.exports?c.exports=d():"function"==typeof a&&a.amd?a(b,d):this[b]=d()}("bowser",function(){function a(a){function b(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function c(b){var c=a.match(b);return c&&c.length>1&&c[2]||""}var d,e=b(/(ipod|iphone|ipad)/i).toLowerCase(),f=/like android/i.test(a),h=!f&&/android/i.test(a),i=/nexus\s*[0-6]\s*/i.test(a),j=!i&&/nexus\s*[0-9]+/i.test(a),k=/CrOS/.test(a),l=/silk/i.test(a),m=/sailfish/i.test(a),n=/tizen/i.test(a),o=/(web|hpw)os/i.test(a),p=/windows phone/i.test(a),q=(/SamsungBrowser/i.test(a),!p&&/windows/i.test(a)),r=!e&&!l&&/macintosh/i.test(a),s=!h&&!m&&!n&&!o&&/linux/i.test(a),t=b(/edge\/(\d+(\.\d+)?)/i),u=b(/version\/(\d+(\.\d+)?)/i),v=/tablet/i.test(a),w=!v&&/[^-]mobi/i.test(a),x=/xbox/i.test(a);/opera/i.test(a)?d={name:"Opera",opera:g,version:u||b(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(a)?d={name:"Opera",opera:g,version:b(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||u}:/SamsungBrowser/i.test(a)?d={name:"Samsung Internet for Android",samsungBrowser:g,version:u||b(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(a)?d={name:"Opera Coast",coast:g,version:u||b(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(a)?d={name:"Yandex Browser",yandexbrowser:g,version:u||b(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(a)?d={name:"UC Browser",ucbrowser:g,version:b(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(a)?d={name:"Maxthon",maxthon:g,version:b(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(a)?d={name:"Epiphany",epiphany:g,version:b(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(a)?d={name:"Puffin",puffin:g,version:b(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(a)?d={name:"Sleipnir",sleipnir:g,version:b(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(a)?d={name:"K-Meleon",kMeleon:g,version:b(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:p?(d={name:"Windows Phone",windowsphone:g},t?(d.msedge=g,d.version=t):(d.msie=g,d.version=b(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(a)?d={name:"Internet Explorer",msie:g,version:b(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:k?d={name:"Chrome",chromeos:g,chromeBook:g,chrome:g,version:b(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(a)?d={name:"Microsoft Edge",msedge:g,version:t}:/vivaldi/i.test(a)?d={name:"Vivaldi",vivaldi:g,version:b(/vivaldi\/(\d+(\.\d+)?)/i)||u}:m?d={name:"Sailfish",sailfish:g,version:b(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?d={name:"SeaMonkey",seamonkey:g,version:b(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(a)?(d={name:"Firefox",firefox:g,version:b(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(d.firefoxos=g)):l?d={name:"Amazon Silk",silk:g,version:b(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(a)?d={name:"PhantomJS",phantom:g,version:b(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(a)?d={name:"SlimerJS",slimer:g,version:b(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?d={name:"BlackBerry",blackberry:g,version:u||b(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:o?(d={name:"WebOS",webos:g,version:u||b(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(d.touchpad=g)):/bada/i.test(a)?d={name:"Bada",bada:g,version:b(/dolfin\/(\d+(\.\d+)?)/i)}:n?d={name:"Tizen",tizen:g,version:b(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||u}:/qupzilla/i.test(a)?d={name:"QupZilla",qupzilla:g,version:b(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||u}:/chromium/i.test(a)?d={name:"Chromium",chromium:g,version:b(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||u}:/chrome|crios|crmo/i.test(a)?d={name:"Chrome",chrome:g,version:b(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:h?d={name:"Android",version:u}:/safari|applewebkit/i.test(a)?(d={name:"Safari",safari:g},u&&(d.version=u)):e?(d={name:"iphone"==e?"iPhone":"ipad"==e?"iPad":"iPod"},u&&(d.version=u)):d=/googlebot/i.test(a)?{name:"Googlebot",googlebot:g,version:b(/googlebot\/(\d+(\.\d+))/i)||u}:{name:b(/^(.*)\/(.*) /),version:c(/^(.*)\/(.*) /)},!d.msedge&&/(apple)?webkit/i.test(a)?(/(apple)?webkit\/537\.36/i.test(a)?(d.name=d.name||"Blink",d.blink=g):(d.name=d.name||"Webkit",d.webkit=g),!d.version&&u&&(d.version=u)):!d.opera&&/gecko\//i.test(a)&&(d.name=d.name||"Gecko",d.gecko=g,d.version=d.version||b(/gecko\/(\d+(\.\d+)?)/i)),d.msedge||!h&&!d.silk?e?(d[e]=g,d.ios=g):r?d.mac=g:x?d.xbox=g:q?d.windows=g:s&&(d.linux=g):d.android=g;var y="";d.windowsphone?y=b(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):e?(y=b(/os (\d+([_\s]\d+)*) like mac os x/i),y=y.replace(/[_\s]/g,".")):h?y=b(/android[ \/-](\d+(\.\d+)*)/i):d.webos?y=b(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):d.blackberry?y=b(/rim\stablet\sos\s(\d+(\.\d+)*)/i):d.bada?y=b(/bada\/(\d+(\.\d+)*)/i):d.tizen&&(y=b(/tizen[\/\s](\d+(\.\d+)*)/i)),y&&(d.osversion=y);var z=y.split(".")[0];return v||j||"ipad"==e||h&&(3==z||z>=4&&!w)||d.silk?d.tablet=g:(w||"iphone"==e||"ipod"==e||h||i||d.blackberry||d.webos||d.bada)&&(d.mobile=g),d.msedge||d.msie&&d.version>=10||d.yandexbrowser&&d.version>=15||d.vivaldi&&d.version>=1||d.chrome&&d.version>=20||d.samsungBrowser&&d.version>=4||d.firefox&&d.version>=20||d.safari&&d.version>=6||d.opera&&d.version>=10||d.ios&&d.osversion&&d.osversion.split(".")[0]>=6||d.blackberry&&d.version>=10.1||d.chromium&&d.version>=20?d.a=g:d.msie&&d.version<10||d.chrome&&d.version<20||d.firefox&&d.version<20||d.safari&&d.version<6||d.opera&&d.version<10||d.ios&&d.osversion&&d.osversion.split(".")[0]<6||d.chromium&&d.version<20?d.c=g:d.x=g,d}function b(a){return a.split(".").length}function c(a,b){var c,d=[];if(Array.prototype.map)return Array.prototype.map.call(a,b);for(c=0;c<a.length;c++)d.push(b(a[c]));return d}function d(a){for(var d=Math.max(b(a[0]),b(a[1])),e=c(a,function(a){var e=d-b(a);return a+=new Array(e+1).join(".0"),c(a.split("."),function(a){return new Array(20-a.length).join("0")+a}).reverse()});--d>=0;){if(e[0][d]>e[1][d])return 1;if(e[0][d]!==e[1][d])return-1;if(0===d)return 0}}function e(b,c,e){var f=h;"string"==typeof c&&(e=c,c=void 0),void 0===c&&(c=!1),e&&(f=a(e));var g=""+f.version;for(var i in b)if(b.hasOwnProperty(i)&&f[i])return d([g,b[i]])<0;return c}function f(a,b,c){return!e(a,b,c)}var g=!0,h=a("undefined"!=typeof navigator?navigator.userAgent||"":"");return h.test=function(a){for(var b=0;b<a.length;++b){var c=a[b];if("string"==typeof c&&c in h)return!0}return!1},h.isUnsupportedBrowser=e,h.compareVersions=d,h.check=f,h._detect=a,h})},{}],46:[function(a,b,c){arguments[4][33][0].apply(c,arguments)},{"./debug":47,dup:33}],47:[function(a,b,c){arguments[4][34][0].apply(c,arguments)},{dup:34,ms:48}],48:[function(a,b,c){arguments[4][35][0].apply(c,arguments)},{dup:35}],49:[function(a,b,c){!function(a){function c(a,b){if("object"!==e(a))return b;for(var d in b)"object"===e(a[d])&&"object"===e(b[d])?a[d]=c(a[d],b[d]):a[d]=b[d];return a}function d(a,b,d){var g=d[0],h=d.length;(a||"object"!==e(g))&&(g={});for(var i=0;i<h;++i){var j=d[i],k=e(j);if("object"===k)for(var l in j){var m=a?f.clone(j[l]):j[l];b?g[l]=c(g[l],m):g[l]=m}}return g}function e(a){return{}.toString.call(a).slice(8,-1).toLowerCase()}var f=function(a){return d(a===!0,!1,arguments)},g="merge";f.recursive=function(a){return d(a===!0,!0,arguments)},f.clone=function(a){var b,c,d=a,g=e(a);if("array"===g)for(d=[],c=a.length,b=0;b<c;++b)d[b]=f.clone(a[b]);else if("object"===g){d={};for(b in a)d[b]=f.clone(a[b])}return d},a?b.exports=f:window[g]=f}("object"==typeof b&&b&&"object"==typeof b.exports&&b.exports)},{}],50:[function(a,b,c){b.exports={name:"rtcninja",version:"0.7.0",description:"WebRTC API wrapper to deal with different browsers",author:"Iñaki Baz Castillo <inaki.baz@eface2face.com> (http://eface2face.com)",contributors:["Jesús Pérez <jesus.perez@eface2face.com>"],license:"MIT",main:"lib/rtcninja.js",homepage:"https://github.com/eface2face/rtcninja.js",repository:{type:"git",url:"https://github.com/eface2face/rtcninja.js.git"},keywords:["webrtc"],engines:{node:">=0.12.0"},dependencies:{bowser:"^1.4.6",debug:"^2.2.0",merge:"^1.2.0"},devDependencies:{browserify:"^13.1.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.8.8","gulp-jscs":"^3.0.2","gulp-jscs-stylish":"^1.4.0","gulp-jshint":"^2.0.1","gulp-rename":"^1.2.2","gulp-uglify":"^1.5.4",jshint:"^2.9.3","jshint-stylish":"^2.2.1","vinyl-source-stream":"^1.1.0"}}},{}]},{},[7])(7)});/**
 * @preserve A JavaScript implementation of the SHA family of hashes, as
 * defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 * as defined in FIPS PUB 198a
 *
 * Copyright Brian Turek 2008-2013
 * Distributed under the BSD License
 * See http://caligatio.github.com/jsSHA/ for more information
 *
 * Several functions taken from Paul Johnston
 */
var SUPPORTED_ALGS=7;!function(a){"use strict";function b(a,b){this.highOrder=a,this.lowOrder=b}function c(a,b){var c,d,e,f=[],g=[],h=0;if("UTF8"===b)for(d=0;d<a.length;d+=1)for(c=a.charCodeAt(d),g=[],2048<c?(g[0]=224|(61440&c)>>>12,g[1]=128|(4032&c)>>>6,g[2]=128|63&c):128<c?(g[0]=192|(1984&c)>>>6,g[1]=128|63&c):g[0]=c,e=0;e<g.length;e+=1)f[h>>>2]|=g[e]<<24-8*(h%4),h+=1;else if("UTF16"===b)for(d=0;d<a.length;d+=1)c=a.charCodeAt(d),f[h>>>2]|=a.charCodeAt(d)<<16-8*(h%4),h+=2;return{value:f,binLen:8*h}}function d(a){var b,c,d=[],e=a.length;if(0!==e%2)throw"String of HEX type must be in byte increments";for(b=0;b<e;b+=2){if(c=parseInt(a.substr(b,2),16),isNaN(c))throw"String of HEX type contains invalid characters";d[b>>>3]|=c<<24-4*(b%8)}return{value:d,binLen:4*e}}function e(a){var b,c,d,e,f,g,h=[],i=0,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(g=a.indexOf("="),a=a.replace(/\=/g,""),-1!==g&&g<a.length)throw"Invalid '=' found in base-64 string";for(c=0;c<a.length;c+=4){for(f=a.substr(c,4),e=0,d=0;d<f.length;d+=1)b=j.indexOf(f[d]),e|=b<<18-6*d;for(d=0;d<f.length-1;d+=1)h[i>>2]|=(e>>>16-8*d&255)<<24-8*(i%4),i+=1}return{value:h,binLen:8*i}}function f(a,b){var c,d,e="0123456789abcdef",f="",g=4*a.length;for(c=0;c<g;c+=1)d=a[c>>>2]>>>8*(3-c%4),f+=e.charAt(d>>>4&15)+e.charAt(15&d);return b.outputUpper?f.toUpperCase():f}function g(a,b){var c,d,e,f="",g=4*a.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(c=0;c<g;c+=3)for(e=(a[c>>>2]>>>8*(3-c%4)&255)<<16|(a[c+1>>>2]>>>8*(3-(c+1)%4)&255)<<8|a[c+2>>>2]>>>8*(3-(c+2)%4)&255,d=0;d<4;d+=1)f+=8*c+6*d<=32*a.length?h.charAt(e>>>6*(3-d)&63):b.b64Pad;return f}function h(a){var b={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(b.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad)}catch(a){}if("boolean"!=typeof b.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof b.b64Pad)throw"Invalid b64Pad formatting option";return b}function i(a,b){return a<<b|a>>>32-b}function j(a,b){return a>>>b|a<<32-b}function k(a,c){var d=null,e=new b(a.highOrder,a.lowOrder);return d=32>=c?new b(e.highOrder>>>c|e.lowOrder<<32-c&4294967295,e.lowOrder>>>c|e.highOrder<<32-c&4294967295):new b(e.lowOrder>>>c-32|e.highOrder<<64-c&4294967295,e.highOrder>>>c-32|e.lowOrder<<64-c&4294967295)}function l(a,b){return a>>>b}function m(a,c){var d=null;return d=32>=c?new b(a.highOrder>>>c,a.lowOrder>>>c|a.highOrder<<32-c&4294967295):new b(0,a.highOrder>>>c-32)}function n(a,b,c){return a^b^c}function o(a,b,c){return a&b^~a&c}function p(a,c,d){return new b(a.highOrder&c.highOrder^~a.highOrder&d.highOrder,a.lowOrder&c.lowOrder^~a.lowOrder&d.lowOrder)}function q(a,b,c){return a&b^a&c^b&c}function r(a,c,d){return new b(a.highOrder&c.highOrder^a.highOrder&d.highOrder^c.highOrder&d.highOrder,a.lowOrder&c.lowOrder^a.lowOrder&d.lowOrder^c.lowOrder&d.lowOrder)}function s(a){return j(a,2)^j(a,13)^j(a,22)}function t(a){var c=k(a,28),d=k(a,34),e=k(a,39);return new b(c.highOrder^d.highOrder^e.highOrder,c.lowOrder^d.lowOrder^e.lowOrder)}function u(a){return j(a,6)^j(a,11)^j(a,25)}function v(a){var c=k(a,14),d=k(a,18),e=k(a,41);return new b(c.highOrder^d.highOrder^e.highOrder,c.lowOrder^d.lowOrder^e.lowOrder)}function w(a){return j(a,7)^j(a,18)^l(a,3)}function x(a){var c=k(a,1),d=k(a,8),e=m(a,7);return new b(c.highOrder^d.highOrder^e.highOrder,c.lowOrder^d.lowOrder^e.lowOrder)}function y(a){return j(a,17)^j(a,19)^l(a,10)}function z(a){var c=k(a,19),d=k(a,61),e=m(a,6);return new b(c.highOrder^d.highOrder^e.highOrder,c.lowOrder^d.lowOrder^e.lowOrder)}function A(a,b){var c=(65535&a)+(65535&b),d=(a>>>16)+(b>>>16)+(c>>>16);return(65535&d)<<16|65535&c}function B(a,b,c,d){var e=(65535&a)+(65535&b)+(65535&c)+(65535&d),f=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16);return(65535&f)<<16|65535&e}function C(a,b,c,d,e){var f=(65535&a)+(65535&b)+(65535&c)+(65535&d)+(65535&e),g=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16);return(65535&g)<<16|65535&f}function D(a,c){var d,e,f,g;return d=(65535&a.lowOrder)+(65535&c.lowOrder),e=(a.lowOrder>>>16)+(c.lowOrder>>>16)+(d>>>16),f=(65535&e)<<16|65535&d,d=(65535&a.highOrder)+(65535&c.highOrder)+(e>>>16),e=(a.highOrder>>>16)+(c.highOrder>>>16)+(d>>>16),g=(65535&e)<<16|65535&d,new b(g,f)}function E(a,c,d,e){var f,g,h,i;return f=(65535&a.lowOrder)+(65535&c.lowOrder)+(65535&d.lowOrder)+(65535&e.lowOrder),g=(a.lowOrder>>>16)+(c.lowOrder>>>16)+(d.lowOrder>>>16)+(e.lowOrder>>>16)+(f>>>16),h=(65535&g)<<16|65535&f,f=(65535&a.highOrder)+(65535&c.highOrder)+(65535&d.highOrder)+(65535&e.highOrder)+(g>>>16),g=(a.highOrder>>>16)+(c.highOrder>>>16)+(d.highOrder>>>16)+(e.highOrder>>>16)+(f>>>16),i=(65535&g)<<16|65535&f,new b(i,h)}function F(a,c,d,e,f){var g,h,i,j;return g=(65535&a.lowOrder)+(65535&c.lowOrder)+(65535&d.lowOrder)+(65535&e.lowOrder)+(65535&f.lowOrder),h=(a.lowOrder>>>16)+(c.lowOrder>>>16)+(d.lowOrder>>>16)+(e.lowOrder>>>16)+(f.lowOrder>>>16)+(g>>>16),i=(65535&h)<<16|65535&g,g=(65535&a.highOrder)+(65535&c.highOrder)+(65535&d.highOrder)+(65535&e.highOrder)+(65535&f.highOrder)+(h>>>16),h=(a.highOrder>>>16)+(c.highOrder>>>16)+(d.highOrder>>>16)+(e.highOrder>>>16)+(f.highOrder>>>16)+(g>>>16),j=(65535&h)<<16|65535&g,new b(j,i)}function G(a,b){var c,d,e,f,g,h,j,k,l,m=[],p=o,r=n,s=q,t=i,u=A,v=C,w=[1732584193,4023233417,2562383102,271733878,3285377520];for(a[b>>>5]|=128<<24-b%32,a[(b+65>>>9<<4)+15]=b,l=a.length,j=0;j<l;j+=16){for(c=w[0],d=w[1],e=w[2],f=w[3],g=w[4],k=0;k<80;k+=1)k<16?m[k]=a[k+j]:m[k]=t(m[k-3]^m[k-8]^m[k-14]^m[k-16],1),h=k<20?v(t(c,5),p(d,e,f),g,1518500249,m[k]):k<40?v(t(c,5),r(d,e,f),g,1859775393,m[k]):k<60?v(t(c,5),s(d,e,f),g,2400959708,m[k]):v(t(c,5),r(d,e,f),g,3395469782,m[k]),g=f,f=e,e=t(d,30),d=c,c=h;w[0]=u(c,w[0]),w[1]=u(d,w[1]),w[2]=u(e,w[2]),w[3]=u(f,w[3]),w[4]=u(g,w[4])}return w}function H(a,c,d){var e,f,g,h,i,j,k,l,m,n,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z=[],$=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],_=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],aa=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if(("SHA-224"===d||"SHA-256"===d)&&2&SUPPORTED_ALGS)H=64,I=(c+65>>>9<<4)+15,L=16,M=1,W=Number,N=A,O=B,P=C,Q=w,R=y,S=s,T=u,V=q,U=o,G="SHA-224"===d?_:aa;else{if("SHA-384"!==d&&"SHA-512"!==d||!(4&SUPPORTED_ALGS))throw"Unexpected error in SHA-2 implementation";H=80,I=(c+128>>>10<<5)+31,L=32,M=2,W=b,N=D,O=E,P=F,Q=x,R=z,S=t,T=v,V=r,U=p,$=[new W($[0],3609767458),new W($[1],602891725),new W($[2],3964484399),new W($[3],2173295548),new W($[4],4081628472),new W($[5],3053834265),new W($[6],2937671579),new W($[7],3664609560),new W($[8],2734883394),new W($[9],1164996542),new W($[10],1323610764),new W($[11],3590304994),new W($[12],4068182383),new W($[13],991336113),new W($[14],633803317),new W($[15],3479774868),new W($[16],2666613458),new W($[17],944711139),new W($[18],2341262773),new W($[19],2007800933),new W($[20],1495990901),new W($[21],1856431235),new W($[22],3175218132),new W($[23],2198950837),new W($[24],3999719339),new W($[25],766784016),new W($[26],2566594879),new W($[27],3203337956),new W($[28],1034457026),new W($[29],2466948901),new W($[30],3758326383),new W($[31],168717936),new W($[32],1188179964),new W($[33],1546045734),new W($[34],1522805485),new W($[35],2643833823),new W($[36],2343527390),new W($[37],1014477480),new W($[38],1206759142),new W($[39],344077627),new W($[40],1290863460),new W($[41],3158454273),new W($[42],3505952657),new W($[43],106217008),new W($[44],3606008344),new W($[45],1432725776),new W($[46],1467031594),new W($[47],851169720),new W($[48],3100823752),new W($[49],1363258195),new W($[50],3750685593),new W($[51],3785050280),new W($[52],3318307427),new W($[53],3812723403),new W($[54],2003034995),new W($[55],3602036899),new W($[56],1575990012),new W($[57],1125592928),new W($[58],2716904306),new W($[59],442776044),new W($[60],593698344),new W($[61],3733110249),new W($[62],2999351573),new W($[63],3815920427),new W(3391569614,3928383900),new W(3515267271,566280711),new W(3940187606,3454069534),new W(4118630271,4000239992),new W(116418474,1914138554),new W(174292421,2731055270),new W(289380356,3203993006),new W(460393269,320620315),new W(685471733,587496836),new W(852142971,1086792851),new W(1017036298,365543100),new W(1126000580,2618297676),new W(1288033470,3409855158),new W(1501505948,4234509866),new W(1607167915,987167468),new W(1816402316,1246189591)],G="SHA-384"===d?[new W(3418070365,_[0]),new W(1654270250,_[1]),new W(2438529370,_[2]),new W(355462360,_[3]),new W(1731405415,_[4]),new W(41048885895,_[5]),new W(3675008525,_[6]),new W(1203062813,_[7])]:[new W(aa[0],4089235720),new W(aa[1],2227873595),new W(aa[2],4271175723),new W(aa[3],1595750129),new W(aa[4],2917565137),new W(aa[5],725511199),new W(aa[6],4215389547),new W(aa[7],327033209)]}for(a[c>>>5]|=128<<24-c%32,a[I]=c,X=a.length,J=0;J<X;J+=L){for(e=G[0],f=G[1],g=G[2],h=G[3],i=G[4],j=G[5],k=G[6],l=G[7],K=0;K<H;K+=1)K<16?Z[K]=new W(a[K*M+J],a[K*M+J+1]):Z[K]=O(R(Z[K-2]),Z[K-7],Q(Z[K-15]),Z[K-16]),m=P(l,T(i),U(i,j,k),$[K],Z[K]),n=N(S(e),V(e,f,g)),l=k,k=j,j=i,i=N(h,m),h=g,g=f,f=e,e=N(m,n);G[0]=N(e,G[0]),G[1]=N(f,G[1]),G[2]=N(g,G[2]),G[3]=N(h,G[3]),G[4]=N(i,G[4]),G[5]=N(j,G[5]),G[6]=N(k,G[6]),G[7]=N(l,G[7])}if("SHA-224"===d&&2&SUPPORTED_ALGS)Y=[G[0],G[1],G[2],G[3],G[4],G[5],G[6]];else if("SHA-256"===d&&2&SUPPORTED_ALGS)Y=G;else if("SHA-384"===d&&4&SUPPORTED_ALGS)Y=[G[0].highOrder,G[0].lowOrder,G[1].highOrder,G[1].lowOrder,G[2].highOrder,G[2].lowOrder,G[3].highOrder,G[3].lowOrder,G[4].highOrder,G[4].lowOrder,G[5].highOrder,G[5].lowOrder];else{if(!("SHA-512"===d&&4&SUPPORTED_ALGS))throw"Unexpected error in SHA-2 implementation";Y=[G[0].highOrder,G[0].lowOrder,G[1].highOrder,G[1].lowOrder,G[2].highOrder,G[2].lowOrder,G[3].highOrder,G[3].lowOrder,G[4].highOrder,G[4].lowOrder,G[5].highOrder,G[5].lowOrder,G[6].highOrder,G[6].lowOrder,G[7].highOrder,G[7].lowOrder]}return Y}var I=function(a,b,i){var j=0,k=[0],l="",m=null;if(l=i||"UTF8","UTF8"!==l&&"UTF16"!==l)throw"encoding must be UTF8 or UTF16";if("HEX"===b){if(0!==a.length%2)throw"srcString of HEX type must be in byte increments";m=d(a),j=m.binLen,k=m.value}else if("ASCII"===b||"TEXT"===b)m=c(a,l),j=m.binLen,k=m.value;else{if("B64"!==b)throw"inputFormat must be HEX, TEXT, ASCII, or B64";m=e(a),j=m.binLen,k=m.value}this.getHash=function(a,b,c,d){var e,i=null,l=k.slice(),m=j;if(3===arguments.length?"number"!=typeof c&&(d=c,c=1):2===arguments.length&&(c=1),c!==parseInt(c,10)||1>c)throw"numRounds must a integer >= 1";switch(b){case"HEX":i=f;break;case"B64":i=g;break;default:throw"format must be HEX or B64"}if("SHA-1"===a&&1&SUPPORTED_ALGS)for(e=0;e<c;e++)l=G(l,m),m=160;else if("SHA-224"===a&&2&SUPPORTED_ALGS)for(e=0;e<c;e++)l=H(l,m,a),m=224;else if("SHA-256"===a&&2&SUPPORTED_ALGS)for(e=0;e<c;e++)l=H(l,m,a),m=256;else if("SHA-384"===a&&4&SUPPORTED_ALGS)for(e=0;e<c;e++)l=H(l,m,a),m=384;else{if(!("SHA-512"===a&&4&SUPPORTED_ALGS))throw"Chosen SHA variant is not supported";for(e=0;e<c;e++)l=H(l,m,a),m=512}return i(l,h(d))},this.getHMAC=function(a,b,i,m,n){var o,p,q,r,s,t,u,v,w,x=[],y=[],z=null;switch(m){case"HEX":o=f;break;case"B64":o=g;break;default:throw"outputFormat must be HEX or B64"}if("SHA-1"===i&&1&SUPPORTED_ALGS)q=64,w=160;else if("SHA-224"===i&&2&SUPPORTED_ALGS)q=64,w=224;else if("SHA-256"===i&&2&SUPPORTED_ALGS)q=64,w=256;else if("SHA-384"===i&&4&SUPPORTED_ALGS)q=128,w=384;else{if(!("SHA-512"===i&&4&SUPPORTED_ALGS))throw"Chosen SHA variant is not supported";q=128,w=512}if("HEX"===b)z=d(a),v=z.binLen,p=z.value;else if("ASCII"===b||"TEXT"===b)z=c(a,l),v=z.binLen,p=z.value;else{if("B64"!==b)throw"inputFormat must be HEX, TEXT, ASCII, or B64";z=e(a),v=z.binLen,p=z.value}if(r=8*q,u=q/4-1,q<v/8){if("SHA-1"===i&&1&SUPPORTED_ALGS)p=G(p,v);else{if(!(6&SUPPORTED_ALGS))throw"Unexpected error in HMAC implementation";p=H(p,v,i)}p[u]&=4294967040}else q>v/8&&(p[u]&=4294967040);for(s=0;s<=u;s+=1)x[s]=909522486^p[s],y[s]=1549556828^p[s];if("SHA-1"===i&&1&SUPPORTED_ALGS)t=G(y.concat(G(x.concat(k),r+j)),r+w);else{if(!(6&SUPPORTED_ALGS))throw"Unexpected error in HMAC implementation";t=H(y.concat(H(x.concat(k),r+j,i)),r+w,i)}return o(t,h(n))}};"function"!=typeof define||(define.amd,0)?"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=exports=I:exports=I:a.jsSHA=I:define(function(){return I})}(this),!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){"use strict";!function(){function c(){function b(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function c(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function d(){var a=c();return a+Wa.currentOffset}function e(){return window.performance.now?window.performance.now():null}function f(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){pa=a})}function g(){if(pa)return pa.level}function h(){if(pa)return pa.charging}function i(a,b){return a.sort().toString()===b.sort().toString()}function j(a){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(b){oa?i(oa,b)||(oa=b,Sb(a)):(oa=b,Sb(a)),setTimeout(function(){j(a)},Ga)}).catch(function(){setTimeout(function(){j(a)},Ga)})}function k(){Ca||window.addEventListener("beforeunload",function(a){var b;for(b in Ua)Ua.hasOwnProperty(b)&&Pb(db.userLeft,null,b,Ua[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function l(a,b,c,d,f){var g=ac(c,d),h=null;g&&(h=e(),Pb(db.mediaPlaybackStartEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function m(a,b,c,d,f){var g=ac(c,d),h=null;g&&(h=e(),Pb(db.mediaSuspendedEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function n(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=Ua[b].ucID;f.oncanplay=function(){l(g,a,b,d,e)},f.onsuspend=function(){m(g,a,b,d,e)}}}function o(a){var b=Ra.codebase,c=!1;if(null===a)c=!1;else if(b===wb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==bb&&a instanceof bb&&(c=!0),"function"!=typeof a&&b!==wb.edge||(c=!0),void 0!==typeof a.createOffer&&(c=!0);return c}function p(a,b){var c;return a&&(b===wb.chrome?(c=a.googLocalAddress,c.concat(":",a.googRemoteAddress)):b===wb.firefox&&(c=a.localAddr,c.concat(":",a.remoteAddr))),Wb(c)}function q(){var a;return a=navigator.onLine===!0?"online":"offline"}function r(a,b,c,d){var e=null;c.ssrcMap.hasOwnProperty(a.data.ssrc)&&(c.ssrcMap[a.data.ssrc].mediaType=d,b===wb.chrome&&(e=a.data.googCodecName),c.ssrcMap[a.data.ssrc].codec=e,a.data.codecImplementationName&&(c.ssrcMap[a.data.ssrc].codecImplementationName=a.data.codecImplementationName))}function s(a,b){var c=xb.unknown;if(a&&a.data&&void 0!==a.data.mediaType)c=a.data.mediaType;else if(b===wb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=xb.video:void 0===a.data.audioInputLevel&&void 0===a.data.audioOutputLevel||(c=xb.audio));else{if(b!==wb.firefox)return;void 0!==a&&void 0!==a.data.framerateMean&&(c=xb.video)}return c}function t(a,b){var c;return b===wb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===wb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||c<0?null:c),c}function u(a,b){var c,d,e,f="unavailable";return c=t(a,b),e=w(a,b),d=v(a,b),void 0!==c&&void 0!==e&&void 0!==d&&e>0&&d>0&&(f=e.concat("x",d,"@",c)),f}function v(a,b){var c;return b===wb.chrome?void 0!==a.data.googFrameHeightReceived?c=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(c=a.data.googFrameHeightSent):b===wb.firefox,c}function w(a,b){var c;return b===wb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(c=a.data.googFrameWidthSent):b===wb.firefox,c}function x(a){var b;return b=isNaN(a)||a<0?null:a}function y(a,b){var c;if(b===wb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=x(parseInt(a.data.googRtt,10))}else if(b===wb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=x(parseInt(a.data.mozRtt,10))}else if(b===wb.edge&&a&&a.data.roundTripTime)return c=x(parseInt(a.data.roundTripTime,10))}function z(a){var b=isNaN(a)?null:a;return b}function A(a,b){var c;if(b===wb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=z(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===wb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=z(parseInt(a.data.jitter,10))}function B(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function C(a){var b,c;return a&&a.length>0&&(b=a.reduce(function(a,b){return a+b}),c=b/a.length),c}function D(a,b,c){var d;return b===xb.audio?a<c.audio.gThreshold?d=mb.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=mb.fair:a>c.audio.rThreshold&&(d=mb.bad):b===xb.video&&(a<c.video.gThreshold?d=mb.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=mb.fair:a>c.video.rThreshold&&(d=mb.bad)),d}function E(a,b,c){var d;return b===xb.audio?a>c.audio.gThreshold?d=mb.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=mb.fair:a<c.audio.rThreshold&&(d=mb.bad):b===xb.video&&(a>c.video.gThreshold?d=mb.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=mb.fair:a<c.video.rThreshold&&(d=mb.bad)),d}function F(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===mb.excellent?b=nb.excellent:c===mb.fair?b=nb.fair:c===mb.bad&&(b=nb.bad)),b}function G(a,b,c){var d,e,f,g,h,i,j,k,l=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k=c-g,k>0&&(b[d].csioReceivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/k,b[d].csioSentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/k,b[d].csioIntBytesReceived=parseInt(b[d].bytesReceived,10)-i,b[d].csioIntBytesSent=parseInt(b[d].bytesSent,10)-j,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(b[d].csioSentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(k/1e3),b[d].csioIntPacketsSent=parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(b[d].csioReceivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(k/1e3),b[d].csioIntPacketsReceived=parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))),l.push(b[d]))}return l}function H(a,b,c,d){var e=[];return c===wb.firefox?e=null:c===wb.chrome&&(e=G(a,b,d)),e}function I(a){if(a=z(a),null!==a){var b=a<0?null:a;return b}}function J(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d][f]&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function K(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,x,A,G,H,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z=null,$=null,_=null,aa=b.reportType,ba=null,ca=null,da=null,ea=null,fa=null,ga=null,ha=null,ia=null,ja=null,ka=b.data,la=0,ma=M(c.streams,b.ssrc,"outbound",aa);ma?(h=z(parseInt(ma.data.bytesSent,10)),i=a.lastStatsSent.apiTS,K=z(parseInt(ma.data.packetsSent,10)),N=z(parseInt(ma.data.packetsLost,10)),O=z(parseInt(ma.data.discardedPackets,10))):(h=0,i=e,N=0,K=0,O=0),k=e,A=k-i,m=s(b,d),n=u(b,d),o=t(b,d),p=w(b,d),T=v(b,d),r(b,d,a,m),l=y(b,d),j=z(parseInt(ka.bytesSent,10)),null!==j&&null!==h&&j<h&&(h=0,Gb(ya,za,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:f,ucID:g})),void 0!==ka.droppedFrames&&(P=I(parseInt(ka.droppedFrames,10)),null!==P&&null!==O&&P<O&&(O=0),null!==P&&null!==O&&(Q=P-O)),L=I(parseInt(ka.packetsLost,10)),null!==L&&null!==N&&($=L-N),H=I(parseInt(ka.packetsSent,10)),null!==H&&null!==K&&(G=H-K),null!==L&&null!==H&&L>0&&(la=L/H*100),void 0!==$&&void 0!==G&&G+$>0&&(_=$/(G+$)),A>0&&(null!==j&&null!==h&&(Z=8*(j-h)/A,H&&0!==H&&(U=j/H)),void 0!==G&&(ja=G/(A/1e3)));var na=b.ssrc;a=J(a,na,"rttInfo",aa,"outbound","rttArray",!0),a=J(a,na,"fractionalLossInfo",aa,"outbound","fractionalLossArray",!0),a=J(a,na,"timeElapse",aa,"outbound","totalTimeMs",!1),a=J(a,na,"frameWidthInfo",aa,"outbound","frameWidthArray",!0),a=J(a,na,"frameRateInfo",aa,"outbound","frameRateArray",!0),a=J(a,na,"frameHeightInfo",aa,"outbound","frameHeightArray",!0),void 0!==l&&null!==l&&a.rttInfo.streams[na].outbound[aa].rttArray.push(parseInt(l,10)),void 0!==_&&null!==_&&a.fractionalLossInfo.streams[na].outbound[aa].fractionalLossArray.push(_),void 0!==o&&null!==o&&a.frameRateInfo.streams[na].outbound[aa].frameRateArray.push(parseInt(o,10)),void 0!==p&&null!==p&&a.frameWidthInfo.streams[na].outbound[aa].frameWidthArray.push(parseInt(p,10)),void 0!==T&&null!==T&&a.frameHeightInfo.streams[na].outbound[aa].frameHeightArray.push(parseInt(T,10)),ba=B(95,a.rttInfo.streams[na].outbound[aa].rttArray),ea=B(95,a.fractionalLossInfo.streams[na].outbound[aa].fractionalLossArray),V=C(a.frameRateInfo.streams[na].outbound[aa].frameRateArray),W=B(50,a.frameHeightInfo.streams[na].outbound[aa].frameHeightArray),X=C(a.frameHeightInfo.streams[na].outbound[aa].frameHeightArray),Y=C(a.rttInfo.streams[na].outbound[aa].rttArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[na].outbound[aa].totalTimeMs=a.timeElapse.streams[na].outbound[aa].totalTimeMs+A),a.timeElapse.streams[na].outbound[aa].totalTimeMs>0&&null!==j&&(ia=8*j/a.timeElapse.streams[na].outbound[aa].totalTimeMs);var oa={csioIntMs:A,csioIntFL:_,csioIntPR:ja,csioIntBRKbps:Z,csioMediaType:m,csioSig2Latency:ba,csioAvgBRKbps:ia,csioTimeElapseMs:a.timeElapse.streams[na].outbound[aa].totalTimeMs,csioRes:n,csioPercentileFl:ea,csioIntFramesDropped:Q,csioAvgRtt:Y,csioAvgFrameRate:V,csioMedianFrameHeight:W,csioAvgFrameHeight:X,csioAvgPacketSize:U,csioPktLossPercentage:la};for(R in ka)ka.hasOwnProperty(R)&&(oa[R]=ka[R]);return m===xb.audio?(S=ba+40,ca=D(S,m,vb),da=E(Z,m,rb),q=F(ca,da),oa.csioMark=q,oa.csioeM=S):m===xb.video&&(oa.csioPercentileFrameWidth=B(95,a.frameWidthInfo.streams[na].outbound[aa].frameWidthArray),oa.csioPercentileFrameRate=B(95,a.frameRateInfo.streams[na].outbound[aa].frameRateArray),x=parseInt(a.rttInfo.streams[na].outbound[aa].frameRate,10),fa=E(o/x,m,sb),ga=D(l,m,tb),ha=E(Z,m,rb),q=F(fa,ga,ha),a.rttInfo.streams[na].outbound[aa].frameRate=o,oa.csioMark=q),oa}function L(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,x,G,H,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da=null,ea=null,fa=b.reportType,ga=null,ha=null,ia=null,ja=null,ka=null,la=null,ma=null,na=null,oa=null,pa=b.data,qa=0,ra=M(c.streams,b.ssrc,"inbound",fa);ra?(h=z(parseInt(ra.data.bytesReceived,10)),l=z(parseInt(ra.data.packetsLost,10)),R=z(parseInt(ra.data.packetsReceived,10)),i=a.lastStatsSent.apiTS,T=z(parseInt(ra.data.discardedPackets,10))):(h=0,i=e,l=0,R=0,T=0),o=s(b,d),p=u(b,d),x=t(b,d),q=A(b,d),X=w(b,d),n=y(b,d),Y=v(b,d),r(b,d,a,o),j=z(parseInt(pa.bytesReceived,10)),null!==j&&null!==h&&j<h&&(h=0,l=0,R=0,Gb(ya,za,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:f,ucID:g})),m=I(parseInt(pa.packetsLost,10)),null!==m&&null!==l&&(ea=m-l),k=e,void 0!==pa.discardedPackets&&(S=I(parseInt(pa.discardedPackets,10)),null!==S&&null!==T&&S<T&&(T=0),null!==S&&null!==T&&(U=S-T)),Q=I(parseInt(pa.packetsReceived,10)),G=Q-R,void 0!==ea&&null!==G&&G+ea>0&&(ha=ea/(G+ea)),null!==m&&null!==Q&&m>0&&(qa=m/Q*100),P=k-i,P>0&&(null!==j&&null!==h&&(da=8*(j-h)/P,Q&&0!==Q&&(Z=j/Q)),null!==G&&(ga=G/(P/1e3)));var sa=b.ssrc;a=J(a,sa,"rttInfo",fa,"inbound","rttArray",!0),a=J(a,sa,"timeElapse",fa,"inbound","totalTimeMs",!1),a=J(a,sa,"jitterInfo",fa,"inbound","jitterArray",!0),a=J(a,sa,"fractionalLossInfo",fa,"inbound","fractionalLossArray",!0),a=J(a,sa,"frameWidthInfo",fa,"inbound","frameWidthArray",!0),a=J(a,sa,"frameRateInfo",fa,"inbound","frameRateArray",!0),a=J(a,sa,"frameHeightInfo",fa,"inbound","frameHeightArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[sa].inbound[fa].rttArray.push(parseInt(n,10)),void 0!==q&&null!==q&&a.jitterInfo.streams[sa].inbound[fa].jitterArray.push(parseInt(q,10)),void 0!==ha&&null!==ha&&a.fractionalLossInfo.streams[sa].inbound[fa].fractionalLossArray.push(ha),void 0!==x&&null!==x&&a.frameRateInfo.streams[sa].inbound[fa].frameRateArray.push(parseInt(x,10)),void 0!==X&&null!==X&&a.frameWidthInfo.streams[sa].inbound[fa].frameWidthArray.push(parseInt(X,10)),void 0!==Y&&null!==Y&&a.frameHeightInfo.streams[sa].inbound[fa].frameHeightArray.push(parseInt(Y,10)),ia=B(95,a.rttInfo.streams[sa].inbound[fa].rttArray),ja=B(95,a.jitterInfo.streams[sa].inbound[fa].jitterArray),ka=B(95,a.fractionalLossInfo.streams[sa].inbound[fa].fractionalLossArray),$=C(a.frameRateInfo.streams[sa].inbound[fa].frameRateArray),_=B(50,a.frameHeightInfo.streams[sa].inbound[fa].frameHeightArray),aa=C(a.frameHeightInfo.streams[sa].inbound[fa].frameHeightArray),ba=C(a.jitterInfo.streams[sa].inbound[fa].jitterArray),ca=C(a.rttInfo.streams[sa].inbound[fa].rttArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[sa].inbound[fa].totalTimeMs=a.timeElapse.streams[sa].inbound[fa].totalTimeMs+P),null!==j&&a.timeElapse.streams[sa].inbound[fa].totalTimeMs>0&&(oa=8*j/a.timeElapse.streams[sa].inbound[fa].totalTimeMs);var ta={csioIntMs:P,csioIntFL:ha,csioIntPR:ga,csioIntBRKbps:da,csioSig2Latency:ia,csioAvgBRKbps:oa,csioMediaType:o,csioTimeElapseMs:a.timeElapse.streams[sa].inbound[fa].totalTimeMs,csioIntPktRcv:G,csioIntPktLoss:ea,csioPercentileJitter:ja,csioRes:p,csioPercentileFl:ka,csioIntPktDiscarded:U,csioAvgJitter:ba,csioAvgRtt:ca,csioAvgFrameRate:$,csioMedianFrameHeight:_,csioAvgFrameHeight:aa,csioAvgPacketSize:Z,csioPktLossPercentage:qa};for(V in pa)pa.hasOwnProperty(V)&&(ta[V]=pa[V]);return o===xb.audio?(W=ia+40,la=D(W,o,vb),ma=D(ha,o,ub),na=E(da,o,rb),H=F(la,ma,na),ta.csioMark=H,ta.csioeM=W):o===xb.video&&(ta.csioPercentileFrameRate=B(95,a.frameRateInfo.streams[sa].inbound[fa].frameRateArray),ta.csioPercentileFrameWidth=B(95,a.frameWidthInfo.streams[sa].inbound[fa].frameWidthArray),K=a.rttInfo.streams[sa].inbound[fa].frameRate,L=E(x/K,o,sb),N=D(n,o,tb),O=E(da,o,rb),H=F(L,N,O),a.rttInfo.streams[sa].inbound[fa].frameRate=x,ta.csioMark=H),ta}function M(a,b,c,d){var e=a.filter(function(a){return a.ssrc===b&&a.streamType===c&&a.reportType===d});return e.length>0?e[0]:null}function N(a,b,c,d,e,f){var g={streams:[]};g.fabricState=a.pcState,g.connectionState=q();var h=null;return h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:[]},b.streams.forEach(function(b){var i={cname:b.cname,usage:b.usage,msid:b.msid,userID:b.userID,associatedVideoTag:b.associatedVideoTag,ssrc:b.ssrc,streamType:b.streamType,reportType:b.reportType};"inbound"===b.streamType?i.data=L(a,b,h,c,d,e,f):i.data=K(a,b,h,c,d,e,f),g.streams.push(i)}),g}function O(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===nb.bad?a.streams[b].inbound[d].mark=2:c===nb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===nb.bad?a.streams[b].outbound[d].mark=2:c===nb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function P(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function Q(a){var b={},c=Rc.getConferenceURL();return a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),c&&(b.conferenceURL=c),b.streams={},a.streams.forEach(function(a){var c={cname:a.cname,ssrc:a.ssrc,msid:a.msid,remoteUserID:a.userID,usageLabel:a.usage,associatedVideoTag:a.associatedVideoTag};a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel),a.data.hasOwnProperty("csioAvgRtt")&&(c.averageRTT=a.data.csioAvgRtt),a.data.hasOwnProperty("csioAvgJitter")&&(c.averageJitter=a.data.csioAvgJitter),a.data.hasOwnProperty("csioPktLossPercentage")&&(c.packetLossPercentage=a.data.csioPktLossPercentage),b.streams[a.ssrc]=c}),b}function R(a,b,c,e,f,g){var h=d();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&!Xa?(ia(eb.processedStats,a,g),b.latestEventSent=h,b.lastFabricState=b.pcState):(a.clockUnsynced=Xa,Na.cacheEvent({channel:eb.processedStats,data:a}),a.hasOwnProperty("token")||Pa.sendAuthenticationRequest(ya,f))}function S(a,b,e,f,i,j,k){function l(l){var m=d(),n=c();void 0===j.lastRawStatsSentInterval||null===j.lastRawStatsSentInterval?j.lastRawStatsSentInterval=n-j.statsPollingStart:j.lastRawStatsSentInterval=n-j.rawstatsTS+j.lastRawStatsSentInterval,void 0===j.lastProcessedStatsSentInterval||null===j.lastProcessedStatsSentInterval?j.lastProcessedStatsSentInterval=n-j.statsPollingStart:j.lastProcessedStatsSentInterval=n-j.rawstatsTS+j.lastProcessedStatsSentInterval,j.rawstatsTS=n;var o={},q=Ra.codebase;o.version=ua,o.appID=ya,o.conferenceID=encodeURIComponent(f),o.apiTS=m,o.timeShift=0,o.fabricState=j.pcState,o.pcID=j.pcHash,void 0!==i&&(o.ucID=i),Pa.authToken?o.token=Pa.authToken:Pa.sendAuthenticationRequest(ya,b),o.localID=encodeURIComponent(b),o.remoteID=encodeURIComponent(e),o.deviceID=Ba;var r,s,t,u,v,w,x,y={streams:[]},z=null,A=!1,B=!1,C={},D={};for(z=dc(l),r=0;r<z.length;++r)if(s=X(z[r]),
t=U(JSON.parse(s),q),!Y(t))if(t.hasOwnProperty("Transport"))u="Transport",y.hasOwnProperty(u)||(y[u]=[]),q!==wb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(y[u].push(t[u]),"true"===t[u].googActiveConnection&&(o.activeConnectionIndex=y[u].length)):(y[u].push(t[u]),"true"===t[u].selected&&(o.activeConnectionIndex=y[u].length));else if(t.localCandidate)C[t.localCandidate.id]=t.localCandidate;else if(t.remoteCandidate)D[t.remoteCandidate.id]=t.remoteCandidate;else if(t.bwe)y.bwe=t.bwe;else{w=Mb(j,t.ssrc),void 0!==w&&w.localStartTime||(x=Ob(e,f,i,j,k,null),x&&(B=!0),w=Mb(j,t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=e);var E={userID:v,data:t.data,reportType:t.reportType,streamType:t.streamType,ssrc:t.ssrc};void 0!==w&&(E.cname=w.cname,E.msid=w.msid,E.associatedVideoTag=w.associatedVideoTag,E.usage=w.usageLabel),y.streams.push(E)}q===wb.firefox&&(y.Transport=P(y.Transport,C,D));var F;if(y.Transport)for(F=0;F<y.Transport.length;F++)y.Transport[F].hash=p(y.Transport[F],q);o.statistics=y,y.Transport&&(A=W(y.Transport,j)),A&&Kc(k,db.fabricTransportSwitch,f),j.pcState===ob.disrupted&&_(o);var G=N(j,y,q,m,f,i);if(y.Transport&&(G.Transport=H(j,y.Transport,q,m)),y.bwe&&(G.bwe=y.bwe),void 0===j.processedStatsTupleArray&&(j.processedStatsTupleArray=[]),qa){var I=Q(G);qa(I)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=g(),G.batteryStatus.isBatteryCharging=h(),G=O(G),j.processedStatsTupleArray.push(G),o.processedStatistics=j.processedStatsTupleArray,j.lastStatsSent=o;var J=ka(o),K=ka(o);delete J.processedStatistics,delete K.statistics,B&&Pb(db.ssrcMap,e,f,i,Nb(j),j.pcHash),(j.lastProcessedStatsSentInterval>=Fa||j.initialPhaseOver)&&(j.processedStatsTupleArray=[],R(K,j,f,e,b,a),j.lastProcessedStatsSentInterval=0)}return l}function T(a){var b;return pb.hasOwnProperty(a)?a===pb.createOffer||a===pb.createAnswer||a===pb.setRemoteDescription?b=qb.negotiationFailure:a===pb.setLocalDescription?b=qb.sdpError:a===pb.addIceCandidate?b=qb.sdpError:a===pb.getUserMedia?b=qb.mediaConfigError:a===pb.iceConnectionFailure?b=qb.iceFailure:a===pb.signalingError?b=qb.signalingError:(a===pb.applicationLog||pb.applicationError)&&(b=qb.applicationLog):b=Hb.invalidWebRTCFunctionName,b}function U(a,b){var c={};return b===wb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inboundrtp"===a.type?"inbound":"outbound",c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===wb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.streamType="outbound":c.streamType="inbound",c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type?c.remoteCandidate=a:"VideoBwe"===a.type&&(c.bwe=a):b===wb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inbound-rtp"===a.type?"inbound":"outbound",c.data=a,c.reportType="local"):"transport"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a)),c}function V(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function W(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c&&(b>=0&&b<=2&&(l=V(b)),!0)};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}if(!m)return k;var o=b.transportData;return void 0!==o&&o.localAddr===c&&o.remoteAddr===d&&o.transportType===g||(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function X(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',c<e&&(b+=",")))}return b+="}"}function Y(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function Z(a){return{magicKey:a,statsSubmissionInterval:Ia,endpoint:Ta,localUserIDObject:Aa}}function $(a,b,c){var d=Ua[a];void 0===d&&(Ua[a]={},Ua[a].participants=null,c&&(Ua[a].userJoinedSent=!0),b&&(Ua[a].refreshPresence=b))}function _(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function aa(a){return clearInterval(a),null}function ba(){var a;for(a in Ua)Ua.hasOwnProperty(a)&&(Ua[a].refreshPresence=aa(Ua[a].refreshPresence),delete Ua[a].refreshPresence);ma()}function ca(a){var b=Ua[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function da(a,b){var c=Ua[a],d=[];if(void 0===c)d.push(b),Ua[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function ea(a){var b=!1;if(!Ua[a])return{conferenceFinished:b,ucID:null};var c=Ua[a].ucID;return 0===Ua[a].participants.length&&(aa(Ua[a].refreshPresence),ma(),Na.sendCachedEvents(Pa),delete Ua[a],b=!0),{conferenceFinished:b,ucID:c}}function fa(a,b){Pb(db.userLeft,null,a,b,null,null,null),Za=aa(Za),ma(),Ya=Kb,Kb=null}function ga(){var a,b=function(a){return setInterval(function(){Tb(a)},Ka)};for(a in Ua)Ua.hasOwnProperty(a)&&(Tb(a),Ua[a].refreshPresence=b(a));na()}function ha(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ia(a,b,c){var d=b.action;b.channel=a,Pa._isTokenValid(Pa.authToken,ya,za)?Xa&&zb.indexOf(d)===-1?(b.clockUnsynced=Xa,Na.cacheEvent({channel:a,data:b,callback:c})):(b.token=Pa.authToken,Sc(a,b,c),c&&c(gb.success,d+" sent to the backend.")):Pa.sendAuthenticationRequest(ya,za,function(e,f){e!==gb.success?(e===hb.authOngoing&&(b.clockUnsynced=Xa,Na.cacheEvent({channel:a,data:b,callback:c})),c&&e!==hb.authOngoing&&c(e,f)):e===gb.success&&"SDK authentication successful."===f&&(Xa&&zb.indexOf(d)===-1?(b.clockUnsynced=Xa,Na.cacheEvent({channel:a,data:b,callback:c})):(b.token=Pa.authToken,Sc(a,b,c),c&&c(gb.success,d+" sent to the backend.")))})}function ja(a){a&&a(hb.authOngoing,null)}function ka(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=ka(a[b]));return c}function la(){var a={};Object.keys(Ua).forEach(function(b){var c=Ua[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:!!Pa.tokenData,clockSync:!Xa,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:ua};b.wsStatus=Rc.getWSConnectionState(),Gb(ya,za,"stateMachine",b)}function ma(){$a||($a=setInterval(function(){la()},_a))}function na(){aa($a),$a=null}var oa,pa,qa,ra=a("./callstatsUtils"),sa="https://collector.callstats.io:443/",ta="https://auth.callstats.io/",ua="3.17.7",va="wss://collector.callstats.io:443/csiows/collectCallStats",wa="https://dashboard.callstats.io/apps/",xa="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",ya=null,za=null,Aa=null,Ba=null,Ca=!1,Da=!1,Ea=3e4,Fa=1e4,Ga=1e4,Ha=2e4,Ia=15e3,Ja=!1,Ka=1e4,La=5e3,Ma=function(){function a(a,b){setTimeout(function(){var b=d(),c=b-a.data.apiTS;a.data.timeShift=c,ia(a.channel,a.data,a.callback)},b)}var b=[];this.sendCachedEvents=function(c,e,f,g,h,i){if(!c.authToken)return void c.sendAuthenticationRequest(ya,za);if(!e){var j,k,l,m,n=d(),o=[],p=Math.max(Ia/b.length,ab);for(j=0;j<b.length;j++)if(l=b[j],l.data.action!==db.userJoined){if(l.data.token=c.authToken,f&&l.data.apiTS>=n-g||!l.data.ucID)if(m=decodeURIComponent(l.data.conferenceID),Ua[m]&&Ua[m].ucID)l.data.ucID=Ua[m].ucID;else{if(m!==h){o.push(b[j]);continue}l.data.ucID=i}if(l.data.clockUnsynced&&(l.data.apiTS+=Wa.currentOffset),l.channel===eb.processedStats&&l.data.clockUnsynced&&l.data.processedStatistics&&l.data.processedStatistics.length>0)for(k=0;k<l.data.processedStatistics.length;k++)l.data.processedStatistics[k].apiTS+=Wa.currentOffset;delete l.data.clockUnsynced,a(l,p*(j+1))}else o.push(b[j]);b=o}},this.sendCachedUserJoinedEvents=function(c){if(!c.authToken)return void c.sendAuthenticationRequest(ya,za);var d,e,f=[],g=Math.max(Ia/b.length,ab);for(d=0;d<b.length;d++)e=b[d],e.data.action===db.userJoined||e.data.action===cb.fabricSetupFailed?(e.data.token=c.authToken,e.data.clockUnsynced&&(e.data.apiTS=e.data.apiTS+Wa.currentOffset),e.data.value&&(e.data.value.statsSubmissionInterval=Ia),a(e,g*(d+1))):f.push(b[d]);b=f},this.cacheEvent=function(a){b.push(a)},this.sendCachedFeedback=function(){var a=Bb("feedback"),b=JSON.parse(Bb("csio_auth_data"));if(a&&b){var c=JSON.parse(a),d=b===c.token;d||za!==c.userID||(c.token=b,d=!0),d?ia(eb.userFeedback,c):Cb("feedback")}}},Na=new Ma,Oa=function(){var a=this,b="urn:x-callstats:auth:errorActions",c=.9,e=3600;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var f=null,g=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};m.cryptotype=null,window.crypto&&window.crypto.subtle?(m.cryptotype="standard",m.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(m.cryptotype="webkit",m.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(m.cryptotype="ie",m.subtlecrypto=window.msCrypto.subtle):(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));for(var e=k(a)+"."+k(b),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);var i=function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;g<f;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)},j=function(a){return d(a)},l={name:"HMAC"};"ie"!==m.cryptotype&&"webkit"!==m.cryptotype||(l.hash={name:"sha-256"});var n=m.subtlecrypto.sign(l,c,g);"ie"===m.cryptotype?(n.onerror=j,n.oncomplete=function(a){i(a.target.result)}):n.then(i).catch(j)},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(a){return null}},m.importKey=function(a,b,c){if("webkit"===m.cryptotype)for(;a.length<32;)a+="\0";var d={kty:"oct",k:k(a),alg:"HS256"},e={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===m.cryptotype?d.extractable=!1:d.ext=!1,"webkit"===m.cryptotype&&(e=null,d.use="sig"),"ie"===m.cryptotype||"webkit"===m.cryptotype){var f=JSON.stringify(d);d=new Uint8Array(f.length);for(var g=0;g<f.length;g++)d[g]=f.charCodeAt(g)}var h=m.subtlecrypto.importKey("jwk",d,e,!1,["sign"]);"ie"===m.cryptotype?(h.onerror=c,h.oncomplete=function(a){b(a.target.result)}):h.then(b).catch(c)},this._isTokenValid=function(a,b,c){var e=!1;if(null===a)return!1;try{var f=m.decode(a);if(null!==f&&f.appID===b&&f.userID===encodeURIComponent(c)){var g=null;if(navigator.mozGetUserMedia){var h=f.expiry.split(" ").join("T");g=Date.parse(h)}else g=new Date(f.expiry);var i=new Date(d());i<g&&(e=!0)}return e}catch(a){}return!1},this.setupAuthToken=function(a){Ab("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),Ia=parseInt(this.tokenData.submissionInterval,10),Ja=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(d,e,g){if(d&&e){if(a.authInProgress)return void ja(g);null!==f&&(clearTimeout(f),f=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(gb.tokenGenerationError,i.toString()));var k=ta+"authenticate",l={client_id:e+"@"+ya,code:j,grant_type:"authorization_code"};Mc(k,l,function(i){var j=null;a.authInProgress=!1;try{j=JSON.parse(i.response)}catch(a){}if(!j)return void(f=setTimeout(a.sendAuthenticationRequest,La,d,e,g));if(200===i.status){if("bearer"!==j.token_type)return void(f=setTimeout(a.sendAuthenticationRequest,La,d,e,g));a.setupAuthToken(j.access_token);var k=parseInt(1e3*parseInt(j.expires_in)*c);o(k,d,e,g),h=!1,g&&g(gb.success,"SDK authentication successful."),Rc._isChannelReady()?(Na.sendCachedUserJoinedEvents(Pa),g&&g(gb.success,"WebSocket establishment successful.")):Rc._setupWebSocketConnection(function(a,b){void 0!==g&&g(a,b)})}else{if(j[b]&&j[b].length>0)return p(d,e,g,j[b]);f=setTimeout(a.sendAuthenticationRequest,La,d,e,g)}})})}};var n=function(){null!==g&&(clearTimeout(g),g=null)},o=function(b,c,d,e){n(),g=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===Ib.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===Ib.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===Ib.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var c=null,f=null,g=!1,h=null;b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]);var i=function(a){b=null,c=a},j=function(a){g=!0,b=null};return m.importKey(b,i,j),function(b,i){if(g)return i("appsecret based token generation failed");if(!b&&null!==f)return i(null,f);if(null===c)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:za,appID:ya,exp:parseInt(d()/1e3)+e,nbf:parseInt(d()/1e3)-e};h&&(j.keyID=h),m.sign({alg:"HS256"},j,c,function(a,b){return a?i(a):(f=b,i(null,b))})}}},Pa=new Oa,Qa=new ra,Ra=Qa.detectBrowserInfo(),Sa=Qa.measureAppLoadingPerformance(Ra),Ta={type:"browser",name:Ra.name,ver:Ra.ver,os:Ra.os,osVersion:Ra.osVersion,userAgent:Ra.userAgent},Ua={},Va={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4]},Wa={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Xa=!0,Ya=null,Za=null,$a=null,_a=2e4,ab=100,bb=null;"Firefox"===Ra.name?bb=mozRTCPeerConnection:"Chrome"===Ra.name||"Opera"===Ra.name?bb=webkitRTCPeerConnection:"Safari"===Ra.name||"Edge"===Ra.name&&(bb=window.RTCPeerConnection);var cb={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},db={autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",refreshPresence:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDevices:"connectedDevices"},eb={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},fb={success:"success",failure:"failure"},gb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},hb={authOngoing:"authOngoing"},ib={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},jb={local:"local",remote:"remote"},kb={excellent:5,good:4,fair:3,poor:2,bad:1},lb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},mb={excellent:3,fair:2,bad:1},nb={excellent:"excellent",fair:"fair",bad:"bad"},ob={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",checkingDisrupted:"checkingDisrupted"},pb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},qb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},rb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},sb={video:{gThreshold:.8,rThreshold:.3}},tb={video:{gThreshold:400,rThreshold:1e3}},ub={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},vb={audio:{gThreshold:240,rThreshold:400}},wb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},xb={unknown:"unknown",audio:"audio",video:"video"},yb={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},zb=[db.userJoined,db.refreshPresence,cb.fabricSetupFailed,cb.applicationErrorLog],Ab=function(a,b){try{window&&window.localStorage&&window.localStorage.setItem(a,b)}catch(a){return}},Bb=function(a){try{if(window&&window.localStorage)return window.localStorage.getItem(a)}catch(a){return null}return null},Cb=function(a){try{window&&window.localStorage&&window.localStorage.removeItem(a)}catch(a){return}},Db=function(){if(Ba=Bb("endpointID"),null===Ba){var a=c(),b=Math.random()*a;pc(b.toString(),function(a){Ba=a,Ab("endpointID",Ba)})}},Eb=function(a,b){var d=null,e=null,f=null,g=new XMLHttpRequest;g.timeout=5e3,g&&(g.open("GET",encodeURI(a)),d=c(),g.onload=function(){e=c(),f=e-d,b(g,f)},g.ontimeout=function(){Xa&&Oc()},g.send())},Fb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},Gb=function(a,b,c,d){var e=sa+"generics",f={appID:a,userID:encodeURIComponent(b),version:ua,eventType:c,data:d};Fb(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:ua,eventType:"error",message:a.message,pageURL:window.location.href};for(b in Ua)Ua.hasOwnProperty(b)&&(d.conferenceID=b,Gb(ya,za,"onErrorLog",d),c=!0);c||Gb(ya,za,"onErrorLog",d)}});var Hb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Ib={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Jb="fabricSetupFailed error reported by the developer",Kb=b(),Lb=function(a,b,e){var f=RegExp.prototype.test.bind(/^([a-z])=(.*)/),g=/^ssrc:(\d*) ([\w_]*):(.*)/,h=/^ssrc-group:SIM (\d*)/;b.split(/(\r\n|\r|\n)/).filter(f).forEach(function(b){var f=b[0],i=b.slice(2);if("a"===f){if(g.test(i)){var j=i.match(g),k=j[1];void 0===a.ssrcMap[k]&&(a.ssrcMap[k]={}),a.ssrcMap[k][j[2]]=j[3],a.ssrcMap[k].localStartTime=c(),a.ssrcMap[k].syncedStartTime=d(),a.ssrcMap[k].streamType=e}h.test(i)&&(void 0===a.ssrcMap.ssrcGroup&&(a.ssrcMap.ssrcGroup={},a.ssrcMap.ssrcGroup[e]={}),a.ssrcMap.ssrcGroup[e].simulcastGroup=i.match(/\d+/g))}})},Mb=function(a,b){return a.ssrcMap[b]},Nb=function(a){return a.ssrcMap},Ob=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Lb(d,g,lb.outbound),Lb(d,h,lb.inbound),Ja){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Qb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Pb=function(a,b,c,e,f,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=d(),j={version:ua,apiTS:i,action:a,localID:encodeURIComponent(za),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:ya,ucID:e,pcID:g,deviceID:Ba,value:f};return null===b&&(j.remoteID=null),null===c?void Gb(ya,za,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(e&&!Xa||a===db.userJoined||a===cb.fabricSetupFailed||a===db.refreshPresence?(j.token=Pa.authToken,ia(eb.callStatsEvent,j,h)):(j.clockUnsynced=Xa,a!==db.fabricStatsCaching&&a!==db.refreshPresence&&Na.cacheEvent({channel:eb.callStatsEvent,data:j,callback:h})))},Qb=function(a,b,c,e,f,g){var h=d(),i={version:ua,appID:ya,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(za),remoteID:encodeURIComponent(a),pcID:f,deviceID:Ba,sdpPayload:e};Pa.authToken&&c&&!Xa?(i.token=Pa.authToken,ia(eb.sdpSubmission,i,g)):(i.clockUnsynced=Xa,Na.cacheEvent({channel:eb.sdpSubmission,data:i,callback:g}),Pa.authToken||Pa.sendAuthenticationRequest(ya,za))},Rb=function(a,b,c,d){var e=bc(a);if(e){var f=e.conferenceID,g=e.fabric,h=g.remoteUserID,i=Ua[f],j={changedState:b,currPair:g.activeIceCandidatePair,prevState:c,newState:d};Pb(db.fabricStateChange,h,f,i.ucID,j,g.pcHash)}},Sb=function(a){var b={connectedDevices:oa},c=Ua[a]?Ua[a].ucID:null;Pb(db.connectedDevices,null,a,c,b,null)},Tb=function(a){var b={ucID:Ua[a].ucID,endpoint:Ta,magicKey:Kb};Pb(db.refreshPresence,null,a,Ua[a].ucID,b,null)},Ub=function(){var a={appID:ya,userID:encodeURIComponent(za),version:ua,endpoint:Ta,pagePerf:Sa,endpointID:Ba,action:"registerPresence",channel:eb.registerPresence};ya!==-1&&Pa.authToken&&(a.token=Pa.authToken,Sc(eb.registerPresence,"registerPresence",a))},Vb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Wb=function(a,b){var c,d,e,f=0;for(c=0,e=a.length;c<e;c++)d=a.charCodeAt(c),f=(f<<5)-f+d,f|=0;return b&&b(f),f},Xb=function(a,b,c,d,e,f){if(!a||!c||!b)return console.error("initialize: Argument missing/invalid"),Vb(fb.failure,"initialize: Argument missing/invalid");if("function"!=typeof b){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle))return d(gb.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Vb(fb.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");b=Pa.appSecretTokenGenerator(b)}if("string"==typeof a&&(a=parseInt(a,10)),ya=a,"object"==typeof c?(za=c.aliasName,Aa=c):za=c,Gb(ya,za,"log",{msg:"callstats initialize in progress"}),Pa.tokenGenerator=b,Bb("csio_auth_data"))try{var g=JSON.parse(Bb("csio_auth_data"));Pa._isTokenValid(g,ya,za)&&(d&&d(gb.success,"SDK authentication successful."),Pa.setupAuthToken(g),Rc._isChannelReady()||Rc._setupWebSocketConnection(d))}catch(a){}return f&&(f.disableBeforeUnloadHandler===!0&&(Ca=!0),null===f.applicationVersion&&void 0===f.applicationVersion||(Ta.appVer=f.applicationVersion)),k(),qa=e,Pa.sendAuthenticationRequest(ya,za,d),Vb(fb.success)},Yb=function(a){return function(b){if(b.remoteUserID===a)return!0}},Zb=function(a,b){var c=!1,d=null;return Ua[a]&&Ua[a].participants&&(d=Ua[a].participants.filter(Yb(b))),c=!!(d&&d.length>0)},$b=function(a){return function(b){return b.pc===a||!(!a.callstatsID||b.pcHash!==a.callstatsID)||void 0}},_b=function(a,b){var c=null,d=null;return Ua[a]&&Ua[a].participants&&(d=Ua[a].participants.filter($b(b))),c=d&&d.length>0?d[0]:null},ac=function(a,b){var c=null,d=null;return c=_b(a,b),c&&(d=c.pcHash),d},bc=function(a){var b=null,c=null,d=null;for(b in Ua)if(Ua.hasOwnProperty(b)&&(d=_b(b,a))){c={fabric:d,conferenceID:b};break}return c},cc=function(a,b){var c=0;if(a&&Ua[b].participants)for(c=0;c<Ua[b].participants.length;c++)if(Ua[b].participants[c].pcHash===a.pcHash){Ua[b].participants.splice(c,1);break}},dc=function(a){var b=Ra.codebase,c=null,d=0;if(b===wb.firefox&&"Safari"!==Ra.name)c=[],a.forEach(function(a){c.push(a)});else if(b===wb.chrome&&"Safari"!==Ra.name)a&&(c=a.result());else{c=[];for(d in a)a.hasOwnProperty(d)&&c.push(a[d])}return c},ec=function(a){var b=null,c=null,d=null,e=[],f=[],g=[],h=0,i=Ra.codebase;if(b=dc(a),!b)return{localCandidates:e,remoteCandidates:f};for(h=0;h<b.length;++h)c=X(b[h]),d=U(JSON.parse(c),i),d.localCandidate?e.push(d.localCandidate):d.remoteCandidate?f.push(d.remoteCandidate):d.Transport&&g.push(d.Transport);return{localCandidates:e,remoteCandidates:f,iceCandidatePairs:g}},fc=function(a){function b(b){var c={};c=ec(b),a(c)}return b},gc=function(a,b,c,d,e,f,g,h){var i=Ra.codebase,j=Ra.name;i===wb.firefox||"Safari"===j?a.getStats(null,c(b,d,e,f,g,h,a),function(a){Gb(ya,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})}):i===wb.chrome?a.getStats(c(b,d,e,f,g,h,a)):i===wb.edge&&a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(a){Gb(ya,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})})},hc=function(a,b){gc(a,b,fc)},ic=function(a,b,d,e){if(!a||!b||!d)return console.error("sendFabricEvent: Arguments missing/Invalid"),Vb(fb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!ya||!za||!Ua[d])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Vb(fb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===cb.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Vb(fb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!o(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Vb(fb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!cb.hasOwnProperty(b)&&!db.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Vb(fb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var f={},g=null,h=c(),i=Ua[d],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Vb(fb.failure,"sendFabricEvent: Conference ID not found!");if(j=_b(d,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Vb(fb.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(b===cb.fabricSetupFailed){var l=h-k;f={failureDelay:l,reason:qb.iceFailure,domError:Jb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,function:pb.iceConnectionFailure,magicKey:Kb,endpoint:Ta}}else if(b===cb.activeDeviceList){if(!e||!e.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Vb(fb.failure,"sendFabricEvent: Arguments missing/Invalid");f={magicKey:Kb,endpoint:Ta,activeDevicelist:e.deviceList}}if(Pb(b,g,d,i.ucID,f,j.pcHash,j.pcCallback),(b===cb.fabricTerminated||b===db.autoFabricSetupFailed||b===cb.fabricSetupFailed)&&Ua[d].participants){j&&(j.statsInterval=aa(j.statsInterval),cc(j,d));var m=ea(d);m.conferenceFinished&&fa(d,m.ucID)}return Vb(fb.success)},jc=function(a){return a.length>Ha&&(console.log("Log exceeds 20kb, It will be truncated"),a=a.substring(0,Ha)),a},kc=function(a){return a&&"string"==typeof a?a=jc(a):a&&"object"==typeof a&&a.message&&(a.message=jc(a.message)),a},lc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},mc=function(a,d,e,f,g,h){if(void 0===a||!e||!d)return console.error("reportError: Arguments missing/invalid"),Vb(fb.error,"reportError: Arguments missing/invalid");if(!ya||!za)return console.error("reportError: SDK is not initialized"),Vb(fb.error,"reportError: SDK is not initialized");if(!pb.hasOwnProperty(e))return console.error("reportError: Invalid webRTC functionName value: %o",e),Vb(fb.error,"reportError: Invalid webRTC functionName value: "+e);void 0===f&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=c(),m=Ua[d],n=null;if(i=T(e),f&&f instanceof DOMException)f={message:f.message,name:f.name};else if(f&&"object"==typeof f){var p={};f.message&&(p.message=f.message),f.name&&(p.name=f.name),f.constraintName&&(p.constraintName=f.constraintName),f.stack&&(p.stack=f.stack),f=p}if(f=kc(f),o(a)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Vb(fb.error,"reportError: Conference ID not found!");if(n=_b(d,a),null===n)return console.error("reportError: Invalid pcObject passed as argument"),Vb(fb.error,"reportError: Invalid pcObject passed as argument");k=n.remoteUserID;var q=n.startTime,r=l-q;if(j={failureDelay:r,reason:i,domError:f,fabricState:n.pcState,iceConnectionState:n.pc.iceConnectionState,function:e,magicKey:Kb,endpoint:Ta},e===pb.applicationLog||e===pb.applicationError?Pb(cb.applicationErrorLog,k,d,m.ucID,j,n.pcHash,n.pcCallback):Pb(cb.fabricSetupFailed,k,d,m.ucID,j,n.pcHash,n.pcCallback),g||h||a&&a.localDescription||a&&a.remoteDescription){var s={sdp:{}};s.sdp.localSDP=lc(a,g,"localDescription"),s.sdp.remoteSDP=lc(a,h,"remoteDescription"),Qb(k,d,m.ucID,s,n.pcHash)}}else{null===Kb&&(Kb=b());var t=null;e!==pb.getUserMedia&&(t=b()),j={failureDelay:0,reason:i,domError:f,function:e,magicKey:Kb,endpoint:Ta},e===pb.applicationLog||e===pb.applicationError?Pb(cb.applicationErrorLog,k,d,null,j,null,null):Pb(cb.fabricSetupFailed,k,d,null,j,t,null)}return Vb(fb.success)},nc=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b[b.length]=d:d>127&&d<2048?(b[b.length]=d>>6|192,b[b.length]=63&d|128):(b[b.length]=d>>12|224,b[b.length]=d>>6&63|128,b[b.length]=63&d|128)}return new Uint8Array(b).buffer},oc=function(a){for(var b,c=new DataView(a),d="",e=0;e<c.byteLength;e++)b=c.getUint8(e).toString(16),b.length<2&&(b="0"+b),d+=b;return d},pc=function(a,b){var c={name:"SHA-256"};if(window.crypto){var d=window.crypto.subtle||window.crypto.webkitSubtle;if(!d)return void Wb(a,b);d.digest(c,nc(a)).then(function(a){b(oc(a))}).catch(function(){Wb(a,b)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Wb(a,b);var e=window.msCrypto.subtle.digest(c,nc(a));e.oncomplete=function(a){a.target&&b(oc(a.target.result))},e.onerror=function(){Wb(a,b)}}else Wb(a,b)},qc=function(a,b,c){var d;if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Vb(fb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Vb(fb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Vb(fb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Vb(fb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var e=Ua[a],f=null;void 0!==e&&void 0!==e.ucID&&(f=e.ucID);var g=null;
if(g=null===Kb?Ya:Kb,null===f&&(f=ha(a)),null===f)return console.error("sendUserFeedback: ucID unavailable"),Vb(fb.error,"sendUserFeedback: ucID unavailable");d="object"==typeof b.userID?b.userID.aliasName:b.userID;var h={conferenceID:encodeURIComponent(a),magicKey:g,appID:ya,version:ua,ucID:f,userID:encodeURIComponent(d),userQoe:{overall:b.overall}};return b.video?h.userQoe.video=b.video:h.userQoe.video=-1,b.audio?h.userQoe.audio=b.audio:h.userQoe.audio=-1,b.screen?h.userQoe.screen=b.screen:h.userQoe.screen=-1,b.comment?h.userQoe.comment=b.comment:h.userQoe.comment=-1,Pa.authToken&&!Xa?(h.token=Pa.authToken,Ab("feedback",JSON.stringify(h)),ia(eb.userFeedback,h,c)):(h.clockUnsynced=Xa,Na.cacheEvent({channel:eb.userFeedback,data:h,callback:c}),Pa.sendAuthenticationRequest(ya,d)),Vb(fb.success)},rc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Vb(fb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Vb(fb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!o(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Vb(fb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=Ua[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Vb(fb.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=_b(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Vb(fb.error,"associateMstWithUserID: Unknown pcObject passed");var j=Mb(i,d);return void 0===j&&(i.ssrcMap[d]={},j=Mb(i,d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==za&&n(g,c,f,a,d),Vb(fb.success)},sc=function(a,d,e,f,g){var h=null,i={authStatus:!!Pa.tokenData,clockSync:!Xa,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:f,version:ua};if(Gb(ya,za,"stateMachine",i),h="object"==typeof d?d.aliasName:d,!(a&&h&&e&&f))return console.error("addNewFabric: Arguments missing/Invalid"),Vb(fb.error,"addNewFabric: Arguments missing/Invalid");if(!ya||!za)return console.error("addNewFabric: SDK not initialized."),Vb(fb.error,"addNewFabric: SDK not initialized");if(""===f||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Vb(fb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!o(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Vb(fb.error,"addNewFabric: Invalid PeerConnection object passed");if(!ib.hasOwnProperty(e)||e instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Vb(fb.error,"addNewFabric: Invalid fabricUsage value");var k=c();null===Kb&&(Kb=b());var l=null,m=!1;if(!ca(f)){var n=Z(Kb);Pb(db.userJoined,null,f,null,n,null,null),m=!0,i={authStatus:!!Pa.tokenData,clockSync:!Xa,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:f,version:ua},Gb(ya,za,"stateMachine",i)}if($(f,l,m),!_b(f,a)){a&&a.addEventListener&&(a.addEventListener("icecandidate",Gc,!1),a.addEventListener("iceconnectionstatechange",Fc,!1),a.addEventListener("signalingstatechange",vc,!1),a.addEventListener("negotiationneeded",Ec,!1));var p=b(),q={pc:a,remoteUserID:h,fabricUsage:e,magicKey:Kb,startTime:k,pcCallback:g,pcState:ob.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:k,pcHash:p,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0,currentActivePhaseIndex:0,ssrcMap:{}};"function"!=typeof a||a.callstatsID||(a.callstatsID=p),"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState||(q.pcState=ob.established),da(f,q),q.pcState===ob.established&&(Jc(a,db.autoFabricSetup,f),wc(q,a,f,h))}return j(f),Vb(fb.success)},tc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Vb(fb.error,"reportUserIDChange: Arguments missing/Invalid");if(!ya||!za)return console.error("reportUserIDChange: SDK not initialized."),Vb(fb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Vb(fb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!o(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Vb(fb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=Ua[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Vb(fb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),Gb(ya,za,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Vb(fb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=_b(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Vb(fb.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Pb(cb.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Vb(fb.success)},uc=function(a){var b=null;if(a&&a.length>0){var c=a.filter(function(a){return"true"===a.selected||"true"===a.googActiveConnection});c.length>0&&(b=c[0])}return b},vc=function(a){if(a){var b,c,d=Ra.codebase,e=null;if(d===wb.firefox)b=a.target;else if(d===wb.chrome)b=a.srcElement;else{if(d!==wb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var f=b.signalingState;e=bc(b),e&&e.fabric&&("closed"===f&&ic(b,cb.fabricTerminated,e.conferenceID),c=e.fabric.signalingState,e.fabric.signalingState=f),Rb(b,yb.signalingState,c,f)}}},wc=function(a,b,d,e){null===a.statsInterval&&(a.statsPollingStart=c(),Ic(b,d,e),a.statsInterval=setInterval(Ic,Va.statsSubmissionIntervalInMS[a.currentActivePhaseIndex],b,d,e))},xc=function(a,b,c,d,e,f){hc(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=uc(b.iceCandidatePairs),f.localCandidates=b.localCandidates,Pb(db.iceFailed,c,d,e,f,b.pcHash,b.pcCallback)})},yc=function(a,b,c,d){var e=b.iceConnectionState,f=b.remoteUserID,g=Ua[c],h={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState,currPair:b.activeIceCandidatePair,failureDelay:d};b.pcState=ob.failed,"checking"===e?xc(a,b,f,c,g.ucID,h):"completed"===e||"connected"===e?Pb(db.fabricDropped,f,c,g.ucID,h,b.pcHash,b.pcCallback):"disconnected"===e&&b.established?Pb(db.fabricDropped,f,c,g.ucID,h,b.pcHash,b.pcCallback):"disconnected"===e&&xc(a,b,f,c,g.ucID,h)},zc=function(a,b,d,e){var f=b.iceConnectionState,g=b.remoteUserID,h=Ua[d],i=c(),j={prevIceConnectionState:f,currIceConnectionState:a.iceConnectionState,prevPair:b.activeIceCandidatePair},k=b.pcState===ob.disrupted;b.connectivityIceStatusDelay=e,b.established=!0,hc(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=uc(b.iceCandidatePairs),j.currPair=b.activeIceCandidatePair,j.disruptionDelay=i-b.disruptedTS,k&&Pb(db.iceDisruptionEnd,g,d,h.ucID,j,b.pcHash,b.pcCallback)}),Jc(b.pc,db.autoFabricSetup,d),b.pcState=ob.established,wc(b,a,d,g)},Ac=function(a,b,d){var e=b.iceConnectionState,f=b.remoteUserID,g=Ua[d],h=c(),i={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState,prevIceConnectionStateTs:b.iceConnectionStateTS,currPair:b.activeIceCandidatePair};b.startTime=h,"connected"===e||"completed"===e?(b.pcState=ob.disrupted,b.disruptedTS=h,Pb(db.iceDisruptionStart,f,d,g.ucID,i,b.pcHash,b.pcCallback),b.pcCallback&&b.pcCallback(gb.appConnectivityError,"Connectivity check for PC object to "+f+" failed.")):"checking"===e&&(b.pcState=ob.checkingDisrupted,b.disruptedTS=h,Pb(db.iceConnectionDisruptionStart,f,d,g.ucID,i,b.pcHash,b.pcCallback),b.pcCallback&&b.pcCallback(gb.appConnectivityError,"Connectivity check for PC object to "+f+" failed."))},Bc=function(a,b,c,d){var e=b.iceConnectionState,f=b.remoteUserID,g=Ua[c],h={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState};"new"===e||"checking"===e?(h.failureDelay=d,Pb(db.iceAborted,f,c,g.ucID,h,b.pcHash,b.pcCallback)):(h.currPair=b.activeIceCandidatePair,Pb(db.iceTerminated,f,c,g.ucID,h,b.pcHash,b.pcCallback))},Cc=function(a,b,c){var d=b.iceConnectionState,e=b.remoteUserID,f=Ua[c],g={prevIceConnectionState:d,currIceConnectionState:a.iceConnectionState,prevPair:b.activeIceCandidatePair};"new"!==d&&(b.established=!1,Pb(db.iceRestarted,e,c,f.ucID,g,b.pcHash,b.pcCallback))},Dc=function(a,b,d,e){var f=b.iceConnectionState,g=b.remoteUserID,h=Ua[d],i=c(),j={prevIceConnectionState:f,currIceConnectionState:a.iceConnectionState};b.gatheringIceCandidatesDelay=e,"disconnected"===f&&b.pcState===ob.checkingDisrupted&&(j.disruptionDelay=i-b.disruptedTS,Pb(db.iceConnectionDisruptionEnd,g,d,h.ucID,j,b.pcHash,b.pcCallback))},Ec=function(a){if(a){var b,c=Ra.codebase;if(c===wb.firefox)b=a.target;else if(c===wb.chrome)b=a.srcElement;else{if(c!==wb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=bc(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},Fc=function(a){if(a){var b,d=Ra.codebase;if(d===wb.firefox)b=a.target;else if(d===wb.chrome)b=a.srcElement;else{if(d!==wb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var e,f,g,h,i,j=null,k=null;k=bc(b),k&&k.fabric&&(j=k.fabric,e=k.conferenceID,f=c(),g=f-j.startTime,h=j.iceConnectionState,i=j.iceGatheringState,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&Dc(b,j,e,g),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?zc(b,j,e,g):"failed"===b.iceConnectionState?yc(b,j,e,g):"disconnected"===b.iceConnectionState?Ac(b,j,e):"closed"===b.iceConnectionState?Bc(b,j,e,g):"new"===b.iceConnectionState&&Cc(),j.iceConnectionState=b.iceConnectionState,j.iceGatheringState=b.iceGatheringState,j.iceConnectionStateTS=c()),i!==b.iceGatheringState&&Rb(b,yb.iceGatheringState,i,b.iceGatheringState),Rb(b,yb.iceConnectionState,h,b.iceConnectionState)}}},Gc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=c[4].indexOf(":")!==-1,b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Ra.codebase;if(h===wb.firefox)g=a.target;else if(h===wb.chrome)g=a.srcElement;else{if(h!==wb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=bc(g),i&&i.fabric&&void 0!==b&&i.fabric.iceCandidates.indexOf(b)===-1&&i.fabric.iceCandidates.push(b)}},Hc=function(a){var b,c=5e3;return Da?(b=Ea,a.intervalAdaptionPhase=!1,Da=!1):a.currentActivePhaseIndex<Va.statsSubmissionIntervalInMS.length-1?(a.currentActivePhaseIndex+=1,b=Va.statsSubmissionIntervalInMS[a.currentActivePhaseIndex],b>Ia&&(b=Ia,a.intervalAdaptionPhase=!1,a.initialPhaseOver=!0)):(b=Ia,a.intervalAdaptionPhase=!1),b>c&&(a.initialPhaseOver=!0),b},Ic=function(a,b,d){if(!Ua.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!Zb(b,d))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",d);if("closed"===a.signalingState)return ic(a,cb.fabricTerminated,b),!0;var e=_b(b,a);if(e.pcState!==ob.established&&e.lastFabricState===e.pcState&&"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState)return!0;var f=Ua[b].ucID;gc(a,e.pcCallback,S,za,d,b,f,e);var g,h=c(),i=h-e.statsPollingStart;(i>Va.statsSubmissionPhaseDurationInMS[e.currentActivePhaseIndex]&&e.intervalAdaptionPhase||Da===!0)&&(aa(e.statsInterval),g=Hc(e),e.statsInterval=setInterval(Ic,g,a,b,d))},Jc=function(a,b,d){var e,f=null,g=Ua[d],h=null,i=c();if(void 0===g&&console.error("sendAutoFabricSetupEvent: Conference ID not found!"),h=_b(d,a),null===h&&console.error("sendAutoFabricSetupEvent: fabricData is null"),!h.fabricSetupSent){f=h.remoteUserID,e=i-h.startTime;var j={setupDelay:e,iceGatheringDelay:h.gatheringIceCandidatesDelay,iceConnectivityDelay:h.connectivityIceStatusDelay};Xa||(j.clockSyncOffset=Wa.currentOffset),hc(a,function(a){j.localCandidates=a.localCandidates,j.remoteCandidates=a.remoteCandidates,j.iceCandidatePairs=a.iceCandidatePairs,h.localCandidates=a.localCandidates,h.remoteCandidates=a.remoteCandidates,h.iceCandidatePairs=a.iceCandidatePairs,h.pcState=ob.established,h.fabricSetupSent=!0,h.activeIceCandidatePair=uc(h.iceCandidatePairs),Pb(b,f,d,g.ucID,j,h.pcHash,h.pcCallback)})}},Kc=function(a,b,c){var d={},e=null,f=Ua[c],g=null;void 0===f&&console.error("sendFabricTransportSwitchEvent: Conference ID not found!"),g=_b(c,a),null===g&&console.error("sendFabricTransportSwitchEvent: fabricData is null"),e=g.remoteUserID,d.prevPair=g.activeIceCandidatePair,hc(a,function(a){d.currPair=uc(a.iceCandidatePairs),g.activeIceCandidatePair=d.currPair,d.switchDelay=null,d.relayType=g.transportData.relayType,Pb(b,e,c,f.ucID,d,g.pcHash,g.pcCallback)})},Lc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},Mc=function(a,b,c){var d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));var f=d.join("&"),g=new XMLHttpRequest;g.open("POST",a),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.onload=function(){c(g)},g.send(f)},Nc=function(){Eb(xa,function(a){if(200===a.status)try{var b=JSON.parse(a.responseText);Lc("eModelThreshold",b,vb),Lc("throughputThreshold",b,rb),Lc("fractionalLossThreshold",b,ub),Lc("rttThreshold",b,tb),Lc("currOverPrevFrameRateThreshold",b,sb)}catch(a){return a}})},Oc=function(){var a=sa+"clockSync",b=null,d=null;Eb(a,function(a,e){200===a.status?(b=JSON.parse(a.response),d=c(),Pc(b,e,d)):Xa&&setTimeout(function(){Oc()},100)})},Pc=function(a,b,c){if(Xa){var d=b/2;if(d>Wa.maxAllowedLatency)Wa.offsetResults=[],Gb(ya,za,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Wa.offsetResults.push(f)}if(Wa.offsetResults.length>=Wa.syncAttempts){var g=Wa.offsetResults.reduce(function(a,b){return a+b});Wa.currentOffset=g/Wa.offsetResults.length,Wa.offsetResults=[],Xa=!1,Gb(ya,za,"log",{msg:"clockSync Done"}),Na.sendCachedUserJoinedEvents(Pa),Na.sendCachedEvents(Pa,Xa)}else Xa&&setTimeout(function(){Oc()},100)}},Qc=function(){var a=this,b=null,d=!1,e=!1,f={},g={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=g.closed;var h=function(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),f[a]=wa+ya+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"};this.getConferenceURL=function(){return f},this._setupWebSocketConnection=function(f){return a._wsConnectionState===g.initiated||a._wsConnectionState===g.connected?(Gb(ya,za,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),void(f&&f(gb.success,"WebSocket establishment successful."))):(a._wsConnectionState=g.initiated,b=new WebSocket(va,"echo-protocol"),b.onopen=function(){Gb(ya,za,"log",{msg:"Successfully connected to the backend"}),a._wsConnectionState=g.connected,d?e=!0:d=!0,Wa.syncHandler||(Gb(ya,za,"log",{msg:"start clockSync"}),Wa.offsetResults=[],Oc(),Wa.syncHandler=!0),Na.sendCachedUserJoinedEvents(Pa),e?(ga(),Na.sendCachedEvents(Pa)):Ub(),e=!1},b.onclose=function(){a._wsConnectionState=g.closed,Gb(ya,za,"log",{msg:"Connection to the server closed."}),ba(),Xa&&(Wa.offsetResults=[],Wa.syncHandler=null,Xa=!1),b&&(b=null),f&&f(gb.httpError,"Connection to the server closed.")},b.onerror=function(b){a._wsConnectionState=g.closed,Gb(ya,za,"log",{msg:"WebSocket establishment failed."}),f&&f(gb.wsChannelFailure,"WebSocket establishment failed.",b)},void(b.onmessage=function(a){var b,d=a.data,e=c(),g=JSON.parse(d);if("Error"===g.status)"Invalid client token."===g.reason&&(Pa.tokenData=null,Pa.authToken=null,Pa.sendAuthenticationRequest(ya,za)),f&&f(gb.csProtoError,d.reason);else if("200 OK"===g.status)if("feedback"===g.event)Cb("feedback");else if(g.event===db.userJoined||g.event===db.refreshPresence){var i=!1,j=null;b=decodeURIComponent(g.conferenceID);var k=function(a){return setInterval(function(){Tb(a)},Ka)};Ua.hasOwnProperty(b)&&(Ua[b].ucID!==g.ucID&&(i=!0,h(b,g.ucID),j=g.conferenceCreationTS?g.conferenceCreationTS:g.conferenceDuration),g.event!==db.userJoined||Ua[b].refreshPresence||(Ua[b].refreshPresence=k(b),na()),Ua[b].ucID=g.ucID),Na.sendCachedFeedback(),Na.sendCachedEvents(Pa,Xa,i,j,b,g.ucID)}else g.event===eb.clockSync?Pc(g,e):g.event===cb.fabricSetupFailed&&(b=decodeURIComponent(g.conferenceID),g.ucID&&(h(b,g.ucID),Na.sendCachedFeedback(),Na.sendCachedEvents(Pa,Xa,!0,0,b,g.ucID)))}))},this._isChannelReady=function(){return!(!b||1!==b.readyState)},this.getWSConnectionState=function(){return b?b.readyState:-1},this.send=function(a){b.send(JSON.stringify(a))}},Rc=new Qc,Sc=function(a,b,c){if(Rc._isChannelReady())try{Rc.send(b)}catch(d){d&&"InvalidStateError"===d.name&&Na.cacheEvent({channel:a,data:b,callback:c})}else Na.cacheEvent({channel:a,data:b,callback:c}),Rc._setupWebSocketConnection()};return f(),Nc(),Oc(),ma(),Db(),{version:ua,initialize:Xb,fabricEvent:cb,addNewFabric:sc,sendFabricEvent:ic,sendUserFeedback:qc,associateMstWithUserID:rc,csError:gb,fabricUsage:ib,qualityRating:kb,webRTCFunctions:pb,reportError:mc,reportUserIDChange:tc,userIDType:jb,callStatsAPIReturnStatus:fb}}"function"==typeof define&&define.amd?define("callstats",[],c):b.callstats=c}("undefined"!=typeof window?window:"undefined"!=typeof b?b:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./callstatsUtils":2}],2:[function(a,b,c){"use strict";function d(){}d.prototype.measureAppLoadingPerformance=function(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0},d.prototype.detectBrowserInfo=function(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};(a=c.indexOf("Opera"))!==-1?(d="Opera",f=c.substring(a+6),(a=c.indexOf("Version"))!==-1&&(f=c.substring(a+8)),b=g.goog):(a=c.indexOf("OPR"))!==-1?(d="Opera",f=c.substring(a+4),(a=c.indexOf("Version"))!==-1&&(f=c.substring(a+8)),b=g.goog):(a=c.indexOf("MSIE"))!==-1?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):(a=c.indexOf("Edge"))!==-1?(d=g.edge,f=c.substring(a+5),b=g.edge):(a=c.indexOf("Chrome"))!==-1?(d=g.goog,f=c.substring(a+7),b=g.goog):(a=c.indexOf("Safari"))!==-1?(d="Safari",f=c.substring(a+7),(a=c.indexOf("Version"))!==-1&&(f=c.substring(a+8)),b=g.goog):(a=c.indexOf("Firefox"))!==-1?(d="Firefox",f=c.substring(a+8),b=g.moz):(a=c.indexOf("Trident"))!==-1&&(d="Microsoft Internet Explorer",a=c.indexOf("rv"),f=c.substring(a+3,a+7),b=g.goog);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j,osVersion:l,codebase:b,userAgent:c}},b.exports=d},{}]},{},[1]);var T1=500,T2=4e3,T4=5e3,Timers={T1:T1,T2:T2,T4:T4,TIMER_B:64*T1,TIMER_D:0*T1,TIMER_F:64*T1,TIMER_H:64*T1,TIMER_I:0*T1,TIMER_J:0*T1,TIMER_K:0*T4,TIMER_L:64*T1,TIMER_M:64*T1,PROVISIONAL_RESPONSE_INTERVAL:6e4},voxbone=voxbone||{};extend(voxbone,{Request:{param:function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length>0&&(b+="&"),b+=c+"="+encodeURIComponent(a[c]));return b},post:function(a,b,c){var d=new XMLHttpRequest,e=this.param(b);d.open("POST",a),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),d.onload=function(){"function"==typeof c&&c({status:d.status,message:d.responseText})},d.send(e)},jsonp:function(a,b){var c=a+(a.indexOf("?")+1?"&":"?"),d=document.getElementsByTagName("head")[0],e=document.createElement("script");c+=this.param(b),e.type="text/javascript",e.src=c,this.currentScript&&d.removeChild(currentScript),d.appendChild(e)}}}),JsSIP.C.SESSION_EXPIRES=3600,JsSIP.debug.enable("JsSIP:*"),JsSIP.debug.log=function(){var a=arguments[0].indexOf("ERROR")===-1?JsSIP.VoxboneLogger.loginfo:JsSIP.VoxboneLogger.logerror;return a.apply(this,arguments)},JsSIP.VoxboneLogger={loginfo:function(){var a=Array.prototype.slice.call(arguments);info.apply(console,a)},logerror:function(){var a=Array.prototype.slice.call(arguments);error.apply(console,a)},setError:function(a){error=a},setInfo:function(a){info=a}},JsSIP.VoxboneLogger.setInfo(function(){var a=Array.prototype.slice.call(arguments);voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.INFO&&console.log.apply(console,a),5==a.length?(voxbone.Logger.addLogToBuffer("INFO: "+a[0]),voxbone.Logger.addLogToBuffer("INFO: "+a[3])):voxbone.Logger.addLogToBuffer("INFO: "+a[0])}),JsSIP.VoxboneLogger.setError=function(){var a=Array.prototype.slice.call(arguments);voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.ERROR&&console.error.apply(console,a),5==a.length?(voxbone.Logger.addLogToBuffer("ERROR: "+a[0]),voxbone.Logger.addLogToBuffer("ERROR: "+a[3])):voxbone.Logger.addLogToBuffer("ERROR: "+a[0])},extend(voxbone,{Logger:{loginfo:function(a){voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.INFO&&console.log(a),voxbone.Logger.addLogToBuffer("INFO: "+a)},logerror:function(a){voxbone.WebRTC.configuration.log_level>=voxbone.Logger.log_level.ERROR&&console.log(a),voxbone.Logger.addLogToBuffer("ERROR: "+a)},addLogToBuffer:function(a){voxbone.WebRTC.webrtcLogs=voxbone.WebRTC.webrtcLogs.concat("\r\n"),voxbone.WebRTC.webrtcLogs=voxbone.WebRTC.webrtcLogs.concat(a)},log_level:{NONE:0,ERROR:1,INFO:2}}}),extend(voxbone,{Pinger:{pingResults:[],ping:function(a,b){var c=(new Date).getTime(),d=this,e=this.recordPingResult;this.img=new Image,d.inUse=!0,this.img.onload=function(){var b=(new Date).getTime()-c;e(a,b),d.inUse=!1},this.img.onerror=function(b){d.inUse=!1,e(a,-1)},this.img.src=b+"?"+(new Date).getTime(),this.timer=setTimeout(function(){d.inUse&&(d.inUse=!1,e(a,-1))},1500)},recordPingResult:function(a,b){voxbone.Logger.loginfo("[ping] "+a+" replied in "+b);var c={name:a,ping:b};voxbone.Pinger.pingResults.push(c)},getBestPop:function(){var a;if(0===this.pingResults.length)a={name:"BE",ping:-1};else for(var b=0;b<this.pingResults.length;b++){var c=this.pingResults[b];(void 0===a||c.ping>0&&(a.ping<0||c.ping<a.ping))&&(a=c)}return a}}}),extend(voxbone,{WebRTC:{callStats:void 0,audioComponentName:"peer-audio",videoComponentName:"peer-video",allowVideo:!1,authServerURL:"https://webrtc.voxbone.com/rest/authentication/createToken",basicAuthServerURL:"https://webrtc.voxbone.com/rest/authentication/basicToken",webrtcLogs:"",rtcSession:{},callid:"",previous_callid:"",audioContext:void 0,localVolume:0,localVolumeTimer:void 0,dtmfTimer:void 0,audioScriptProcessor:{},preferedPop:void 0,configuration:{authorization_user:void 0,password:void 0,ws_servers:void 0,stun_servers:void 0,turn_servers:void 0,log_level:voxbone.Logger.log_level.INFO,post_logs:!1,post_logs_nocall:!1,webrtc_log:void 0,uri:"sip:voxrtc@voxbone.com",trace_sip:!0,register:!1,dialer_string:void 0,digit_duration:100,digit_gap:500},customEventHandler:{progress:function(a){},accepted:function(a){},getUserMediaFailed:function(a){voxbone.Logger.logerror("Failed to access mic/camera")},localMediaVolume:function(a){},failed:function(a){},ended:function(a){},authExpired:function(a){},getUserMediaAccepted:function(a){voxbone.Logger.loginfo("local media accepted")}},phone:void 0,context:void 0,init:function(a){voxbone.Logger.loginfo("auth server: "+this.authServerURL);var b={username:a.username,key:a.key,expires:a.expires,jsonp:"voxbone.WebRTC.processAuthData"};voxbone.Request.jsonp(this.authServerURL,b)},basicAuthInit:function(a,b){voxbone.Logger.loginfo("auth server: "+this.basicAuthServerURL);var c={username:a,key:b,jsonp:"voxbone.WebRTC.processAuthData"};voxbone.Request.jsonp(this.basicAuthServerURL,c)},processAuthData:function(a){if(this.configuration.ws_servers=a.wss,this.configuration.stun_servers=a.stunServers,this.configuration.turn_servers=a.turnServers,this.configuration.webrtc_log=a.log,this.configuration.authorization_user=a.username,this.configuration.password=a.password,"undefined"==typeof this.preferedPop){voxbone.Logger.loginfo("prefered pop undefined, pinging...."),this.pingServers=a.pingServers;for(var b=0;b<this.pingServers.length;b++)voxbone.Pinger.ping(b,this.pingServers[b])}else voxbone.Logger.loginfo("preferred pop already set to "+this.preferedPop);var c=this.getAuthExpiration();c>0&&(voxbone.Logger.loginfo("Credential expires in "+c+" seconds"),setTimeout(this.customEventHandler.authExpired,750*c));var d=a.callStatsCredentials;voxbone.WebRTC.callStats=new callstats(null,null,jsSHA);var e=function(a,b){voxbone.Logger.loginfo("callStats Status: errCode= "+a+" Msg= "+b)},f=a.username.split(":")[1];voxbone.WebRTC.callStats.initialize(d.appId,d.appSecret,f,e,null,null)},getAuthExpiration:function(a){var b=Math.floor((new Date).getTime()/1e3),c=this.configuration.authorization_user.split(/:/);return c[0]-b},initAudioElement:function(a,b){var c=document.getElementById(a);return c||(c=document.createElement("audio"),c.id=a,c.hidden=!1,c.autoplay=!0,document.body.appendChild(c)),c.src=(window.URL?URL:webkitURL).createObjectURL(b),c},initVideoElement:function(a,b){var c=document.getElementById(a);return c||(c=document.createElement("video"),c.id=a,c.hidden=!1,c.autoplay=!0,document.body.appendChild(c)),c.src=(window.URL?URL:webkitURL).createObjectURL(b),c},sendPreConfiguredDtmf:function(a){var b,c=0,d=!1;if(void 0!==voxbone.WebRTC.dtmfTimer&&(clearTimeout(voxbone.WebRTC.dtmfTimer),voxbone.WebRTC.dtmfTime=void 0),a.length>0){if(a[0].indexOf("ms")!=-1?c=parseInt(a[0].substring(0,a[0].indexOf("ms"))):b=a[0],a=a.slice(1,a.length),void 0!==b){Date.now();voxbone.WebRTC.rtcSession.sendDTMF(b),d=!0}if(a.length>0){var e=c>0?c-voxbone.WebRTC.configuration.digit_gap:voxbone.WebRTC.configuration.digit_gap+voxbone.WebRTC.configuration.digit_duration;e<0&&(e=0),voxbone.WebRTC.dtmfTimer=setTimeout(function(){voxbone.WebRTC.sendPreConfiguredDtmf(a)},e)}}},postCallRating:function(a,b,c,d){if(void 0!==voxbone.WebRTC.previous_callid){var e={payload_type:"webrtc_call_rating",username:voxbone.WebRTC.configuration.authorization_user,password:voxbone.WebRTC.configuration.password,callid:voxbone.WebRTC.previous_callid,e164:a,url:d,rating:b,comment:c},f=voxbone.WebRTC.configuration.webrtc_log;voxbone.Request.post(f,e),voxbone.WebRTC.previous_callid=void 0}},postLogsToServer:function(){if(voxbone.WebRTC.configuration.post_logs===!0&&void 0!==voxbone.WebRTC.configuration.webrtc_log){var a=voxbone.WebRTC.configuration.webrtc_log,b={payload_type:"webrtc_logs",username:voxbone.WebRTC.configuration.authorization_user,password:voxbone.WebRTC.configuration.password,callid:voxbone.WebRTC.callid,pop:voxbone.WebRTC.preferedPop,context:voxbone.WebRTC.context,uri:voxbone.WebRTC.configuration.uri,logs:voxbone.WebRTC.webrtcLogs};voxbone.Request.post(a,b)}},cleanUp:function(){void 0!==voxbone.WebRTC.localVolumeTimer&&(clearInterval(voxbone.WebRTC.localVolumeTimer),voxbone.WebRTC.localVolumeTimer=void 0),void 0!==voxbone.WebRTC.audioScriptProcessor&&(void 0!==voxbone.WebRTC.audioContext&&void 0!==voxbone.WebRTC.audioContext.destination&&voxbone.WebRTC.audioScriptProcessor.disconnect(voxbone.WebRTC.audioContext.destination),voxbone.WebRTC.audioScriptProcessor=void 0),void 0!==voxbone.WebRTC.dtmfTimer&&(clearTimeout(voxbone.WebRTC.dtmfTimer),voxbone.WebRTC.dtmfTimer=void 0),voxbone.WebRTC.cleanAudioElement(voxbone.WebRTC.audioComponentName),voxbone.WebRTC.previous_callid=voxbone.WebRTC.callid,voxbone.WebRTC.callid="",voxbone.WebRTC.webrtcLogs="",voxbone.WebRTC.rtcSession={},delete voxbone.WebRTC.phone},cleanAudioElement:function(a){var b=document.getElementById(a);return b&&(b.removeAttribute("src"),b.load()),b},call:function(a){var b=new JsSIP.URI("sip",a,"voxout.voxbone.com");void 0===this.preferedPop&&(this.preferedPop=voxbone.Pinger.getBestPop().name),voxbone.Logger.loginfo("prefered pop: ",this.preferedPop);var c=[];c.push("X-Voxbone-Pop: "+this.preferedPop),this.context&&c.push("X-Voxbone-Context: "+this.context);var d={eventHandlers:{peerconnection:function(a){var b=a.peerconnection.getLocalStreams();voxbone.Logger.loginfo("streams "+b.length);for(var c=0;c<b.length;c++)if(b[c].getAudioTracks().length>0){try{void 0===voxbone.WebRTC.audioContext&&(voxbone.WebRTC.audioContext=new AudioContext)}catch(a){voxbone.Logger.logerror("Web Audio API not supported "+a)}voxbone.WebRTC.audioScriptProcessor=voxbone.WebRTC.audioContext.createScriptProcessor(0,1,1);var d=voxbone.WebRTC.audioContext.createMediaStreamSource(b[c]);d.connect(voxbone.WebRTC.audioScriptProcessor),voxbone.WebRTC.audioScriptProcessor.connect(voxbone.WebRTC.audioContext.destination),voxbone.WebRTC.audioScriptProcessor.onaudioprocess=function(a){var b,c=a.inputBuffer.getChannelData(0),d=0;for(b=0;b<c.length;++b)d+=c[b]*c[b];voxbone.WebRTC.localVolume=Math.sqrt(d/c.length);
},voxbone.WebRTC.localVolumeTimer=setInterval(function(){var a={localVolume:voxbone.WebRTC.localVolume.toFixed(2)};voxbone.WebRTC.customEventHandler.localMediaVolume(a)},200);break}},sending:function(a){voxbone.WebRTC.callid=a.request.call_id;var b=voxbone.WebRTC.rtcSession.connection.pc,c=voxbone.WebRTC.rtcSession.remote_identity.uri.user;voxbone.WebRTC.callStats.addNewFabric(b,c,voxbone.WebRTC.callStats.fabricUsage.audio,voxbone.WebRTC.callid,null)},progress:function(a){voxbone.WebRTC.customEventHandler.progress(a)},failed:function(a){var b,c=voxbone.WebRTC.callid,d=voxbone.WebRTC.callStats;switch(voxbone.Logger.logerror("Call ("+c+") failed. Cause: "+a.cause),"undefined"!=typeof voxbone.WebRTC.rtcSession.connection&&(b=voxbone.WebRTC.rtcSession.connection.pc),a.cause){case JsSIP.C.causes.USER_DENIED_MEDIA_ACCESS:"object"==typeof b&&d.reportError(b,c,d.webRTCFunctions.getUserMedia),voxbone.WebRTC.customEventHandler.getUserMediaFailed(a);break;case JsSIP.C.causes.INCOMPATIBLE_SDP:case JsSIP.C.causes.MISSING_SDP:"object"==typeof b&&d.reportError(b,c,d.webRTCFunctions.createOffer);break;case JsSIP.C.causes.BYE:case JsSIP.C.causes.CANCELED:case JsSIP.C.causes.NO_ANSWER:case JsSIP.C.causes.EXPIRES:case JsSIP.C.causes.NO_ACK:case JsSIP.C.causes.BUSY:case JsSIP.C.causes.REJECTED:case JsSIP.C.causes.REDIRECTED:case JsSIP.C.causes.UNAVAILABLE:case JsSIP.C.causes.NOT_FOUND:"object"==typeof b&&d.reportError(b,c,d.webRTCFunctions.applicationError);break;default:"object"==typeof b&&d.reportError(b,c,d.webRTCFunctions.signalingError)}voxbone.WebRTC.postLogsToServer(),voxbone.WebRTC.cleanUp(),voxbone.WebRTC.customEventHandler.failed(a)},accepted:function(a){voxbone.WebRTC.customEventHandler.accepted(a)},addstream:function(a){voxbone.WebRTC.allowVideo?voxbone.WebRTC.initVideoElement(voxbone.WebRTC.videoComponentName,a.stream):voxbone.WebRTC.initAudioElement(voxbone.WebRTC.audioComponentName,a.stream)},confirmed:function(a){if(void 0!==voxbone.WebRTC.configuration.dialer_string&&voxbone.WebRTC.configuration.dialer_string.length>0){var b=voxbone.WebRTC.configuration.dialer_string.split(",");voxbone.WebRTC.sendPreConfiguredDtmf(b)}},ended:function(a){voxbone.WebRTC.postLogsToServer(),voxbone.WebRTC.cleanUp(),voxbone.WebRTC.customEventHandler.ended(a)}},extraHeaders:[],pcConfig:{rtcpMuxPolicy:"negotiate"},mediaConstraints:{audio:!0,video:voxbone.WebRTC.allowVideo}};if(void 0!==this.configuration.stun_servers||void 0!==this.configuration.turn_servers){var e,f=[];for(e=0;e<this.configuration.stun_servers.length;e++)f.push(this.configuration.stun_servers[e]);for(e=0;e<this.configuration.turn_servers.length;e++)f.push(this.configuration.turn_servers[e]);d.pcConfig.iceServers=f,d.pcConfig.gatheringTimeoutAfterRelay=5e3}d.pcConfig.iceCandidatePoolSize=10,d.extraHeaders=c,void 0===this.phone?(this.phone=new JsSIP.UA(this.configuration),this.phone.once("connected",function(){voxbone.WebRTC.rtcSession=voxbone.WebRTC.phone.call(b.toAor(),d)}),this.phone.on("newRTCSession",function(a){a.session.on("connecting",function(a){voxbone.WebRTC.customEventHandler.getUserMediaAccepted(a)}),a.session.on("reinvite",function(b){request=b.request;var c=["Contact: "+a.session.contact];handleSessionTimersInIncomingRequest.call(a.session,request,c),request.reply(200,null,c,null,function(){self.status=JsSIP.C.STATUS_WAITING_FOR_ACK,setInvite2xxTimer.call(a.session,request,null),setACKTimer.call(a.session)})})}),this.phone.start()):(this.phone.configuration=this.configuration,this.rtcSession=this.phone.call(b.toAor(),d))},isCallOpen:function(){return"function"==typeof voxbone.WebRTC.rtcSession.isEstablished&&"function"==typeof voxbone.WebRTC.rtcSession.isInProgress&&(voxbone.WebRTC.rtcSession.isInProgress()===!0||voxbone.WebRTC.rtcSession.isEstablished()===!0)},sendDTMF:function(a){this.rtcSession.sendDTMF(a)},hangup:function(){void 0!==this.rtcSession&&this.rtcSession.terminate()},isMuted:!1,mute:function(){for(var a=this.rtcSession.connection.getLocalStreams(),b=0;b<a.length;b++)for(var c=0;c<a[b].getAudioTracks().length;c++)a[b].getAudioTracks()[c].enabled=!1;this.isMuted=!0,voxbone.WebRTC.callStats.sendFabricEvent(this.rtcSession.connection.pc,voxbone.WebRTC.callStats.fabricEvent.audioMute,voxbone.WebRTC.callid)},unmute:function(){for(var a=this.rtcSession.connection.getLocalStreams(),b=0;b<a.length;b++)for(var c=0;c<a[b].getAudioTracks().length;c++)a[b].getAudioTracks()[c].enabled=!0;this.isMuted=!1,voxbone.WebRTC.callStats.sendFabricEvent(this.rtcSession.connection.pc,voxbone.WebRTC.callStats.fabricEvent.audioUnmute,voxbone.WebRTC.callid)},unloadHandler:function(){voxbone.WebRTC.isCallOpen()?(voxbone.Logger.loginfo("Page unloading while a call was in progress, hanging up"),voxbone.WebRTC.hangup(),voxbone.WebRTC.postLogsToServer()):voxbone.WebRTC.configuration.post_logs_nocall===!0&&voxbone.WebRTC.postLogsToServer()},isWebRTCSupported:function(){if(window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia){var a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(a){var b=new RegExp("firefox/([0-9])+"),c=new RegExp("([0-9])+"),d=b.exec(navigator.userAgent.toLowerCase())[0],e=c.exec(d)[0];if(e<23)return!1}return!0}return!1}}});
//# sourceMappingURL=voxbone-2.min.js.map